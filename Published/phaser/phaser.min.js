/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.1.1 "Eianrod" - Built: Thu Sep 11 2014 10:37:16
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser
* and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/
(function(){var t=this,n=n||{};n.WEBGL_RENDERER=0;n.CANVAS_RENDERER=1;n.VERSION="v1.6.1";n.blendModes={NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16};n.scaleModes={DEFAULT:0,LINEAR:0,NEAREST:1};n._UID=0;typeof Float32Array!="undefined"?(n.Float32Array=Float32Array,n.Uint16Array=Uint16Array):(n.Float32Array=Array,n.Uint16Array=Array);n.INTERACTION_FREQUENCY=30;n.AUTO_PREVENT_DEFAULT=!0;n.RAD_TO_DEG=180/Math.PI;n.DEG_TO_RAD=Math.PI/180;n.dontSayHello=!1;n.sayHello=function(t){if(!n.dontSayHello){if(navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var i=["%c %c %c Pixi.js "+n.VERSION+" - "+t+"  %c  %c  http://www.pixijs.com/  %c %c ♥%c♥%c♥ ","background: #ff66a5","background: #ff66a5","color: #ff66a5; background: #030307;","background: #ff66a5","background: #ffc3dc","background: #ff66a5","color: #ff2424; background: #fff","color: #ff2424; background: #fff","color: #ff2424; background: #fff"];console.log.apply(console,i)}else window.console&&console.log("Pixi.js "+n.VERSION+" - http://www.pixijs.com/");n.dontSayHello=!0}};n.Matrix=function(){this.a=1;this.b=0;this.c=0;this.d=1;this.tx=0;this.ty=0};n.Matrix.prototype.fromArray=function(n){this.a=n[0];this.b=n[1];this.c=n[3];this.d=n[4];this.tx=n[2];this.ty=n[5]};n.Matrix.prototype.toArray=function(n){this.array||(this.array=new Float32Array(9));var t=this.array;return n?(t[0]=this.a,t[1]=this.c,t[2]=0,t[3]=this.b,t[4]=this.d,t[5]=0,t[6]=this.tx,t[7]=this.ty,t[8]=1):(t[0]=this.a,t[1]=this.b,t[2]=this.tx,t[3]=this.c,t[4]=this.d,t[5]=this.ty,t[6]=0,t[7]=0,t[8]=1),t};n.Matrix.prototype.apply=function(t,i){return i=i||new n.Point,i.x=this.a*t.x+this.b*t.y+this.tx,i.y=this.c*t.x+this.d*t.y+this.ty,i};n.Matrix.prototype.applyInverse=function(t,i){i=i||new n.Point;var r=1/(this.a*this.d+this.b*-this.c);return i.x=this.d*r*t.x-this.b*r*t.y+(this.ty*this.b-this.tx*this.d)*r,i.y=this.a*r*t.y-this.c*r*t.x+(this.tx*this.c-this.ty*this.a)*r,i};n.identityMatrix=new n.Matrix;n.determineMatrixArrayType=function(){return typeof Float32Array!="undefined"?Float32Array:Array};n.Matrix2=n.determineMatrixArrayType();n.DisplayObject=function(){this.position=new n.Point;this.scale=new n.Point(1,1);this.pivot=new n.Point(0,0);this.rotation=0;this.alpha=1;this.visible=!0;this.hitArea=null;this.buttonMode=!1;this.renderable=!1;this.parent=null;this.stage=null;this.worldAlpha=1;this._interactive=!1;this.defaultCursor="pointer";this.worldTransform=new n.Matrix;this.color=[];this.dynamic=!0;this._sr=0;this._cr=1;this.filterArea=null;this._bounds=new n.Rectangle(0,0,1,1);this._currentBounds=null;this._mask=null;this._cacheAsBitmap=!1;this._cacheIsDirty=!1};n.DisplayObject.prototype.constructor=n.DisplayObject;n.DisplayObject.prototype.setInteractive=function(n){this.interactive=n};Object.defineProperty(n.DisplayObject.prototype,"interactive",{get:function(){return this._interactive},set:function(n){this._interactive=n;this.stage&&(this.stage.dirty=!0)}});Object.defineProperty(n.DisplayObject.prototype,"worldVisible",{get:function(){var n=this;do{if(!n.visible)return!1;n=n.parent}while(n);return!0}});Object.defineProperty(n.DisplayObject.prototype,"mask",{get:function(){return this._mask},set:function(n){this._mask&&(this._mask.isMask=!1);this._mask=n;this._mask&&(this._mask.isMask=!0)}});Object.defineProperty(n.DisplayObject.prototype,"filters",{get:function(){return this._filters},set:function(n){var r,t,u,i;if(n){for(r=[],t=0;t<n.length;t++)for(u=n[t].passes,i=0;i<u.length;i++)r.push(u[i]);this._filterBlock={target:this,filterPasses:r}}this._filters=n}});Object.defineProperty(n.DisplayObject.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap!==n&&(n?this._generateCachedSprite():this._destroyCachedSprite(),this._cacheAsBitmap=n)}});n.DisplayObject.prototype.updateTransform=function(){this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation));var n=this.parent.worldTransform,t=this.worldTransform,c=this.pivot.x,l=this.pivot.y,i=this._cr*this.scale.x,r=-this._sr*this.scale.y,u=this._sr*this.scale.x,f=this._cr*this.scale.y,a=this.position.x-i*c-l*r,v=this.position.y-f*l-c*u,e=n.a,o=n.b,s=n.c,h=n.d;t.a=e*i+o*u;t.b=e*r+o*f;t.tx=e*a+o*v+n.tx;t.c=s*i+h*u;t.d=s*r+h*f;t.ty=s*a+h*v+n.ty;this.worldAlpha=this.alpha*this.parent.worldAlpha};n.DisplayObject.prototype.getBounds=function(t){return t=t,n.EmptyRectangle};n.DisplayObject.prototype.getLocalBounds=function(){return this.getBounds(n.identityMatrix)};n.DisplayObject.prototype.setStageReference=function(n){this.stage=n;this._interactive&&(this.stage.dirty=!0)};n.DisplayObject.prototype.generateTexture=function(t){var i=this.getLocalBounds(),r=new n.RenderTexture(i.width|0,i.height|0,t);return r.render(this,new n.Point(-i.x,-i.y)),r};n.DisplayObject.prototype.updateCache=function(){this._generateCachedSprite()};n.DisplayObject.prototype.toGlobal=function(n){return this.updateTransform(),this.worldTransform.apply(n)};n.DisplayObject.prototype.toLocal=function(n,t){return t&&(n=t.toGlobal(n)),this.updateTransform(),this.worldTransform.applyInverse(n)};n.DisplayObject.prototype._renderCachedSprite=function(t){this._cachedSprite.worldAlpha=this.worldAlpha;t.gl?n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t):n.Sprite.prototype._renderCanvas.call(this._cachedSprite,t)};n.DisplayObject.prototype._generateCachedSprite=function(){var t,r,i;this._cacheAsBitmap=!1;t=this.getLocalBounds();this._cachedSprite?this._cachedSprite.texture.resize(t.width|0,t.height|0):(r=new n.RenderTexture(t.width|0,t.height|0),this._cachedSprite=new n.Sprite(r),this._cachedSprite.worldTransform=this.worldTransform);i=this._filters;this._filters=null;this._cachedSprite.filters=i;this._cachedSprite.texture.render(this,new n.Point(-t.x,-t.y));this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._filters=i;this._cacheAsBitmap=!0};n.DisplayObject.prototype._destroyCachedSprite=function(){this._cachedSprite&&(this._cachedSprite.texture.destroy(!0),this._cachedSprite=null)};n.DisplayObject.prototype._renderWebGL=function(n){n=n};n.DisplayObject.prototype._renderCanvas=function(n){n=n};Object.defineProperty(n.DisplayObject.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.DisplayObject.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.DisplayObjectContainer=function(){n.DisplayObject.call(this);this.children=[]};n.DisplayObjectContainer.prototype=Object.create(n.DisplayObject.prototype);n.DisplayObjectContainer.prototype.constructor=n.DisplayObjectContainer;Object.defineProperty(n.DisplayObjectContainer.prototype,"width",{get:function(){return this.scale.x*this.getLocalBounds().width},set:function(n){var t=this.getLocalBounds().width;this.scale.x=t!==0?n/(t/this.scale.x):1;this._width=n}});Object.defineProperty(n.DisplayObjectContainer.prototype,"height",{get:function(){return this.scale.y*this.getLocalBounds().height},set:function(n){var t=this.getLocalBounds().height;this.scale.y=t!==0?n/(t/this.scale.y):1;this._height=n}});n.DisplayObjectContainer.prototype.addChild=function(n){return this.addChildAt(n,this.children.length)};n.DisplayObjectContainer.prototype.addChildAt=function(n,t){if(t>=0&&t<=this.children.length)return n.parent&&n.parent.removeChild(n),n.parent=this,this.children.splice(t,0,n),this.stage&&n.setStageReference(this.stage),n;throw new Error(n+" The index "+t+" supplied is out of bounds "+this.children.length);};n.DisplayObjectContainer.prototype.swapChildren=function(n,t){if(n!==t){var i=this.children.indexOf(n),r=this.children.indexOf(t);if(i<0||r<0)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[i]=t;this.children[r]=n}};n.DisplayObjectContainer.prototype.getChildAt=function(n){if(n>=0&&n<this.children.length)return this.children[n];throw new Error("Supplied index does not exist in the child list, or the supplied DisplayObject must be a child of the caller");};n.DisplayObjectContainer.prototype.removeChild=function(n){return this.removeChildAt(this.children.indexOf(n))};n.DisplayObjectContainer.prototype.removeChildAt=function(n){var t=this.getChildAt(n);return this.stage&&t.removeStageReference(),t.parent=undefined,this.children.splice(n,1),t};n.DisplayObjectContainer.prototype.removeChildren=function(n,t){var e=n||0,o=typeof t=="number"?t:this.children.length,i=o-e,r,u,f;if(i>0&&i<=o){for(r=this.children.splice(e,i),u=0;u<r.length;u++)f=r[u],this.stage&&f.removeStageReference(),f.parent=undefined;return r}if(i===0&&this.children.length===0)return[];throw new Error("Range Error, numeric values are outside the acceptable range");};n.DisplayObjectContainer.prototype.updateTransform=function(){if(this.visible&&(n.DisplayObject.prototype.updateTransform.call(this),!this._cacheAsBitmap))for(var t=0,i=this.children.length;t<i;t++)this.children[t].updateTransform()};n.DisplayObjectContainer.prototype.getBounds=function(t){var l,e,v,y,r;if(this.children.length===0)return n.EmptyRectangle;t&&(l=this.worldTransform,this.worldTransform=t,this.updateTransform(),this.worldTransform=l);var u=Infinity,f=Infinity,o=-Infinity,s=-Infinity,i,h,c,a=!1;for(e=0,v=this.children.length;e<v;e++)(y=this.children[e],y.visible)&&(a=!0,i=this.children[e].getBounds(t),u=u<i.x?u:i.x,f=f<i.y?f:i.y,h=i.width+i.x,c=i.height+i.y,o=o>h?o:h,s=s>c?s:c);return a?(r=this._bounds,r.x=u,r.y=f,r.width=o-u,r.height=s-f,r):n.EmptyRectangle};n.DisplayObjectContainer.prototype.getLocalBounds=function(){var u=this.worldTransform,t,i,r;for(this.worldTransform=n.identityMatrix,t=0,i=this.children.length;t<i;t++)this.children[t].updateTransform();return r=this.getBounds(),this.worldTransform=u,r};n.DisplayObjectContainer.prototype.setStageReference=function(n){var t,i,r;for(this.stage=n,this._interactive&&(this.stage.dirty=!0),t=0,i=this.children.length;t<i;t++)r=this.children[t],r.setStageReference(n)};n.DisplayObjectContainer.prototype.removeStageReference=function(){for(var i,n=0,t=this.children.length;n<t;n++)i=this.children[n],i.removeStageReference();this._interactive&&(this.stage.dirty=!0);this.stage=null};n.DisplayObjectContainer.prototype._renderWebGL=function(n){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}var t,i;if(this._mask||this._filters){for(this._filters&&(n.spriteBatch.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(n.spriteBatch.stop(),n.maskManager.pushMask(this.mask,n),n.spriteBatch.start()),t=0,i=this.children.length;t<i;t++)this.children[t]._renderWebGL(n);n.spriteBatch.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();n.spriteBatch.start()}else for(t=0,i=this.children.length;t<i;t++)this.children[t]._renderWebGL(n)}};n.DisplayObjectContainer.prototype._renderCanvas=function(n){var t,i,r;if(this.visible!==!1&&this.alpha!==0){if(this._cacheAsBitmap){this._renderCachedSprite(n);return}for(this._mask&&n.maskManager.pushMask(this._mask,n.context),t=0,i=this.children.length;t<i;t++)r=this.children[t],r._renderCanvas(n);this._mask&&n.maskManager.popMask(n.context)}};n.Sprite=function(t){n.DisplayObjectContainer.call(this);this.anchor=new n.Point;this.texture=t;this._width=0;this._height=0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL;t.baseTexture.hasLoaded?this.onTextureUpdate():(this.onTextureUpdateBind=this.onTextureUpdate.bind(this),this.texture.addEventListener("update",this.onTextureUpdateBind));this.renderable=!0};n.Sprite.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Sprite.prototype.constructor=n.Sprite;Object.defineProperty(n.Sprite.prototype,"width",{get:function(){return this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Sprite.prototype,"height",{get:function(){return this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Sprite.prototype.setTexture=function(n){this.texture=n;this.cachedTint=16777215};n.Sprite.prototype.onTextureUpdate=function(){this._width&&(this.scale.x=this._width/this.texture.frame.width);this._height&&(this.scale.y=this._height/this.texture.frame.height)};n.Sprite.prototype.getBounds=function(n){var ut=this.texture.frame.width,ft=this.texture.frame.height,o=ut*(1-this.anchor.x),s=ut*-this.anchor.x,h=ft*(1-this.anchor.y),c=ft*-this.anchor.y,e=n||this.worldTransform,l=e.a,a=e.c,v=e.b,y=e.d,p=e.tx,w=e.ty,b=l*s+v*c+p,k=y*c+a*s+w,d=l*o+v*c+p,g=y*c+a*o+w,nt=l*o+v*h+p,tt=y*h+a*o+w,it=l*s+v*h+p,rt=y*h+a*s+w,r=-Infinity,u=-Infinity,t=Infinity,i=Infinity,f;return t=b<t?b:t,t=d<t?d:t,t=nt<t?nt:t,t=it<t?it:t,i=k<i?k:i,i=g<i?g:i,i=tt<i?tt:i,i=rt<i?rt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,r=it>r?it:r,u=k>u?k:u,u=g>u?g:u,u=tt>u?tt:u,u=rt>u?rt:u,f=this._bounds,f.x=t,f.width=r-t,f.y=i,f.height=u-i,this._currentBounds=f,f};n.Sprite.prototype._renderWebGL=function(n){var t,r,i;if(this.visible&&!(this.alpha<=0))if(this._mask||this._filters){for(i=n.spriteBatch,this._filters&&(i.flush(),n.filterManager.pushFilter(this._filterBlock)),this._mask&&(i.stop(),n.maskManager.pushMask(this.mask,n),i.start()),i.render(this),t=0,r=this.children.length;t<r;t++)this.children[t]._renderWebGL(n);i.stop();this._mask&&n.maskManager.popMask(this._mask,n);this._filters&&n.filterManager.popFilter();i.start()}else for(n.spriteBatch.render(this),t=0,r=this.children.length;t<r;t++)this.children[t]._renderWebGL(n)};n.Sprite.prototype._renderCanvas=function(t){var r,u,i,f;if(this.visible!==!1&&this.alpha!==0&&!(this.texture.crop.width<=0)&&!(this.texture.crop.height<=0)){for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,t.context.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t.context),this.texture.valid&&(t.context.globalAlpha=this.worldAlpha,t.roundPixels?t.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx|0,this.worldTransform.ty|0):t.context.setTransform(this.worldTransform.a,this.worldTransform.c,this.worldTransform.b,this.worldTransform.d,this.worldTransform.tx,this.worldTransform.ty),t.smoothProperty&&t.scaleMode!==this.texture.baseTexture.scaleMode&&(t.scaleMode=this.texture.baseTexture.scaleMode,t.context[t.smoothProperty]=t.scaleMode===n.scaleModes.LINEAR),r=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,u=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,this.tint!==16777215?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=n.CanvasTinter.getTintedTexture(this,this.tint)),t.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,r,u,this.texture.crop.width,this.texture.crop.height)):t.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,r,u,this.texture.crop.width,this.texture.crop.height)),i=0,f=this.children.length;i<f;i++)this.children[i]._renderCanvas(t);this._mask&&t.maskManager.popMask(t.context)}};n.Sprite.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache'+this);return new n.Sprite(i)};n.Sprite.fromImage=function(t,i,r){var u=n.Texture.fromImage(t,i,r);return new n.Sprite(u)};n.SpriteBatch=function(t){n.DisplayObjectContainer.call(this);this.textureThing=t;this.ready=!1};n.SpriteBatch.prototype=Object.create(n.DisplayObjectContainer.prototype);n.SpriteBatch.constructor=n.SpriteBatch;n.SpriteBatch.prototype.initWebGL=function(t){this.fastSpriteBatch=new n.WebGLFastSpriteBatch(t);this.ready=!0};n.SpriteBatch.prototype.updateTransform=function(){n.DisplayObject.prototype.updateTransform.call(this)};n.SpriteBatch.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||!this.children.length||(this.ready||this.initWebGL(n.gl),n.spriteBatch.stop(),n.shaderManager.setShader(n.shaderManager.fastShader),this.fastSpriteBatch.begin(this,n),this.fastSpriteBatch.render(this),n.spriteBatch.start())};n.SpriteBatch.prototype._renderCanvas=function(t){var f=t.context,e,o,s,i,h,r,u;for(f.globalAlpha=this.worldAlpha,n.DisplayObject.prototype.updateTransform.call(this),e=this.worldTransform,o=!0,s=0;s<this.children.length;s++)(i=this.children[s],i.visible)&&(h=i.texture,r=h.frame,f.globalAlpha=this.worldAlpha*i.alpha,i.rotation%(Math.PI*2)==0?(o&&(f.setTransform(e.a,e.c,e.b,e.d,e.tx,e.ty),o=!1),f.drawImage(h.baseTexture.source,r.x,r.y,r.width,r.height,i.anchor.x*-r.width*i.scale.x+i.position.x+.5|0,i.anchor.y*-r.height*i.scale.y+i.position.y+.5|0,r.width*i.scale.x,r.height*i.scale.y)):(o||(o=!0),n.DisplayObject.prototype.updateTransform.call(i),u=i.worldTransform,t.roundPixels?f.setTransform(u.a,u.c,u.b,u.d,u.tx|0,u.ty|0):f.setTransform(u.a,u.c,u.b,u.d,u.tx,u.ty),f.drawImage(h.baseTexture.source,r.x,r.y,r.width,r.height,i.anchor.x*-r.width+.5|0,i.anchor.y*-r.height+.5|0,r.width,r.height)))};n.AbstractFilter=function(n,t){this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms=t||{};this.fragmentSrc=n||[]};n.FilterBlock=function(){this.visible=!0;this.renderable=!0};n.Text=function(t,i){this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");n.Sprite.call(this,n.Texture.fromCanvas(this.canvas));this.setText(t);this.setStyle(i)};n.Text.prototype=Object.create(n.Sprite.prototype);n.Text.prototype.constructor=n.Text;Object.defineProperty(n.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width},set:function(n){this.scale.x=n/this.texture.frame.width;this._width=n}});Object.defineProperty(n.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height},set:function(n){this.scale.y=n/this.texture.frame.height;this._height=n}});n.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;n.dropShadow=n.dropShadow||!1;n.dropShadowAngle=n.dropShadowAngle||Math.PI/6;n.dropShadowDistance=n.dropShadowDistance||4;n.dropShadowColor=n.dropShadowColor||"black";this.style=n;this.dirty=!0};n.Text.prototype.setText=function(n){this.text=n.toString()||" ";this.dirty=!0};n.Text.prototype.updateText=function(){var o,n,s,h,e,c,t,f,l,a;this.context.font=this.style.font;o=this.text;this.style.wordWrap&&(o=this.wordWrap(this.text));var i=o.split(/(?:\r\n|\r|\n)/),u=[],r=0;for(n=0;n<i.length;n++)s=this.context.measureText(i[n]).width,u[n]=s,r=Math.max(r,s);if(h=r+this.style.strokeThickness,this.style.dropShadow&&(h+=this.style.dropShadowDistance),this.canvas.width=h+this.context.lineWidth,e=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness,c=e*i.length,this.style.dropShadow&&(c+=this.style.dropShadowDistance),this.canvas.height=c,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.textBaseline="top",this.style.dropShadow)for(this.context.fillStyle=this.style.dropShadowColor,l=Math.sin(this.style.dropShadowAngle)*this.style.dropShadowDistance,a=Math.cos(this.style.dropShadowAngle)*this.style.dropShadowDistance,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e,this.style.align==="right"?t+=r-u[n]:this.style.align==="center"&&(t+=(r-u[n])/2),this.style.fill&&this.context.fillText(i[n],t+l,f+a);for(this.context.fillStyle=this.style.fill,n=0;n<i.length;n++)t=this.style.strokeThickness/2,f=this.style.strokeThickness/2+n*e,this.style.align==="right"?t+=r-u[n]:this.style.align==="center"&&(t+=(r-u[n])/2),this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t,f),this.style.fill&&this.context.fillText(i[n],t,f);this.updateTexture()};n.Text.prototype.updateTexture=function(){this.texture.baseTexture.width=this.canvas.width;this.texture.baseTexture.height=this.canvas.height;this.texture.crop.width=this.texture.frame.width=this.canvas.width;this.texture.crop.height=this.texture.frame.height=this.canvas.height;this._width=this.canvas.width;this._height=this.canvas.height;this.requiresUpdate=!0};n.Text.prototype._renderWebGL=function(t){this.requiresUpdate&&(this.requiresUpdate=!1,n.updateWebGLTexture(this.texture.baseTexture,t.gl));n.Sprite.prototype._renderWebGL.call(this,t)};n.Text.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);n.Sprite.prototype.updateTransform.call(this)};n.Text.prototype.determineFontHeight=function(t){var r=n.Text.heightCache[t];if(!r){var u=document.getElementsByTagName("body")[0],i=document.createElement("div"),f=document.createTextNode("M");i.appendChild(f);i.setAttribute("style",t+";position:absolute;top:0;left:0");u.appendChild(i);r=i.offsetHeight;n.Text.heightCache[t]=r;u.removeChild(i)}return r};n.Text.prototype.wordWrap=function(n){for(var f,r,t,o,s,i="",e=n.split("\n"),u=0;u<e.length;u++){for(f=this.style.wordWrapWidth,r=e[u].split(" "),t=0;t<r.length;t++)o=this.context.measureText(r[t]).width,s=o+this.context.measureText(" ").width,t===0||s>f?(t>0&&(i+="\n"),i+=r[t],f=this.style.wordWrapWidth-o):(f-=s,i+=" "+r[t]);u<e.length-1&&(i+="\n")}return i};n.Text.prototype.destroy=function(n){this.context=null;this.canvas=null;this.texture.destroy(n===undefined?!0:n)};n.Text.heightCache={};n.BitmapText=function(t,i){n.DisplayObjectContainer.call(this);this._pool=[];this.setText(t);this.setStyle(i);this.updateText();this.dirty=!1};n.BitmapText.prototype=Object.create(n.DisplayObjectContainer.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.BitmapText.prototype.setText=function(n){this.text=n||" ";this.dirty=!0};n.BitmapText.prototype.setStyle=function(t){t=t||{};t.align=t.align||"left";this.style=t;var i=t.font.split(" ");this.fontName=i[i.length-1];this.fontSize=i.length>=2?parseInt(i[i.length-2],10):n.BitmapText.fonts[this.fontName].size;this.dirty=!0;this.tint=t.tint};n.BitmapText.prototype.updateText=function(){for(var l,u,y,a,r,p,h=n.BitmapText.fonts[this.fontName],i=new n.Point,o=null,f=[],e=0,c=[],v=0,s=this.fontSize/h.size,t=0;t<this.text.length;t++){if(l=this.text.charCodeAt(t),/(?:\r\n|\r|\n)/.test(this.text.charAt(t))){c.push(i.x);e=Math.max(e,i.x);v++;i.x=0;i.y+=h.lineHeight;o=null;continue}(u=h.chars[l],u)&&(o&&u[o]&&(i.x+=u.kerning[o]),f.push({texture:u.texture,line:v,charCode:l,position:new n.Point(i.x+u.xOffset,i.y+u.yOffset)}),i.x+=u.xAdvance,o=l)}for(c.push(i.x),e=Math.max(e,i.x),y=[],t=0;t<=v;t++)a=0,this.style.align==="right"?a=e-c[t]:this.style.align==="center"&&(a=(e-c[t])/2),y.push(a);var b=this.children.length,w=f.length,k=this.tint||16777215;for(t=0;t<w;t++)r=t<b?this.children[t]:this._pool.pop(),r?r.setTexture(f[t].texture):r=new n.Sprite(f[t].texture),r.position.x=(f[t].position.x+y[f[t].line])*s,r.position.y=f[t].position.y*s,r.scale.x=r.scale.y=s,r.tint=k,r.parent||this.addChild(r);while(this.children.length>w)p=this.getChildAt(this.children.length-1),this._pool.push(p),this.removeChild(p);this.textWidth=e*s;this.textHeight=(i.y+h.lineHeight)*s};n.BitmapText.prototype.updateTransform=function(){this.dirty&&(this.updateText(),this.dirty=!1);n.DisplayObjectContainer.prototype.updateTransform.call(this)};n.BitmapText.fonts={};n.Stage=function(t){n.DisplayObjectContainer.call(this);this.worldTransform=new n.Matrix;this.interactive=!0;this.interactionManager=new n.InteractionManager(this);this.dirty=!0;this.stage=this;this.stage.hitArea=new n.Rectangle(0,0,1e5,1e5);this.setBackgroundColor(t)};n.Stage.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.setInteractionDelegate=function(n){this.interactionManager.setTargetDomElement(n)};n.Stage.prototype.updateTransform=function(){this.worldAlpha=1;for(var n=0,t=this.children.length;n<t;n++)this.children[n].updateTransform();this.dirty&&(this.dirty=!1,this.interactionManager.dirty=!0);this.interactive&&this.interactionManager.update()};n.Stage.prototype.setBackgroundColor=function(t){this.backgroundColor=t||0;this.backgroundColorSplit=n.hex2rgb(this.backgroundColor);var i=this.backgroundColor.toString(16);i="000000".substr(0,6-i.length)+i;this.backgroundColorString="#"+i};n.Stage.prototype.getMousePosition=function(){return this.interactionManager.mouse.global},function(n){for(var r=0,i=["ms","moz","webkit","o"],t=0;t<i.length&&!n.requestAnimationFrame;++t)n.requestAnimationFrame=n[i[t]+"RequestAnimationFrame"],n.cancelAnimationFrame=n[i[t]+"CancelAnimationFrame"]||n[i[t]+"CancelRequestAnimationFrame"];n.requestAnimationFrame||(n.requestAnimationFrame=function(t){var i=(new Date).getTime(),u=Math.max(0,16-(i-r)),f=n.setTimeout(function(){t(i+u)},u);return r=i+u,f});n.cancelAnimationFrame||(n.cancelAnimationFrame=function(n){clearTimeout(n)});n.requestAnimFrame=n.requestAnimationFrame}(this);n.hex2rgb=function(n){return[(n>>16&255)/255,(n>>8&255)/255,(n&255)/255]};n.rgb2hex=function(n){return(n[0]*255<<16)+(n[1]*255<<8)+n[2]*255};typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){return function(n){function u(){for(var t=arguments.length,f=new Array(t);t--;)f[t]=arguments[t];f=r.concat(f);i.apply(this instanceof u?this:n,f)}var i=this,t=arguments.length-1,r=[];if(t>0)for(r.length=t;t--;)r[t]=arguments[t+1];if(typeof i!="function")throw new TypeError;return u.prototype=function f(n){return n&&(f.prototype=n),(this instanceof f)?void 0:new f}(i.prototype),u}}());n.AjaxRequest=function(){var t=["Msxml2.XMLHTTP.6.0","Msxml2.XMLHTTP.3.0","Microsoft.XMLHTTP"],n;if(window.ActiveXObject)for(n=0;n<t.length;n++)try{return new window.ActiveXObject(t[n])}catch(i){}else return window.XMLHttpRequest?new window.XMLHttpRequest:!1};n.canUseNewCanvasBlendModes=function(){var t,n;return typeof document=="undefined"?!1:(t=document.createElement("canvas"),t.width=1,t.height=1,n=t.getContext("2d"),n.fillStyle="#000",n.fillRect(0,0,1,1),n.globalCompositeOperation="multiply",n.fillStyle="#fff",n.fillRect(0,0,1,1),n.getImageData(0,0,1,1).data[0]===0)};n.getNextPowerOfTwo=function(n){if(n>0&&(n&n-1)==0)return n;for(var t=1;t<n;)t<<=1;return t};n.EventTarget=function(){var n={};this.addEventListener=this.on=function(t,i){n[t]===undefined&&(n[t]=[]);n[t].indexOf(i)===-1&&n[t].unshift(i)};this.dispatchEvent=this.emit=function(t){if(n[t.type]&&n[t.type].length)for(var i=n[t.type].length-1;i>=0;i--)n[t.type][i](t)};this.removeEventListener=this.off=function(t,i){if(n[t]!==undefined){var r=n[t].indexOf(i);r!==-1&&n[t].splice(r,1)}};this.removeAllEventListeners=function(t){var i=n[t];i&&(i.length=0)}};n.PolyK={};n.PolyK.Triangulate=function(t){var a=!0,e=t.length>>1,o,r,i,u,l,f;if(e<3)return[];for(o=[],r=[],i=0;i<e;i++)r.push(i);for(i=0,u=e;u>3;){var s=r[(i+0)%u],h=r[(i+1)%u],c=r[(i+2)%u],y=t[2*s],p=t[2*s+1],w=t[2*h],b=t[2*h+1],k=t[2*c],d=t[2*c+1],v=!1;if(n.PolyK._convex(y,p,w,b,k,d,a))for(v=!0,l=0;l<u;l++)if((f=r[l],f!==s&&f!==h&&f!==c)&&n.PolyK._PointInTriangle(t[2*f],t[2*f+1],y,p,w,b,k,d)){v=!1;break}if(v)o.push(s,h,c),r.splice((i+1)%u,1),u--,i=0;else if(i++>3*u)if(a){for(o=[],r=[],i=0;i<e;i++)r.push(i);i=0;u=e;a=!1}else return window.console.log("PIXI Warning: shape too complex to fill"),[]}return o.push(r[0],r[1],r[2]),o};n.PolyK._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1};n.PolyK._convex=function(n,t,i,r,u,f,e){return(t-r)*(u-i)+(i-n)*(f-r)>=0===e};n.initDefaultShaders=function(){};n.CompileVertexShader=function(t,i){return n._CompileShader(t,i,t.VERTEX_SHADER)};n.CompileFragmentShader=function(t,i){return n._CompileShader(t,i,t.FRAGMENT_SHADER)};n._CompileShader=function(n,t,i){var u=t.join("\n"),r=n.createShader(i);return(n.shaderSource(r,u),n.compileShader(r),!n.getShaderParameter(r,n.COMPILE_STATUS))?(window.console.log(n.getShaderInfoLog(r)),null):r};n.compileProgram=function(t,i,r){var f=n.CompileFragmentShader(t,r),e=n.CompileVertexShader(t,i),u=t.createProgram();return t.attachShader(u,e),t.attachShader(u,f),t.linkProgram(u),t.getProgramParameter(u,t.LINK_STATUS)||window.console.log("Could not initialise shaders"),u};n.PixiShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.textureCount=0;this.attributes=[];this.init()};n.PixiShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc||n.PixiShader.defaultVertexSrc,this.fragmentSrc),r;t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute];for(r in this.uniforms)this.uniforms[r].uniformLocation=t.getUniformLocation(i,r);this.initUniforms();this.program=i};n.PixiShader.prototype.initUniforms=function(){var i,t,r,n;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],n=t.type,n==="sampler2D"?(t._init=!1,t.value!==null&&this.initSampler2D(t)):n==="mat2"||n==="mat3"||n==="mat4"?(t.glMatrix=!0,t.glValueLength=1,n==="mat2"?t.glFunc=i.uniformMatrix2fv:n==="mat3"?t.glFunc=i.uniformMatrix3fv:n==="mat4"&&(t.glFunc=i.uniformMatrix4fv)):(t.glFunc=i["uniform"+n],t.glValueLength=n==="2f"||n==="2i"?2:n==="3f"||n==="3i"?3:n==="4f"||n==="4i"?4:1)};n.PixiShader.prototype.initSampler2D=function(n){var t;if(n.value&&n.value.baseTexture&&n.value.baseTexture.hasLoaded){if(t=this.gl,t.activeTexture(t["TEXTURE"+this.textureCount]),t.bindTexture(t.TEXTURE_2D,n.value.baseTexture._glTextures[t.id]),n.textureData){var i=n.textureData,e=i.magFilter?i.magFilter:t.LINEAR,o=i.minFilter?i.minFilter:t.LINEAR,u=i.wrapS?i.wrapS:t.CLAMP_TO_EDGE,f=i.wrapT?i.wrapT:t.CLAMP_TO_EDGE,r=i.luminance?t.LUMINANCE:t.RGBA;if(i.repeat&&(u=t.REPEAT,f=t.REPEAT),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!!i.flipY),i.width){var s=i.width?i.width:512,h=i.height?i.height:2,c=i.border?i.border:0;t.texImage2D(t.TEXTURE_2D,0,r,s,h,c,r,t.UNSIGNED_BYTE,null)}else t.texImage2D(t.TEXTURE_2D,0,r,t.RGBA,t.UNSIGNED_BYTE,n.value.baseTexture.source);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,o);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,u);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,f)}t.uniform1i(n.uniformLocation,this.textureCount);n._init=!0;this.textureCount++}};n.PixiShader.prototype.syncUniforms=function(){var t,i,r;this.textureCount=1;i=this.gl;for(r in this.uniforms)t=this.uniforms[r],t.glValueLength===1?t.glMatrix===!0?t.glFunc.call(i,t.uniformLocation,t.transpose,t.value):t.glFunc.call(i,t.uniformLocation,t.value):t.glValueLength===2?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y):t.glValueLength===3?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z):t.glValueLength===4?t.glFunc.call(i,t.uniformLocation,t.value.x,t.value.y,t.value.z,t.value.w):t.type==="sampler2D"&&(t._init?(i.activeTexture(i["TEXTURE"+this.textureCount]),i.bindTexture(i.TEXTURE_2D,t.value.baseTexture._glTextures[i.id]||n.createWebGLTexture(t.value.baseTexture,i)),i.uniform1i(t.uniformLocation,this.textureCount),this.textureCount++):this.initSampler2D(t))};n.PixiShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.PixiShader.defaultVertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vec3 color = mod(vec3(aColor.y/65536.0, aColor.y/256.0, aColor.y), 256.0) / 256.0;","   vColor = vec4(color * aColor.x, aColor.x);","}"];n.PixiFastShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision lowp float;","varying vec2 vTextureCoord;","varying float vColor;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vTextureCoord) * vColor ;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aPositionCoord;","attribute vec2 aScale;","attribute float aRotation;","attribute vec2 aTextureCoord;","attribute float aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform mat3 uMatrix;","varying vec2 vTextureCoord;","varying float vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   vec2 v;","   vec2 sv = aVertexPosition * aScale;","   v.x = (sv.x) * cos(aRotation) - (sv.y) * sin(aRotation);","   v.y = (sv.x) * sin(aRotation) + (sv.y) * cos(aRotation);","   v = ( uMatrix * vec3(v + aPositionCoord , 1.0) ).xy ;","   gl_Position = vec4( ( v / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = aColor;","}"];this.textureCount=0;this.init()};n.PixiFastShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.dimensions=t.getUniformLocation(i,"dimensions");this.uMatrix=t.getUniformLocation(i,"uMatrix");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aPositionCoord=t.getAttribLocation(i,"aPositionCoord");this.aScale=t.getAttribLocation(i,"aScale");this.aRotation=t.getAttribLocation(i,"aRotation");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.colorAttribute=t.getAttribLocation(i,"aColor");this.colorAttribute===-1&&(this.colorAttribute=2);this.attributes=[this.aVertexPosition,this.aPositionCoord,this.aScale,this.aRotation,this.aTextureCoord,this.colorAttribute];this.program=i};n.PixiFastShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.StripShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform float alpha;","uniform sampler2D uSampler;","void main(void) {","   gl_FragColor = texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y));","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","}"];this.init()};n.StripShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.uSampler=t.getUniformLocation(i,"uSampler");this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.colorAttribute=t.getAttribLocation(i,"aColor");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.aTextureCoord=t.getAttribLocation(i,"aTextureCoord");this.attributes=[this.aVertexPosition,this.aTextureCoord];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.StripShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.PrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec4 aColor;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float alpha;","uniform vec3 tint;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = aColor * vec4(tint * alpha, alpha);","}"];this.init()};n.PrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.colorAttribute=t.getAttribLocation(i,"aColor");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.PrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attributes=null};n.ComplexPrimitiveShader=function(t){this._UID=n._UID++;this.gl=t;this.program=null;this.fragmentSrc=["precision mediump float;","varying vec4 vColor;","void main(void) {","   gl_FragColor = vColor;","}"];this.vertexSrc=["attribute vec2 aVertexPosition;","uniform mat3 translationMatrix;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform vec3 tint;","uniform float alpha;","uniform vec3 color;","varying vec4 vColor;","void main(void) {","   vec3 v = translationMatrix * vec3(aVertexPosition , 1.0);","   v -= offsetVector.xyx;","   gl_Position = vec4( v.x / projectionVector.x -1.0, v.y / -projectionVector.y + 1.0 , 0.0, 1.0);","   vColor = vec4(color * alpha * tint, alpha);","}"];this.init()};n.ComplexPrimitiveShader.prototype.init=function(){var t=this.gl,i=n.compileProgram(t,this.vertexSrc,this.fragmentSrc);t.useProgram(i);this.projectionVector=t.getUniformLocation(i,"projectionVector");this.offsetVector=t.getUniformLocation(i,"offsetVector");this.tintColor=t.getUniformLocation(i,"tint");this.color=t.getUniformLocation(i,"color");this.aVertexPosition=t.getAttribLocation(i,"aVertexPosition");this.attributes=[this.aVertexPosition,this.colorAttribute];this.translationMatrix=t.getUniformLocation(i,"translationMatrix");this.alpha=t.getUniformLocation(i,"alpha");this.program=i};n.ComplexPrimitiveShader.prototype.destroy=function(){this.gl.deleteProgram(this.program);this.uniforms=null;this.gl=null;this.attribute=null};n.WebGLGraphics=function(){};n.WebGLGraphics.renderGraphics=function(t,i){var r=i.gl,s=i.projection,h=i.offset,u=i.shaderManager.primitiveShader,f,o,e;for(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),o=t._webGL[r.id],e=0;e<o.data.length;e++)o.data[e].mode===1?(f=o.data[e],i.stencilManager.pushStencil(t,f,i),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(f.indices.length-4)*2),i.stencilManager.popStencil(t,f,i)):(f=o.data[e],i.shaderManager.setShader(u),u=i.shaderManager.primitiveShader,r.uniformMatrix3fv(u.translationMatrix,!1,t.worldTransform.toArray(!0)),r.uniform2f(u.projectionVector,s.x,-s.y),r.uniform2f(u.offsetVector,-h.x,-h.y),r.uniform3fv(u.tintColor,n.hex2rgb(t.tint)),r.uniform1f(u.alpha,t.worldAlpha),r.bindBuffer(r.ARRAY_BUFFER,f.buffer),r.vertexAttribPointer(u.aVertexPosition,2,r.FLOAT,!1,24,0),r.vertexAttribPointer(u.colorAttribute,4,r.FLOAT,!1,24,8),r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,f.indexBuffer),r.drawElements(r.TRIANGLE_STRIP,f.indices.length,r.UNSIGNED_SHORT,0))};n.WebGLGraphics.updateGraphics=function(t,i){var u=t._webGL[i.id],e,o,f,r;if(u||(u=t._webGL[i.id]={lastIndex:0,data:[],gl:i}),t.dirty=!1,t.clearDirty){for(t.clearDirty=!1,e=0;e<u.data.length;e++)o=u.data[e],o.reset(),n.WebGLGraphics.graphicsDataPool.push(o);u.data=[];u.lastIndex=0}for(e=u.lastIndex;e<t.graphicsData.length;e++)r=t.graphicsData[e],r.type===n.Graphics.POLY?(r.fill&&r.points.length>6&&(r.points.length>10?(f=n.WebGLGraphics.switchMode(u,1),n.WebGLGraphics.buildComplexPoly(r,f)):(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildPoly(r,f))),r.lineWidth>0&&(f=n.WebGLGraphics.switchMode(u,0),n.WebGLGraphics.buildLine(r,f))):(f=n.WebGLGraphics.switchMode(u,0),r.type===n.Graphics.RECT?n.WebGLGraphics.buildRectangle(r,f):r.type===n.Graphics.CIRC||r.type===n.Graphics.ELIP?n.WebGLGraphics.buildCircle(r,f):r.type===n.Graphics.RREC&&n.WebGLGraphics.buildRoundedRectangle(r,f)),u.lastIndex++;for(e=0;e<u.data.length;e++)f=u.data[e],f.dirty&&f.upload()};n.WebGLGraphics.switchMode=function(t,i){var r;return t.data.length?(r=t.data[t.data.length-1],(r.mode!==i||i===1)&&(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r))):(r=n.WebGLGraphics.graphicsDataPool.pop()||new n.WebGLGraphicsData(t.gl),r.mode=i,t.data.push(r)),r.dirty=!0,r};n.WebGLGraphics.buildRectangle=function(t,i){var s=t.points,r=s[0],u=s[1],h=s[2],c=s[3],p;if(t.fill){var y=n.hex2rgb(t.fillColor),e=t.fillAlpha,l=y[0]*e,a=y[1]*e,v=y[2]*e,f=i.points,w=i.indices,o=f.length/6;f.push(r,u);f.push(l,a,v,e);f.push(r+h,u);f.push(l,a,v,e);f.push(r,u+c);f.push(l,a,v,e);f.push(r+h,u+c);f.push(l,a,v,e);w.push(o,o,o+1,o+2,o+3,o+3)}t.lineWidth&&(p=t.points,t.points=[r,u,r+h,u,r+h,u+c,r,u+c,r,u],n.WebGLGraphics.buildLine(t,i),t.points=p)};n.WebGLGraphics.buildRoundedRectangle=function(t,i){var l=t.points,u=l[0],f=l[1],s=l[2],h=l[3],o=l[4],r=[],b;if(r.push(u,f+o),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u,f+h-o,u,f+h,u+o,f+h)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s-o,f+h,u+s,f+h,u+s,f+h-o)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+s,f+o,u+s,f,u+s-o,f)),r=r.concat(n.WebGLGraphics.quadraticBezierCurve(u+o,f,u,f,u,f+o)),t.fill){for(var p=n.hex2rgb(t.fillColor),y=t.fillAlpha,k=p[0]*y,d=p[1]*y,g=p[2]*y,w=i.points,a=i.indices,v=w.length/6,c=n.PolyK.Triangulate(r),e=0,e=0;e<c.length;e+=3)a.push(c[e]+v),a.push(c[e]+v),a.push(c[e+1]+v),a.push(c[e+2]+v),a.push(c[e+2]+v);for(e=0;e<r.length;e++)w.push(r[e],r[++e],k,d,g,y)}t.lineWidth&&(b=t.points,t.points=r,n.WebGLGraphics.buildLine(t,i),t.points=b)};n.WebGLGraphics.quadraticBezierCurve=function(n,t,i,r,u,f){function o(n,t,i){var r=t-n;return n+r*i}for(var h,c,l,a,v,y,p=20,w=[],e=0,s=0;s<=p;s++)e=s/p,h=o(n,i,e),c=o(t,r,e),l=o(i,u,e),a=o(r,f,e),v=o(h,l,e),y=o(c,a,e),w.push(v,y);return w};n.WebGLGraphics.buildCircle=function(t,i){var f=t.points,s=f[0],h=f[1],y=f[2],p=f[3],c=40,e=Math.PI*2/c,r=0,d;if(t.fill){var l=n.hex2rgb(t.fillColor),u=t.fillAlpha,w=l[0]*u,b=l[1]*u,k=l[2]*u,a=i.points,v=i.indices,o=a.length/6;for(v.push(o),r=0;r<c+1;r++)a.push(s,h,w,b,k,u),a.push(s+Math.sin(e*r)*y,h+Math.cos(e*r)*p,w,b,k,u),v.push(o++,o++);v.push(o-1)}if(t.lineWidth){for(d=t.points,t.points=[],r=0;r<c+1;r++)t.points.push(s+Math.sin(e*r)*y,h+Math.cos(e*r)*p);n.WebGLGraphics.buildLine(t,i);t.points=d}};n.WebGLGraphics.buildLine=function(t,i){var h=0,r=t.points,it,g,ht,ct;if(r.length!==0){if(t.lineWidth%2)for(h=0;h<r.length;h++)r[h]+=.5;it=new n.Point(r[0],r[1]);g=new n.Point(r[r.length-2],r[r.length-1]);it.x===g.x&&it.y===g.y&&(r=r.slice(),r.pop(),r.pop(),g=new n.Point(r[r.length-2],r[r.length-1]),ht=g.x+(it.x-g.x)*.5,ct=g.y+(it.y-g.y)*.5,r.unshift(ht,ct),r.push(ht,ct));var s=i.points,lt=i.indices,rt=r.length/2,gt=r.length,at=s.length/6,p=t.lineWidth/2,vt=n.hex2rgb(t.lineColor),l=t.lineAlpha,a=vt[0]*l,v=vt[1]*l,y=vt[2]*l,ut,ft,w,b,e,o,ot,st,u,f,k,d,nt,tt,yt,pt,wt,bt,kt,dt,et,ni,c;for(w=r[0],b=r[1],e=r[2],o=r[3],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(w-u,b-f,a,v,y,l),s.push(w+u,b+f,a,v,y,l),h=1;h<rt-1;h++){if(w=r[(h-1)*2],b=r[(h-1)*2+1],e=r[h*2],o=r[h*2+1],ot=r[(h+1)*2],st=r[(h+1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,k=-(o-st),d=e-ot,c=Math.sqrt(k*k+d*d),k/=c,d/=c,k*=p,d*=p,yt=-f+b-(-f+o),pt=-u+e-(-u+w),wt=(-u+w)*(-f+o)-(-u+e)*(-f+b),bt=-d+st-(-d+o),kt=-k+e-(-k+ot),dt=(-k+ot)*(-d+o)-(-k+e)*(-d+st),et=yt*kt-bt*pt,Math.abs(et)<.1){et+=10.1;s.push(e-u,o-f,a,v,y,l);s.push(e+u,o+f,a,v,y,l);continue}ut=(pt*dt-kt*wt)/et;ft=(bt*wt-yt*dt)/et;ni=(ut-e)*(ut-e)+(ft-o)+(ft-o);ni>19600?(nt=u-k,tt=f-d,c=Math.sqrt(nt*nt+tt*tt),nt/=c,tt/=c,nt*=p,tt*=p,s.push(e-nt,o-tt),s.push(a,v,y,l),s.push(e+nt,o+tt),s.push(a,v,y,l),s.push(e-nt,o-tt),s.push(a,v,y,l),gt++):(s.push(ut,ft),s.push(a,v,y,l),s.push(e-(ut-e),o-(ft-o)),s.push(a,v,y,l))}for(w=r[(rt-2)*2],b=r[(rt-2)*2+1],e=r[(rt-1)*2],o=r[(rt-1)*2+1],u=-(b-o),f=w-e,c=Math.sqrt(u*u+f*f),u/=c,f/=c,u*=p,f*=p,s.push(e-u,o-f),s.push(a,v,y,l),s.push(e+u,o+f),s.push(a,v,y,l),lt.push(at),h=0;h<gt;h++)lt.push(at++);lt.push(at-1)}};n.WebGLGraphics.buildComplexPoly=function(t,i){var u=t.points.slice(),l,r,a;if(!(u.length<6)){l=i.indices;i.points=u;i.alpha=t.fillAlpha;i.color=n.hex2rgb(t.fillColor);var f=Infinity,e=-Infinity,o=Infinity,s=-Infinity,h,c;for(r=0;r<u.length;r+=2)h=u[r],c=u[r+1],f=h<f?h:f,e=h>e?h:e,o=c<o?c:o,s=c>s?c:s;for(u.push(f,o,e,o,e,s,f,s),a=u.length/2,r=0;r<a;r++)l.push(r)}};n.WebGLGraphics.buildPoly=function(t,i){var f=t.points;if(!(f.length<6)){for(var c=i.points,e=i.indices,l=f.length/2,h=n.hex2rgb(t.fillColor),s=t.fillAlpha,a=h[0]*s,v=h[1]*s,y=h[2]*s,u=n.PolyK.Triangulate(f),o=c.length/6,r=0,r=0;r<u.length;r+=3)e.push(u[r]+o),e.push(u[r]+o),e.push(u[r+1]+o),e.push(u[r+2]+o),e.push(u[r+2]+o);for(r=0;r<l;r++)c.push(f[r*2],f[r*2+1],a,v,y,s)}};n.WebGLGraphics.graphicsDataPool=[];n.WebGLGraphicsData=function(n){this.gl=n;this.color=[0,0,0];this.points=[];this.indices=[];this.lastIndex=0;this.buffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.mode=1;this.alpha=1;this.dirty=!0};n.WebGLGraphicsData.prototype.reset=function(){this.points=[];this.indices=[];this.lastIndex=0};n.WebGLGraphicsData.prototype.upload=function(){var n=this.gl;this.glPoints=new Float32Array(this.points);n.bindBuffer(n.ARRAY_BUFFER,this.buffer);n.bufferData(n.ARRAY_BUFFER,this.glPoints,n.STATIC_DRAW);this.glIndicies=new Uint16Array(this.indices);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.glIndicies,n.STATIC_DRAW);this.dirty=!1};n.glContexts=[];n.WebGLRenderer=function(t,i,r,u,f,e){n.defaultRenderer||(n.sayHello("webGL"),n.defaultRenderer=this);this.type=n.WEBGL_RENDERER;this.transparent=!!u;this.preserveDrawingBuffer=e;this.width=t||800;this.height=i||600;this.view=r||document.createElement("canvas");this.view.width=this.width;this.view.height=this.height;this.contextLost=this.handleContextLost.bind(this);this.contextRestoredLost=this.handleContextRestored.bind(this);this.view.addEventListener("webglcontextlost",this.contextLost,!1);this.view.addEventListener("webglcontextrestored",this.contextRestoredLost,!1);this.options={alpha:this.transparent,antialias:!!f,premultipliedAlpha:!!u&&u!=="notMultiplied",stencil:!0,preserveDrawingBuffer:e};var o=null;if(["experimental-webgl","webgl"].forEach(function(n){try{o=o||this.view.getContext(n,this.options)}catch(t){}},this),!o)throw new Error("This browser does not support webGL. Try using the canvas renderer"+this);this.gl=o;this.glContextId=o.id=n.WebGLRenderer.glContextId++;n.glContexts[this.glContextId]=o;n.blendModesWebGL||(n.blendModesWebGL=[],n.blendModesWebGL[n.blendModes.NORMAL]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.ADD]=[o.SRC_ALPHA,o.DST_ALPHA],n.blendModesWebGL[n.blendModes.MULTIPLY]=[o.DST_COLOR,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SCREEN]=[o.SRC_ALPHA,o.ONE],n.blendModesWebGL[n.blendModes.OVERLAY]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DARKEN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LIGHTEN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_DODGE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR_BURN]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HARD_LIGHT]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SOFT_LIGHT]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.DIFFERENCE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.EXCLUSION]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.HUE]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.SATURATION]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.COLOR]=[o.ONE,o.ONE_MINUS_SRC_ALPHA],n.blendModesWebGL[n.blendModes.LUMINOSITY]=[o.ONE,o.ONE_MINUS_SRC_ALPHA]);this.projection=new n.Point;this.projection.x=this.width/2;this.projection.y=-this.height/2;this.offset=new n.Point(0,0);this.resize(this.width,this.height);this.contextLost=!1;this.shaderManager=new n.WebGLShaderManager(o);this.spriteBatch=new n.WebGLSpriteBatch(o);this.maskManager=new n.WebGLMaskManager(o);this.filterManager=new n.WebGLFilterManager(o,this.transparent);this.stencilManager=new n.WebGLStencilManager(o);this.blendModeManager=new n.WebGLBlendModeManager(o);this.renderSession={};this.renderSession.gl=this.gl;this.renderSession.drawCount=0;this.renderSession.shaderManager=this.shaderManager;this.renderSession.maskManager=this.maskManager;this.renderSession.filterManager=this.filterManager;this.renderSession.blendModeManager=this.blendModeManager;this.renderSession.spriteBatch=this.spriteBatch;this.renderSession.stencilManager=this.stencilManager;this.renderSession.renderer=this;o.useProgram(this.shaderManager.defaultShader.program);o.disable(o.DEPTH_TEST);o.disable(o.CULL_FACE);o.enable(o.BLEND);o.colorMask(!0,!0,!0,this.transparent)};n.WebGLRenderer.prototype.constructor=n.WebGLRenderer;n.WebGLRenderer.prototype.render=function(t){if(!this.contextLost){this.__stage!==t&&(t.interactive&&t.interactionManager.removeEvents(),this.__stage=t);n.WebGLRenderer.updateTextures();t.updateTransform();t._interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)));var i=this.gl;i.viewport(0,0,this.width,this.height);i.bindFramebuffer(i.FRAMEBUFFER,null);this.transparent?i.clearColor(0,0,0,0):i.clearColor(t.backgroundColorSplit[0],t.backgroundColorSplit[1],t.backgroundColorSplit[2],1);i.clear(i.COLOR_BUFFER_BIT);this.renderDisplayObject(t,this.projection);t.interactive?t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)):t._interactiveEventsAdded&&(t._interactiveEventsAdded=!1,t.interactionManager.setTarget(this))}};n.WebGLRenderer.prototype.renderDisplayObject=function(t,i,r){this.renderSession.blendModeManager.setBlendMode(n.blendModes.NORMAL);this.renderSession.drawCount=0;this.renderSession.currentBlendMode=9999;this.renderSession.projection=i;this.renderSession.offset=this.offset;this.spriteBatch.begin(this.renderSession);this.filterManager.begin(this.renderSession,r);t._renderWebGL(this.renderSession);this.spriteBatch.end()};n.WebGLRenderer.updateTextures=function(){for(var t=0,t=0;t<n.Texture.frameUpdates.length;t++)n.WebGLRenderer.updateTextureFrame(n.Texture.frameUpdates[t]);for(t=0;t<n.texturesToDestroy.length;t++)n.WebGLRenderer.destroyTexture(n.texturesToDestroy[t]);n.texturesToUpdate.length=0;n.texturesToDestroy.length=0;n.Texture.frameUpdates.length=0};n.WebGLRenderer.destroyTexture=function(t){for(var r,u,i=t._glTextures.length-1;i>=0;i--)r=t._glTextures[i],u=n.glContexts[i],u&&r&&u.deleteTexture(r);t._glTextures.length=0};n.WebGLRenderer.updateTextureFrame=function(n){n._updateWebGLuvs()};n.WebGLRenderer.prototype.resize=function(n,t){this.width=n;this.height=t;this.view.width=n;this.view.height=t;this.gl.viewport(0,0,this.width,this.height);this.projection.x=this.width/2;this.projection.y=-this.height/2};n.createWebGLTexture=function(t,i){return t.hasLoaded&&(t._glTextures[i.id]=i.createTexture(),i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),i.bindTexture(i.TEXTURE_2D,null),t._dirty[i.id]=!1),t._glTextures[i.id]};n.updateWebGLTexture=function(t,i){t._glTextures[i.id]&&(i.bindTexture(i.TEXTURE_2D,t._glTextures[i.id]),i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultipliedAlpha),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t.source),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,t.scaleMode===n.scaleModes.LINEAR?i.LINEAR:i.NEAREST),t._powerOf2?(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.REPEAT),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.REPEAT)):(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE)),t._dirty[i.id]=!1)};n.WebGLRenderer.prototype.handleContextLost=function(n){n.preventDefault();this.contextLost=!0};n.WebGLRenderer.prototype.handleContextRestored=function(){var t,i,r;try{this.gl=this.view.getContext("experimental-webgl",this.options)}catch(u){try{this.gl=this.view.getContext("webgl",this.options)}catch(f){throw new Error(" This browser does not support webGL. Try using the canvas renderer"+this);}}n.glContexts[this.glContextId]=null;t=this.gl;this.glContextId=t.id=n.WebGLRenderer.glContextId++;n.glContexts[this.glContextId]=t;this.shaderManager.setContext(t);this.spriteBatch.setContext(t);this.maskManager.setContext(t);this.filterManager.setContext(t);this.renderSession.gl=this.gl;t.disable(t.DEPTH_TEST);t.disable(t.CULL_FACE);t.enable(t.BLEND);t.colorMask(!0,!0,!0,this.transparent);this.gl.viewport(0,0,this.width,this.height);for(i in n.TextureCache)r=n.TextureCache[i].baseTexture,r._glTextures=[];this.contextLost=!1};n.WebGLRenderer.prototype.destroy=function(){this.view.removeEventListener("webglcontextlost",this.contextLost);this.view.removeEventListener("webglcontextrestored",this.contextRestoredLost);n.glContexts[this.glContextId]=null;this.projection=null;this.offset=null;this.shaderManager.destroy();this.spriteBatch.destroy();this.maskManager.destroy();this.filterManager.destroy();this.shaderManager=null;this.spriteBatch=null;this.maskManager=null;this.filterManager=null;this.gl=null;this.renderSession=null};n.WebGLRenderer.glContextId=0;n.WebGLBlendModeManager=function(n){this.gl=n;this.currentBlendMode=99999};n.WebGLBlendModeManager.prototype.setBlendMode=function(t){if(this.currentBlendMode===t)return!1;this.currentBlendMode=t;var i=n.blendModesWebGL[this.currentBlendMode];return this.gl.blendFunc(i[0],i[1]),!0};n.WebGLBlendModeManager.prototype.destroy=function(){this.gl=null};n.WebGLMaskManager=function(n){this.setContext(n)};n.WebGLMaskManager.prototype.setContext=function(n){this.gl=n};n.WebGLMaskManager.prototype.pushMask=function(t,i){var r=i.gl;(t.dirty&&n.WebGLGraphics.updateGraphics(t,r),t._webGL[r.id].data.length)&&i.stencilManager.pushStencil(t,t._webGL[r.id].data[0],i)};n.WebGLMaskManager.prototype.popMask=function(n,t){var i=this.gl;t.stencilManager.popStencil(n,n._webGL[i.id].data[0],t)};n.WebGLMaskManager.prototype.destroy=function(){this.gl=null};n.WebGLStencilManager=function(n){this.stencilStack=[];this.setContext(n);this.reverse=!0;this.count=0};n.WebGLStencilManager.prototype.setContext=function(n){this.gl=n};n.WebGLStencilManager.prototype.pushStencil=function(n,t,i){var r=this.gl,u;this.bindGraphics(n,t,i);this.stencilStack.length===0&&(r.enable(r.STENCIL_TEST),r.clear(r.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0);this.stencilStack.push(t);u=this.count;r.colorMask(!1,!1,!1,!1);r.stencilFunc(r.ALWAYS,0,255);r.stencilOp(r.KEEP,r.KEEP,r.INVERT);t.mode===1?(r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),this.reverse?r.stencilFunc(r.EQUAL,255-(u+1),255):r.stencilFunc(r.EQUAL,u+1,255),this.reverse=!this.reverse):(this.reverse?(r.stencilFunc(r.EQUAL,u,255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,255-u,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u+1,255):r.stencilFunc(r.EQUAL,255-(u+1),255));r.colorMask(!0,!0,!0,!0);r.stencilOp(r.KEEP,r.KEEP,r.KEEP);this.count++};n.WebGLStencilManager.prototype.bindGraphics=function(t,i,r){this._currentGraphics=t;var u=this.gl,e=r.projection,o=r.offset,f;i.mode===1?(f=r.shaderManager.complexPrimitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform3fv(f.color,i.color),u.uniform1f(f.alpha,t.worldAlpha*i.alpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,8,0),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer)):(f=r.shaderManager.primitiveShader,r.shaderManager.setShader(f),u.uniformMatrix3fv(f.translationMatrix,!1,t.worldTransform.toArray(!0)),u.uniform2f(f.projectionVector,e.x,-e.y),u.uniform2f(f.offsetVector,-o.x,-o.y),u.uniform3fv(f.tintColor,n.hex2rgb(t.tint)),u.uniform1f(f.alpha,t.worldAlpha),u.bindBuffer(u.ARRAY_BUFFER,i.buffer),u.vertexAttribPointer(f.aVertexPosition,2,u.FLOAT,!1,24,0),u.vertexAttribPointer(f.colorAttribute,4,u.FLOAT,!1,24,8),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i.indexBuffer))};n.WebGLStencilManager.prototype.popStencil=function(n,t,i){var r=this.gl,u;this.stencilStack.pop();this.count--;this.stencilStack.length===0?r.disable(r.STENCIL_TEST):(u=this.count,this.bindGraphics(n,t,i),r.colorMask(!1,!1,!1,!1),t.mode===1?(this.reverse=!this.reverse,this.reverse?(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)):(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)),r.drawElements(r.TRIANGLE_FAN,4,r.UNSIGNED_SHORT,(t.indices.length-4)*2),r.stencilFunc(r.ALWAYS,0,255),r.stencilOp(r.KEEP,r.KEEP,r.INVERT),r.drawElements(r.TRIANGLE_FAN,t.indices.length-4,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)):(this.reverse?(r.stencilFunc(r.EQUAL,u+1,255),r.stencilOp(r.KEEP,r.KEEP,r.DECR)):(r.stencilFunc(r.EQUAL,255-(u+1),255),r.stencilOp(r.KEEP,r.KEEP,r.INCR)),r.drawElements(r.TRIANGLE_STRIP,t.indices.length,r.UNSIGNED_SHORT,0),this.reverse?r.stencilFunc(r.EQUAL,u,255):r.stencilFunc(r.EQUAL,255-u,255)),r.colorMask(!0,!0,!0,!0),r.stencilOp(r.KEEP,r.KEEP,r.KEEP))};n.WebGLStencilManager.prototype.destroy=function(){this.stencilStack=null;this.gl=null};n.WebGLShaderManager=function(n){this.maxAttibs=10;this.attribState=[];this.tempAttribState=[];for(var t=0;t<this.maxAttibs;t++)this.attribState[t]=!1;this.setContext(n)};n.WebGLShaderManager.prototype.setContext=function(t){this.gl=t;this.primitiveShader=new n.PrimitiveShader(t);this.complexPrimitiveShader=new n.ComplexPrimitiveShader(t);this.defaultShader=new n.PixiShader(t);this.fastShader=new n.PixiFastShader(t);this.stripShader=new n.StripShader(t);this.setShader(this.defaultShader)};n.WebGLShaderManager.prototype.setAttribs=function(n){for(var r,i,t=0;t<this.tempAttribState.length;t++)this.tempAttribState[t]=!1;for(t=0;t<n.length;t++)r=n[t],this.tempAttribState[r]=!0;for(i=this.gl,t=0;t<this.attribState.length;t++)this.attribState[t]!==this.tempAttribState[t]&&(this.attribState[t]=this.tempAttribState[t],this.tempAttribState[t]?i.enableVertexAttribArray(t):i.disableVertexAttribArray(t))};n.WebGLShaderManager.prototype.setShader=function(n){return this._currentId===n._UID?!1:(this._currentId=n._UID,this.currentShader=n,this.gl.useProgram(n.program),this.setAttribs(n.attributes),!0)};n.WebGLShaderManager.prototype.destroy=function(){this.attribState=null;this.tempAttribState=null;this.primitiveShader.destroy();this.complexPrimitiveShader.destroy();this.defaultShader.destroy();this.fastShader.destroy();this.stripShader.destroy();this.gl=null};n.WebGLSpriteBatch=function(n){var u,r,t,i;for(this.vertSize=6,this.size=2e3,u=this.size*4*this.vertSize,r=this.size*6,this.vertices=new Float32Array(u),this.indices=new Uint16Array(r),this.lastIndexCount=0,t=0,i=0;t<r;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.setContext(n);this.dirty=!0;this.textures=[];this.blendModes=[]};n.WebGLSpriteBatch.prototype.setContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW);this.currentBlendMode=99999};n.WebGLSpriteBatch.prototype.begin=function(n){this.renderSession=n;this.shader=this.renderSession.shaderManager.defaultShader;this.start()};n.WebGLSpriteBatch.prototype.end=function(){this.flush()};n.WebGLSpriteBatch.prototype.render=function(n){var r=n.texture,u,c;if(this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=r.baseTexture),u=r._uvs,u){var l=n.worldAlpha,a=n.tint,t=this.vertices,d=n.anchor.x,g=n.anchor.y,o,f,s,e;r.trim?(c=r.trim,f=c.x-d*c.width,o=f+r.crop.width,e=c.y-g*c.height,s=e+r.crop.height):(o=r.frame.width*(1-d),f=r.frame.width*-d,s=r.frame.height*(1-g),e=r.frame.height*-g);var i=this.currentBatchSize*4*this.vertSize,h=n.worldTransform,v=h.a,y=h.c,p=h.b,w=h.d,b=h.tx,k=h.ty;t[i++]=v*f+p*e+b;t[i++]=w*e+y*f+k;t[i++]=u.x0;t[i++]=u.y0;t[i++]=l;t[i++]=a;t[i++]=v*o+p*e+b;t[i++]=w*e+y*o+k;t[i++]=u.x1;t[i++]=u.y1;t[i++]=l;t[i++]=a;t[i++]=v*o+p*s+b;t[i++]=w*s+y*o+k;t[i++]=u.x2;t[i++]=u.y2;t[i++]=l;t[i++]=a;t[i++]=v*f+p*s+b;t[i++]=w*s+y*f+k;t[i++]=u.x3;t[i++]=u.y3;t[i++]=l;t[i++]=a;this.textures[this.currentBatchSize]=n.texture.baseTexture;this.blendModes[this.currentBatchSize]=n.blendMode;this.currentBatchSize++}};n.WebGLSpriteBatch.prototype.renderTilingSprite=function(t){var f=t.tilingTexture,u;this.currentBatchSize>=this.size&&(this.flush(),this.currentBaseTexture=f.baseTexture);t._uvs||(t._uvs=new n.TextureUvs);u=t._uvs;t.tilePosition.x%=f.baseTexture.width*t.tileScaleOffset.x;t.tilePosition.y%=f.baseTexture.height*t.tileScaleOffset.y;var o=t.tilePosition.x/(f.baseTexture.width*t.tileScaleOffset.x),s=t.tilePosition.y/(f.baseTexture.height*t.tileScaleOffset.y),nt=t.width/f.baseTexture.width/(t.tileScale.x*t.tileScaleOffset.x),tt=t.height/f.baseTexture.height/(t.tileScale.y*t.tileScaleOffset.y);u.x0=0-o;u.y0=0-s;u.x1=1*nt-o;u.y1=0-s;u.x2=1*nt-o;u.y2=1*tt-s;u.x3=0-o;u.y3=1*tt-s;var h=t.worldAlpha,c=t.tint,i=this.vertices,it=t.width,rt=t.height,ut=t.anchor.x,ft=t.anchor.y,l=it*(1-ut),a=it*-ut,v=rt*(1-ft),y=rt*-ft,r=this.currentBatchSize*4*this.vertSize,e=t.worldTransform,p=e.a,w=e.c,b=e.b,k=e.d,d=e.tx,g=e.ty;i[r++]=p*a+b*y+d;i[r++]=k*y+w*a+g;i[r++]=u.x0;i[r++]=u.y0;i[r++]=h;i[r++]=c;i[r++]=p*l+b*y+d;i[r++]=k*y+w*l+g;i[r++]=u.x1;i[r++]=u.y1;i[r++]=h;i[r++]=c;i[r++]=p*l+b*v+d;i[r++]=k*v+w*l+g;i[r++]=u.x2;i[r++]=u.y2;i[r++]=h;i[r++]=c;i[r++]=p*a+b*v+d;i[r++]=k*v+w*a+g;i[r++]=u.x3;i[r++]=u.y3;i[r++]=h;i[r++]=c;this.textures[this.currentBatchSize]=f.baseTexture;this.blendModes[this.currentBatchSize]=t.blendMode;this.currentBatchSize++};n.WebGLSpriteBatch.prototype.flush=function(){var n,f,i,c,t,l;if(this.currentBatchSize!==0){n=this.gl;this.renderSession.shaderManager.setShader(this.renderSession.shaderManager.defaultShader);this.dirty&&(this.dirty=!1,n.activeTexture(n.TEXTURE0),n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer),f=this.renderSession.projection,n.uniform2f(this.shader.projectionVector,f.x,f.y),i=this.vertSize*4,n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,i,0),n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,i,8),n.vertexAttribPointer(this.shader.colorAttribute,2,n.FLOAT,!1,i,16));this.currentBatchSize>this.size*.5?n.bufferSubData(n.ARRAY_BUFFER,0,this.vertices):(c=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize),n.bufferSubData(n.ARRAY_BUFFER,0,c));var e,o,r=0,s=0,u=null,h=this.renderSession.blendModeManager.currentBlendMode;for(t=0,l=this.currentBatchSize;t<l;t++)e=this.textures[t],o=this.blendModes[t],(u!==e||h!==o)&&(this.renderBatch(u,r,s),s=t,r=0,u=e,h=o,this.renderSession.blendModeManager.setBlendMode(h)),r++;this.renderBatch(u,r,s);this.currentBatchSize=0}};n.WebGLSpriteBatch.prototype.renderBatch=function(t,i,r){if(i!==0){var u=this.gl;u.bindTexture(u.TEXTURE_2D,t._glTextures[u.id]||n.createWebGLTexture(t,u));t._dirty[u.id]&&n.updateWebGLTexture(this.currentBaseTexture,u);u.drawElements(u.TRIANGLES,i*6,u.UNSIGNED_SHORT,r*12);this.renderSession.drawCount++}};n.WebGLSpriteBatch.prototype.stop=function(){this.flush()};n.WebGLSpriteBatch.prototype.start=function(){this.dirty=!0};n.WebGLSpriteBatch.prototype.destroy=function(){this.vertices=null;this.indices=null;this.gl.deleteBuffer(this.vertexBuffer);this.gl.deleteBuffer(this.indexBuffer);this.currentBaseTexture=null;this.gl=null};n.WebGLFastSpriteBatch=function(n){var u,r,t,i;for(this.vertSize=10,this.maxSize=6e3,this.size=this.maxSize,u=this.size*4*this.vertSize,r=this.maxSize*6,this.vertices=new Float32Array(u),this.indices=new Uint16Array(r),this.vertexBuffer=null,this.indexBuffer=null,this.lastIndexCount=0,t=0,i=0;t<r;t+=6,i+=4)this.indices[t+0]=i+0,this.indices[t+1]=i+1,this.indices[t+2]=i+2,this.indices[t+3]=i+0,this.indices[t+4]=i+2,this.indices[t+5]=i+3;this.drawing=!1;this.currentBatchSize=0;this.currentBaseTexture=null;this.currentBlendMode=0;this.renderSession=null;this.shader=null;this.matrix=null;this.setContext(n)};n.WebGLFastSpriteBatch.prototype.setContext=function(n){this.gl=n;this.vertexBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,this.indices,n.STATIC_DRAW);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertices,n.DYNAMIC_DRAW)};n.WebGLFastSpriteBatch.prototype.begin=function(n,t){this.renderSession=t;this.shader=this.renderSession.shaderManager.fastShader;this.matrix=n.worldTransform.toArray(!0);this.start()};n.WebGLFastSpriteBatch.prototype.end=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.render=function(n){var r=n.children,t=r[0],i,u;if(t.texture._uvs){for(this.currentBaseTexture=t.texture.baseTexture,t.blendMode!==this.renderSession.blendModeManager.currentBlendMode&&(this.flush(),this.renderSession.blendModeManager.setBlendMode(t.blendMode)),i=0,u=r.length;i<u;i++)this.renderSprite(r[i]);this.flush()}};n.WebGLFastSpriteBatch.prototype.renderSprite=function(n){var r,t,h,c,o,u,s,f,i,e;n.visible&&(n.texture.baseTexture===this.currentBaseTexture||(this.flush(),this.currentBaseTexture=n.texture.baseTexture,n.texture._uvs))&&(t=this.vertices,r=n.texture._uvs,h=n.texture.frame.width,c=n.texture.frame.height,n.texture.trim?(e=n.texture.trim,u=e.x-n.anchor.x*e.width,o=u+n.texture.crop.width,f=e.y-n.anchor.y*e.height,s=f+n.texture.crop.height):(o=n.texture.frame.width*(1-n.anchor.x),u=n.texture.frame.width*-n.anchor.x,s=n.texture.frame.height*(1-n.anchor.y),f=n.texture.frame.height*-n.anchor.y),i=this.currentBatchSize*4*this.vertSize,t[i++]=u,t[i++]=f,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x0,t[i++]=r.y1,t[i++]=n.alpha,t[i++]=o,t[i++]=f,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x1,t[i++]=r.y1,t[i++]=n.alpha,t[i++]=o,t[i++]=s,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x2,t[i++]=r.y2,t[i++]=n.alpha,t[i++]=u,t[i++]=s,t[i++]=n.position.x,t[i++]=n.position.y,t[i++]=n.scale.x,t[i++]=n.scale.y,t[i++]=n.rotation,t[i++]=r.x3,t[i++]=r.y3,t[i++]=n.alpha,this.currentBatchSize++,this.currentBatchSize>=this.size&&this.flush())};n.WebGLFastSpriteBatch.prototype.flush=function(){var t,i;this.currentBatchSize!==0&&(t=this.gl,this.currentBaseTexture._glTextures[t.id]||n.createWebGLTexture(this.currentBaseTexture,t),t.bindTexture(t.TEXTURE_2D,this.currentBaseTexture._glTextures[t.id]),this.currentBatchSize>this.size*.5?t.bufferSubData(t.ARRAY_BUFFER,0,this.vertices):(i=this.vertices.subarray(0,this.currentBatchSize*4*this.vertSize),t.bufferSubData(t.ARRAY_BUFFER,0,i)),t.drawElements(t.TRIANGLES,this.currentBatchSize*6,t.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++)};n.WebGLFastSpriteBatch.prototype.stop=function(){this.flush()};n.WebGLFastSpriteBatch.prototype.start=function(){var n=this.gl,i,t;n.activeTexture(n.TEXTURE0);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);i=this.renderSession.projection;n.uniform2f(this.shader.projectionVector,i.x,i.y);n.uniformMatrix3fv(this.shader.uMatrix,!1,this.matrix);t=this.vertSize*4;n.vertexAttribPointer(this.shader.aVertexPosition,2,n.FLOAT,!1,t,0);n.vertexAttribPointer(this.shader.aPositionCoord,2,n.FLOAT,!1,t,8);n.vertexAttribPointer(this.shader.aScale,2,n.FLOAT,!1,t,16);n.vertexAttribPointer(this.shader.aRotation,1,n.FLOAT,!1,t,24);n.vertexAttribPointer(this.shader.aTextureCoord,2,n.FLOAT,!1,t,28);n.vertexAttribPointer(this.shader.colorAttribute,1,n.FLOAT,!1,t,36)};n.WebGLFilterManager=function(n,t){this.transparent=t;this.filterStack=[];this.offsetX=0;this.offsetY=0;this.setContext(n)};n.WebGLFilterManager.prototype.setContext=function(n){this.gl=n;this.texturePool=[];this.initShaderBuffers()};n.WebGLFilterManager.prototype.begin=function(n,t){this.renderSession=n;this.defaultShader=n.shaderManager.defaultShader;var i=this.renderSession.projection;this.width=i.x*2;this.height=-i.y*2;this.buffer=t};n.WebGLFilterManager.prototype.pushFilter=function(t){var r=this.gl,e=this.renderSession.projection,o=this.renderSession.offset,s,u,i,f;t._filterArea=t.target.filterArea||t.target.getBounds();this.filterStack.push(t);s=t.filterPasses[0];this.offsetX+=t._filterArea.x;this.offsetY+=t._filterArea.y;u=this.texturePool.pop();u?u.resize(this.width,this.height):u=new n.FilterTexture(this.gl,this.width,this.height);r.bindTexture(r.TEXTURE_2D,u.texture);i=t._filterArea;f=s.padding;i.x-=f;i.y-=f;i.width+=f*2;i.height+=f*2;i.x<0&&(i.x=0);i.width>this.width&&(i.width=this.width);i.y<0&&(i.y=0);i.height>this.height&&(i.height=this.height);r.bindFramebuffer(r.FRAMEBUFFER,u.frameBuffer);r.viewport(0,0,i.width,i.height);e.x=i.width/2;e.y=-i.height/2;o.x=-i.x;o.y=-i.y;this.renderSession.shaderManager.setShader(this.defaultShader);r.uniform2f(this.defaultShader.projectionVector,i.width/2,-i.height/2);r.uniform2f(this.defaultShader.offsetVector,-i.x,-i.y);r.colorMask(!0,!0,!0,!0);r.clearColor(0,0,0,0);r.clear(r.COLOR_BUFFER_BIT);t._glFilterTexture=u};n.WebGLFilterManager.prototype.popFilter=function(){var t=this.gl,r=this.filterStack.pop(),i=r._filterArea,c=r._glFilterTexture,p=this.renderSession.projection,w=this.renderSession.offset,f,u,l,b,k,d,y,s,h;if(r.filterPasses.length>1){for(t.viewport(0,0,i.width,i.height),t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=i.height,this.vertexArray[2]=i.width,this.vertexArray[3]=i.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=i.width,this.vertexArray[7]=0,t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray),t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer),this.uvArray[2]=i.width/this.width,this.uvArray[5]=i.height/this.height,this.uvArray[6]=i.width/this.width,this.uvArray[7]=i.height/this.height,t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray),f=c,u=this.texturePool.pop(),u||(u=new n.FilterTexture(this.gl,this.width,this.height)),u.resize(this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.clear(t.COLOR_BUFFER_BIT),t.disable(t.BLEND),l=0;l<r.filterPasses.length-1;l++)b=r.filterPasses[l],t.bindFramebuffer(t.FRAMEBUFFER,u.frameBuffer),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f.texture),this.applyFilterPass(b,i,i.width,i.height),k=f,f=u,u=k;t.enable(t.BLEND);c=f;this.texturePool.push(u)}d=r.filterPasses[r.filterPasses.length-1];this.offsetX-=i.x;this.offsetY-=i.y;var e=this.width,o=this.height,a=0,v=0,g=this.buffer;this.filterStack.length===0?t.colorMask(!0,!0,!0,!0):(y=this.filterStack[this.filterStack.length-1],i=y._filterArea,e=i.width,o=i.height,a=i.x,v=i.y,g=y._glFilterTexture.frameBuffer);p.x=e/2;p.y=-o/2;w.x=a;w.y=v;i=r._filterArea;s=i.x-a;h=i.y-v;t.bindBuffer(t.ARRAY_BUFFER,this.vertexBuffer);this.vertexArray[0]=s;this.vertexArray[1]=h+i.height;this.vertexArray[2]=s+i.width;this.vertexArray[3]=h+i.height;this.vertexArray[4]=s;this.vertexArray[5]=h;this.vertexArray[6]=s+i.width;this.vertexArray[7]=h;t.bufferSubData(t.ARRAY_BUFFER,0,this.vertexArray);t.bindBuffer(t.ARRAY_BUFFER,this.uvBuffer);this.uvArray[2]=i.width/this.width;this.uvArray[5]=i.height/this.height;this.uvArray[6]=i.width/this.width;this.uvArray[7]=i.height/this.height;t.bufferSubData(t.ARRAY_BUFFER,0,this.uvArray);t.viewport(0,0,e,o);t.bindFramebuffer(t.FRAMEBUFFER,g);t.activeTexture(t.TEXTURE0);t.bindTexture(t.TEXTURE_2D,c.texture);this.applyFilterPass(d,i,e,o);this.renderSession.shaderManager.setShader(this.defaultShader);t.uniform2f(this.defaultShader.projectionVector,e/2,-o/2);t.uniform2f(this.defaultShader.offsetVector,-a,-v);this.texturePool.push(c);r._glFilterTexture=null};n.WebGLFilterManager.prototype.applyFilterPass=function(t,i,r,u){var f=this.gl,e=t.shaders[f.id];e||(e=new n.PixiShader(f),e.fragmentSrc=t.fragmentSrc,e.uniforms=t.uniforms,e.init(),t.shaders[f.id]=e);this.renderSession.shaderManager.setShader(e);f.uniform2f(e.projectionVector,r/2,-u/2);f.uniform2f(e.offsetVector,0,0);t.uniforms.dimensions&&(t.uniforms.dimensions.value[0]=this.width,t.uniforms.dimensions.value[1]=this.height,t.uniforms.dimensions.value[2]=this.vertexArray[0],t.uniforms.dimensions.value[3]=this.vertexArray[5]);e.syncUniforms();f.bindBuffer(f.ARRAY_BUFFER,this.vertexBuffer);f.vertexAttribPointer(e.aVertexPosition,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.uvBuffer);f.vertexAttribPointer(e.aTextureCoord,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ARRAY_BUFFER,this.colorBuffer);f.vertexAttribPointer(e.colorAttribute,2,f.FLOAT,!1,0,0);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,this.indexBuffer);f.drawElements(f.TRIANGLES,6,f.UNSIGNED_SHORT,0);this.renderSession.drawCount++};n.WebGLFilterManager.prototype.initShaderBuffers=function(){var n=this.gl;this.vertexBuffer=n.createBuffer();this.uvBuffer=n.createBuffer();this.colorBuffer=n.createBuffer();this.indexBuffer=n.createBuffer();this.vertexArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.vertexBuffer);n.bufferData(n.ARRAY_BUFFER,this.vertexArray,n.STATIC_DRAW);this.uvArray=new Float32Array([0,0,1,0,0,1,1,1]);n.bindBuffer(n.ARRAY_BUFFER,this.uvBuffer);n.bufferData(n.ARRAY_BUFFER,this.uvArray,n.STATIC_DRAW);this.colorArray=new Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]);n.bindBuffer(n.ARRAY_BUFFER,this.colorBuffer);n.bufferData(n.ARRAY_BUFFER,this.colorArray,n.STATIC_DRAW);n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,this.indexBuffer);n.bufferData(n.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),n.STATIC_DRAW)};n.WebGLFilterManager.prototype.destroy=function(){var n=this.gl,t;for(this.filterStack=null,this.offsetX=0,this.offsetY=0,t=0;t<this.texturePool.length;t++)this.texturePool[t].destroy();this.texturePool=null;n.deleteBuffer(this.vertexBuffer);n.deleteBuffer(this.uvBuffer);n.deleteBuffer(this.colorBuffer);n.deleteBuffer(this.indexBuffer)};n.FilterTexture=function(t,i,r,u){this.gl=t;this.frameBuffer=t.createFramebuffer();this.texture=t.createTexture();u=u||n.scaleModes.DEFAULT;t.bindTexture(t.TEXTURE_2D,this.texture);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,u===n.scaleModes.LINEAR?t.LINEAR:t.NEAREST);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE);t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.bindFramebuffer(t.FRAMEBUFFER,this.frameBuffer);t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);this.renderBuffer=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,this.renderBuffer);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,this.renderBuffer);this.resize(i,r)};n.FilterTexture.prototype.clear=function(){var n=this.gl;n.clearColor(0,0,0,0);n.clear(n.COLOR_BUFFER_BIT)};n.FilterTexture.prototype.resize=function(n,t){if(this.width!==n||this.height!==t){this.width=n;this.height=t;var i=this.gl;i.bindTexture(i.TEXTURE_2D,this.texture);i.texImage2D(i.TEXTURE_2D,0,i.RGBA,n,t,0,i.RGBA,i.UNSIGNED_BYTE,null);i.bindRenderbuffer(i.RENDERBUFFER,this.renderBuffer);i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,t)}};n.FilterTexture.prototype.destroy=function(){var n=this.gl;n.deleteFramebuffer(this.frameBuffer);n.deleteTexture(this.texture);this.frameBuffer=null;this.texture=null};n.CanvasMaskManager=function(){};n.CanvasMaskManager.prototype.pushMask=function(t,i){i.save();var u=t.alpha,r=t.worldTransform;i.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty);n.CanvasGraphics.renderGraphicsMask(t,i);i.clip();t.worldAlpha=u};n.CanvasMaskManager.prototype.popMask=function(n){n.restore()};n.CanvasTinter=function(){};n.CanvasTinter.getTintedTexture=function(t,i){var r=t.texture,u,f,e;return(i=n.CanvasTinter.roundColor(i),u="#"+("00000"+(i|0).toString(16)).substr(-6),r.tintCache=r.tintCache||{},r.tintCache[u])?r.tintCache[u]:(f=n.CanvasTinter.canvas||document.createElement("canvas"),n.CanvasTinter.tintMethod(r,i,f),n.CanvasTinter.convertTintToImage?(e=new Image,e.src=f.toDataURL(),r.tintCache[u]=e):(r.tintCache[u]=f,n.CanvasTinter.canvas=null),f)};n.CanvasTinter.tintWithMultiply=function(n,t,i){var u=i.getContext("2d"),r=n.frame;i.width=r.width;i.height=r.height;u.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="multiply";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithOverlay=function(n,t,i){var u=i.getContext("2d"),r=n.frame;i.width=r.width;i.height=r.height;u.globalCompositeOperation="copy";u.fillStyle="#"+("00000"+(t|0).toString(16)).substr(-6);u.fillRect(0,0,r.width,r.height);u.globalCompositeOperation="destination-atop";u.drawImage(n.baseTexture.source,r.x,r.y,r.width,r.height,0,0,r.width,r.height)};n.CanvasTinter.tintWithPerPixel=function(t,i,r){var e=r.getContext("2d"),u=t.frame,f;r.width=u.width;r.height=u.height;e.globalCompositeOperation="copy";e.drawImage(t.baseTexture.source,u.x,u.y,u.width,u.height,0,0,u.width,u.height);var s=n.hex2rgb(i),c=s[0],l=s[1],a=s[2],h=e.getImageData(0,0,u.width,u.height),o=h.data;for(f=0;f<o.length;f+=4)o[f+0]*=c,o[f+1]*=l,o[f+2]*=a;e.putImageData(h,0,0)};n.CanvasTinter.roundColor=function(t){var r=n.CanvasTinter.cacheStepsPerColorChannel,i=n.hex2rgb(t);return i[0]=Math.min(255,i[0]/r*r),i[1]=Math.min(255,i[1]/r*r),i[2]=Math.min(255,i[2]/r*r),n.rgb2hex(i)};n.CanvasTinter.cacheStepsPerColorChannel=8;n.CanvasTinter.convertTintToImage=!1;n.CanvasTinter.canUseMultiply=n.canUseNewCanvasBlendModes();n.CanvasTinter.tintMethod=n.CanvasTinter.canUseMultiply?n.CanvasTinter.tintWithMultiply:n.CanvasTinter.tintWithPerPixel;n.CanvasRenderer=function(t,i,r,u){n.defaultRenderer||(n.sayHello("Canvas"),n.defaultRenderer=this);this.type=n.CANVAS_RENDERER;this.clearBeforeRender=!0;this.transparent=!!u;n.blendModesCanvas||(n.blendModesCanvas=[],n.canUseNewCanvasBlendModes()?(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="multiply",n.blendModesCanvas[n.blendModes.SCREEN]="screen",n.blendModesCanvas[n.blendModes.OVERLAY]="overlay",n.blendModesCanvas[n.blendModes.DARKEN]="darken",n.blendModesCanvas[n.blendModes.LIGHTEN]="lighten",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="color-dodge",n.blendModesCanvas[n.blendModes.COLOR_BURN]="color-burn",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="hard-light",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="soft-light",n.blendModesCanvas[n.blendModes.DIFFERENCE]="difference",n.blendModesCanvas[n.blendModes.EXCLUSION]="exclusion",n.blendModesCanvas[n.blendModes.HUE]="hue",n.blendModesCanvas[n.blendModes.SATURATION]="saturation",n.blendModesCanvas[n.blendModes.COLOR]="color",n.blendModesCanvas[n.blendModes.LUMINOSITY]="luminosity"):(n.blendModesCanvas[n.blendModes.NORMAL]="source-over",n.blendModesCanvas[n.blendModes.ADD]="lighter",n.blendModesCanvas[n.blendModes.MULTIPLY]="source-over",n.blendModesCanvas[n.blendModes.SCREEN]="source-over",n.blendModesCanvas[n.blendModes.OVERLAY]="source-over",n.blendModesCanvas[n.blendModes.DARKEN]="source-over",n.blendModesCanvas[n.blendModes.LIGHTEN]="source-over",n.blendModesCanvas[n.blendModes.COLOR_DODGE]="source-over",n.blendModesCanvas[n.blendModes.COLOR_BURN]="source-over",n.blendModesCanvas[n.blendModes.HARD_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.SOFT_LIGHT]="source-over",n.blendModesCanvas[n.blendModes.DIFFERENCE]="source-over",n.blendModesCanvas[n.blendModes.EXCLUSION]="source-over",n.blendModesCanvas[n.blendModes.HUE]="source-over",n.blendModesCanvas[n.blendModes.SATURATION]="source-over",n.blendModesCanvas[n.blendModes.COLOR]="source-over",n.blendModesCanvas[n.blendModes.LUMINOSITY]="source-over"));this.width=t||800;this.height=i||600;this.view=r||document.createElement("canvas");this.context=this.view.getContext("2d",{alpha:this.transparent});this.refresh=!0;this.view.width=this.width;this.view.height=this.height;this.count=0;this.maskManager=new n.CanvasMaskManager;this.renderSession={context:this.context,maskManager:this.maskManager,scaleMode:null,smoothProperty:null,roundPixels:!1};"imageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="imageSmoothingEnabled":"webkitImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="webkitImageSmoothingEnabled":"mozImageSmoothingEnabled"in this.context?this.renderSession.smoothProperty="mozImageSmoothingEnabled":"oImageSmoothingEnabled"in this.context&&(this.renderSession.smoothProperty="oImageSmoothingEnabled")};n.CanvasRenderer.prototype.constructor=n.CanvasRenderer;n.CanvasRenderer.prototype.render=function(t){n.texturesToUpdate.length=0;n.texturesToDestroy.length=0;t.updateTransform();this.context.setTransform(1,0,0,1,0,0);this.context.globalAlpha=1;navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());!this.transparent&&this.clearBeforeRender?(this.context.fillStyle=t.backgroundColorString,this.context.fillRect(0,0,this.width,this.height)):this.transparent&&this.clearBeforeRender&&this.context.clearRect(0,0,this.width,this.height);this.renderDisplayObject(t);t.interactive&&(t._interactiveEventsAdded||(t._interactiveEventsAdded=!0,t.interactionManager.setTarget(this)));n.Texture.frameUpdates.length>0&&(n.Texture.frameUpdates.length=0)};n.CanvasRenderer.prototype.resize=function(n,t){this.width=n;this.height=t;this.view.width=n;this.view.height=t};n.CanvasRenderer.prototype.renderDisplayObject=function(n,t){this.renderSession.context=t||this.context;n._renderCanvas(this.renderSession)};n.CanvasRenderer.prototype.renderStripFlat=function(n){var t=this.context,i=n.verticies,f=i.length/2,u;for(this.count++,t.beginPath(),u=1;u<f-2;u++){var r=u*2,e=i[r],o=i[r+2],s=i[r+4],h=i[r+1],c=i[r+3],l=i[r+5];t.moveTo(e,h);t.lineTo(o,c);t.lineTo(s,l)}t.fillStyle="#FF0000";t.fill();t.closePath()};n.CanvasRenderer.prototype.renderStrip=function(n){var i=this.context,h=n.verticies,w=n.uvs,d=h.length/2,k;for(this.count++,k=1;k<d-2;k++){var t=k*2,c=h[t],l=h[t+2],a=h[t+4],v=h[t+1],y=h[t+3],p=h[t+5],r=w[t]*n.texture.width,u=w[t+2]*n.texture.width,f=w[t+4]*n.texture.width,e=w[t+1]*n.texture.height,o=w[t+3]*n.texture.height,s=w[t+5]*n.texture.height;i.save();i.beginPath();i.moveTo(c,v);i.lineTo(l,y);i.lineTo(a,p);i.closePath();i.clip();var b=r*o+e*f+u*s-o*f-e*u-r*s,g=c*o+e*a+l*s-o*a-e*l-c*s,nt=r*l+c*f+u*a-l*f-c*u-r*a,tt=r*o*a+e*l*f+c*u*s-c*o*f-e*u*a-r*l*s,it=v*o+e*p+y*s-o*p-e*y-v*s,rt=r*y+v*f+u*p-y*f-v*u-r*p,ut=r*o*p+e*y*f+v*u*s-v*o*f-e*u*p-r*y*s;i.transform(g/b,it/b,nt/b,rt/b,tt/b,ut/b);i.drawImage(n.texture.baseTexture.source,0,0);i.restore()}};n.CanvasBuffer=function(n,t){this.width=n;this.height=t;this.canvas=document.createElement("canvas");this.context=this.canvas.getContext("2d");this.canvas.width=n;this.canvas.height=t};n.CanvasBuffer.prototype.clear=function(){this.context.clearRect(0,0,this.width,this.height)};n.CanvasBuffer.prototype.resize=function(n,t){this.width=this.canvas.width=n;this.height=this.canvas.height=t};n.CanvasGraphics=function(){};n.CanvasGraphics.renderGraphics=function(t,i){for(var r,u,p,s=t.worldAlpha,a="",tt=0;tt<t.graphicsData.length;tt++)if(r=t.graphicsData[tt],u=r.points,i.strokeStyle=a="#"+("00000"+(r.lineColor|0).toString(16)).substr(-6),i.lineWidth=r.lineWidth,r.type===n.Graphics.POLY){for(i.beginPath(),i.moveTo(u[0],u[1]),p=1;p<u.length/2;p++)i.lineTo(u[p*2],u[p*2+1]);u[0]===u[u.length-2]&&u[1]===u[u.length-1]&&i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}else if(r.type===n.Graphics.RECT)(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fillRect(u[0],u[1],u[2],u[3])),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.strokeRect(u[0],u[1],u[2],u[3]));else if(r.type===n.Graphics.CIRC)i.beginPath(),i.arc(u[0],u[1],u[2],0,2*Math.PI),i.closePath(),r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill()),r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke());else if(r.type===n.Graphics.ELIP){var b=r.points,k=b[2]*2,d=b[3]*2,v=b[0]-k/2,w=b[1]-d/2;i.beginPath();var ut=.5522848,g=k/2*ut,nt=d/2*ut,it=v+k,rt=w+d,y=v+k/2,h=w+d/2;i.moveTo(v,h);i.bezierCurveTo(v,h-nt,y-g,w,y,w);i.bezierCurveTo(y+g,w,it,h-nt,it,h);i.bezierCurveTo(it,h+nt,y+g,rt,y,rt);i.bezierCurveTo(y-g,rt,v,h+nt,v,h);i.closePath();r.fill&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}else if(r.type===n.Graphics.RREC){var f=u[0],e=u[1],c=u[2],l=u[3],o=u[4],ft=Math.min(c,l)/2|0;o=o>ft?ft:o;i.beginPath();i.moveTo(f,e+o);i.lineTo(f,e+l-o);i.quadraticCurveTo(f,e+l,f+o,e+l);i.lineTo(f+c-o,e+l);i.quadraticCurveTo(f+c,e+l,f+c,e+l-o);i.lineTo(f+c,e+o);i.quadraticCurveTo(f+c,e,f+c-o,e);i.lineTo(f+o,e);i.quadraticCurveTo(f,e,f,e+o);i.closePath();(r.fillColor||r.fillColor===0)&&(i.globalAlpha=r.fillAlpha*s,i.fillStyle=a="#"+("00000"+(r.fillColor|0).toString(16)).substr(-6),i.fill());r.lineWidth&&(i.globalAlpha=r.lineAlpha*s,i.stroke())}};n.CanvasGraphics.renderGraphicsMask=function(t,i){var nt=t.graphicsData.length,p,o,r,v;if(nt!==0)for(nt>1&&(nt=1,window.console.log("Pixi.js warning: masks in canvas can only mask using the first path in the graphics object")),p=0;p<1;p++)if(o=t.graphicsData[p],r=o.points,o.type===n.Graphics.POLY){for(i.beginPath(),i.moveTo(r[0],r[1]),v=1;v<r.length/2;v++)i.lineTo(r[v*2],r[v*2+1]);r[0]===r[r.length-2]&&r[1]===r[r.length-1]&&i.closePath()}else if(o.type===n.Graphics.RECT)i.beginPath(),i.rect(r[0],r[1],r[2],r[3]),i.closePath();else if(o.type===n.Graphics.CIRC)i.beginPath(),i.arc(r[0],r[1],r[2],0,2*Math.PI),i.closePath();else if(o.type===n.Graphics.ELIP){var w=o.points,b=w[2]*2,k=w[3]*2,l=w[0]-b/2,y=w[1]-k/2;i.beginPath();var rt=.5522848,d=b/2*rt,g=k/2*rt,tt=l+b,it=y+k,a=l+b/2,s=y+k/2;i.moveTo(l,s);i.bezierCurveTo(l,s-g,a-d,y,a,y);i.bezierCurveTo(a+d,y,tt,s-g,tt,s);i.bezierCurveTo(tt,s+g,a+d,it,a,it);i.bezierCurveTo(a-d,it,l,s+g,l,s);i.closePath()}else if(o.type===n.Graphics.RREC){var u=r[0],f=r[1],h=r[2],c=r[3],e=r[4],ut=Math.min(h,c)/2|0;e=e>ut?ut:e;i.beginPath();i.moveTo(u,f+e);i.lineTo(u,f+c-e);i.quadraticCurveTo(u,f+c,u+e,f+c);i.lineTo(u+h-e,f+c);i.quadraticCurveTo(u+h,f+c,u+h,f+c-e);i.lineTo(u+h,f+e);i.quadraticCurveTo(u+h,f,u+h-e,f);i.lineTo(u+e,f);i.quadraticCurveTo(u,f,u,f+e);i.closePath()}};n.Graphics=function(){n.DisplayObjectContainer.call(this);this.renderable=!0;this.fillAlpha=1;this.lineWidth=0;this.lineColor="black";this.graphicsData=[];this.tint=16777215;this.blendMode=n.blendModes.NORMAL;this.currentPath={points:[]};this._webGL=[];this.isMask=!1;this.bounds=null;this.boundsPadding=10;this.dirty=!0};n.Graphics.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Graphics.prototype.constructor=n.Graphics;Object.defineProperty(n.Graphics.prototype,"cacheAsBitmap",{get:function(){return this._cacheAsBitmap},set:function(n){this._cacheAsBitmap=n;this._cacheAsBitmap?this._generateCachedSprite():(this.destroyCachedSprite(),this.dirty=!0)}});n.Graphics.prototype.lineStyle=function(t,i,r){return this.currentPath.points.length||this.graphicsData.pop(),this.lineWidth=t||0,this.lineColor=i||0,this.lineAlpha=arguments.length<3?1:r,this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath),this};n.Graphics.prototype.moveTo=function(t,i){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath=this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.currentPath.points.push(t,i),this.graphicsData.push(this.currentPath),this};n.Graphics.prototype.lineTo=function(n,t){return this.currentPath.points.push(n,t),this.dirty=!0,this};n.Graphics.prototype.quadraticCurveTo=function(n,t,i,r){var o,s,h,u,e;this.currentPath.points.length===0&&this.moveTo(0,0);h=20;u=this.currentPath.points;u.length===0&&this.moveTo(0,0);var c=u[u.length-2],l=u[u.length-1],f=0;for(e=1;e<=h;e++)f=e/h,o=c+(n-c)*f,s=l+(t-l)*f,u.push(o+(n+(i-n)*f-o)*f,s+(t+(r-t)*f-s)*f);return this.dirty=!0,this};n.Graphics.prototype.bezierCurveTo=function(n,t,i,r,u,f){var l;this.currentPath.points.length===0&&this.moveTo(0,0);var y=20,o,h,a,c,v,s=this.currentPath.points,p=s[s.length-2],w=s[s.length-1],e=0;for(l=1;l<y;l++)e=l/y,o=1-e,h=o*o,a=h*o,c=e*e,v=c*e,s.push(a*p+3*h*e*n+3*o*c*i+v*u,a*w+3*h*e*t+3*o*c*r+v*f);return this.dirty=!0,this};n.Graphics.prototype.arcTo=function(n,t,i,r,u){this.currentPath.points.length===0&&this.moveTo(n,t);var h=this.currentPath.points,g=h[h.length-2],nt=h[h.length-1],f=nt-t,e=g-n,o=r-t,s=i-n,a=Math.abs(f*s-e*o);if(a<1e-8||u===0)h.push(n,t);else{var p=f*f+e*e,w=o*o+s*s,b=f*o+e*s,c=u*Math.sqrt(p)/a,l=u*Math.sqrt(w)/a,k=c*b/p,d=l*b/w,v=c*s+l*e,y=c*o+l*f,tt=e*(l+k),it=f*(l+k),rt=s*(c+d),ut=o*(c+d),ft=Math.atan2(it-y,tt-v),et=Math.atan2(ut-y,rt-v);this.arc(v+n,y+t,u,ft,et,e*o>s*f)}return this.dirty=!0,this};n.Graphics.prototype.arc=function(n,t,i,r,u,f){var a=n+Math.cos(r)*i,v=t+Math.sin(r)*i,e=this.currentPath.points,s,c,o;if(((e.length!==0&&e[e.length-2]!==a||e[e.length-1]!==v)&&(this.moveTo(a,v),e=this.currentPath.points),r===u)||(!f&&u<=r?u+=Math.PI*2:f&&r<=u&&(r+=Math.PI*2),s=f?(r-u)*-1:u-r,c=Math.abs(s)/(Math.PI*2)*40,s===0))return this;var h=s/(c*2),d=h*2,y=Math.cos(h),p=Math.sin(h),l=c-1,g=l%1/l;for(o=0;o<=l;o++){var nt=o+g*o,w=h+r+d*nt,b=Math.cos(w),k=-Math.sin(w);e.push((y*b+p*k)*i+n,(y*-k+p*b)*i+t)}return this.dirty=!0,this};n.Graphics.prototype.drawPath=function(t){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[],type:n.Graphics.POLY},this.graphicsData.push(this.currentPath),this.currentPath.points=this.currentPath.points.concat(t),this.dirty=!0,this};n.Graphics.prototype.beginFill=function(n,t){return this.filling=!0,this.fillColor=n||0,this.fillAlpha=arguments.length<2?1:t,this};n.Graphics.prototype.endFill=function(){return this.filling=!1,this.fillColor=null,this.fillAlpha=1,this};n.Graphics.prototype.drawRect=function(t,i,r,u){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u],type:n.Graphics.RECT},this.graphicsData.push(this.currentPath),this.dirty=!0,this};n.Graphics.prototype.drawRoundedRect=function(t,i,r,u,f){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u,f],type:n.Graphics.RREC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};n.Graphics.prototype.drawCircle=function(t,i,r){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,r],type:n.Graphics.CIRC},this.graphicsData.push(this.currentPath),this.dirty=!0,this};n.Graphics.prototype.drawEllipse=function(t,i,r,u){return this.currentPath.points.length||this.graphicsData.pop(),this.currentPath={lineWidth:this.lineWidth,lineColor:this.lineColor,lineAlpha:this.lineAlpha,fillColor:this.fillColor,fillAlpha:this.fillAlpha,fill:this.filling,points:[t,i,r,u],type:n.Graphics.ELIP},this.graphicsData.push(this.currentPath),this.dirty=!0,this};n.Graphics.prototype.clear=function(){return this.lineWidth=0,this.filling=!1,this.dirty=!0,this.clearDirty=!0,this.graphicsData=[],this.bounds=null,this};n.Graphics.prototype.generateTexture=function(){var t=this.getBounds(),i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas);return i.context.translate(-t.x,-t.y),n.CanvasGraphics.renderGraphics(this,i.context),r};n.Graphics.prototype._renderWebGL=function(t){var r,i,u;if(this.visible!==!1&&this.alpha!==0&&this.isMask!==!0){if(this._cacheAsBitmap){this.dirty&&(this._generateCachedSprite(),n.updateWebGLTexture(this._cachedSprite.texture.baseTexture,t.gl),this.dirty=!1);this._cachedSprite.alpha=this.alpha;n.Sprite.prototype._renderWebGL.call(this._cachedSprite,t);return}if(t.spriteBatch.stop(),t.blendModeManager.setBlendMode(this.blendMode),this._mask&&t.maskManager.pushMask(this._mask,t),this._filters&&t.filterManager.pushFilter(this._filterBlock),this.blendMode!==t.spriteBatch.currentBlendMode&&(t.spriteBatch.currentBlendMode=this.blendMode,r=n.blendModesWebGL[t.spriteBatch.currentBlendMode],t.spriteBatch.gl.blendFunc(r[0],r[1])),n.WebGLGraphics.renderGraphics(this,t),this.children.length){for(t.spriteBatch.start(),i=0,u=this.children.length;i<u;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop()}this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this.mask,t);t.drawCount++;t.spriteBatch.start()}};n.Graphics.prototype._renderCanvas=function(t){var r,i,u,f;if(this.visible!==!1&&this.alpha!==0&&this.isMask!==!0){for(r=t.context,i=this.worldTransform,this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,r.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),this._mask&&t.maskManager.pushMask(this._mask,t.context),r.setTransform(i.a,i.c,i.b,i.d,i.tx,i.ty),n.CanvasGraphics.renderGraphics(this,r),u=0,f=this.children.length;u<f;u++)this.children[u]._renderCanvas(t);this._mask&&t.maskManager.popMask(t.context)}};n.Graphics.prototype.getBounds=function(n){var e;this.bounds||this.updateBounds();var o=this.bounds.x,s=this.bounds.width+this.bounds.x,h=this.bounds.y,c=this.bounds.height+this.bounds.y,f=n||this.worldTransform,l=f.a,a=f.c,v=f.b,y=f.d,p=f.tx,w=f.ty,it=l*s+v*c+p,rt=y*c+a*s+w,b=l*o+v*c+p,k=y*c+a*o+w,d=l*o+v*h+p,g=y*h+a*o+w,nt=l*s+v*h+p,tt=y*h+a*s+w,r=it,u=rt,t=it,i=rt;return t=b<t?b:t,t=d<t?d:t,t=nt<t?nt:t,i=k<i?k:i,i=g<i?g:i,i=tt<i?tt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,u=k>u?k:u,u=g>u?g:u,u=tt>u?tt:u,e=this._bounds,e.x=t,e.width=r-t,e.y=i,e.height=u-i,e};n.Graphics.prototype.updateBounds=function(){for(var l,a,f=Infinity,o=-Infinity,e=Infinity,s=-Infinity,u,t,i,h,c,v=0;v<this.graphicsData.length;v++){var y=this.graphicsData[v],p=y.type,r=y.lineWidth;if(u=y.points,p===n.Graphics.RECT)t=u[0]-r/2,i=u[1]-r/2,h=u[2]+r,c=u[3]+r,f=t<f?t:f,o=t+h>o?t+h:o,e=i<e?t:e,s=i+c>s?i+c:s;else if(p===n.Graphics.CIRC||p===n.Graphics.ELIP)t=u[0],i=u[1],h=u[2]+r/2,c=u[3]+r/2,f=t-h<f?t-h:f,o=t+h>o?t+h:o,e=i-c<e?i-c:e,s=i+c>s?i+c:s;else for(l=0;l<u.length;l+=2)t=u[l],i=u[l+1],f=t-r<f?t-r:f,o=t+r>o?t+r:o,e=i-r<e?i-r:e,s=i+r>s?i+r:s}a=this.boundsPadding;this.bounds=new n.Rectangle(f-a,e-a,o-f+a*2,s-e+a*2)};n.Graphics.prototype._generateCachedSprite=function(){var t=this.getLocalBounds(),i,r;this._cachedSprite?this._cachedSprite.buffer.resize(t.width,t.height):(i=new n.CanvasBuffer(t.width,t.height),r=n.Texture.fromCanvas(i.canvas),this._cachedSprite=new n.Sprite(r),this._cachedSprite.buffer=i,this._cachedSprite.worldTransform=this.worldTransform);this._cachedSprite.anchor.x=-(t.x/t.width);this._cachedSprite.anchor.y=-(t.y/t.height);this._cachedSprite.buffer.context.translate(-t.x,-t.y);n.CanvasGraphics.renderGraphics(this,this._cachedSprite.buffer.context);this._cachedSprite.alpha=this.alpha};n.Graphics.prototype.destroyCachedSprite=function(){this._cachedSprite.texture.destroy(!0);this._cachedSprite=null};n.Graphics.POLY=0;n.Graphics.RECT=1;n.Graphics.CIRC=2;n.Graphics.ELIP=3;n.Graphics.RREC=4;n.Strip=function(t){n.DisplayObjectContainer.call(this);this.texture=t;this.uvs=new n.Float32Array([0,1,1,1,1,0,0,1]);this.verticies=new n.Float32Array([0,0,100,0,100,100,0,100]);this.colors=new n.Float32Array([1,1,1,1]);this.indices=new n.Uint16Array([0,1,2,3]);this.dirty=!0;this.padding=0};n.Strip.prototype=Object.create(n.DisplayObjectContainer.prototype);n.Strip.prototype.constructor=n.Strip;n.Strip.prototype._renderWebGL=function(n){!this.visible||this.alpha<=0||(n.spriteBatch.stop(),this._vertexBuffer||this._initWebGL(n),n.shaderManager.setShader(n.shaderManager.stripShader),this._renderStrip(n),n.spriteBatch.start())};n.Strip.prototype._initWebGL=function(n){var t=n.gl;this._vertexBuffer=t.createBuffer();this._indexBuffer=t.createBuffer();this._uvBuffer=t.createBuffer();this._colorBuffer=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer);t.bufferData(t.ARRAY_BUFFER,this.verticies,t.DYNAMIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._uvBuffer);t.bufferData(t.ARRAY_BUFFER,this.uvs,t.STATIC_DRAW);t.bindBuffer(t.ARRAY_BUFFER,this._colorBuffer);t.bufferData(t.ARRAY_BUFFER,this.colors,t.STATIC_DRAW);t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer);t.bufferData(t.ELEMENT_ARRAY_BUFFER,this.indices,t.STATIC_DRAW)};n.Strip.prototype._renderStrip=function(t){var i=t.gl,u=t.projection,f=t.offset,r=t.shaderManager.stripShader;i.blendFunc(i.ONE,i.ONE_MINUS_SRC_ALPHA);i.uniformMatrix3fv(r.translationMatrix,!1,this.worldTransform.toArray(!0));i.uniform2f(r.projectionVector,u.x,-u.y);i.uniform2f(r.offsetVector,-f.x,-f.y);i.uniform1f(r.alpha,1);this.dirty?(this.dirty=!1,i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferData(i.ARRAY_BUFFER,this.verticies,i.STATIC_DRAW),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.bufferData(i.ARRAY_BUFFER,this.uvs,i.STATIC_DRAW),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]||n.createWebGLTexture(this.texture.baseTexture,i)),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,this.indices,i.STATIC_DRAW)):(i.bindBuffer(i.ARRAY_BUFFER,this._vertexBuffer),i.bufferSubData(i.ARRAY_BUFFER,0,this.verticies),i.vertexAttribPointer(r.aVertexPosition,2,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._uvBuffer),i.vertexAttribPointer(r.aTextureCoord,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.texture.baseTexture._glTextures[i.id]||n.createWebGLTexture(this.texture.baseTexture,i)),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer));i.drawElements(i.TRIANGLE_STRIP,this.indices.length,i.UNSIGNED_SHORT,0)};n.Strip.prototype._renderCanvas=function(n){var i=n.context,r=this.worldTransform,ut;n.roundPixels?i.setTransform(r.a,r.c,r.b,r.d,r.tx|0,r.ty|0):i.setTransform(r.a,r.c,r.b,r.d,r.tx,r.ty);var d=this,g=d.verticies,nt=d.uvs,ft=g.length/2;for(this.count++,ut=0;ut<ft-2;ut++){var u=ut*2,o=g[u],s=g[u+2],h=g[u+4],c=g[u+1],l=g[u+3],a=g[u+5];if(this.padding===0){var tt=(o+s+h)/3,it=(c+l+a)/3,f=o-tt,e=c-it,t=Math.sqrt(f*f+e*e);o=tt+f/t*(t+3);c=it+e/t*(t+3);f=s-tt;e=l-it;t=Math.sqrt(f*f+e*e);s=tt+f/t*(t+3);l=it+e/t*(t+3);f=h-tt;e=a-it;t=Math.sqrt(f*f+e*e);h=tt+f/t*(t+3);a=it+e/t*(t+3)}var v=nt[u]*d.texture.width,y=nt[u+2]*d.texture.width,p=nt[u+4]*d.texture.width,w=nt[u+1]*d.texture.height,b=nt[u+3]*d.texture.height,k=nt[u+5]*d.texture.height;i.save();i.beginPath();i.moveTo(o,c);i.lineTo(s,l);i.lineTo(h,a);i.closePath();i.clip();var rt=v*b+w*p+y*k-b*p-w*y-v*k,et=o*b+w*h+s*k-b*h-w*s-o*k,ot=v*s+o*p+y*h-s*p-o*y-v*h,st=v*b*h+w*s*p+o*y*k-o*b*p-w*y*h-v*s*k,ht=c*b+w*a+l*k-b*a-w*l-c*k,ct=v*l+c*p+y*a-l*p-c*y-v*a,lt=v*b*a+w*l*p+c*y*k-c*b*p-w*y*a-v*l*k;i.transform(et/rt,ht/rt,ot/rt,ct/rt,st/rt,lt/rt);i.drawImage(d.texture.baseTexture.source,0,0);i.restore()}};n.Strip.prototype.onTextureUpdate=function(){this.updateFrame=!0};n.Rope=function(t,i){n.Strip.call(this,t);this.points=i;this.verticies=new n.Float32Array(i.length*4);this.uvs=new n.Float32Array(i.length*4);this.colors=new n.Float32Array(i.length*2);this.indices=new n.Uint16Array(i.length*2);this.refresh()};n.Rope.prototype=Object.create(n.Strip.prototype);n.Rope.prototype.constructor=n.Rope;n.Rope.prototype.refresh=function(){var u=this.points,o,s,n,r,i;if(!(u.length<1)){var t=this.uvs,h=u[0],f=this.indices,e=this.colors;for(this.count-=.2,t[0]=0,t[1]=0,t[2]=0,t[3]=1,e[0]=1,e[1]=1,f[0]=0,f[1]=1,o=u.length,i=1;i<o;i++)s=u[i],n=i*4,r=i/(o-1),i%2?(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1):(t[n]=r,t[n+1]=0,t[n+2]=r,t[n+3]=1),n=i*2,e[n]=1,e[n+1]=1,n=i*2,f[n]=n,f[n+1]=n+1,h=s}};n.Rope.prototype.updateTransform=function(){var u=this.points,o,s,t,f,h,r,e,c,l,a,i;if(!(u.length<1)){for(o=u[0],t={x:0,y:0},this.count-=.2,f=this.verticies,h=u.length,i=0;i<h;i++)r=u[i],e=i*4,s=i<u.length-1?u[i+1]:r,t.y=-(s.x-o.x),t.x=s.y-o.y,c=(1-i/(h-1))*10,c>1&&(c=1),l=Math.sqrt(t.x*t.x+t.y*t.y),a=this.texture.height/2,t.x/=l,t.y/=l,t.x*=a,t.y*=a,f[e]=r.x+t.x,f[e+1]=r.y+t.y,f[e+2]=r.x-t.x,f[e+3]=r.y-t.y,o=r;n.DisplayObjectContainer.prototype.updateTransform.call(this)}};n.Rope.prototype.setTexture=function(n){this.texture=n};n.TilingSprite=function(t,i,r){n.Sprite.call(this,t);this._width=i||100;this._height=r||100;this.tileScale=new n.Point(1,1);this.tileScaleOffset=new n.Point(1,1);this.tilePosition=new n.Point(0,0);this.renderable=!0;this.tint=16777215;this.blendMode=n.blendModes.NORMAL};n.TilingSprite.prototype=Object.create(n.Sprite.prototype);n.TilingSprite.prototype.constructor=n.TilingSprite;Object.defineProperty(n.TilingSprite.prototype,"width",{get:function(){return this._width},set:function(n){this._width=n}});Object.defineProperty(n.TilingSprite.prototype,"height",{get:function(){return this._height},set:function(n){this._height=n}});n.TilingSprite.prototype.setTexture=function(n){this.texture!==n&&(this.texture=n,this.refreshTexture=!0,this.cachedTint=16777215)};n.TilingSprite.prototype._renderWebGL=function(t){if(this.visible!==!1&&this.alpha!==0){var i,r;for(this._mask&&(t.spriteBatch.stop(),t.maskManager.pushMask(this.mask,t),t.spriteBatch.start()),this._filters&&(t.spriteBatch.flush(),t.filterManager.pushFilter(this._filterBlock)),!this.tilingTexture||this.refreshTexture?(this.generateTilingTexture(!0),this.tilingTexture&&this.tilingTexture.needsUpdate&&(n.updateWebGLTexture(this.tilingTexture.baseTexture,t.gl),this.tilingTexture.needsUpdate=!1)):t.spriteBatch.renderTilingSprite(this),i=0,r=this.children.length;i<r;i++)this.children[i]._renderWebGL(t);t.spriteBatch.stop();this._filters&&t.filterManager.popFilter();this._mask&&t.maskManager.popMask(this._mask,t);t.spriteBatch.start()}};n.TilingSprite.prototype._renderCanvas=function(t){var i,u,e,o,r,f;if(this.visible!==!1&&this.alpha!==0){if(i=t.context,this._mask&&t.maskManager.pushMask(this._mask,i),i.globalAlpha=this.worldAlpha,u=this.worldTransform,i.setTransform(u.a,u.c,u.b,u.d,u.tx,u.ty),!this.__tilePattern||this.refreshTexture)if(this.generateTilingTexture(!1),this.tilingTexture)this.__tilePattern=i.createPattern(this.tilingTexture.baseTexture.source,"repeat");else return;for(this.blendMode!==t.currentBlendMode&&(t.currentBlendMode=this.blendMode,i.globalCompositeOperation=n.blendModesCanvas[t.currentBlendMode]),r=this.tilePosition,f=this.tileScale,r.x%=this.tilingTexture.baseTexture.width,r.y%=this.tilingTexture.baseTexture.height,i.scale(f.x,f.y),i.translate(r.x,r.y),i.fillStyle=this.__tilePattern,i.fillRect(-r.x+this.anchor.x*-this._width,-r.y+this.anchor.y*-this._height,this._width/f.x,this._height/f.y),i.scale(1/f.x,1/f.y),i.translate(-r.x,-r.y),this._mask&&t.maskManager.popMask(t.context),e=0,o=this.children.length;e<o;e++)this.children[e]._renderCanvas(t)}};n.TilingSprite.prototype.getBounds=function(){var rt=this._width,ut=this._height,e=rt*(1-this.anchor.x),o=rt*-this.anchor.x,s=ut*(1-this.anchor.y),h=ut*-this.anchor.y,f=this.worldTransform,c=f.a,l=f.c,a=f.b,v=f.d,y=f.tx,p=f.ty,w=c*o+a*h+y,b=v*h+l*o+p,k=c*e+a*h+y,d=v*h+l*e+p,g=c*e+a*s+y,nt=v*s+l*e+p,tt=c*o+a*s+y,it=v*s+l*o+p,i=-Infinity,r=-Infinity,n=Infinity,t=Infinity,u;return n=w<n?w:n,n=k<n?k:n,n=g<n?g:n,n=tt<n?tt:n,t=b<t?b:t,t=d<t?d:t,t=nt<t?nt:t,t=it<t?it:t,i=w>i?w:i,i=k>i?k:i,i=g>i?g:i,i=tt>i?tt:i,r=b>r?b:r,r=d>r?d:r,r=nt>r?nt:r,r=it>r?it:r,u=this._bounds,u.x=n,u.width=i-n,u.y=t,u.height=r-t,this._currentBounds=u,u};n.TilingSprite.prototype.onTextureUpdate=function(){};n.TilingSprite.prototype.generateTilingTexture=function(t){var e;if(this.texture.baseTexture.hasLoaded){var r=this.texture,i=r.frame,u,f,s=i.width!==r.baseTexture.width||i.height!==r.baseTexture.height,o=!1;t?(u=n.getNextPowerOfTwo(i.width),f=n.getNextPowerOfTwo(i.height),(i.width!==u||i.height!==f)&&(o=!0)):s&&(u=i.width,f=i.height,o=!0);o?(this.tilingTexture&&this.tilingTexture.isTiling?(e=this.tilingTexture.canvasBuffer,e.resize(u,f),this.tilingTexture.baseTexture.width=u,this.tilingTexture.baseTexture.height=f,this.tilingTexture.needsUpdate=!0):(e=new n.CanvasBuffer(u,f),this.tilingTexture=n.Texture.fromCanvas(e.canvas),this.tilingTexture.canvasBuffer=e,this.tilingTexture.isTiling=!0),e.context.drawImage(r.baseTexture.source,r.crop.x,r.crop.y,r.crop.width,r.crop.height,0,0,u,f),this.tileScaleOffset.x=i.width/u,this.tileScaleOffset.y=i.height/f):(this.tilingTexture&&this.tilingTexture.isTiling&&this.tilingTexture.destroy(!0),this.tileScaleOffset.x=1,this.tileScaleOffset.y=1,this.tilingTexture=r);this.refreshTexture=!1;this.tilingTexture.baseTexture._powerOf2=!0}};n.BaseTextureCache={};n.texturesToUpdate=[];n.texturesToDestroy=[];n.BaseTextureCacheIdGenerator=0;n.BaseTexture=function(t,i){if(n.EventTarget.call(this),this.width=100,this.height=100,this.scaleMode=i||n.scaleModes.DEFAULT,this.hasLoaded=!1,this.source=t,this.id=n.BaseTextureCacheIdGenerator++,this.premultipliedAlpha=!0,this._glTextures=[],this._dirty=[],t){if((this.source.complete||this.source.getContext)&&this.source.width&&this.source.height)this.hasLoaded=!0,this.width=this.source.width,this.height=this.source.height,n.texturesToUpdate.push(this);else{var r=this;this.source.onload=function(){r.hasLoaded=!0;r.width=r.source.width;r.height=r.source.height;for(var n=0;n<r._glTextures.length;n++)r._dirty[n]=!0;r.dispatchEvent({type:"loaded",content:r})};this.source.onerror=function(){r.dispatchEvent({type:"error",content:r})}}this.imageUrl=null;this._powerOf2=!1}};n.BaseTexture.prototype.constructor=n.BaseTexture;n.BaseTexture.prototype.destroy=function(){this.imageUrl?(delete n.BaseTextureCache[this.imageUrl],delete n.TextureCache[this.imageUrl],this.imageUrl=null,this.source.src=null):this.source&&this.source._pixiId&&delete n.BaseTextureCache[this.source._pixiId];this.source=null;n.texturesToDestroy.push(this)};n.BaseTexture.prototype.updateSourceImage=function(n){this.hasLoaded=!1;this.source.src=null;this.source.src=n};n.BaseTexture.fromImage=function(t,i,r){var u=n.BaseTextureCache[t],f;return i===undefined&&t.indexOf("data:")===-1&&(i=!0),u||(f=new Image,i&&(f.crossOrigin=""),f.src=t,u=new n.BaseTexture(f,r),u.imageUrl=t,n.BaseTextureCache[t]=u),u};n.BaseTexture.fromCanvas=function(t,i){t._pixiId||(t._pixiId="canvas_"+n.TextureCacheIdGenerator++);var r=n.BaseTextureCache[t._pixiId];return r||(r=new n.BaseTexture(t,i),n.BaseTextureCache[t._pixiId]=r),r};n.TextureCache={};n.FrameCache={};n.TextureCacheIdGenerator=0;n.Texture=function(t,i){n.EventTarget.call(this);this.noFrame=!1;i||(this.noFrame=!0,i=new n.Rectangle(0,0,1,1));t instanceof n.Texture&&(t=t.baseTexture);this.baseTexture=t;this.frame=i;this.trim=null;this.valid=!1;this._uvs=null;this.width=0;this.height=0;this.crop=new n.Rectangle(0,0,1,1);t.hasLoaded?(this.noFrame&&(i=new n.Rectangle(0,0,t.width,t.height)),this.setFrame(i)):t.addEventListener("loaded",this.onBaseTextureLoaded.bind(this))};n.Texture.prototype.constructor=n.Texture;n.Texture.prototype.onBaseTextureLoaded=function(){var t=this.baseTexture;t.removeEventListener("loaded",this.onLoaded);this.noFrame&&(this.frame=new n.Rectangle(0,0,t.width,t.height));this.setFrame(this.frame);this.dispatchEvent({type:"update",content:this})};n.Texture.prototype.destroy=function(n){n&&this.baseTexture.destroy();this.valid=!1};n.Texture.prototype.setFrame=function(t){if(this.noFrame=!1,this.frame=t,this.width=t.width,this.height=t.height,this.crop.x=t.x,this.crop.y=t.y,this.crop.width=t.width,this.crop.height=t.height,!this.trim&&(t.x+t.width>this.baseTexture.width||t.y+t.height>this.baseTexture.height))throw new Error("Texture Error: frame does not fit inside the base Texture dimensions "+this);this.valid=t&&t.width&&t.height&&this.baseTexture.source&&this.baseTexture.hasLoaded;this.trim&&(this.width=this.trim.width,this.height=this.trim.height,this.frame.width=this.trim.width,this.frame.height=this.trim.height);this.valid&&n.Texture.frameUpdates.push(this)};n.Texture.prototype._updateWebGLuvs=function(){this._uvs||(this._uvs=new n.TextureUvs);var t=this.crop,i=this.baseTexture.width,r=this.baseTexture.height;this._uvs.x0=t.x/i;this._uvs.y0=t.y/r;this._uvs.x1=(t.x+t.width)/i;this._uvs.y1=t.y/r;this._uvs.x2=(t.x+t.width)/i;this._uvs.y2=(t.y+t.height)/r;this._uvs.x3=t.x/i;this._uvs.y3=(t.y+t.height)/r};n.Texture.fromImage=function(t,i,r){var u=n.TextureCache[t];return u||(u=new n.Texture(n.BaseTexture.fromImage(t,i,r)),n.TextureCache[t]=u),u};n.Texture.fromFrame=function(t){var i=n.TextureCache[t];if(!i)throw new Error('The frameId "'+t+'" does not exist in the texture cache ');return i};n.Texture.fromCanvas=function(t,i){var r=n.BaseTexture.fromCanvas(t,i);return new n.Texture(r)};n.Texture.addTextureToCache=function(t,i){n.TextureCache[i]=t};n.Texture.removeTextureFromCache=function(t){var i=n.TextureCache[t];return delete n.TextureCache[t],delete n.BaseTextureCache[t],i};n.Texture.frameUpdates=[];n.TextureUvs=function(){this.x0=0;this.y0=0;this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.x3=0;this.y3=0};n.RenderTexture=function(t,i,r,u){if(n.EventTarget.call(this),this.width=t||100,this.height=i||100,this.frame=new n.Rectangle(0,0,this.width,this.height),this.crop=new n.Rectangle(0,0,this.width,this.height),this.baseTexture=new n.BaseTexture,this.baseTexture.width=this.width,this.baseTexture.height=this.height,this.baseTexture._glTextures=[],this.baseTexture.scaleMode=u||n.scaleModes.DEFAULT,this.baseTexture.hasLoaded=!0,this.renderer=r||n.defaultRenderer,this.renderer.type===n.WEBGL_RENDERER){var f=this.renderer.gl;this.textureBuffer=new n.FilterTexture(f,this.width,this.height,this.baseTexture.scaleMode);this.baseTexture._glTextures[f.id]=this.textureBuffer.texture;this.render=this.renderWebGL;this.projection=new n.Point(this.width/2,-this.height/2)}else this.render=this.renderCanvas,this.textureBuffer=new n.CanvasBuffer(this.width,this.height),this.baseTexture.source=this.textureBuffer.canvas;this.valid=!0;n.Texture.frameUpdates.push(this)};n.RenderTexture.prototype=Object.create(n.Texture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.resize=function(t,i,r){(t!==this.width||i!==this.height)&&(this.valid=t>0&&i>0,this.width=this.frame.width=this.crop.width=t,this.height=this.frame.height=this.crop.height=i,r&&(this.baseTexture.width=this.width,this.baseTexture.height=this.height),this.renderer.type===n.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid)&&this.textureBuffer.resize(this.width,this.height)};n.RenderTexture.prototype.clear=function(){this.valid&&(this.renderer.type===n.WEBGL_RENDERER&&this.renderer.gl.bindFramebuffer(this.renderer.gl.FRAMEBUFFER,this.textureBuffer.frameBuffer),this.textureBuffer.clear())};n.RenderTexture.prototype.renderWebGL=function(t,i,r){var u,e,o,f,s;if(this.valid){for(u=this.renderer.gl,u.colorMask(!0,!0,!0,!0),u.viewport(0,0,this.width,this.height),u.bindFramebuffer(u.FRAMEBUFFER,this.textureBuffer.frameBuffer),r&&this.textureBuffer.clear(),e=t.children,o=t.worldTransform,t.worldTransform=n.RenderTexture.tempMatrix,t.worldTransform.d=-1,t.worldTransform.ty=this.projection.y*-2,i&&(t.worldTransform.tx=i.x,t.worldTransform.ty-=i.y),f=0,s=e.length;f<s;f++)e[f].updateTransform();n.WebGLRenderer.updateTextures();this.renderer.spriteBatch.dirty=!0;this.renderer.renderDisplayObject(t,this.projection,this.textureBuffer.frameBuffer);t.worldTransform=o;this.renderer.spriteBatch.dirty=!0}};n.RenderTexture.prototype.renderCanvas=function(t,i,r){var f,o,u,s,e;if(this.valid){for(f=t.children,o=t.worldTransform,t.worldTransform=n.RenderTexture.tempMatrix,i?(t.worldTransform.tx=i.x,t.worldTransform.ty=i.y):(t.worldTransform.tx=0,t.worldTransform.ty=0),u=0,s=f.length;u<s;u++)f[u].updateTransform();r&&this.textureBuffer.clear();e=this.textureBuffer.context;this.renderer.renderDisplayObject(t,e);e.setTransform(1,0,0,1,0,0);t.worldTransform=o}};n.RenderTexture.prototype.getImage=function(){var n=new Image;return n.src=this.getBase64(),n};n.RenderTexture.prototype.getBase64=function(){return this.getCanvas().toDataURL()};n.RenderTexture.prototype.getCanvas=function(){var t,u;if(this.renderer.type===n.WEBGL_RENDERER){var i=this.renderer.gl,f=this.textureBuffer.width,e=this.textureBuffer.height,r=new Uint8Array(4*f*e);i.bindFramebuffer(i.FRAMEBUFFER,this.textureBuffer.frameBuffer);i.readPixels(0,0,f,e,i.RGBA,i.UNSIGNED_BYTE,r);i.bindFramebuffer(i.FRAMEBUFFER,null);var s=new n.CanvasBuffer(f,e),h=s.context.getImageData(0,0,f,e),o=h.data;for(t=0;t<r.length;t+=4)u=r[t+3],o[t]=r[t]*u,o[t+1]=r[t+1]*u,o[t+2]=r[t+2]*u,o[t+3]=u;return s.context.putImageData(h,0,0),s.canvas}return this.textureBuffer.canvas};n.RenderTexture.tempMatrix=new n.Matrix;typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.PIXI=n):typeof define!="undefined"&&define.amd?define("PIXI",function(){return t.PIXI=n}()):t.PIXI=n}).call(this);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*
* @overview
*
* Phaser - http://phaser.io
*
* v2.1.1 "Eianrod" - Built: Thu Sep 11 2014 10:37:16
*
* By Richard Davey http://www.photonstorm.com @photonstorm
*
* Phaser is a fun, free and fast 2D game framework for making HTML5 games
* for desktop and mobile web browsers, supporting Canvas and WebGL rendering.
*
* Phaser uses Pixi.js for rendering, created by Mat Groves http://matgroves.com @Doormat23
* Phaser uses p2.js for full-body physics, created by Stefan Hedman https://github.com/schteppe/p2.js @schteppe
* Phaser contains a port of N+ Physics, converted by Richard Davey, original by http://www.metanetsoftware.com
*
* Many thanks to Adam Saltsman (@ADAMATOMIC) for releasing Flixel, from which both Phaser
* and my love of framework development originate.
*
* Follow development at http://phaser.io and on our forum
*
* "If you want your children to be intelligent,  read them fairy tales."
* "If you want them to be more intelligent, read them more fairy tales."
*                                                     -- Albert Einstein
*/
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
(function(){var i=this,n,t;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n=n||{VERSION:"2.1.1",GAMES:[],AUTO:0,CANVAS:1,WEBGL:2,HEADLESS:3,NONE:0,LEFT:1,RIGHT:2,UP:3,DOWN:4,SPRITE:0,BUTTON:1,IMAGE:2,GRAPHICS:3,TEXT:4,TILESPRITE:5,BITMAPTEXT:6,GROUP:7,RENDERTEXTURE:8,TILEMAP:9,TILEMAPLAYER:10,EMITTER:11,POLYGON:12,BITMAPDATA:13,CANVAS_FILTER:14,WEBGL_FILTER:15,ELLIPSE:16,SPRITEBATCH:17,RETROFONT:18,POINTER:19,ROPE:20,blendModes:{NORMAL:0,ADD:1,MULTIPLY:2,SCREEN:3,OVERLAY:4,DARKEN:5,LIGHTEN:6,COLOR_DODGE:7,COLOR_BURN:8,HARD_LIGHT:9,SOFT_LIGHT:10,DIFFERENCE:11,EXCLUSION:12,HUE:13,SATURATION:14,COLOR:15,LUMINOSITY:16},scaleModes:{DEFAULT:0,LINEAR:0,NEAREST:1}};PIXI.InteractionManager=PIXI.InteractionManager||function(){};PIXI.dontSayHello=!0;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils={getProperty:function(n,t){for(var i=t.split("."),f=i.pop(),e=i.length,r=1,u=i[0];r<e&&(n=n[u]);)u=i[r],r++;return n?n[f]:null},setProperty:function(n,t,i){for(var r=t.split("."),e=r.pop(),o=r.length,u=1,f=r[0];u<o&&(n=n[f]);)f=r[u],u++;return n&&(n[e]=i),n},transposeArray:function(n){for(var i,r=new Array(n[0].length),t=0;t<n[0].length;t++)for(r[t]=new Array(n.length-1),i=n.length-1;i>-1;i--)r[t][i]=n[i][t];return r},rotateArray:function(t,i){if(typeof i!="string"&&(i=(i%360+360)%360),i===90||i===-270||i==="rotateLeft")t=n.Utils.transposeArray(t),t=t.reverse();else if(i===-90||i===270||i==="rotateRight")t=t.reverse(),t=n.Utils.transposeArray(t);else if(Math.abs(i)===180||i==="rotate180"){for(var r=0;r<t.length;r++)t[r].reverse();t=t.reverse()}return t},parseDimension:function(n,t){var r=0,i=0;return typeof n=="string"?n.substr(-1)==="%"?(r=parseInt(n,10)/100,i=t===0?window.innerWidth*r:window.innerHeight*r):i=parseInt(n,10):i=n,i},shuffle:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},pad:function(n,t,i,r){var t,i,r,u,f,e;if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=" "),typeof r=="undefined"&&(r=3),u=0,t+1>=n.length)switch(r){case 1:n=new Array(t+1-n.length).join(i)+n;break;case 3:f=Math.ceil((u=t-n.length)/2);e=u-f;n=new Array(e+1).join(i)+n+new Array(f+1).join(i);break;default:n=n+new Array(t+1-n.length).join(i)}return n},isPlainObject:function(n){if(typeof n!="object"||n.nodeType||n===n.window)return!1;try{if(n.constructor&&!{}.hasOwnProperty.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},extend:function(){var e,f,r,i,o,s,t=arguments[0]||{},u=1,c=arguments.length,h=!1;for(typeof t=="boolean"&&(h=t,t=arguments[1]||{},u=2),c===u&&(t=this,--u);u<c;u++)if((e=arguments[u])!=null)for(f in e)(r=t[f],i=e[f],t!==i)&&(h&&i&&(n.Utils.isPlainObject(i)||(o=Array.isArray(i)))?(o?(o=!1,s=r&&Array.isArray(r)?r:[]):s=r&&n.Utils.isPlainObject(r)?r:{},t[f]=n.Utils.extend(h,s,i)):i!==undefined&&(t[f]=i));return t},mixin:function(t,i){var r,u,f;if(!t||typeof t!="object")return i;for(r in t)(u=t[r],u.childNodes||u.cloneNode)||(f=typeof t[r],i[r]=t[r]&&f==="object"?typeof i[r]===f?n.Utils.mixin(t[r],i[r]):n.Utils.mixin(t[r],new u.constructor):t[r]);return i}};typeof Function.prototype.bind!="function"&&(Function.prototype.bind=function(){var n=Array.prototype.slice;return function(t){function r(){var u=f.concat(n.call(arguments));i.apply(this instanceof r?this:t,u)}var i=this,f=n.call(arguments,1);if(typeof i!="function")throw new TypeError;return r.prototype=function u(n){return n&&(u.prototype=n),(this instanceof u)?void 0:new u}(i.prototype),r}}());Array.isArray||(Array.isArray=function(n){return Object.prototype.toString.call(n)=="[object Array]"});Array.prototype.forEach||(Array.prototype.forEach=function(n){"use strict";var i,r,u,t;if(this===void 0||this===null)throw new TypeError;if(i=Object(this),r=i.length>>>0,typeof n!="function")throw new TypeError;for(u=arguments.length>=2?arguments[1]:void 0,t=0;t<r;t++)t in i&&n.call(u,i[t],t,i)});typeof Uint32Array!="function"&&(t=function(n){window[n]=function(n){var t;if(typeof n=="number")for(Array.call(this,n),this.length=n,t=0;t<this.length;t++)this[t]=0;else for(Array.call(this,n.length),this.length=n.length,t=0;t<this.length;t++)this[t]=n[t]};window[n].prototype=[];window[n].constructor=window[n]},t("Uint32Array"),t("Int16Array"));window.console||(window.console={},window.console.log=window.console.assert=function(){},window.console.warn=window.console.assert=function(){});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Circle=function(n,t,i){n=n||0;t=t||0;i=i||0;this.x=n;this.y=t;this._diameter=i;this._radius=i>0?i*.5:0};n.Circle.prototype={circumference:function(){return 2*Math.PI*this._radius},setTo:function(n,t,i){return this.x=n,this.y=t,this._diameter=i,this._radius=i*.5,this},copyFrom:function(n){return this.setTo(n.x,n.y,n.diameter)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.diameter=this._diameter,n},distance:function(t,i){return typeof i=="undefined"&&(i=!1),i?n.Math.distanceRounded(this.x,this.y,t.x,t.y):n.Math.distance(this.x,this.y,t.x,t.y)},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Circle(this.x,this.y,this.diameter):t.setTo(this.x,this.y,this.diameter),t},contains:function(t,i){return n.Circle.contains(this,t,i)},circumferencePoint:function(t,i,r){return n.Circle.circumferencePoint(this,t,i,r)},offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},toString:function(){return"[{Phaser.Circle (x="+this.x+" y="+this.y+" diameter="+this.diameter+" radius="+this.radius+")}]"}};n.Circle.prototype.constructor=n.Circle;Object.defineProperty(n.Circle.prototype,"diameter",{get:function(){return this._diameter},set:function(n){n>0&&(this._diameter=n,this._radius=n*.5)}});Object.defineProperty(n.Circle.prototype,"radius",{get:function(){return this._radius},set:function(n){n>0&&(this._radius=n,this._diameter=n*2)}});Object.defineProperty(n.Circle.prototype,"left",{get:function(){return this.x-this._radius},set:function(n){n>this.x?(this._radius=0,this._diameter=0):this.radius=this.x-n}});Object.defineProperty(n.Circle.prototype,"right",{get:function(){return this.x+this._radius},set:function(n){n<this.x?(this._radius=0,this._diameter=0):this.radius=n-this.x}});Object.defineProperty(n.Circle.prototype,"top",{get:function(){return this.y-this._radius},set:function(n){n>this.y?(this._radius=0,this._diameter=0):this.radius=this.y-n}});Object.defineProperty(n.Circle.prototype,"bottom",{get:function(){return this.y+this._radius},set:function(n){n<this.y?(this._radius=0,this._diameter=0):this.radius=n-this.y}});Object.defineProperty(n.Circle.prototype,"area",{get:function(){return this._radius>0?Math.PI*this._radius*this._radius:0}});Object.defineProperty(n.Circle.prototype,"empty",{get:function(){return this._diameter===0},set:function(n){n===!0&&this.setTo(0,0,0)}});n.Circle.contains=function(n,t,i){if(n.radius>0&&t>=n.left&&t<=n.right&&i>=n.top&&i<=n.bottom){var r=(n.x-t)*(n.x-t),u=(n.y-i)*(n.y-i);return r+u<=n.radius*n.radius}return!1};n.Circle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.diameter==t.diameter};n.Circle.intersects=function(t,i){return n.Math.distance(t.x,t.y,i.x,i.y)<=t.radius+i.radius};n.Circle.circumferencePoint=function(t,i,r,u){return typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=new n.Point),r===!0&&(i=n.Math.degToRad(i)),u.x=t.x+t.radius*Math.cos(i),u.y=t.y+t.radius*Math.sin(i),u};n.Circle.intersectsRectangle=function(n,t){var r=Math.abs(n.x-t.x-t.halfWidth),o=t.halfWidth+n.radius,i,u;if(r>o||(i=Math.abs(n.y-t.y-t.halfHeight),u=t.halfHeight+n.radius,i>u))return!1;if(r<=t.halfWidth||i<=t.halfHeight)return!0;var f=r-t.halfWidth,e=i-t.halfHeight,s=f*f,h=e*e,c=n.radius*n.radius;return s+h<=c};PIXI.Circle=n.Circle;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Point=function(n,t){n=n||0;t=t||0;this.x=n;this.y=t};n.Point.prototype={copyFrom:function(n){return this.setTo(n.x,n.y)},invert:function(){return this.setTo(this.y,this.x)},setTo:function(n,t){return this.x=n||0,this.y=t||(t!==0?this.x:0),this},set:function(n,t){return this.x=n||0,this.y=t||(t!==0?this.x:0),this},add:function(n,t){return this.x+=n,this.y+=t,this},subtract:function(n,t){return this.x-=n,this.y-=t,this},multiply:function(n,t){return this.x*=n,this.y*=t,this},divide:function(n,t){return this.x/=n,this.y/=t,this},clampX:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this},clampY:function(t,i){return this.y=n.Math.clamp(this.y,t,i),this},clamp:function(t,i){return this.x=n.Math.clamp(this.x,t,i),this.y=n.Math.clamp(this.y,t,i),this},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Point(this.x,this.y):t.setTo(this.x,this.y),t},copyTo:function(n){return n.x=this.x,n.y=this.y,n},distance:function(t,i){return n.Point.distance(this,t,i)},equals:function(n){return n.x===this.x&&n.y===this.y},angle:function(t,i){return typeof i=="undefined"&&(i=!1),i?n.Math.radToDeg(Math.atan2(t.y-this.y,t.x-this.x)):Math.atan2(t.y-this.y,t.x-this.x)},angleSq:function(n){return this.subtract(n).angle(n.subtract(this))},rotate:function(t,i,r,u,f){return n.Point.rotate(this,t,i,r,u,f)},getMagnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},getMagnitudeSq:function(){return this.x*this.x+this.y*this.y},setMagnitude:function(n){return this.normalize().multiply(n,n)},normalize:function(){if(!this.isZero()){var n=this.getMagnitude();this.x/=n;this.y/=n}return this},isZero:function(){return this.x===0&&this.y===0},dot:function(n){return this.x*n.x+this.y*n.y},cross:function(n){return this.x*n.y-this.y*n.x},perp:function(){return this.setTo(-this.y,this.x)},rperp:function(){return this.setTo(this.y,-this.x)},normalRightHand:function(){return this.setTo(this.y*-1,this.x)},toString:function(){return"[{Point (x="+this.x+" y="+this.y+")}]"}};n.Point.prototype.constructor=n.Point;n.Point.add=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x+i.x,r.y=t.y+i.y,r};n.Point.subtract=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x-i.x,r.y=t.y-i.y,r};n.Point.multiply=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x*i.x,r.y=t.y*i.y,r};n.Point.divide=function(t,i,r){return typeof r=="undefined"&&(r=new n.Point),r.x=t.x/i.x,r.y=t.y/i.y,r};n.Point.equals=function(n,t){return n.x===t.x&&n.y===t.y};n.Point.angle=function(n,t){return Math.atan2(n.y-t.y,n.x-t.x)};n.Point.angleSq=function(n,t){return n.subtract(t).angle(t.subtract(n))};n.Point.negative=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(-t.x,-t.y)};n.Point.multiplyAdd=function(t,i,r,u){return typeof u=="undefined"&&(u=new n.Point),u.setTo(t.x+i.x*r,t.y+i.y*r)};n.Point.interpolate=function(t,i,r,u){return typeof u=="undefined"&&(u=new n.Point),u.setTo(t.x+(i.x-t.x)*r,t.y+(i.y-t.y)*r)};n.Point.perp=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(-t.y,t.x)};n.Point.rperp=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(t.y,-t.x)};n.Point.distance=function(t,i,r){return typeof r=="undefined"&&(r=!1),r?n.Math.distanceRounded(t.x,t.y,i.x,i.y):n.Math.distance(t.x,t.y,i.x,i.y)};n.Point.project=function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.dot(i)/i.getMagnitudeSq();return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.projectUnit=function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.dot(i);return u!==0&&r.setTo(u*i.x,u*i.y),r};n.Point.normalRightHand=function(t,i){return typeof i=="undefined"&&(i=new n.Point),i.setTo(t.y*-1,t.x)};n.Point.normalize=function(t,i){typeof i=="undefined"&&(i=new n.Point);var r=t.getMagnitude();return r!==0&&i.setTo(t.x/r,t.y/r),i};n.Point.rotate=function(t,i,r,u,f,e){f=f||!1;e=e||null;f&&(u=n.Math.degToRad(u));e===null&&(e=Math.sqrt((i-t.x)*(i-t.x)+(r-t.y)*(r-t.y)));var o=u+Math.atan2(t.y-r,t.x-i);return t.setTo(i+e*Math.cos(o),r+e*Math.sin(o))};n.Point.centroid=function(t,i){var r,u;if(typeof i=="undefined"&&(i=new n.Point),Object.prototype.toString.call(t)!=="[object Array]")throw new Error("Phaser.Point. Parameter 'points' must be an array");if(r=t.length,r<1)throw new Error("Phaser.Point. Parameter 'points' array must not be empty");if(r===1)return i.copyFrom(t[0]),i;for(u=0;u<r;u++)n.Point.add(i,t[u],i);return i.divide(r,r),i};PIXI.Point=n.Point;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rectangle=function(n,t,i,r){n=n||0;t=t||0;i=i||0;r=r||0;this.x=n;this.y=t;this.width=i;this.height=r};n.Rectangle.prototype={offset:function(n,t){return this.x+=n,this.y+=t,this},offsetPoint:function(n){return this.offset(n.x,n.y)},setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},centerOn:function(n,t){return this.centerX=n,this.centerY=t,this},floor:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y)},floorAll:function(){this.x=Math.floor(this.x);this.y=Math.floor(this.y);this.width=Math.floor(this.width);this.height=Math.floor(this.height)},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},inflate:function(t,i){return n.Rectangle.inflate(this,t,i)},size:function(t){return n.Rectangle.size(this,t)},clone:function(t){return n.Rectangle.clone(this,t)},contains:function(t,i){return n.Rectangle.contains(this,t,i)},containsRect:function(t){return n.Rectangle.containsRect(t,this)},equals:function(t){return n.Rectangle.equals(this,t)},intersection:function(t,i){return n.Rectangle.intersection(this,t,i)},intersects:function(t,i){return n.Rectangle.intersects(this,t,i)},intersectsRaw:function(t,i,r,u,f){return n.Rectangle.intersectsRaw(this,t,i,r,u,f)},union:function(t,i){return n.Rectangle.union(this,t,i)},toString:function(){return"[{Rectangle (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+" empty="+this.empty+")}]"}};Object.defineProperty(n.Rectangle.prototype,"halfWidth",{get:function(){return Math.round(this.width/2)}});Object.defineProperty(n.Rectangle.prototype,"halfHeight",{get:function(){return Math.round(this.height/2)}});Object.defineProperty(n.Rectangle.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<=this.y?0:n-this.y}});Object.defineProperty(n.Rectangle.prototype,"bottomRight",{get:function(){return new n.Point(this.right,this.bottom)},set:function(n){this.right=n.x;this.bottom=n.y}});Object.defineProperty(n.Rectangle.prototype,"left",{get:function(){return this.x},set:function(n){this.width=n>=this.right?0:this.right-n;this.x=n}});Object.defineProperty(n.Rectangle.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<=this.x?0:n-this.x}});Object.defineProperty(n.Rectangle.prototype,"volume",{get:function(){return this.width*this.height}});Object.defineProperty(n.Rectangle.prototype,"perimeter",{get:function(){return this.width*2+this.height*2}});Object.defineProperty(n.Rectangle.prototype,"centerX",{get:function(){return this.x+this.halfWidth},set:function(n){this.x=n-this.halfWidth}});Object.defineProperty(n.Rectangle.prototype,"centerY",{get:function(){return this.y+this.halfHeight},set:function(n){this.y=n-this.halfHeight}});Object.defineProperty(n.Rectangle.prototype,"randomX",{get:function(){return this.x+Math.random()*this.width}});Object.defineProperty(n.Rectangle.prototype,"randomY",{get:function(){return this.y+Math.random()*this.height}});Object.defineProperty(n.Rectangle.prototype,"top",{get:function(){return this.y},set:function(n){n>=this.bottom?(this.height=0,this.y=n):this.height=this.bottom-n}});Object.defineProperty(n.Rectangle.prototype,"topLeft",{get:function(){return new n.Point(this.x,this.y)},set:function(n){this.x=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"topRight",{get:function(){return new n.Point(this.x+this.width,this.y)},set:function(n){this.right=n.x;this.y=n.y}});Object.defineProperty(n.Rectangle.prototype,"empty",{get:function(){return!this.width||!this.height},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Rectangle.prototype.constructor=n.Rectangle;n.Rectangle.inflate=function(n,t,i){return n.x-=t,n.width+=2*t,n.y-=i,n.height+=2*i,n};n.Rectangle.inflatePoint=function(t,i){return n.Rectangle.inflate(t,i.x,i.y)};n.Rectangle.size=function(t,i){return typeof i=="undefined"||i===null?i=new n.Point(t.width,t.height):i.setTo(t.width,t.height),i};n.Rectangle.clone=function(t,i){return typeof i=="undefined"||i===null?i=new n.Rectangle(t.x,t.y,t.width,t.height):i.setTo(t.x,t.y,t.width,t.height),i};n.Rectangle.contains=function(n,t,i){return n.width<=0||n.height<=0?!1:t>=n.x&&t<=n.right&&i>=n.y&&i<=n.bottom};n.Rectangle.containsRaw=function(n,t,i,r,u,f){return u>=n&&u<=n+i&&f>=t&&f<=t+r};n.Rectangle.containsPoint=function(t,i){return n.Rectangle.contains(t,i.x,i.y)};n.Rectangle.containsRect=function(n,t){return n.volume>t.volume?!1:n.x>=t.x&&n.y>=t.y&&n.right<=t.right&&n.bottom<=t.bottom};n.Rectangle.equals=function(n,t){return n.x==t.x&&n.y==t.y&&n.width==t.width&&n.height==t.height};n.Rectangle.intersection=function(t,i,r){return typeof r=="undefined"&&(r=new n.Rectangle),n.Rectangle.intersects(t,i)&&(r.x=Math.max(t.x,i.x),r.y=Math.max(t.y,i.y),r.width=Math.min(t.right,i.right)-r.x,r.height=Math.min(t.bottom,i.bottom)-r.y),r};n.Rectangle.intersects=function(n,t){return n.width<=0||n.height<=0||t.width<=0||t.height<=0?!1:!(n.right<t.x||n.bottom<t.y||n.x>t.right||n.y>t.bottom)};n.Rectangle.intersectsRaw=function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=0),!(t>n.right+f||i<n.left-f||r>n.bottom+f||u<n.top-f)};n.Rectangle.union=function(t,i,r){return typeof r=="undefined"&&(r=new n.Rectangle),r.setTo(Math.min(t.x,i.x),Math.min(t.y,i.y),Math.max(t.right,i.right)-Math.min(t.left,i.left),Math.max(t.bottom,i.bottom)-Math.min(t.top,i.top))};PIXI.Rectangle=n.Rectangle;PIXI.EmptyRectangle=new n.Rectangle(0,0,0,0);
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Line=function(t,i,r,u){t=t||0;i=i||0;r=r||0;u=u||0;this.start=new n.Point(t,i);this.end=new n.Point(r,u)};n.Line.prototype={setTo:function(n,t,i,r){return this.start.setTo(n,t),this.end.setTo(i,r),this},fromSprite:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.setTo(n.center.x,n.center.y,t.center.x,t.center.y):this.setTo(n.x,n.y,t.x,t.y)},intersects:function(t,i,r){return n.Line.intersectsPoints(this.start,this.end,t.start,t.end,i,r)},pointOnLine:function(n,t){return(n-this.start.x)*(this.end.y-this.start.y)==(this.end.x-this.start.x)*(t-this.start.y)},pointOnSegment:function(n,t){var i=Math.min(this.start.x,this.end.x),r=Math.max(this.start.x,this.end.x),u=Math.min(this.start.y,this.end.y),f=Math.max(this.start.y,this.end.y);return this.pointOnLine(n,t)&&n>=i&&n<=r&&t>=u&&t<=f},coordinatesOnLine:function(n,t){var h,c;typeof n=="undefined"&&(n=1);typeof t=="undefined"&&(t=[]);var i=Math.round(this.start.x),r=Math.round(this.start.y),u=Math.round(this.end.x),f=Math.round(this.end.y),e=Math.abs(u-i),o=Math.abs(f-r),l=i<u?1:-1,a=r<f?1:-1,s=e-o;for(t.push([i,r]),h=1;!(i==u&&r==f);)c=s<<1,c>-o&&(s-=o,i+=l),c<e&&(s+=e,r+=a),h%n==0&&t.push([i,r]),h++;return t},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Line(this.start.x,this.start.y,this.end.x,this.end.y):t.setTo(this.start.x,this.start.y,this.end.x,this.end.y),t}};Object.defineProperty(n.Line.prototype,"length",{get:function(){return Math.sqrt((this.end.x-this.start.x)*(this.end.x-this.start.x)+(this.end.y-this.start.y)*(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"angle",{get:function(){return Math.atan2(this.end.y-this.start.y,this.end.x-this.start.x)}});Object.defineProperty(n.Line.prototype,"slope",{get:function(){return(this.end.y-this.start.y)/(this.end.x-this.start.x)}});Object.defineProperty(n.Line.prototype,"perpSlope",{get:function(){return-((this.end.x-this.start.x)/(this.end.y-this.start.y))}});Object.defineProperty(n.Line.prototype,"x",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"y",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"left",{get:function(){return Math.min(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"right",{get:function(){return Math.max(this.start.x,this.end.x)}});Object.defineProperty(n.Line.prototype,"top",{get:function(){return Math.min(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"bottom",{get:function(){return Math.max(this.start.y,this.end.y)}});Object.defineProperty(n.Line.prototype,"width",{get:function(){return Math.abs(this.start.x-this.end.x)}});Object.defineProperty(n.Line.prototype,"height",{get:function(){return Math.abs(this.start.y-this.end.y)}});n.Line.intersectsPoints=function(t,i,r,u,f,e){typeof f=="undefined"&&(f=!0);typeof e=="undefined"&&(e=new n.Point);var s=i.y-t.y,h=u.y-r.y,c=t.x-i.x,l=r.x-u.x,a=i.x*t.y-t.x*i.y,v=u.x*r.y-r.x*u.y,o=s*l-h*c;if(o===0)return null;if(e.x=(c*v-l*a)/o,e.y=(h*a-s*v)/o,f){var y=(u.y-r.y)*(i.x-t.x)-(u.x-r.x)*(i.y-t.y),p=((u.x-r.x)*(t.y-r.y)-(u.y-r.y)*(t.x-r.x))/y,w=((i.x-t.x)*(t.y-r.y)-(i.y-t.y)*(t.x-r.x))/y;return p>=0&&p<=1&&w>=0&&w<=1?e:null}return e};n.Line.intersects=function(t,i,r,u){return n.Line.intersectsPoints(t.start,t.end,i.start,i.end,r,u)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Chad Engler <chad@pantherdev.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Ellipse=function(t,i,r,u){this.type=n.ELLIPSE;t=t||0;i=i||0;r=r||0;u=u||0;this.x=t;this.y=i;this.width=r;this.height=u};n.Ellipse.prototype={setTo:function(n,t,i,r){return this.x=n,this.y=t,this.width=i,this.height=r,this},copyFrom:function(n){return this.setTo(n.x,n.y,n.width,n.height)},copyTo:function(n){return n.x=this.x,n.y=this.y,n.width=this.width,n.height=this.height,n},clone:function(t){return typeof t=="undefined"||t===null?t=new n.Ellipse(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t},contains:function(t,i){return n.Ellipse.contains(this,t,i)},toString:function(){return"[{Phaser.Ellipse (x="+this.x+" y="+this.y+" width="+this.width+" height="+this.height+")}]"}};n.Ellipse.prototype.constructor=n.Ellipse;Object.defineProperty(n.Ellipse.prototype,"left",{get:function(){return this.x},set:function(n){this.x=n}});Object.defineProperty(n.Ellipse.prototype,"right",{get:function(){return this.x+this.width},set:function(n){this.width=n<this.x?0:this.x+n}});Object.defineProperty(n.Ellipse.prototype,"top",{get:function(){return this.y},set:function(n){this.y=n}});Object.defineProperty(n.Ellipse.prototype,"bottom",{get:function(){return this.y+this.height},set:function(n){this.height=n<this.y?0:this.y+n}});Object.defineProperty(n.Ellipse.prototype,"empty",{get:function(){return this.width===0||this.height===0},set:function(n){n===!0&&this.setTo(0,0,0,0)}});n.Ellipse.contains=function(n,t,i){if(n.width<=0||n.height<=0)return!1;var r=(t-n.x)/n.width-.5,u=(i-n.y)/n.height-.5;return r*=r,u*=u,r+u<.25};n.Ellipse.prototype.getBounds=function(){return new n.Rectangle(this.x,this.y,this.width,this.height)};PIXI.Ellipse=n.Ellipse;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @author       Adrien Brault <adrien.brault@gmail.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Polygon=function(t){this.type=n.POLYGON;this.points=t};n.Polygon.prototype={clone:function(t){for(var i=[],r=0;r<this.points.length;r++)i.push(this.points[r].clone());return typeof t=="undefined"||t===null?t=new n.Polygon(i):t.setTo(i),t},contains:function(n,t){for(var r=!1,i=0,u=this.points.length-1;i<this.points.length;u=i++){var e=this.points[i].x,f=this.points[i].y,s=this.points[u].x,o=this.points[u].y,h=f>t!=o>t&&n<(s-e)*(t-f)/(o-f)+e;h&&(r=!r)}return r},setTo:function(n){return this.points=n,this}};n.Polygon.prototype.constructor=n.Polygon;Object.defineProperty(n.Polygon.prototype,"points",{get:function(){return this._points},set:function(t){var r,i,u;if(t instanceof Array||(t=Array.prototype.slice.call(arguments)),typeof t[0]=="number"){for(r=[],i=0,u=t.length;i<u;i+=2)r.push(new n.Point(t[i],t[i+1]));t=r}this._points=t}});Object.defineProperty(n.Polygon.prototype,"area",{get:function(){for(var i,r,u,f,t=Number.MAX_VALUE,e=0,n=0;n<this.points.length;n++)this.points[n].y<t&&(t=this.points[n].y);for(n=0;n<this.points.length;n++)i=this.points[n],r=n===this.points.length-1?this.points[0]:this.points[n+1],u=(i.y-t+(r.y-t))/2,f=i.x-r.x,e+=u*f;return e}});PIXI.Polygon=n.Polygon;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Camera=function(t,i,r,u,f,e){this.game=t;this.world=t.world;this.id=0;this.view=new n.Rectangle(r,u,f,e);this.screenView=new n.Rectangle(r,u,f,e);this.bounds=new n.Rectangle(r,u,f,e);this.deadzone=null;this.visible=!0;this.roundPx=!0;this.atLimit={x:!1,y:!1};this.target=null;this._edge=0;this._position=new n.Point;this.displayObject=null;this.scale=null};n.Camera.FOLLOW_LOCKON=0;n.Camera.FOLLOW_PLATFORMER=1;n.Camera.FOLLOW_TOPDOWN=2;n.Camera.FOLLOW_TOPDOWN_TIGHT=3;n.Camera.prototype={follow:function(t,i){var r,f,u;typeof i=="undefined"&&(i=n.Camera.FOLLOW_LOCKON);this.target=t;switch(i){case n.Camera.FOLLOW_PLATFORMER:f=this.width/8;u=this.height/3;this.deadzone=new n.Rectangle((this.width-f)/2,(this.height-u)/2-u*.25,f,u);break;case n.Camera.FOLLOW_TOPDOWN:r=Math.max(this.width,this.height)/4;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_TOPDOWN_TIGHT:r=Math.max(this.width,this.height)/8;this.deadzone=new n.Rectangle((this.width-r)/2,(this.height-r)/2,r,r);break;case n.Camera.FOLLOW_LOCKON:this.deadzone=null;break;default:this.deadzone=null}},unfollow:function(){this.target=null},focusOn:function(n){this.setPosition(Math.round(n.x-this.view.halfWidth),Math.round(n.y-this.view.halfHeight))},focusOnXY:function(n,t){this.setPosition(Math.round(n-this.view.halfWidth),Math.round(t-this.view.halfHeight))},update:function(){this.target&&this.updateTarget();this.bounds&&this.checkBounds();this.roundPx&&this.view.floor();this.displayObject.position.x=-this.view.x;this.displayObject.position.y=-this.view.y},updateTarget:function(){this.deadzone?(this._edge=this.target.x-this.view.x,this._edge<this.deadzone.left?this.view.x=this.target.x-this.deadzone.left:this._edge>this.deadzone.right&&(this.view.x=this.target.x-this.deadzone.right),this._edge=this.target.y-this.view.y,this._edge<this.deadzone.top?this.view.y=this.target.y-this.deadzone.top:this._edge>this.deadzone.bottom&&(this.view.y=this.target.y-this.deadzone.bottom)):(this.view.x=this.target.x-this.view.halfWidth,this.view.y=this.target.y-this.view.halfHeight)},setBoundsToWorld:function(){this.bounds&&this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},checkBounds:function(){this.atLimit.x=!1;this.atLimit.y=!1;this.view.x<=this.bounds.x&&(this.atLimit.x=!0,this.view.x=this.bounds.x);this.view.right>=this.bounds.right&&(this.atLimit.x=!0,this.view.x=this.bounds.right-this.width);this.view.y<=this.bounds.top&&(this.atLimit.y=!0,this.view.y=this.bounds.top);this.view.bottom>=this.bounds.bottom&&(this.atLimit.y=!0,this.view.y=this.bounds.bottom-this.height)},setPosition:function(n,t){this.view.x=n;this.view.y=t;this.bounds&&this.checkBounds()},setSize:function(n,t){this.view.width=n;this.view.height=t},reset:function(){this.target=null;this.view.x=0;this.view.y=0}};n.Camera.prototype.constructor=n.Camera;Object.defineProperty(n.Camera.prototype,"x",{get:function(){return this.view.x},set:function(n){this.view.x=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"y",{get:function(){return this.view.y},set:function(n){this.view.y=n;this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"position",{get:function(){return this._position.set(this.view.centerX,this.view.centerY),this._position},set:function(n){typeof n.x!="undefined"&&(this.view.x=n.x);typeof n.y!="undefined"&&(this.view.y=n.y);this.bounds&&this.checkBounds()}});Object.defineProperty(n.Camera.prototype,"width",{get:function(){return this.view.width},set:function(n){this.view.width=n}});Object.defineProperty(n.Camera.prototype,"height",{get:function(){return this.view.height},set:function(n){this.view.height=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.State=function(){this.game=null;this.add=null;this.make=null;this.camera=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.sound=null;this.scale=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.particles=null;this.physics=null;this.rnd=null};n.State.prototype={preload:function(){},loadUpdate:function(){},loadRender:function(){},create:function(){},update:function(){},render:function(){},resize:function(){},paused:function(){},pauseUpdate:function(){},shutdown:function(){}};n.State.prototype.constructor=n.State;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.StateManager=function(n,t){this.game=n;this.states={};this._pendingState=null;typeof t!="undefined"&&t!==null&&(this._pendingState=t);this._clearWorld=!1;this._clearCache=!1;this._created=!1;this._args=[];this.current="";this.onInitCallback=null;this.onPreloadCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onResizeCallback=null;this.onPreRenderCallback=null;this.onLoadUpdateCallback=null;this.onLoadRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.onShutDownCallback=null};n.StateManager.prototype={boot:function(){this.game.onPause.add(this.pause,this);this.game.onResume.add(this.resume,this);this.game.load.onLoadComplete.add(this.loadComplete,this);this._pendingState!==null&&(typeof this._pendingState=="string"?this.start(this._pendingState,!1,!1):this.add("default",this._pendingState,!0))},add:function(t,i,r){typeof r=="undefined"&&(r=!1);var u;return i instanceof n.State?u=i:typeof i=="object"?(u=i,u.game=this.game):typeof i=="function"&&(u=new i(this.game)),this.states[t]=u,r&&(this.game.isBooted?this.start(t):this._pendingState=t),u},remove:function(n){this.current===n&&(this.callbackContext=null,this.onInitCallback=null,this.onShutDownCallback=null,this.onPreloadCallback=null,this.onLoadRenderCallback=null,this.onLoadUpdateCallback=null,this.onCreateCallback=null,this.onUpdateCallback=null,this.onRenderCallback=null,this.onResizeCallback=null,this.onPausedCallback=null,this.onResumedCallback=null,this.onPauseUpdateCallback=null);delete this.states[n]},start:function(n,t,i){typeof t=="undefined"&&(t=!0);typeof i=="undefined"&&(i=!1);this.checkState(n)&&(this._pendingState=n,this._clearWorld=t,this._clearCache=i,arguments.length>3&&(this._args=Array.prototype.splice.call(arguments,3)))},restart:function(n,t){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=!1);this._pendingState=this.current;this._clearWorld=n;this._clearCache=t;arguments.length>2&&(this._args=Array.prototype.splice.call(arguments,2))},dummy:function(){},preUpdate:function(){this._pendingState&&this.game.isBooted&&(this.clearCurrentState(),this.setCurrentState(this._pendingState),this._pendingState=null,this.onPreloadCallback?(this.game.load.reset(),this.onPreloadCallback.call(this.callbackContext,this.game),this.game.load.totalQueuedFiles()===0&&this.game.load.totalQueuedPacks()===0?this.loadComplete():this.game.load.start()):this.loadComplete())},clearCurrentState:function(){this.current&&(this.onShutDownCallback&&this.onShutDownCallback.call(this.callbackContext,this.game),this.game.tweens.removeAll(),this.game.camera.reset(),this.game.input.reset(!0),this.game.physics.clear(),this.game.time.removeAll(),this.game.scale.reset(this._clearWorld),this.game.debug&&this.game.debug.reset(),this._clearWorld&&(this.game.world.shutdown(),this._clearCache===!0&&this.game.cache.destroy()))},checkState:function(n){if(this.states[n]){var t=!1;return(this.states[n].preload&&(t=!0),this.states[n].create&&(t=!0),this.states[n].update&&(t=!0),this.states[n].render&&(t=!0),t===!1)?(console.warn("Invalid Phaser State object given. Must contain at least a one of the required functions: preload, create, update or render"),!1):!0}return console.warn("Phaser.StateManager - No state found with the key: "+n),!1},link:function(n){this.states[n].game=this.game;this.states[n].add=this.game.add;this.states[n].make=this.game.make;this.states[n].camera=this.game.camera;this.states[n].cache=this.game.cache;this.states[n].input=this.game.input;this.states[n].load=this.game.load;this.states[n].math=this.game.math;this.states[n].sound=this.game.sound;this.states[n].scale=this.game.scale;this.states[n].state=this;this.states[n].stage=this.game.stage;this.states[n].time=this.game.time;this.states[n].tweens=this.game.tweens;this.states[n].world=this.game.world;this.states[n].particles=this.game.particles;this.states[n].rnd=this.game.rnd;this.states[n].physics=this.game.physics},setCurrentState:function(n){this.callbackContext=this.states[n];this.link(n);this.onInitCallback=this.states[n].init||this.dummy;this.onPreloadCallback=this.states[n].preload||null;this.onLoadRenderCallback=this.states[n].loadRender||null;this.onLoadUpdateCallback=this.states[n].loadUpdate||null;this.onCreateCallback=this.states[n].create||null;this.onUpdateCallback=this.states[n].update||null;this.onPreRenderCallback=this.states[n].preRender||null;this.onRenderCallback=this.states[n].render||null;this.onResizeCallback=this.states[n].resize||null;this.onPausedCallback=this.states[n].paused||null;this.onResumedCallback=this.states[n].resumed||null;this.onPauseUpdateCallback=this.states[n].pauseUpdate||null;this.onShutDownCallback=this.states[n].shutdown||this.dummy;this.current=n;this._created=!1;this.onInitCallback.apply(this.callbackContext,this._args);this._args=[]},getCurrentState:function(){return this.states[this.current]},loadComplete:function(){this._created===!1&&this.onCreateCallback?(this._created=!0,this.onCreateCallback.call(this.callbackContext,this.game)):this._created=!0},pause:function(){this._created&&this.onPausedCallback&&this.onPausedCallback.call(this.callbackContext,this.game)},resume:function(){this._created&&this.onResumedCallback&&this.onResumedCallback.call(this.callbackContext,this.game)},update:function(){this._created&&this.onUpdateCallback?this.onUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},pauseUpdate:function(){this._created&&this.onPauseUpdateCallback?this.onPauseUpdateCallback.call(this.callbackContext,this.game):this.onLoadUpdateCallback&&this.onLoadUpdateCallback.call(this.callbackContext,this.game)},preRender:function(){this.onPreRenderCallback&&this.onPreRenderCallback.call(this.callbackContext,this.game)},resize:function(n,t){this.onResizeCallback&&this.onResizeCallback.call(this.callbackContext,n,t)},render:function(){this._created&&this.onRenderCallback?(this.game.renderType===n.CANVAS&&(this.game.context.save(),this.game.context.setTransform(1,0,0,1,0,0)),this.onRenderCallback.call(this.callbackContext,this.game),this.game.renderType===n.CANVAS&&this.game.context.restore()):this.onLoadRenderCallback&&this.onLoadRenderCallback.call(this.callbackContext,this.game)},destroy:function(){this.clearCurrentState();this.callbackContext=null;this.onInitCallback=null;this.onShutDownCallback=null;this.onPreloadCallback=null;this.onLoadRenderCallback=null;this.onLoadUpdateCallback=null;this.onCreateCallback=null;this.onUpdateCallback=null;this.onRenderCallback=null;this.onPausedCallback=null;this.onResumedCallback=null;this.onPauseUpdateCallback=null;this.game=null;this.states={};this._pendingState=null}};n.StateManager.prototype.constructor=n.StateManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LinkedList=function(){this.next=null;this.prev=null;this.first=null;this.last=null;this.total=0};n.LinkedList.prototype={add:function(n){return this.total===0&&this.first===null&&this.last===null?(this.first=n,this.last=n,this.next=n,n.prev=this,this.total++,n):(this.last.next=n,n.prev=this.last,this.last=n,this.total++,n)},reset:function(){this.first=null;this.last=null;this.next=null;this.prev=null;this.total=0},remove:function(n){if(this.total===1){this.reset();n.next=n.prev=null;return}n===this.first?this.first=this.first.next:n===this.last&&(this.last=this.last.prev);n.prev&&(n.prev.next=n.next);n.next&&(n.next.prev=n.prev);n.next=n.prev=null;this.first===null&&(this.last=null);this.total--},callAll:function(n){if(this.first&&this.last){var t=this.first;do t&&t[n]&&t[n].call(t),t=t.next;while(t!=this.last.next)}}};n.LinkedList.prototype.constructor=n.LinkedList;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ArrayList=function(){this.total=0;this.position=0;this.list=[]};n.ArrayList.prototype={add:function(n){return this.exists(n)||(this.list.push(n),this.total++),n},getIndex:function(n){return this.list.indexOf(n)},exists:function(n){return this.list.indexOf(n)>-1},reset:function(){this.list.length=0;this.total=0},remove:function(n){var t=this.list.indexOf(n);if(t>-1)return this.list.splice(t,1),this.total--,n},setAll:function(n,t){for(var i=this.list.length;i--;)this.list[i]&&this.list[i][n]&&(this.list[i][n]=t)},callAll:function(n){for(var i=Array.prototype.splice.call(arguments,1),t=this.list.length;t--;)this.list[t]&&this.list[t][n]&&this.list[t][n].apply(this.list[t],i)}};Object.defineProperty(n.ArrayList.prototype,"first",{get:function(){return this.position=0,this.total>0?this.list[0]:null}});Object.defineProperty(n.ArrayList.prototype,"next",{get:function(){return this.position<this.total?(this.position++,this.list[this.position]):null}});n.ArrayList.prototype.constructor=n.ArrayList;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Signal=function(){this._bindings=[];this._prevParams=null;var t=this;this.dispatch=function(){n.Signal.prototype.dispatch.apply(t,arguments)}};n.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,validateListener:function(n,t){if(typeof n!="function")throw new Error("Phaser.Signal: listener is a required param of {fn}() and should be a Function.".replace("{fn}",t));},_registerListener:function(t,i,r,u){var e=this._indexOfListener(t,r),f;if(e!==-1){if(f=this._bindings[e],f.isOnce()!==i)throw new Error("You cannot add"+(i?"":"Once")+"() then add"+(i?"Once":"")+"() the same listener without removing the relationship first.");}else f=new n.SignalBinding(this,t,i,r,u),this._addBinding(f);return this.memorize&&this._prevParams&&f.execute(this._prevParams),f},_addBinding:function(n){var t=this._bindings.length;do t--;while(this._bindings[t]&&n._priority<=this._bindings[t]._priority);this._bindings.splice(t+1,0,n)},_indexOfListener:function(n,t){for(var i=this._bindings.length,r;i--;)if(r=this._bindings[i],r._listener===n&&r.context===t)return i;return-1},has:function(n,t){return this._indexOfListener(n,t)!==-1},add:function(n,t,i){return this.validateListener(n,"add"),this._registerListener(n,!1,t,i)},addOnce:function(n,t,i){return this.validateListener(n,"addOnce"),this._registerListener(n,!0,t,i)},remove:function(n,t){this.validateListener(n,"remove");var i=this._indexOfListener(n,t);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),n},removeAll:function(n){typeof n=="undefined"&&(n=null);for(var t=this._bindings.length;t--;)n?this._bindings[t].context===n&&(this._bindings[t]._destroy(),this._bindings.splice(t,1)):this._bindings[t]._destroy();n||(this._bindings.length=0)},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(){if(this.active){var i=Array.prototype.slice.call(arguments),n=this._bindings.length,t;if(this.memorize&&(this._prevParams=i),n){t=this._bindings.slice();this._shouldPropagate=!0;do n--;while(t[n]&&this._shouldPropagate&&t[n].execute(i)!==!1)}}},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Phaser.Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};n.Signal.prototype.constructor=n.Signal;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SignalBinding=function(n,t,i,r,u){this._listener=t;this._isOnce=i;this.context=r;this._signal=n;this._priority=u||0};n.SignalBinding.prototype={active:!0,params:null,execute:function(n){var t,i;return this.active&&!!this._listener&&(i=this.params?this.params.concat(n):n,t=this._listener.apply(this.context,i),this._isOnce&&this.detach()),t},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[Phaser.SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};n.SignalBinding.prototype.constructor=n.SignalBinding;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Filter=function(t,i,r){this.game=t;this.type=n.WEBGL_FILTER;this.passes=[this];this.shaders=[];this.dirty=!0;this.padding=0;this.uniforms={time:{type:"1f",value:0},resolution:{type:"2f",value:{x:256,y:256}},mouse:{type:"2f",value:{x:0,y:0}}};this.fragmentSrc=r||[]};n.Filter.prototype={init:function(){},setResolution:function(n,t){this.uniforms.resolution.value.x=n;this.uniforms.resolution.value.y=t},update:function(n){typeof n!="undefined"&&(n.x>0&&(this.uniforms.mouse.x=n.x.toFixed(2)),n.y>0&&(this.uniforms.mouse.y=n.y.toFixed(2)));this.uniforms.time.value=this.game.time.totalElapsedSeconds()},destroy:function(){this.game=null}};n.Filter.prototype.constructor=n.Filter;Object.defineProperty(n.Filter.prototype,"width",{get:function(){return this.uniforms.resolution.value.x},set:function(n){this.uniforms.resolution.value.x=n}});Object.defineProperty(n.Filter.prototype,"height",{get:function(){return this.uniforms.resolution.value.y},set:function(n){this.uniforms.resolution.value.y=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Plugin=function(n,t){typeof t=="undefined"&&(t=null);this.game=n;this.parent=t;this.active=!1;this.visible=!1;this.hasPreUpdate=!1;this.hasUpdate=!1;this.hasPostUpdate=!1;this.hasRender=!1;this.hasPostRender=!1};n.Plugin.prototype={preUpdate:function(){},update:function(){},render:function(){},postRender:function(){},destroy:function(){this.game=null;this.parent=null;this.active=!1;this.visible=!1}};n.Plugin.prototype.constructor=n.Plugin;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.PluginManager=function(n){this.game=n;this.plugins=[];this._len=0;this._i=0};n.PluginManager.prototype={add:function(n){var i=Array.prototype.splice.call(arguments,1),t=!1;return typeof n=="function"?n=new n(this.game,this):(n.game=this.game,n.parent=this),typeof n.preUpdate=="function"&&(n.hasPreUpdate=!0,t=!0),typeof n.update=="function"&&(n.hasUpdate=!0,t=!0),typeof n.postUpdate=="function"&&(n.hasPostUpdate=!0,t=!0),typeof n.render=="function"&&(n.hasRender=!0,t=!0),typeof n.postRender=="function"&&(n.hasPostRender=!0,t=!0),t?((n.hasPreUpdate||n.hasUpdate||n.hasPostUpdate)&&(n.active=!0),(n.hasRender||n.hasPostRender)&&(n.visible=!0),this._len=this.plugins.push(n),typeof n.init=="function"&&n.init.apply(n,i),n):null},remove:function(n){for(this._i=this._len;this._i--;)if(this.plugins[this._i]===n){n.destroy();this.plugins.splice(this._i,1);this._len--;return}},removeAll:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].destroy();this.plugins.length=0;this._len=0},preUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPreUpdate&&this.plugins[this._i].preUpdate()},update:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasUpdate&&this.plugins[this._i].update()},postUpdate:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].active&&this.plugins[this._i].hasPostUpdate&&this.plugins[this._i].postUpdate()},render:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasRender&&this.plugins[this._i].render()},postRender:function(){for(this._i=this._len;this._i--;)this.plugins[this._i].visible&&this.plugins[this._i].hasPostRender&&this.plugins[this._i].postRender()},destroy:function(){this.removeAll();this.game=null}};n.PluginManager.prototype.constructor=n.PluginManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Stage=function(n){this.game=n;PIXI.Stage.call(this,0);this.name="_stage_root";this.interactive=!1;this.disableVisibilityChange=!1;this.exists=!0;this.currentRenderOrderID=0;this._hiddenVar="hidden";this._backgroundColor=0;n.config&&this.parseConfig(n.config)};n.Stage.prototype=Object.create(PIXI.Stage.prototype);n.Stage.prototype.constructor=n.Stage;n.Stage.prototype.parseConfig=function(n){n.disableVisibilityChange&&(this.disableVisibilityChange=n.disableVisibilityChange);n.backgroundColor&&(this.backgroundColor=n.backgroundColor)};n.Stage.prototype.boot=function(){n.Canvas.getOffset(this.game.canvas,this.offset);var t=this;this._onChange=function(n){return t.visibilityChange(n)};n.Canvas.setUserSelect(this.game.canvas,"none");n.Canvas.setTouchAction(this.game.canvas,"none");this.checkVisibility()};n.Stage.prototype.preUpdate=function(){var t,n;for(this.currentRenderOrderID=0,t=this.children.length,n=0;n<t;n++)this.children[n].preUpdate()};n.Stage.prototype.update=function(){for(var n=this.children.length;n--;)this.children[n].update()};n.Stage.prototype.postUpdate=function(){var n;if(this.game.world.camera.target)for(this.game.world.camera.target.postUpdate(),this.game.world.camera.update(),n=this.children.length;n--;)this.children[n]!==this.game.world.camera.target&&this.children[n].postUpdate();else for(this.game.world.camera.update(),n=this.children.length;n--;)this.children[n].postUpdate()};n.Stage.prototype.checkVisibility=function(){this._hiddenVar=document.webkitHidden!==undefined?"webkitvisibilitychange":document.mozHidden!==undefined?"mozvisibilitychange":document.msHidden!==undefined?"msvisibilitychange":document.hidden!==undefined?"visibilitychange":null;this._hiddenVar&&document.addEventListener(this._hiddenVar,this._onChange,!1);window.onpagehide=this._onChange;window.onpageshow=this._onChange;window.onblur=this._onChange;window.onfocus=this._onChange;var t=this;this.game.device.cocoonJSApp&&(CocoonJS.App.onSuspended.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"pause"})}),CocoonJS.App.onActivated.addEventListener(function(){n.Stage.prototype.visibilityChange.call(t,{type:"resume"})}))};n.Stage.prototype.visibilityChange=function(n){if(n.type==="pagehide"||n.type==="blur"||n.type==="pageshow"||n.type==="focus"){n.type==="pagehide"||n.type==="blur"?this.game.focusLoss(n):(n.type==="pageshow"||n.type==="focus")&&this.game.focusGain(n);return}this.disableVisibilityChange||(document.hidden||document.mozHidden||document.msHidden||document.webkitHidden||n.type==="pause"?this.game.gamePaused(n):this.game.gameResumed(n))};n.Stage.prototype.setBackgroundColor=function(t){var i;typeof t=="string"?(i=n.Color.hexToColor(t),this._backgroundColor=n.Color.getColor(i.r,i.g,i.b)):(i=n.Color.getRGB(t),this._backgroundColor=t);this.backgroundColorSplit=[i.r/255,i.g/255,i.b/255];this.backgroundColorString=n.Color.RGBtoString(i.r,i.g,i.b,255,"#")};n.Stage.prototype.destroy=function(){this._hiddenVar&&document.removeEventListener(this._hiddenVar,this._onChange,!1);window.onpagehide=null;window.onpageshow=null;window.onblur=null;window.onfocus=null};Object.defineProperty(n.Stage.prototype,"backgroundColor",{get:function(){return this._backgroundColor},set:function(n){this.game.transparent||this.setBackgroundColor(n)}});Object.defineProperty(n.Stage.prototype,"smoothed",{get:function(){return!PIXI.scaleModes.LINEAR},set:function(n){PIXI.scaleModes.LINEAR=n?0:1}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Group=function(t,i,r,u,f,e){typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=!1);typeof e=="undefined"&&(e=n.Physics.ARCADE);this.game=t;typeof i=="undefined"&&(i=t.world);this.name=r||"group";PIXI.DisplayObjectContainer.call(this);u?this.game.stage.addChild(this):i&&i.addChild(this);this.z=0;this.type=n.GROUP;this.alive=!0;this.exists=!0;this.classType=n.Sprite;this.scale=new n.Point(1,1);this.cursor=null;this.cameraOffset=new n.Point;this.enableBody=f;this.enableBodyDebug=!1;this.physicsBodyType=e;this.onDestroy=new n.Signal;this._sortProperty="z";this._cache=[0,0,0,0,1,0,1,0,0,0]};n.Group.prototype=Object.create(PIXI.DisplayObjectContainer.prototype);n.Group.prototype.constructor=n.Group;n.Group.RETURN_NONE=0;n.Group.RETURN_TOTAL=1;n.Group.RETURN_CHILD=2;n.Group.SORT_ASCENDING=-1;n.Group.SORT_DESCENDING=1;n.Group.prototype.add=function(n,t){return typeof t=="undefined"&&(t=!1),n.parent!==this&&(this.enableBody&&this.game.physics.enable(n,this.physicsBodyType),this.addChild(n),n.z=this.children.length,!t&&n.events&&n.events.onAddedToGroup.dispatch(n,this),this.cursor===null&&(this.cursor=n)),n};n.Group.prototype.addMultiple=function(n,t){if(Array.isArray(n))for(var i=0;i<n.length;i++)this.add(n[i],t);return n};n.Group.prototype.addAt=function(n,t,i){return typeof i=="undefined"&&(i=!1),n.parent!==this&&(this.enableBody&&this.game.physics.enable(n,this.physicsBodyType),this.addChildAt(n,t),this.updateZ(),!i&&n.events&&n.events.onAddedToGroup.dispatch(n,this),this.cursor===null&&(this.cursor=n)),n};n.Group.prototype.getAt=function(n){return n<0||n>=this.children.length?-1:this.getChildAt(n)};n.Group.prototype.create=function(n,t,i,r,u){typeof u=="undefined"&&(u=!0);var f=new this.classType(this.game,n,t,i,r);return this.enableBody&&this.game.physics.enable(f,this.physicsBodyType,this.enableBodyDebug),f.exists=u,f.visible=u,f.alive=u,this.addChild(f),f.z=this.children.length,f.events&&f.events.onAddedToGroup.dispatch(f,this),this.cursor===null&&(this.cursor=f),f};n.Group.prototype.createMultiple=function(n,t,i,r){typeof r=="undefined"&&(r=!1);for(var u=0;u<n;u++)this.create(0,0,t,i,r)};n.Group.prototype.updateZ=function(){for(var n=this.children.length;n--;)this.children[n].z=n};n.Group.prototype.resetCursor=function(n){return typeof n=="undefined"&&(n=0),n>this.children.length-1&&(n=0),this.cursor?(this._cache[8]=n,this.cursor=this.children[this._cache[8]],this.cursor):void 0};n.Group.prototype.next=function(){if(this.cursor)return this._cache[8]>=this.children.length-1?this._cache[8]=0:this._cache[8]++,this.cursor=this.children[this._cache[8]],this.cursor};n.Group.prototype.previous=function(){if(this.cursor)return this._cache[8]===0?this._cache[8]=this.children.length-1:this._cache[8]--,this.cursor=this.children[this._cache[8]],this.cursor};n.Group.prototype.swap=function(n,t){this.swapChildren(n,t);this.updateZ()};n.Group.prototype.bringToTop=function(n){return n.parent===this&&this.getIndex(n)<this.children.length&&(this.remove(n,!1,!0),this.add(n,!0)),n};n.Group.prototype.sendToBack=function(n){return n.parent===this&&this.getIndex(n)>0&&(this.remove(n,!1,!0),this.addAt(n,0,!0)),n};n.Group.prototype.moveUp=function(n){if(n.parent===this&&this.getIndex(n)<this.children.length-1){var i=this.getIndex(n),t=this.getAt(i+1);t&&this.swap(n,t)}return n};n.Group.prototype.moveDown=function(n){if(n.parent===this&&this.getIndex(n)>0){var i=this.getIndex(n),t=this.getAt(i-1);t&&this.swap(n,t)}return n};n.Group.prototype.xy=function(n,t,i){if(n<0||n>this.children.length)return-1;this.getChildAt(n).x=t;this.getChildAt(n).y=i};n.Group.prototype.reverse=function(){this.children.reverse();this.updateZ()};n.Group.prototype.getIndex=function(n){return this.children.indexOf(n)};n.Group.prototype.replace=function(t,i){var u=this.getIndex(t),r;if(u!==-1)return i.parent!==undefined&&(i.events.onRemovedFromGroup.dispatch(i,this),i.parent.removeChild(i),i.parent instanceof n.Group&&i.parent.updateZ()),r=t,this.remove(r),this.addAt(i,u),r};n.Group.prototype.hasProperty=function(n,t){var i=t.length;return i===1&&t[0]in n?!0:i===2&&t[0]in n&&t[1]in n[t[0]]||i===3&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]||i===4&&t[0]in n&&t[1]in n[t[0]]&&t[2]in n[t[0]][t[1]]&&t[3]in n[t[0]][t[1]][t[2]]?!0:!1};n.Group.prototype.setProperty=function(n,t,i,r,u){if(typeof u=="undefined"&&(u=!1),r=r||0,!this.hasProperty(n,t)&&(!u||r>0))return!1;var f=t.length;return f===1?r===0?n[t[0]]=i:r==1?n[t[0]]+=i:r==2?n[t[0]]-=i:r==3?n[t[0]]*=i:r==4&&(n[t[0]]/=i):f===2?r===0?n[t[0]][t[1]]=i:r==1?n[t[0]][t[1]]+=i:r==2?n[t[0]][t[1]]-=i:r==3?n[t[0]][t[1]]*=i:r==4&&(n[t[0]][t[1]]/=i):f===3?r===0?n[t[0]][t[1]][t[2]]=i:r==1?n[t[0]][t[1]][t[2]]+=i:r==2?n[t[0]][t[1]][t[2]]-=i:r==3?n[t[0]][t[1]][t[2]]*=i:r==4&&(n[t[0]][t[1]][t[2]]/=i):f===4&&(r===0?n[t[0]][t[1]][t[2]][t[3]]=i:r==1?n[t[0]][t[1]][t[2]][t[3]]+=i:r==2?n[t[0]][t[1]][t[2]][t[3]]-=i:r==3?n[t[0]][t[1]][t[2]][t[3]]*=i:r==4&&(n[t[0]][t[1]][t[2]][t[3]]/=i)),!0};n.Group.prototype.checkProperty=function(t,i,r,u){return(typeof u=="undefined"&&(u=!1),!n.Utils.getProperty(t,i)&&u)?!1:n.Utils.getProperty(t,i)!==r?!1:!0};n.Group.prototype.set=function(n,t,i,r,u,f,e){return typeof e=="undefined"&&(e=!1),t=t.split("."),typeof r=="undefined"&&(r=!1),typeof u=="undefined"&&(u=!1),(r===!1||r&&n.alive)&&(u===!1||u&&n.visible)?this.setProperty(n,t,i,f,e):void 0};n.Group.prototype.setAll=function(n,t,i,r,u,f){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof f=="undefined"&&(f=!1);n=n.split(".");u=u||0;for(var e=0,o=this.children.length;e<o;e++)(!i||i&&this.children[e].alive)&&(!r||r&&this.children[e].visible)&&this.setProperty(this.children[e],n,t,u,f)};n.Group.prototype.setAllChildren=function(t,i,r,u,f,e){typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);typeof e=="undefined"&&(e=!1);f=f||0;for(var o=0,s=this.children.length;o<s;o++)(!r||r&&this.children[o].alive)&&(!u||u&&this.children[o].visible)&&(this.children[o]instanceof n.Group?this.children[o].setAllChildren(t,i,r,u,f,e):this.setProperty(this.children[o],t.split("."),i,f,e))};n.Group.prototype.checkAll=function(n,t,i,r,u){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);for(var f=0,e=this.children.length;f<e;f++)if((!i||i&&this.children[f].alive)&&(!r||r&&this.children[f].visible)&&!this.checkProperty(this.children[f],n,t,u))return!1;return!0};n.Group.prototype.addAll=function(n,t,i,r){this.setAll(n,t,i,r,1)};n.Group.prototype.subAll=function(n,t,i,r){this.setAll(n,t,i,r,2)};n.Group.prototype.multiplyAll=function(n,t,i,r){this.setAll(n,t,i,r,3)};n.Group.prototype.divideAll=function(n,t,i,r){this.setAll(n,t,i,r,4)};n.Group.prototype.callAllExists=function(n,t){for(var r=Array.prototype.splice.call(arguments,2),i=0,u=this.children.length;i<u;i++)this.children[i].exists===t&&this.children[i][n]&&this.children[i][n].apply(this.children[i],r)};n.Group.prototype.callbackFromArray=function(n,t,i){if(i==1){if(n[t[0]])return n[t[0]]}else if(i==2){if(n[t[0]][t[1]])return n[t[0]][t[1]]}else if(i==3){if(n[t[0]][t[1]][t[2]])return n[t[0]][t[1]][t[2]]}else if(i==4){if(n[t[0]][t[1]][t[2]][t[3]])return n[t[0]][t[1]][t[2]][t[3]]}else if(n[t])return n[t];return!1};n.Group.prototype.callAll=function(n,t){var u,f,r,s;if(typeof n!="undefined"){n=n.split(".");u=n.length;typeof t=="undefined"||t===null||t===""?t=null:typeof t=="string"&&(t=t.split("."),f=t.length);var e=Array.prototype.splice.call(arguments,2),i=null,o=null;for(r=0,s=this.children.length;r<s;r++)i=this.callbackFromArray(this.children[r],n,u),t&&i?(o=this.callbackFromArray(this.children[r],t,f),i&&i.apply(o,e)):i&&i.apply(this.children[r],e)}};n.Group.prototype.preUpdate=function(){if(!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;for(var n=this.children.length;n--;)this.children[n].preUpdate();return!0};n.Group.prototype.update=function(){for(var n=this.children.length;n--;)this.children[n].update()};n.Group.prototype.postUpdate=function(){this._cache[7]===1&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);for(var n=this.children.length;n--;)this.children[n].postUpdate()};n.Group.prototype.forEach=function(n,t,i){var u,r,f;for(typeof i=="undefined"&&(i=!1),u=Array.prototype.splice.call(arguments,3),u.unshift(null),r=0,f=this.children.length;r<f;r++)(!i||i&&this.children[r].exists)&&(u[0]=this.children[r],n.apply(t,u))};n.Group.prototype.forEachExists=function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("exists",!0,n.Group.RETURN_TOTAL,t,i,r)};n.Group.prototype.forEachAlive=function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("alive",!0,n.Group.RETURN_TOTAL,t,i,r)};n.Group.prototype.forEachDead=function(t,i){var r=Array.prototype.splice.call(arguments,2);r.unshift(null);this.iterate("alive",!1,n.Group.RETURN_TOTAL,t,i,r)};n.Group.prototype.sort=function(t,i){this.children.length<2||(typeof t=="undefined"&&(t="z"),typeof i=="undefined"&&(i=n.Group.SORT_ASCENDING),this._sortProperty=t,i===n.Group.SORT_ASCENDING?this.children.sort(this.ascendingSortHandler.bind(this)):this.children.sort(this.descendingSortHandler.bind(this)),this.updateZ())};n.Group.prototype.customSort=function(n,t){this.children.length<2||(this.children.sort(n.bind(t)),this.updateZ())};n.Group.prototype.ascendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?-1:n[this._sortProperty]>t[this._sortProperty]?1:n.z<t.z?-1:1};n.Group.prototype.descendingSortHandler=function(n,t){return n[this._sortProperty]<t[this._sortProperty]?1:n[this._sortProperty]>t[this._sortProperty]?-1:0};n.Group.prototype.iterate=function(t,i,r,u,f,e){var s,o,h;if(r===n.Group.RETURN_TOTAL&&this.children.length===0)return 0;for(typeof u=="undefined"&&(u=!1),s=0,o=0,h=this.children.length;o<h;o++)if(this.children[o][t]===i&&(s++,u&&(e[0]=this.children[o],u.apply(f,e)),r===n.Group.RETURN_CHILD))return this.children[o];return r===n.Group.RETURN_TOTAL?s:r===n.Group.RETURN_CHILD?null:void 0};n.Group.prototype.getFirstExists=function(t){return typeof t!="boolean"&&(t=!0),this.iterate("exists",t,n.Group.RETURN_CHILD)};n.Group.prototype.getFirstAlive=function(){return this.iterate("alive",!0,n.Group.RETURN_CHILD)};n.Group.prototype.getFirstDead=function(){return this.iterate("alive",!1,n.Group.RETURN_CHILD)};n.Group.prototype.getTop=function(){if(this.children.length>0)return this.children[this.children.length-1]};n.Group.prototype.getBottom=function(){if(this.children.length>0)return this.children[0]};n.Group.prototype.countLiving=function(){return this.iterate("alive",!0,n.Group.RETURN_TOTAL)};n.Group.prototype.countDead=function(){return this.iterate("alive",!1,n.Group.RETURN_TOTAL)};n.Group.prototype.getRandom=function(n,t){return this.children.length===0?null:(n=n||0,t=t||this.children.length,this.game.math.getRandom(this.children,n,t))};n.Group.prototype.remove=function(n,t,i){if(typeof t=="undefined"&&(t=!1),typeof i=="undefined"&&(i=!1),this.children.length===0||this.children.indexOf(n)===-1)return!1;i||!n.events||n.destroyPhase||n.events.onRemovedFromGroup.dispatch(n,this);var r=this.removeChild(n);return this.updateZ(),this.cursor===n&&this.next(),t&&r&&r.destroy(!0),!0};n.Group.prototype.removeAll=function(n,t){if(typeof n=="undefined"&&(n=!1),typeof t=="undefined"&&(t=!1),this.children.length!==0){do{!t&&this.children[0].events&&this.children[0].events.onRemovedFromGroup.dispatch(this.children[0],this);var i=this.removeChild(this.children[0]);n&&i&&i.destroy(!0)}while(this.children.length>0);this.cursor=null}};n.Group.prototype.removeBetween=function(n,t,i,r){var u,f;if(typeof t=="undefined"&&(t=this.children.length-1),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=!1),this.children.length!==0){if(n>t||n<0||t>this.children.length)return!1;for(u=t;u>=n;)!r&&this.children[u].events&&this.children[u].events.onRemovedFromGroup.dispatch(this.children[u],this),f=this.removeChild(this.children[u]),i&&f&&f.destroy(!0),this.cursor===this.children[u]&&(this.cursor=null),u--;this.updateZ()}};n.Group.prototype.destroy=function(n,t){this.game!==null&&(typeof n=="undefined"&&(n=!0),typeof t=="undefined"&&(t=!1),this.onDestroy.dispatch(this,n,t),this.removeAll(n),this.cursor=null,this.filters=null,t||(this.parent&&this.parent.removeChild(this),this.game=null,this.exists=!1))};Object.defineProperty(n.Group.prototype,"total",{get:function(){return this.iterate("exists",!0,n.Group.RETURN_TOTAL)}});Object.defineProperty(n.Group.prototype,"length",{get:function(){return this.children.length}});Object.defineProperty(n.Group.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});Object.defineProperty(n.Group.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.World=function(t){n.Group.call(this,t,null,"__world",!1);this.bounds=new n.Rectangle(0,0,t.width,t.height);this.camera=null;this._definedSize=!1;this._width=t.width;this._height=t.height};n.World.prototype=Object.create(n.Group.prototype);n.World.prototype.constructor=n.World;n.World.prototype.boot=function(){this.camera=new n.Camera(this.game,0,0,0,this.game.width,this.game.height);this.camera.displayObject=this;this.camera.scale=this.scale;this.game.camera=this.camera;this.game.stage.addChild(this)};n.World.prototype.setBounds=function(n,t,i,r){this._definedSize=!0;this._width=i;this._height=r;this.bounds.setTo(n,t,i,r);this.camera.bounds&&this.camera.bounds.setTo(n,t,Math.max(i,this.game.width),Math.max(r,this.game.height));this.game.physics.setBoundsToWorld()};n.World.prototype.resize=function(n,t){this._definedSize&&(n<this._width&&(n=this._width),t<this._height&&(t=this._height));this.bounds.width=n;this.bounds.height=t;this.game.camera.setBoundsToWorld();this.game.physics.setBoundsToWorld()};n.World.prototype.shutdown=function(){this.destroy(!0,!0)};n.World.prototype.wrap=function(n,t,i,r,u){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=!0);i?(n.getBounds(),r&&(n.x+n._currentBounds.width<this.bounds.x?n.x=this.bounds.right:n.x>this.bounds.right&&(n.x=this.bounds.left)),u&&(n.y+n._currentBounds.height<this.bounds.top?n.y=this.bounds.bottom:n.y>this.bounds.bottom&&(n.y=this.bounds.top))):(r&&n.x+t<this.bounds.x?n.x=this.bounds.right+t:r&&n.x-t>this.bounds.right&&(n.x=this.bounds.left-t),u&&n.y+t<this.bounds.top?n.y=this.bounds.bottom+t:u&&n.y-t>this.bounds.bottom&&(n.y=this.bounds.top-t))};Object.defineProperty(n.World.prototype,"width",{get:function(){return this.bounds.width},set:function(n){n<this.game.width&&(n=this.game.width);this.bounds.width=n;this._width=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"height",{get:function(){return this.bounds.height},set:function(n){n<this.game.height&&(n=this.game.height);this.bounds.height=n;this._height=n;this._definedSize=!0}});Object.defineProperty(n.World.prototype,"centerX",{get:function(){return this.bounds.halfWidth}});Object.defineProperty(n.World.prototype,"centerY",{get:function(){return this.bounds.halfHeight}});Object.defineProperty(n.World.prototype,"randomX",{get:function(){return this.bounds.x<0?this.game.rnd.integerInRange(this.bounds.x,this.bounds.width-Math.abs(this.bounds.x)):this.game.rnd.integerInRange(this.bounds.x,this.bounds.width)}});Object.defineProperty(n.World.prototype,"randomY",{get:function(){return this.bounds.y<0?this.game.rnd.integerInRange(this.bounds.y,this.bounds.height-Math.abs(this.bounds.y)):this.game.rnd.integerInRange(this.bounds.y,this.bounds.height)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexGrid=function(t,i,r){this.game=t.game;this.manager=t;this.width=i;this.height=r;this.boundsFluid=new n.Rectangle(0,0,i,r);this.boundsFull=new n.Rectangle(0,0,i,r);this.boundsNone=new n.Rectangle(0,0,i,r);this.positionFluid=new n.Point(0,0);this.positionFull=new n.Point(0,0);this.positionNone=new n.Point(0,0);this.scaleFluid=new n.Point(1,1);this.scaleFluidInversed=new n.Point(1,1);this.scaleFull=new n.Point(1,1);this.scaleNone=new n.Point(1,1);this.ratioH=i/r;this.ratioV=r/i;this.multiplier=0;this.layers=[]};n.FlexGrid.prototype={setSize:function(t,i){this.width=t;this.height=i;this.ratioH=t/i;this.ratioV=i/t;this.scaleNone=new n.Point(1,1);this.boundsNone.width=this.width;this.boundsNone.height=this.height;this.refresh()},createFluidLayer:function(t,i){typeof i=="undefined"&&(i=!0);var r=new n.FlexLayer(this,this.positionFluid,this.boundsFluid,this.scaleFluid);return i&&this.game.world.add(r),this.layers.push(r),typeof t!="undefined"&&!0&&r.addMultiple(t),r},createFullLayer:function(t){var i=new n.FlexLayer(this,this.positionFull,this.boundsFull,this.scaleFluid);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},createFixedLayer:function(t){var i=new n.FlexLayer(this,this.positionNone,this.boundsNone,this.scaleNone);return this.game.world.add(i),this.layers.push(i),typeof t!="undefined"&&i.addMultiple(t),i},reset:function(){for(var n=this.layers.length;n--;)this.layers[n].persist||(this.layers[n].position=null,this.layers[n].scale=null,this.layers.slice(n,1))},onResize:function(n,t){this.refresh(n,t)},refresh:function(){this.multiplier=Math.min(this.manager.height/this.height,this.manager.width/this.width);this.boundsFluid.width=Math.round(this.width*this.multiplier);this.boundsFluid.height=Math.round(this.height*this.multiplier);this.scaleFluid.set(this.boundsFluid.width/this.width,this.boundsFluid.height/this.height);this.scaleFluidInversed.set(this.width/this.boundsFluid.width,this.height/this.boundsFluid.height);this.scaleFull.set(this.boundsFull.width/this.width,this.boundsFull.height/this.height);this.boundsFull.width=this.manager.width*this.scaleFluidInversed.x;this.boundsFull.height=this.manager.height*this.scaleFluidInversed.y;this.boundsFluid.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.boundsNone.centerOn(this.manager.bounds.centerX,this.manager.bounds.centerY);this.positionFluid.set(this.boundsFluid.x,this.boundsFluid.y);this.positionNone.set(this.boundsNone.x,this.boundsNone.y)},debug:function(){this.game.debug.text(this.boundsFull.width+" x "+this.boundsFull.height,this.boundsFull.x+4,this.boundsFull.y+16);this.game.debug.geom(this.boundsFull,"rgba(0,0,255,0.9",!1);this.game.debug.text(this.boundsFluid.width+" x "+this.boundsFluid.height,this.boundsFluid.x+4,this.boundsFluid.y+16);this.game.debug.geom(this.boundsFluid,"rgba(255,0,0,0.9",!1);this.game.debug.text(this.boundsNone.width+" x "+this.boundsNone.height,this.boundsNone.x+4,this.boundsNone.y+16);this.game.debug.geom(this.boundsNone,"rgba(0,255,0,0.9",!1)}};n.FlexGrid.prototype.constructor=n.FlexGrid;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FlexLayer=function(t,i,r,u){n.Group.call(this,t.game,null,"__flexLayer"+t.game.rnd.uuid(),!1);this.manager=t.manager;this.grid=t;this.persist=!1;this.position=i;this.bounds=r;this.scale=u;this.topLeft=r.topLeft;this.topMiddle=new n.Point(r.halfWidth,0);this.topRight=r.topRight;this.bottomLeft=r.bottomLeft;this.bottomMiddle=new n.Point(r.halfWidth,r.bottom);this.bottomRight=r.bottomRight};n.FlexLayer.prototype=Object.create(n.Group.prototype);n.FlexLayer.prototype.constructor=n.FlexLayer;n.FlexLayer.prototype.resize=function(){};n.FlexLayer.prototype.debug=function(){this.game.debug.text(this.bounds.width+" x "+this.bounds.height,this.bounds.x+4,this.bounds.y+16);this.game.debug.geom(this.bounds,"rgba(0,0,255,0.9",!1);this.game.debug.geom(this.topLeft,"rgba(255,255,255,0.9");this.game.debug.geom(this.topMiddle,"rgba(255,255,255,0.9");this.game.debug.geom(this.topRight,"rgba(255,255,255,0.9")};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.ScaleManager=function(t,i,r){this.game=t;this.grid=null;this.width=0;this.height=0;this.minWidth=null;this.maxWidth=null;this.minHeight=null;this.maxHeight=null;this.offset=new n.Point;this.forceLandscape=!1;this.forcePortrait=!1;this.incorrectOrientation=!1;this.pageAlignHorizontally=!1;this.pageAlignVertically=!1;this.maxIterations=5;this.enterLandscape=new n.Signal;this.enterPortrait=new n.Signal;this.enterIncorrectOrientation=new n.Signal;this.leaveIncorrectOrientation=new n.Signal;this.fullScreenTarget=null;this.enterFullScreen=new n.Signal;this.leaveFullScreen=new n.Signal;this.orientation=0;window.orientation?this.orientation=window.orientation:window.outerWidth>window.outerHeight&&(this.orientation=90);this.scaleFactor=new n.Point(1,1);this.scaleFactorInversed=new n.Point(1,1);this.margin=new n.Point(0,0);this.bounds=new n.Rectangle;this.aspectRatio=0;this.sourceAspectRatio=0;this.event=null;this.fullScreenScaleMode=n.ScaleManager.NO_SCALE;this.parentIsWindow=!1;this.parentNode=null;this.parentScaleFactor=new n.Point(1,1);this.trackParentInterval=2e3;this.onResize=null;this.onResizeContext=null;this._scaleMode=n.ScaleManager.NO_SCALE;this._width=0;this._height=0;this._check=null;this._nextParentCheck=0;this._parentBounds=null;t.config&&this.parseConfig(t.config);this.setupScale(i,r)};n.ScaleManager.EXACT_FIT=0;n.ScaleManager.NO_SCALE=1;n.ScaleManager.SHOW_ALL=2;n.ScaleManager.RESIZE=3;n.ScaleManager.prototype={parseConfig:function(n){n.scaleMode&&(this.scaleMode=n.scaleMode);n.fullScreenScaleMode&&(this.fullScreenScaleMode=n.fullScreenScaleMode);n.fullScreenTarget&&(this.fullScreenTarget=n.fullScreenTarget)},setupScale:function(t,i){var e,r=new n.Rectangle,u,f;this.game.parent!==""&&(typeof this.game.parent=="string"?e=document.getElementById(this.game.parent):typeof this.game.parent=="object"&&this.game.parent.nodeType===1&&(e=this.game.parent));e?(this.parentNode=e,this.parentIsWindow=!1,this._parentBounds=this.parentNode.getBoundingClientRect(),r.width=this._parentBounds.width,r.height=this._parentBounds.height,this.offset.set(this._parentBounds.left,this._parentBounds.top)):(this.parentNode=null,this.parentIsWindow=!0,r.width=window.innerWidth,r.height=window.innerHeight);u=0;f=0;typeof t=="number"?u=t:(this.parentScaleFactor.x=parseInt(t,10)/100,u=r.width*this.parentScaleFactor.x);typeof i=="number"?f=i:(this.parentScaleFactor.y=parseInt(i,10)/100,f=r.height*this.parentScaleFactor.y);this.grid=new n.FlexGrid(this,u,f);this.updateDimensions(u,f,!1)},boot:function(){this.fullScreenTarget=this.game.canvas;var t=this;this._checkOrientation=function(n){return t.checkOrientation(n)};this._checkResize=function(n){return t.checkResize(n)};this._fullScreenChange=function(n){return t.fullScreenChange(n)};window.addEventListener("orientationchange",this._checkOrientation,!1);window.addEventListener("resize",this._checkResize,!1);this.game.device.cocoonJS||(document.addEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.addEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.addEventListener("fullscreenchange",this._fullScreenChange,!1));this.updateDimensions(this.width,this.height,!0);n.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height)},setResizeCallback:function(n,t){this.onResize=n;this.onResizeContext=t},setMinMax:function(n,t,i,r){this.minWidth=n;this.minHeight=t;typeof i!="undefined"&&(this.maxWidth=i);typeof r!="undefined"&&(this.maxHeight=r)},preUpdate:function(){this.game.time.now<this._nextParentCheck||(this.parentIsWindow||(n.Canvas.getOffset(this.game.canvas,this.offset),this._scaleMode===n.ScaleManager.RESIZE&&(this._parentBounds=this.parentNode.getBoundingClientRect(),(this._parentBounds.width!==this.width||this._parentBounds.height!==this.height)&&this.updateDimensions(this._parentBounds.width,this._parentBounds.height,!0))),this._nextParentCheck=this.game.time.now+this.trackParentInterval)},updateDimensions:function(n,t,i){this.width=n*this.parentScaleFactor.x;this.height=t*this.parentScaleFactor.y;this.game.width=this.width;this.game.height=this.height;this.sourceAspectRatio=this.width/this.height;this.bounds.width=this.width;this.bounds.height=this.height;i&&(this.game.renderer.resize(this.width,this.height),this.game.camera.setSize(this.width,this.height),this.game.world.resize(this.width,this.height));this.grid.onResize(n,t);this.onResize&&this.onResize.call(this.onResizeContext,this.width,this.height);this.game.state.resize(n,t)},forceOrientation:function(n,t){typeof t=="undefined"&&(t=!1);this.forceLandscape=n;this.forcePortrait=t},checkOrientationState:function(){this.incorrectOrientation?(this.forceLandscape&&window.innerWidth>window.innerHeight||this.forcePortrait&&window.innerHeight>window.innerWidth)&&(this.incorrectOrientation=!1,this.leaveIncorrectOrientation.dispatch(),this.scaleMode!==n.ScaleManager.NO_SCALE&&this.refresh()):(this.forceLandscape&&window.innerWidth<window.innerHeight||this.forcePortrait&&window.innerHeight<window.innerWidth)&&(this.incorrectOrientation=!0,this.enterIncorrectOrientation.dispatch(),this.scaleMode!==n.ScaleManager.NO_SCALE&&this.refresh())},checkOrientation:function(t){this.event=t;this.orientation=window.orientation;this.isLandscape?this.enterLandscape.dispatch(this.orientation,!0,!1):this.enterPortrait.dispatch(this.orientation,!1,!0);this.scaleMode!==n.ScaleManager.NO_SCALE&&this.refresh()},checkResize:function(t){this.event=t;var i=this.isLandscape;this.orientation=window.outerWidth>window.outerHeight?90:0;i&&this.isPortrait?(this.enterPortrait.dispatch(this.orientation,!1,!0),this.forceLandscape?this.enterIncorrectOrientation.dispatch():this.forcePortrait&&this.leaveIncorrectOrientation.dispatch()):!i&&this.isLandscape&&(this.enterLandscape.dispatch(this.orientation,!0,!1),this.forceLandscape?this.leaveIncorrectOrientation.dispatch():this.forcePortrait&&this.enterIncorrectOrientation.dispatch());this._scaleMode===n.ScaleManager.RESIZE&&this.parentIsWindow?this.updateDimensions(window.innerWidth,window.innerHeight,!0):(this._scaleMode===n.ScaleManager.EXACT_FIT||this._scaleMode===n.ScaleManager.SHOW_ALL)&&(this.refresh(),this.checkOrientationState(),this.onResize&&this.onResize.call(this.onResizeContext,this.width,this.height))},refresh:function(){if(this.scaleMode!==n.ScaleManager.RESIZE&&(this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),this._check===null&&this.maxIterations>0)){this._iterations=this.maxIterations;var t=this;this._check=window.setInterval(function(){return t.setScreenSize()},10);this.setScreenSize()}},setScreenSize:function(t){this.scaleMode!==n.ScaleManager.RESIZE&&(typeof t=="undefined"&&(t=!1),this.game.device.iPad||this.game.device.webApp||this.game.device.desktop||(this.game.device.android&&!this.game.device.chrome?window.scrollTo(0,1):window.scrollTo(0,0)),this._iterations--,(t||this._iterations<0)&&(document.documentElement.style.minHeight=window.innerHeight+"px",this.incorrectOrientation?this.setMaximum():this.isFullScreen?this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT?this.setExactFit():this.fullScreenScaleMode===n.ScaleManager.SHOW_ALL&&this.setShowAll():this.scaleMode===n.ScaleManager.EXACT_FIT?this.setExactFit():this.scaleMode===n.ScaleManager.SHOW_ALL&&this.setShowAll(),this.setSize(),clearInterval(this._check),this._check=null))},setSize:function(){this.incorrectOrientation||(this.maxWidth&&this.width>this.maxWidth&&(this.width=this.maxWidth),this.maxHeight&&this.height>this.maxHeight&&(this.height=this.maxHeight),this.minWidth&&this.width<this.minWidth&&(this.width=this.minWidth),this.minHeight&&this.height<this.minHeight&&(this.height=this.minHeight));this.game.canvas.style.width=this.width+"px";this.game.canvas.style.height=this.height+"px";this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height);this.pageAlignHorizontally&&(this.width<window.innerWidth&&!this.incorrectOrientation?(this.margin.x=Math.round((window.innerWidth-this.width)/2),this.game.canvas.style.marginLeft=this.margin.x+"px"):(this.margin.x=0,this.game.canvas.style.marginLeft="0px"));this.pageAlignVertically&&(this.height<window.innerHeight&&!this.incorrectOrientation?(this.margin.y=Math.round((window.innerHeight-this.height)/2),this.game.canvas.style.marginTop=this.margin.y+"px"):(this.margin.y=0,this.game.canvas.style.marginTop="0px"));n.Canvas.getOffset(this.game.canvas,this.offset);this.bounds.setTo(this.offset.x,this.offset.y,this.width,this.height);this.aspectRatio=this.width/this.height;this.scaleFactor.x=this.game.width/this.width;this.scaleFactor.y=this.game.height/this.height;this.scaleFactorInversed.x=this.width/this.game.width;this.scaleFactorInversed.y=this.height/this.game.height;this.checkOrientationState()},reset:function(n){n&&this.grid.reset()},setMaximum:function(){this.width=window.innerWidth;this.height=window.innerHeight},setShowAll:function(){var n=Math.min(window.innerHeight/this.game.height,window.innerWidth/this.game.width);this.width=Math.round(this.game.width*n);this.height=Math.round(this.game.height*n)},setExactFit:function(){var n=window.innerWidth,t=window.innerHeight;this.width=this.maxWidth&&n>this.maxWidth?this.maxWidth:n;this.height=this.maxHeight&&t>this.maxHeight?this.maxHeight:t},startFullScreen:function(t){!this.isFullScreen&&this.game.device.fullscreen&&(typeof t!="undefined"&&this.game.renderType===n.CANVAS&&(this.game.stage.smoothed=t),this._width=this.width,this._height=this.height,this.game.device.fullscreenKeyboard?this.fullScreenTarget[this.game.device.requestFullscreen](Element.ALLOW_KEYBOARD_INPUT):this.fullScreenTarget[this.game.device.requestFullscreen]())},stopFullScreen:function(){document[this.game.device.cancelFullscreen]()},fullScreenChange:function(t){this.event=t;this.isFullScreen?(this.fullScreenScaleMode===n.ScaleManager.EXACT_FIT?(this.fullScreenTarget.style.width="100%",this.fullScreenTarget.style.height="100%",this.width=window.outerWidth,this.height=window.outerHeight,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.checkResize()):this.fullScreenScaleMode===n.ScaleManager.SHOW_ALL&&(this.setShowAll(),this.refresh()),this.enterFullScreen.dispatch(this.width,this.height)):(this.fullScreenTarget.style.width=this.game.width+"px",this.fullScreenTarget.style.height=this.game.height+"px",this.width=this._width,this.height=this._height,this.game.input.scale.setTo(this.game.width/this.width,this.game.height/this.height),this.aspectRatio=this.width/this.height,this.scaleFactor.x=this.game.width/this.width,this.scaleFactor.y=this.game.height/this.height,this.leaveFullScreen.dispatch(this.width,this.height))},destroy:function(){window.removeEventListener("orientationchange",this._checkOrientation,!1);window.removeEventListener("resize",this._checkResize,!1);this.game.device.cocoonJS||(document.removeEventListener("webkitfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("mozfullscreenchange",this._fullScreenChange,!1),document.removeEventListener("fullscreenchange",this._fullScreenChange,!1))}};n.ScaleManager.prototype.constructor=n.ScaleManager;Object.defineProperty(n.ScaleManager.prototype,"scaleMode",{get:function(){return this._scaleMode},set:function(n){n!==this._scaleMode&&(this._scaleMode=n)}});Object.defineProperty(n.ScaleManager.prototype,"isFullScreen",{get:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement}});Object.defineProperty(n.ScaleManager.prototype,"isPortrait",{get:function(){return this.orientation===0||this.orientation===180}});Object.defineProperty(n.ScaleManager.prototype,"isLandscape",{get:function(){return this.orientation===90||this.orientation===-90}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Game=function(t,i,r,u,f,e,o,s){this.id=n.GAMES.push(this)-1;this.config=null;this.physicsConfig=s;this.parent="";this.width=800;this.height=600;this.transparent=!1;this.antialias=!0;this.preserveDrawingBuffer=!1;this.renderer=null;this.renderType=n.AUTO;this.state=null;this.isBooted=!1;this.isRunning=!1;this.raf=null;this.add=null;this.make=null;this.cache=null;this.input=null;this.load=null;this.math=null;this.net=null;this.scale=null;this.sound=null;this.stage=null;this.time=null;this.tweens=null;this.world=null;this.physics=null;this.rnd=null;this.device=null;this.camera=null;this.canvas=null;this.context=null;this.debug=null;this.particles=null;this.stepping=!1;this.pendingStep=!1;this.stepCount=0;this.onPause=null;this.onResume=null;this.onBlur=null;this.onFocus=null;this._paused=!1;this._codePaused=!1;this._width=800;this._height=600;arguments.length===1&&typeof arguments[0]=="object"?this.parseConfig(arguments[0]):(this.config={enableDebug:!0},typeof t!="undefined"&&(this._width=t),typeof i!="undefined"&&(this._height=i),typeof r!="undefined"&&(this.renderType=r),typeof u!="undefined"&&(this.parent=u),typeof e!="undefined"&&(this.transparent=e),typeof o!="undefined"&&(this.antialias=o),this.rnd=new n.RandomDataGenerator([(Date.now()*Math.random()).toString()]),this.state=new n.StateManager(this,f));var h=this;return this._onBoot=function(){return h.boot()},document.readyState==="complete"||document.readyState==="interactive"?window.setTimeout(this._onBoot,0):typeof cordova!="undefined"?document.addEventListener("deviceready",this._onBoot,!1):(document.addEventListener("DOMContentLoaded",this._onBoot,!1),window.addEventListener("load",this._onBoot,!1)),this};n.Game.prototype={parseConfig:function(t){var i,r;this.config=t;typeof t.enableDebug=="undefined"&&(this.config.enableDebug=!0);t.width&&(this._width=t.width);t.height&&(this._height=t.height);t.renderer&&(this.renderType=t.renderer);t.parent&&(this.parent=t.parent);t.transparent&&(this.transparent=t.transparent);t.antialias&&(this.antialias=t.antialias);t.preserveDrawingBuffer&&(this.preserveDrawingBuffer=t.preserveDrawingBuffer);t.physicsConfig&&(this.physicsConfig=t.physicsConfig);i=[(Date.now()*Math.random()).toString()];t.seed&&(i=t.seed);this.rnd=new n.RandomDataGenerator(i);r=null;t.state&&(r=t.state);this.state=new n.StateManager(this,r)},boot:function(){this.isBooted||(document.body?(document.removeEventListener("DOMContentLoaded",this._onBoot),window.removeEventListener("load",this._onBoot),this.onPause=new n.Signal,this.onResume=new n.Signal,this.onBlur=new n.Signal,this.onFocus=new n.Signal,this.isBooted=!0,this.device=new n.Device(this),this.math=n.Math,this.scale=new n.ScaleManager(this,this._width,this._height),this.stage=new n.Stage(this),this.setUpRenderer(),this.device.checkFullScreenSupport(),this.world=new n.World(this),this.add=new n.GameObjectFactory(this),this.make=new n.GameObjectCreator(this),this.cache=new n.Cache(this),this.load=new n.Loader(this),this.time=new n.Time(this),this.tweens=new n.TweenManager(this),this.input=new n.Input(this),this.sound=new n.SoundManager(this),this.physics=new n.Physics(this,this.physicsConfig),this.particles=new n.Particles(this),this.plugins=new n.PluginManager(this),this.net=new n.Net(this),this.time.boot(),this.stage.boot(),this.world.boot(),this.scale.boot(),this.input.boot(),this.sound.boot(),this.state.boot(),this.config.enableDebug&&(this.debug=new n.Utils.Debug(this),this.debug.boot()),this.showDebugHeader(),this.isRunning=!0,this.raf=this.config&&this.config.forceSetTimeOut?new n.RequestAnimationFrame(this,this.config.forceSetTimeOut):new n.RequestAnimationFrame(this,!1),this.raf.start()):window.setTimeout(this._onBoot,20))},showDebugHeader:function(){var e=n.VERSION,t="Canvas",u="HTML Audio",f=1,i,r;if(this.renderType===n.WEBGL?(t="WebGL",f++):this.renderType==n.HEADLESS&&(t="Headless"),this.device.webAudio&&(u="WebAudio",f++),this.device.chrome){for(i=["%c %c %c Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+u+"  %c %c  http://phaser.io  %c %c ♥%c♥%c♥ ","background: #7a66a3","background: #625186","color: #ffffff; background: #43375b;","background: #625186","background: #ccb9f2","background: #625186"],r=0;r<3;r++)r<f?i.push("color: #ff2424; background: #fff"):i.push("color: #959595; background: #fff");console.log.apply(console,i)}else window.console&&console.log("Phaser v"+e+" | Pixi.js "+PIXI.VERSION+" | "+t+" | "+u+" | http://phaser.io")},setUpRenderer:function(){if(this.device.trident&&(this.renderType=n.CANVAS),this.canvas=this.config.canvasID?n.Canvas.create(this.width,this.height,this.config.canvasID):n.Canvas.create(this.width,this.height),this.config.canvasStyle?this.canvas.style=this.config.canvasStyle:this.canvas.style["-webkit-full-screen"]="width: 100%; height: 100%",this.device.cocoonJS&&(this.canvas.screencanvas=this.renderType===n.CANVAS?!0:!1),this.renderType===n.HEADLESS||this.renderType===n.CANVAS||this.renderType===n.AUTO&&this.device.webGL===!1)if(this.device.canvas)this.renderType===n.AUTO&&(this.renderType=n.CANVAS),this.renderer=new PIXI.CanvasRenderer(this.width,this.height,this.canvas,this.transparent),this.context=this.renderer.context;else throw new Error("Phaser.Game - cannot create Canvas or WebGL context, aborting.");else this.renderType=n.WEBGL,this.renderer=new PIXI.WebGLRenderer(this.width,this.height,this.canvas,this.transparent,this.antialias,this.preserveDrawingBuffer),this.context=null;this.renderType!==n.HEADLESS&&(this.stage.smoothed=this.antialias,n.Canvas.addToDOM(this.canvas,this.parent,!1),n.Canvas.setTouchAction(this.canvas))},update:function(t){this.time.update(t);this._paused||this.pendingStep?(this.state.pauseUpdate(),this.config.enableDebug&&this.debug.preUpdate()):(this.stepping&&(this.pendingStep=!0),this.scale.preUpdate(),this.config.enableDebug&&this.debug.preUpdate(),this.physics.preUpdate(),this.state.preUpdate(),this.plugins.preUpdate(),this.stage.preUpdate(),this.state.update(),this.stage.update(),this.tweens.update(),this.sound.update(),this.input.update(),this.physics.update(),this.particles.update(),this.plugins.update(),this.stage.postUpdate(),this.plugins.postUpdate());this.renderType!=n.HEADLESS&&(this.state.preRender(),this.renderer.render(this.stage),this.plugins.render(),this.state.render(),this.plugins.postRender(),this.device.cocoonJS&&this.renderType===n.CANVAS&&this.stage.currentRenderOrderID===1&&this.context.fillRect(0,0,0,0))},enableStep:function(){this.stepping=!0;this.pendingStep=!1;this.stepCount=0},disableStep:function(){this.stepping=!1;this.pendingStep=!1},step:function(){this.pendingStep=!1;this.stepCount++},destroy:function(){this.raf.stop();this.state.destroy();this.sound.destroy();this.scale.destroy();this.stage.destroy();this.input.destroy();this.physics.destroy();this.state=null;this.cache=null;this.input=null;this.load=null;this.sound=null;this.stage=null;this.time=null;this.world=null;this.isBooted=!1;n.Canvas.removeFromDOM(this.canvas)},gamePaused:function(n){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(n))},gameResumed:function(n){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(n))},focusLoss:function(n){this.onBlur.dispatch(n);this.stage.disableVisibilityChange||this.gamePaused(n)},focusGain:function(n){this.onFocus.dispatch(n);this.stage.disableVisibilityChange||this.gameResumed(n)}};n.Game.prototype.constructor=n.Game;Object.defineProperty(n.Game.prototype,"paused",{get:function(){return this._paused},set:function(n){n===!0?(this._paused===!1&&(this._paused=!0,this.sound.setMute(),this.time.gamePaused(),this.onPause.dispatch(this)),this._codePaused=!0):(this._paused&&(this._paused=!1,this.input.reset(),this.sound.unsetMute(),this.time.gameResumed(),this.onResume.dispatch(this)),this._codePaused=!1)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Input=function(t){this.game=t;this.hitCanvas=null;this.hitContext=null;this.moveCallbacks=[];this.moveCallback=null;this.moveCallbackContext=this;this.pollRate=0;this.disabled=!1;this.multiInputOverride=n.Input.MOUSE_TOUCH_COMBINE;this.position=null;this.speed=null;this.circle=null;this.scale=null;this.maxPointers=10;this.currentPointers=0;this.tapRate=200;this.doubleTapRate=300;this.holdRate=2e3;this.justPressedRate=200;this.justReleasedRate=200;this.recordPointerHistory=!1;this.recordRate=100;this.recordLimit=100;this.pointer1=null;this.pointer2=null;this.pointer3=null;this.pointer4=null;this.pointer5=null;this.pointer6=null;this.pointer7=null;this.pointer8=null;this.pointer9=null;this.pointer10=null;this.activePointer=null;this.mousePointer=null;this.mouse=null;this.keyboard=null;this.touch=null;this.mspointer=null;this.gamepad=null;this.resetLocked=!1;this.onDown=null;this.onUp=null;this.onTap=null;this.onHold=null;this.minPriorityID=0;this.interactiveItems=new n.ArrayList;this._localPoint=new n.Point;this._pollCounter=0;this._oldPosition=null;this._x=0;this._y=0};n.Input.MOUSE_OVERRIDES_TOUCH=0;n.Input.TOUCH_OVERRIDES_MOUSE=1;n.Input.MOUSE_TOUCH_COMBINE=2;n.Input.prototype={boot:function(){this.mousePointer=new n.Pointer(this.game,0);this.pointer1=new n.Pointer(this.game,1);this.pointer2=new n.Pointer(this.game,2);this.mouse=new n.Mouse(this.game);this.keyboard=new n.Keyboard(this.game);this.touch=new n.Touch(this.game);this.mspointer=new n.MSPointer(this.game);this.gamepad=new n.Gamepad(this.game);this.onDown=new n.Signal;this.onUp=new n.Signal;this.onTap=new n.Signal;this.onHold=new n.Signal;this.scale=new n.Point(1,1);this.speed=new n.Point;this.position=new n.Point;this._oldPosition=new n.Point;this.circle=new n.Circle(0,0,44);this.activePointer=this.mousePointer;this.currentPointers=0;this.hitCanvas=document.createElement("canvas");this.hitCanvas.width=1;this.hitCanvas.height=1;this.hitContext=this.hitCanvas.getContext("2d");this.mouse.start();this.keyboard.start();this.touch.start();this.mspointer.start();this.mousePointer.active=!0},destroy:function(){this.mouse.stop();this.keyboard.stop();this.touch.stop();this.mspointer.stop();this.gamepad.stop();this.moveCallbacks=[]},addMoveCallback:function(n,t){return this.moveCallbacks.push({callback:n,context:t})-1},deleteMoveCallback:function(n){this.moveCallbacks[n]&&this.moveCallbacks.splice(n,1)},addPointer:function(){for(var t=0,i=10;i>0;i--)this["pointer"+i]===null&&(t=i);return t===0?(console.warn("You can only have 10 Pointer objects"),null):(this["pointer"+t]=new n.Pointer(this.game,t),this["pointer"+t])},update:function(){if(this.keyboard.update(),this.pollRate>0&&this._pollCounter<this.pollRate){this._pollCounter++;return}this.speed.x=this.position.x-this._oldPosition.x;this.speed.y=this.position.y-this._oldPosition.y;this._oldPosition.copyFrom(this.position);this.mousePointer.update();this.gamepad.active&&this.gamepad.update();this.pointer1.update();this.pointer2.update();this.pointer3&&this.pointer3.update();this.pointer4&&this.pointer4.update();this.pointer5&&this.pointer5.update();this.pointer6&&this.pointer6.update();this.pointer7&&this.pointer7.update();this.pointer8&&this.pointer8.update();this.pointer9&&this.pointer9.update();this.pointer10&&this.pointer10.update();this._pollCounter=0},reset:function(t){if(this.game.isBooted&&!this.resetLocked){typeof t=="undefined"&&(t=!1);this.keyboard.reset(t);this.mousePointer.reset();this.gamepad.reset();for(var i=1;i<=10;i++)this["pointer"+i]&&this["pointer"+i].reset();this.currentPointers=0;this.game.canvas.style.cursor!=="none"&&(this.game.canvas.style.cursor="inherit");t&&(this.onDown.dispose(),this.onUp.dispose(),this.onTap.dispose(),this.onHold.dispose(),this.onDown=new n.Signal,this.onUp=new n.Signal,this.onTap=new n.Signal,this.onHold=new n.Signal,this.moveCallbacks=[]);this._pollCounter=0}},resetSpeed:function(n,t){this._oldPosition.setTo(n,t);this.speed.setTo(0,0)},startPointer:function(n){if(this.maxPointers<10&&this.totalActivePointers==this.maxPointers)return null;if(this.pointer1.active===!1)return this.pointer1.start(n);if(this.pointer2.active===!1)return this.pointer2.start(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active===!1)return this["pointer"+t].start(n);return null},updatePointer:function(n){if(this.pointer1.active&&this.pointer1.identifier==n.identifier)return this.pointer1.move(n);if(this.pointer2.active&&this.pointer2.identifier==n.identifier)return this.pointer2.move(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==n.identifier)return this["pointer"+t].move(n);return null},stopPointer:function(n){if(this.pointer1.active&&this.pointer1.identifier==n.identifier)return this.pointer1.stop(n);if(this.pointer2.active&&this.pointer2.identifier==n.identifier)return this.pointer2.stop(n);for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active&&this["pointer"+t].identifier==n.identifier)return this["pointer"+t].stop(n);return null},getPointer:function(n){if(n=n||!1,this.pointer1.active==n)return this.pointer1;if(this.pointer2.active==n)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].active==n)return this["pointer"+t];return null},getPointerFromIdentifier:function(n){if(this.pointer1.identifier===n)return this.pointer1;if(this.pointer2.identifier===n)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].identifier===n)return this["pointer"+t];return null},getPointerFromId:function(n){if(this.pointer1.pointerId===n)return this.pointer1;if(this.pointer2.pointerId===n)return this.pointer2;for(var t=3;t<=10;t++)if(this["pointer"+t]&&this["pointer"+t].pointerId===n)return this["pointer"+t];return null},getLocalPosition:function(t,i,r){typeof r=="undefined"&&(r=new n.Point);var u=t.worldTransform,f=1/(u.a*u.d+u.b*-u.c);return r.setTo(u.d*f*i.x+-u.b*f*i.y+(u.ty*u.b-u.tx*u.d)*f,u.a*f*i.y+-u.c*f*i.x+(-u.ty*u.a+u.tx*u.c)*f)},hitTest:function(t,i,r){var u,s,h;if(!t.worldVisible)return!1;if(this.getLocalPosition(t,i,this._localPoint),r.copyFrom(this._localPoint),t.hitArea&&t.hitArea.contains)return t.hitArea.contains(this._localPoint.x,this._localPoint.y)?!0:!1;if(t instanceof n.TileSprite){var f=t.width,e=t.height,o=-f*t.anchor.x;if(this._localPoint.x>o&&this._localPoint.x<o+f&&(u=-e*t.anchor.y,this._localPoint.y>u&&this._localPoint.y<u+e))return!0}else if(t instanceof PIXI.Sprite){var f=t.texture.frame.width,e=t.texture.frame.height,o=-f*t.anchor.x;if(this._localPoint.x>o&&this._localPoint.x<o+f&&(u=-e*t.anchor.y,this._localPoint.y>u&&this._localPoint.y<u+e))return!0}for(s=0,h=t.children.length;s<h;s++)if(this.hitTest(t.children[s],i,r))return!0;return!1}};n.Input.prototype.constructor=n.Input;Object.defineProperty(n.Input.prototype,"x",{get:function(){return this._x},set:function(n){this._x=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"y",{get:function(){return this._y},set:function(n){this._y=Math.floor(n)}});Object.defineProperty(n.Input.prototype,"pollLocked",{get:function(){return this.pollRate>0&&this._pollCounter<this.pollRate}});Object.defineProperty(n.Input.prototype,"totalInactivePointers",{get:function(){return 10-this.currentPointers}});Object.defineProperty(n.Input.prototype,"totalActivePointers",{get:function(){this.currentPointers=0;for(var n=1;n<=10;n++)this["pointer"+n]&&this["pointer"+n].active&&this.currentPointers++;return this.currentPointers}});Object.defineProperty(n.Input.prototype,"worldX",{get:function(){return this.game.camera.view.x+this.x}});Object.defineProperty(n.Input.prototype,"worldY",{get:function(){return this.game.camera.view.y+this.y}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Key=function(t,i){this.game=t;this.enabled=!0;this.event=null;this.isDown=!1;this.isUp=!0;this.altKey=!1;this.ctrlKey=!1;this.shiftKey=!1;this.timeDown=0;this.duration=0;this.timeUp=-2500;this.repeats=0;this.keyCode=i;this.onDown=new n.Signal;this.onHoldCallback=null;this.onHoldContext=null;this.onUp=new n.Signal};n.Key.prototype={update:function(){this.enabled&&this.isDown&&(this.duration=this.game.time.now-this.timeDown,this.repeats++,this.onHoldCallback&&this.onHoldCallback.call(this.onHoldContext,this))},processKeyDown:function(n){this.enabled&&((this.event=n,this.isDown)||(this.altKey=n.altKey,this.ctrlKey=n.ctrlKey,this.shiftKey=n.shiftKey,this.isDown=!0,this.isUp=!1,this.timeDown=this.game.time.now,this.duration=0,this.repeats=0,this.onDown.dispatch(this)))},processKeyUp:function(n){this.enabled&&((this.event=n,this.isUp)||(this.isDown=!1,this.isUp=!0,this.timeUp=this.game.time.now,this.duration=this.game.time.now-this.timeDown,this.onUp.dispatch(this)))},reset:function(n){typeof n=="undefined"&&(n=!0);this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.now;this.duration=0;this.enabled=!0;n&&(this.onDown.removeAll(),this.onUp.removeAll(),this.onHoldCallback=null,this.onHoldContext=null)},justPressed:function(n){return typeof n=="undefined"&&(n=50),this.isDown&&this.duration<n},justReleased:function(n){return typeof n=="undefined"&&(n=50),!this.isDown&&this.game.time.now-this.timeUp<n}};n.Key.prototype.constructor=n.Key;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Keyboard=function(n){this.game=n;this.disabled=!1;this.event=null;this.pressEvent=null;this.callbackContext=this;this.onDownCallback=null;this.onPressCallback=null;this.onUpCallback=null;this._keys=[];this._capture=[];this._onKeyDown=null;this._onKeyPress=null;this._onKeyUp=null;this._i=0;this._k=0};n.Keyboard.prototype={addCallbacks:function(n,t,i,r){this.callbackContext=n;typeof t!="undefined"&&(this.onDownCallback=t);typeof i!="undefined"&&(this.onUpCallback=i);typeof r!="undefined"&&(this.onPressCallback=r)},addKey:function(t){return this._keys[t]||(this._keys[t]=new n.Key(this.game,t),this.addKeyCapture(t)),this._keys[t]},removeKey:function(n){this._keys[n]&&(this._keys[n]=null,this.removeKeyCapture(n))},createCursorKeys:function(){return{up:this.addKey(n.Keyboard.UP),down:this.addKey(n.Keyboard.DOWN),left:this.addKey(n.Keyboard.LEFT),right:this.addKey(n.Keyboard.RIGHT)}},start:function(){if(!this.game.device.cocoonJS&&this._onKeyDown===null){var n=this;this._onKeyDown=function(t){return n.processKeyDown(t)};this._onKeyUp=function(t){return n.processKeyUp(t)};this._onKeyPress=function(t){return n.processKeyPress(t)};window.addEventListener("keydown",this._onKeyDown,!1);window.addEventListener("keyup",this._onKeyUp,!1);window.addEventListener("keypress",this._onKeyPress,!1)}},stop:function(){window.removeEventListener("keydown",this._onKeyDown);window.removeEventListener("keyup",this._onKeyUp);window.removeEventListener("keypress",this._onKeyPress);this._onKeyDown=null;this._onKeyUp=null;this._onKeyPress=null},destroy:function(){this.stop();this.clearCaptures();this._keys.length=0;this._i=0},addKeyCapture:function(n){if(typeof n=="object")for(var t in n)this._capture[n[t]]=!0;else this._capture[n]=!0},removeKeyCapture:function(n){delete this._capture[n]},clearCaptures:function(){this._capture={}},update:function(){for(this._i=this._keys.length;this._i--;)this._keys[this._i]&&this._keys[this._i].update()},processKeyDown:function(t){(this.event=t,this.game.input.disabled||this.disabled)||(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new n.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyDown(t),this._k=t.keyCode,this.onDownCallback&&this.onDownCallback.call(this.callbackContext,t))},processKeyPress:function(n){(this.pressEvent=n,this.game.input.disabled||this.disabled)||this.onPressCallback&&this.onPressCallback.call(this.callbackContext,String.fromCharCode(n.charCode),n)},processKeyUp:function(t){(this.event=t,this.game.input.disabled||this.disabled)||(this._capture[t.keyCode]&&t.preventDefault(),this._keys[t.keyCode]||(this._keys[t.keyCode]=new n.Key(this.game,t.keyCode)),this._keys[t.keyCode].processKeyUp(t),this.onUpCallback&&this.onUpCallback.call(this.callbackContext,t))},reset:function(n){typeof n=="undefined"&&(n=!0);this.event=null;for(var t=this._keys.length;t--;)this._keys[t]&&this._keys[t].reset(n)},justPressed:function(n,t){return typeof t=="undefined"&&(t=50),this._keys[n]?this._keys[n].justPressed(t):!1},justReleased:function(n,t){return typeof t=="undefined"&&(t=50),this._keys[n]?this._keys[n].justReleased(t):!1},isDown:function(n){return this._keys[n]?this._keys[n].isDown:!1}};Object.defineProperty(n.Keyboard.prototype,"lastChar",{get:function(){return this.event.charCode===32?"":String.fromCharCode(this.pressEvent.charCode)}});Object.defineProperty(n.Keyboard.prototype,"lastKey",{get:function(){return this._keys[this._k]}});n.Keyboard.prototype.constructor=n.Keyboard;n.Keyboard.A="A".charCodeAt(0);n.Keyboard.B="B".charCodeAt(0);n.Keyboard.C="C".charCodeAt(0);n.Keyboard.D="D".charCodeAt(0);n.Keyboard.E="E".charCodeAt(0);n.Keyboard.F="F".charCodeAt(0);n.Keyboard.G="G".charCodeAt(0);n.Keyboard.H="H".charCodeAt(0);n.Keyboard.I="I".charCodeAt(0);n.Keyboard.J="J".charCodeAt(0);n.Keyboard.K="K".charCodeAt(0);n.Keyboard.L="L".charCodeAt(0);n.Keyboard.M="M".charCodeAt(0);n.Keyboard.N="N".charCodeAt(0);n.Keyboard.O="O".charCodeAt(0);n.Keyboard.P="P".charCodeAt(0);n.Keyboard.Q="Q".charCodeAt(0);n.Keyboard.R="R".charCodeAt(0);n.Keyboard.S="S".charCodeAt(0);n.Keyboard.T="T".charCodeAt(0);n.Keyboard.U="U".charCodeAt(0);n.Keyboard.V="V".charCodeAt(0);n.Keyboard.W="W".charCodeAt(0);n.Keyboard.X="X".charCodeAt(0);n.Keyboard.Y="Y".charCodeAt(0);n.Keyboard.Z="Z".charCodeAt(0);n.Keyboard.ZERO="0".charCodeAt(0);n.Keyboard.ONE="1".charCodeAt(0);n.Keyboard.TWO="2".charCodeAt(0);n.Keyboard.THREE="3".charCodeAt(0);n.Keyboard.FOUR="4".charCodeAt(0);n.Keyboard.FIVE="5".charCodeAt(0);n.Keyboard.SIX="6".charCodeAt(0);n.Keyboard.SEVEN="7".charCodeAt(0);n.Keyboard.EIGHT="8".charCodeAt(0);n.Keyboard.NINE="9".charCodeAt(0);n.Keyboard.NUMPAD_0=96;n.Keyboard.NUMPAD_1=97;n.Keyboard.NUMPAD_2=98;n.Keyboard.NUMPAD_3=99;n.Keyboard.NUMPAD_4=100;n.Keyboard.NUMPAD_5=101;n.Keyboard.NUMPAD_6=102;n.Keyboard.NUMPAD_7=103;n.Keyboard.NUMPAD_8=104;n.Keyboard.NUMPAD_9=105;n.Keyboard.NUMPAD_MULTIPLY=106;n.Keyboard.NUMPAD_ADD=107;n.Keyboard.NUMPAD_ENTER=108;n.Keyboard.NUMPAD_SUBTRACT=109;n.Keyboard.NUMPAD_DECIMAL=110;n.Keyboard.NUMPAD_DIVIDE=111;n.Keyboard.F1=112;n.Keyboard.F2=113;n.Keyboard.F3=114;n.Keyboard.F4=115;n.Keyboard.F5=116;n.Keyboard.F6=117;n.Keyboard.F7=118;n.Keyboard.F8=119;n.Keyboard.F9=120;n.Keyboard.F10=121;n.Keyboard.F11=122;n.Keyboard.F12=123;n.Keyboard.F13=124;n.Keyboard.F14=125;n.Keyboard.F15=126;n.Keyboard.COLON=186;n.Keyboard.EQUALS=187;n.Keyboard.UNDERSCORE=189;n.Keyboard.QUESTION_MARK=191;n.Keyboard.TILDE=192;n.Keyboard.OPEN_BRACKET=219;n.Keyboard.BACKWARD_SLASH=220;n.Keyboard.CLOSED_BRACKET=221;n.Keyboard.QUOTES=222;n.Keyboard.BACKSPACE=8;n.Keyboard.TAB=9;n.Keyboard.CLEAR=12;n.Keyboard.ENTER=13;n.Keyboard.SHIFT=16;n.Keyboard.CONTROL=17;n.Keyboard.ALT=18;n.Keyboard.CAPS_LOCK=20;n.Keyboard.ESC=27;n.Keyboard.SPACEBAR=32;n.Keyboard.PAGE_UP=33;n.Keyboard.PAGE_DOWN=34;n.Keyboard.END=35;n.Keyboard.HOME=36;n.Keyboard.LEFT=37;n.Keyboard.UP=38;n.Keyboard.RIGHT=39;n.Keyboard.DOWN=40;n.Keyboard.INSERT=45;n.Keyboard.DELETE=46;n.Keyboard.HELP=47;n.Keyboard.NUM_LOCK=144;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Mouse=function(t){this.game=t;this.callbackContext=this.game;this.mouseDownCallback=null;this.mouseMoveCallback=null;this.mouseUpCallback=null;this.mouseOutCallback=null;this.mouseOverCallback=null;this.mouseWheelCallback=null;this.capture=!1;this.button=-1;this.wheelDelta=0;this.disabled=!1;this.locked=!1;this.stopOnGameOut=!1;this.pointerLock=new n.Signal;this.event=null;this._onMouseDown=null;this._onMouseMove=null;this._onMouseUp=null;this._onMouseOut=null;this._onMouseOver=null;this._onMouseWheel=null};n.Mouse.NO_BUTTON=-1;n.Mouse.LEFT_BUTTON=0;n.Mouse.MIDDLE_BUTTON=1;n.Mouse.RIGHT_BUTTON=2;n.Mouse.WHEEL_UP=1;n.Mouse.WHEEL_DOWN=-1;n.Mouse.prototype={start:function(){if((!this.game.device.android||this.game.device.chrome!==!1)&&this._onMouseDown===null){var n=this;this._onMouseDown=function(t){return n.onMouseDown(t)};this._onMouseMove=function(t){return n.onMouseMove(t)};this._onMouseUp=function(t){return n.onMouseUp(t)};this._onMouseUpGlobal=function(t){return n.onMouseUpGlobal(t)};this._onMouseOut=function(t){return n.onMouseOut(t)};this._onMouseOver=function(t){return n.onMouseOver(t)};this._onMouseWheel=function(t){return n.onMouseWheel(t)};this.game.canvas.addEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.addEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.addEventListener("mouseup",this._onMouseUp,!0);this.game.device.cocoonJS||(window.addEventListener("mouseup",this._onMouseUpGlobal,!0),this.game.canvas.addEventListener("mouseover",this._onMouseOver,!0),this.game.canvas.addEventListener("mouseout",this._onMouseOut,!0),this.game.canvas.addEventListener("mousewheel",this._onMouseWheel,!0),this.game.canvas.addEventListener("DOMMouseScroll",this._onMouseWheel,!0))}},onMouseDown:function(n){(this.event=n,this.capture&&n.preventDefault(),this.button=n.button,this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||(n.identifier=0,this.game.input.mousePointer.start(n))},onMouseMove:function(n){(this.event=n,this.capture&&n.preventDefault(),this.mouseMoveCallback&&this.mouseMoveCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||(n.identifier=0,this.game.input.mousePointer.move(n))},onMouseUp:function(t){(this.event=t,this.capture&&t.preventDefault(),this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),this.game.input.disabled||this.disabled)||(t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseUpGlobal:function(t){this.game.input.mousePointer.withinGame||(this.button=n.Mouse.NO_BUTTON,this.mouseUpCallback&&this.mouseUpCallback.call(this.callbackContext,t),t.identifier=0,this.game.input.mousePointer.stop(t))},onMouseOut:function(n){(this.event=n,this.capture&&n.preventDefault(),this.game.input.mousePointer.withinGame=!1,this.mouseOutCallback&&this.mouseOutCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||this.stopOnGameOut&&(n.identifier=0,this.game.input.mousePointer.stop(n))},onMouseWheel:function(n){this.event=n;this.capture&&n.preventDefault();this.wheelDelta=Math.max(-1,Math.min(1,n.wheelDelta||-n.detail));this.mouseWheelCallback&&this.mouseWheelCallback.call(this.callbackContext,n)},onMouseOver:function(n){this.event=n;this.capture&&n.preventDefault();this.game.input.mousePointer.withinGame=!0;this.mouseOverCallback&&this.mouseOverCallback.call(this.callbackContext,n);this.game.input.disabled||this.disabled},requestPointerLock:function(){var n,t;this.game.device.pointerLock&&(n=this.game.canvas,n.requestPointerLock=n.requestPointerLock||n.mozRequestPointerLock||n.webkitRequestPointerLock,n.requestPointerLock(),t=this,this._pointerLockChange=function(n){return t.pointerLockChange(n)},document.addEventListener("pointerlockchange",this._pointerLockChange,!0),document.addEventListener("mozpointerlockchange",this._pointerLockChange,!0),document.addEventListener("webkitpointerlockchange",this._pointerLockChange,!0))},pointerLockChange:function(n){var t=this.game.canvas;document.pointerLockElement===t||document.mozPointerLockElement===t||document.webkitPointerLockElement===t?(this.locked=!0,this.pointerLock.dispatch(!0,n)):(this.locked=!1,this.pointerLock.dispatch(!1,n))},releasePointerLock:function(){document.exitPointerLock=document.exitPointerLock||document.mozExitPointerLock||document.webkitExitPointerLock;document.exitPointerLock();document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)},stop:function(){this.game.canvas.removeEventListener("mousedown",this._onMouseDown,!0);this.game.canvas.removeEventListener("mousemove",this._onMouseMove,!0);this.game.canvas.removeEventListener("mouseup",this._onMouseUp,!0);this.game.canvas.removeEventListener("mouseover",this._onMouseOver,!0);this.game.canvas.removeEventListener("mouseout",this._onMouseOut,!0);this.game.canvas.removeEventListener("mousewheel",this._onMouseWheel,!0);this.game.canvas.removeEventListener("DOMMouseScroll",this._onMouseWheel,!0);window.removeEventListener("mouseup",this._onMouseUpGlobal,!0);document.removeEventListener("pointerlockchange",this._pointerLockChange,!0);document.removeEventListener("mozpointerlockchange",this._pointerLockChange,!0);document.removeEventListener("webkitpointerlockchange",this._pointerLockChange,!0)}};n.Mouse.prototype.constructor=n.Mouse;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.MSPointer=function(n){this.game=n;this.callbackContext=this.game;this.disabled=!1;this._onMSPointerDown=null;this._onMSPointerMove=null;this._onMSPointerUp=null};n.MSPointer.prototype={start:function(){if(this._onMSPointerDown===null){var n=this;this.game.device.mspointer&&(this._onMSPointerDown=function(t){return n.onPointerDown(t)},this._onMSPointerMove=function(t){return n.onPointerMove(t)},this._onMSPointerUp=function(t){return n.onPointerUp(t)},this.game.canvas.addEventListener("MSPointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("MSPointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("MSPointerUp",this._onMSPointerUp,!1),this.game.canvas.addEventListener("pointerDown",this._onMSPointerDown,!1),this.game.canvas.addEventListener("pointerMove",this._onMSPointerMove,!1),this.game.canvas.addEventListener("pointerUp",this._onMSPointerUp,!1),this.game.canvas.style["-ms-content-zooming"]="none",this.game.canvas.style["-ms-touch-action"]="none")}},onPointerDown:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.startPointer(n))},onPointerMove:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.updatePointer(n))},onPointerUp:function(n){this.game.input.disabled||this.disabled||(n.preventDefault(),n.identifier=n.pointerId,this.game.input.stopPointer(n))},stop:function(){this.game.canvas.removeEventListener("MSPointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("MSPointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("MSPointerUp",this._onMSPointerUp);this.game.canvas.removeEventListener("pointerDown",this._onMSPointerDown);this.game.canvas.removeEventListener("pointerMove",this._onMSPointerMove);this.game.canvas.removeEventListener("pointerUp",this._onMSPointerUp)}};n.MSPointer.prototype.constructor=n.MSPointer;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Pointer=function(t,i){this.game=t;this.id=i;this.type=n.POINTER;this.exists=!0;this.identifier=0;this.pointerId=null;this.target=null;this.button=null;this._holdSent=!1;this._history=[];this._nextDrop=0;this._stateReset=!1;this.withinGame=!1;this.clientX=-1;this.clientY=-1;this.pageX=-1;this.pageY=-1;this.screenX=-1;this.screenY=-1;this.rawMovementX=0;this.rawMovementY=0;this.movementX=0;this.movementY=0;this.x=-1;this.y=-1;this.isMouse=!1;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.timeUp=0;this.previousTapTime=0;this.totalTouches=0;this.msSinceLastClick=Number.MAX_VALUE;this.targetObject=null;this.active=!1;this.dirty=!1;this.position=new n.Point;this.positionDown=new n.Point;this.positionUp=new n.Point;this.circle=new n.Circle(0,0,44);i===0&&(this.isMouse=!0)};n.Pointer.prototype={start:function(t){return t.pointerId&&(this.pointerId=t.pointerId),this.identifier=t.identifier,this.target=t.target,typeof t.button!="undefined"&&(this.button=t.button),this._history=[],this.active=!0,this.withinGame=!0,this.isDown=!0,this.isUp=!1,this.dirty=!1,this.msSinceLastClick=this.game.time.now-this.timeDown,this.timeDown=this.game.time.now,this._holdSent=!1,this.move(t,!0),this.positionDown.setTo(this.x,this.y),(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.x,this.y),this.game.input.onDown.dispatch(this,t),this.game.input.resetSpeed(this.x,this.y)),this._stateReset=!1,this.totalTouches++,this.isMouse||this.game.input.currentPointers++,this.targetObject!==null&&this.targetObject._touchedHandler(this),this},update:function(){this.active&&(this.dirty&&(this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(!0),this.dirty=!1),this._holdSent===!1&&this.duration>=this.game.input.holdRate&&((this.game.input.multiInputOverride==n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride==n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride==n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&this.game.input.onHold.dispatch(this),this._holdSent=!0),this.game.input.recordPointerHistory&&this.game.time.now>=this._nextDrop&&(this._nextDrop=this.game.time.now+this.game.input.recordRate,this._history.push({x:this.position.x,y:this.position.y}),this._history.length>this.game.input.recordLimit&&this._history.shift()))},move:function(t,i){if(!this.game.input.pollLocked){if(typeof i=="undefined"&&(i=!1),typeof t.button!="undefined"&&(this.button=t.button),this.clientX=t.clientX,this.clientY=t.clientY,this.pageX=t.pageX,this.pageY=t.pageY,this.screenX=t.screenX,this.screenY=t.screenY,this.isMouse&&this.game.input.mouse.locked&&!i&&(this.rawMovementX=t.movementX||t.mozMovementX||t.webkitMovementX||0,this.rawMovementY=t.movementY||t.mozMovementY||t.webkitMovementY||0,this.movementX+=this.rawMovementX,this.movementY+=this.rawMovementY),this.x=(this.pageX-this.game.scale.offset.x)*this.game.input.scale.x,this.y=(this.pageY-this.game.scale.offset.y)*this.game.input.scale.y,this.position.setTo(this.x,this.y),this.circle.x=this.x,this.circle.y=this.y,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.activePointer=this,this.game.input.x=this.x,this.game.input.y=this.y,this.game.input.position.setTo(this.game.input.x,this.game.input.y),this.game.input.circle.x=this.game.input.x,this.game.input.circle.y=this.game.input.y),this.withinGame=this.game.scale.bounds.contains(this.pageX,this.pageY),this.game.paused)return this;for(var r=this.game.input.moveCallbacks.length;r--;)this.game.input.moveCallbacks[r].callback.call(this.game.input.moveCallbacks[r].context,this,this.x,this.y,i);return this.targetObject!==null&&this.targetObject.isDragged===!0?this.targetObject.update(this)===!1&&(this.targetObject=null):this.game.input.interactiveItems.total>0&&this.processInteractiveObjects(i),this}},processInteractiveObjects:function(n){var t;this.game.input.interactiveItems.setAll("checked",!1);this._highestRenderOrderID=Number.MAX_SAFE_INTEGER;this._highestRenderObject=null;this._highestInputPriorityID=-1;t=this.game.input.interactiveItems.first;do t&&t.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!1)&&(t.checked=!0,(n&&t.checkPointerDown(this,!0)||!n&&t.checkPointerOver(this,!0))&&(this._highestRenderOrderID=t.sprite._cache[3],this._highestInputPriorityID=t.priorityID,this._highestRenderObject=t)),t=this.game.input.interactiveItems.next;while(t!==null);t=this.game.input.interactiveItems.first;do t&&!t.checked&&t.validForInput(this._highestInputPriorityID,this._highestRenderOrderID,!0)&&(n&&t.checkPointerDown(this,!1)||!n&&t.checkPointerOver(this,!1))&&(this._highestRenderOrderID=t.sprite._cache[3],this._highestInputPriorityID=t.priorityID,this._highestRenderObject=t),t=this.game.input.interactiveItems.next;while(t!==null);return this._highestRenderObject===null?this.targetObject&&(this.targetObject._pointerOutHandler(this),this.targetObject=null):this.targetObject===null?(this.targetObject=this._highestRenderObject,this._highestRenderObject._pointerOverHandler(this)):this.targetObject===this._highestRenderObject?this._highestRenderObject.update(this)===!1&&(this.targetObject=null):(this.targetObject._pointerOutHandler(this),this.targetObject=this._highestRenderObject,this.targetObject._pointerOverHandler(this)),this.targetObject!==null},leave:function(n){this.withinGame=!1;this.move(n,!1)},stop:function(t){if(this._stateReset){t.preventDefault();return}return this.timeUp=this.game.time.now,(this.game.input.multiInputOverride===n.Input.MOUSE_OVERRIDES_TOUCH||this.game.input.multiInputOverride===n.Input.MOUSE_TOUCH_COMBINE||this.game.input.multiInputOverride===n.Input.TOUCH_OVERRIDES_MOUSE&&this.game.input.currentPointers===0)&&(this.game.input.onUp.dispatch(this,t),this.duration>=0&&this.duration<=this.game.input.tapRate&&(this.timeUp-this.previousTapTime<this.game.input.doubleTapRate?this.game.input.onTap.dispatch(this,!0):this.game.input.onTap.dispatch(this,!1),this.previousTapTime=this.timeUp)),this.id>0&&(this.active=!1),this.withinGame=!1,this.isDown=!1,this.isUp=!0,this.pointerId=null,this.identifier=null,this.positionUp.setTo(this.x,this.y),this.isMouse===!1&&this.game.input.currentPointers--,this.game.input.interactiveItems.callAll("_releasedHandler",this),this.targetObject=null,this},justPressed:function(n){return n=n||this.game.input.justPressedRate,this.isDown===!0&&this.timeDown+n>this.game.time.now},justReleased:function(n){return n=n||this.game.input.justReleasedRate,this.isUp===!0&&this.timeUp+n>this.game.time.now},reset:function(){this.isMouse===!1&&(this.active=!1);this.pointerId=null;this.identifier=null;this.dirty=!1;this.isDown=!1;this.isUp=!0;this.totalTouches=0;this._holdSent=!1;this._history.length=0;this._stateReset=!0;this.targetObject&&this.targetObject._releasedHandler(this);this.targetObject=null},resetMovement:function(){this.movementX=0;this.movementY=0}};n.Pointer.prototype.constructor=n.Pointer;Object.defineProperty(n.Pointer.prototype,"duration",{get:function(){return this.isUp?-1:this.game.time.now-this.timeDown}});Object.defineProperty(n.Pointer.prototype,"worldX",{get:function(){return this.game.world.camera.x+this.x}});Object.defineProperty(n.Pointer.prototype,"worldY",{get:function(){return this.game.world.camera.y+this.y}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Touch=function(n){this.game=n;this.disabled=!1;this.callbackContext=this.game;this.touchStartCallback=null;this.touchMoveCallback=null;this.touchEndCallback=null;this.touchEnterCallback=null;this.touchLeaveCallback=null;this.touchCancelCallback=null;this.preventDefault=!0;this.event=null;this._onTouchStart=null;this._onTouchMove=null;this._onTouchEnd=null;this._onTouchEnter=null;this._onTouchLeave=null;this._onTouchCancel=null;this._onTouchMove=null};n.Touch.prototype={start:function(){if(this._onTouchStart===null){var n=this;this.game.device.touch&&(this._onTouchStart=function(t){return n.onTouchStart(t)},this._onTouchMove=function(t){return n.onTouchMove(t)},this._onTouchEnd=function(t){return n.onTouchEnd(t)},this._onTouchEnter=function(t){return n.onTouchEnter(t)},this._onTouchLeave=function(t){return n.onTouchLeave(t)},this._onTouchCancel=function(t){return n.onTouchCancel(t)},this.game.canvas.addEventListener("touchstart",this._onTouchStart,!1),this.game.canvas.addEventListener("touchmove",this._onTouchMove,!1),this.game.canvas.addEventListener("touchend",this._onTouchEnd,!1),this.game.canvas.addEventListener("touchcancel",this._onTouchCancel,!1),this.game.device.cocoonJS||(this.game.canvas.addEventListener("touchenter",this._onTouchEnter,!1),this.game.canvas.addEventListener("touchleave",this._onTouchLeave,!1)))}},consumeDocumentTouches:function(){this._documentTouchMove=function(n){n.preventDefault()};document.addEventListener("touchmove",this._documentTouchMove,!1)},onTouchStart:function(n){if(this.event=n,this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,n),!this.game.input.disabled&&!this.disabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.startPointer(n.changedTouches[t])}},onTouchCancel:function(n){if(this.event=n,this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,n),!this.game.input.disabled&&!this.disabled){this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])}},onTouchEnter:function(n){(this.event=n,this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,n),this.game.input.disabled||this.disabled)||this.preventDefault&&n.preventDefault()},onTouchLeave:function(n){this.event=n;this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault()},onTouchMove:function(n){this.event=n;this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.updatePointer(n.changedTouches[t])},onTouchEnd:function(n){this.event=n;this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,n);this.preventDefault&&n.preventDefault();for(var t=0;t<n.changedTouches.length;t++)this.game.input.stopPointer(n.changedTouches[t])},stop:function(){this.game.device.touch&&(this.game.canvas.removeEventListener("touchstart",this._onTouchStart),this.game.canvas.removeEventListener("touchmove",this._onTouchMove),this.game.canvas.removeEventListener("touchend",this._onTouchEnd),this.game.canvas.removeEventListener("touchenter",this._onTouchEnter),this.game.canvas.removeEventListener("touchleave",this._onTouchLeave),this.game.canvas.removeEventListener("touchcancel",this._onTouchCancel))}};n.Touch.prototype.constructor=n.Touch;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Gamepad=function(t){this.game=t;this._gamepadIndexMap={};this._rawPads=[];this._active=!1;this.disabled=!1;this._gamepadSupportAvailable=!!navigator.webkitGetGamepads||!!navigator.webkitGamepads||navigator.userAgent.indexOf("Firefox/")!=-1||!!navigator.getGamepads;this._prevRawGamepadTypes=[];this._prevTimestamps=[];this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this._ongamepadconnected=null;this._gamepaddisconnected=null;this._gamepads=[new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this),new n.SinglePad(t,this)]};n.Gamepad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback)},start:function(){if(!this._active){this._active=!0;var n=this;this._onGamepadConnected=function(t){return n.onGamepadConnected(t)};this._onGamepadDisconnected=function(t){return n.onGamepadDisconnected(t)};window.addEventListener("gamepadconnected",this._onGamepadConnected,!1);window.addEventListener("gamepaddisconnected",this._onGamepadDisconnected,!1)}},onGamepadConnected:function(n){var t=n.gamepad;this._rawPads.push(t);this._gamepads[t.index].connect(t)},onGamepadDisconnected:function(n){var t=n.gamepad;for(var i in this._rawPads)this._rawPads[i].index===t.index&&this._rawPads.splice(i,1);this._gamepads[t.index].disconnect()},update:function(){this._pollGamepads();this.pad1.pollStatus();this.pad2.pollStatus();this.pad3.pollStatus();this.pad4.pollStatus()},_pollGamepads:function(){var t,h,n,r,i,f,o,u,s,e;if(navigator.getGamepads?t=navigator.getGamepads():navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.webkitGamepads&&(t=navigator.webkitGamepads()),t){for(this._rawPads=[],h=!1,n=0;n<t.length;n++)if(typeof t[n]!==this._prevRawGamepadTypes[n]&&(h=!0,this._prevRawGamepadTypes[n]=typeof t[n]),t[n]&&this._rawPads.push(t[n]),n===3)break;if(h){for(r={rawIndices:{},padIndices:{}},f=0;f<this._gamepads.length;f++)if(i=this._gamepads[f],i.connected)for(o=0;o<this._rawPads.length;o++)this._rawPads[o].index===i.index&&(r.rawIndices[i.index]=!0,r.padIndices[f]=!0);for(u=0;u<this._gamepads.length;u++)if(i=this._gamepads[u],!r.padIndices[u])for(this._rawPads.length<1&&i.disconnect(),s=0;s<this._rawPads.length;s++){if(r.padIndices[u])break;if(e=this._rawPads[s],e)if(r.rawIndices[e.index]){i.disconnect();continue}else i.connect(e),r.rawIndices[e.index]=!0,r.padIndices[u]=!0;else i.disconnect()}}}},setDeadZones:function(n){for(var t=0;t<this._gamepads.length;t++)this._gamepads[t].deadZone=n},stop:function(){this._active=!1;window.removeEventListener("gamepadconnected",this._onGamepadConnected);window.removeEventListener("gamepaddisconnected",this._onGamepadDisconnected)},reset:function(){this.update();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].reset()},justPressed:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justPressed(n,t)===!0)return!0;return!1},justReleased:function(n,t){for(var i=0;i<this._gamepads.length;i++)if(this._gamepads[i].justReleased(n,t)===!0)return!0;return!1},isDown:function(n){for(var t=0;t<this._gamepads.length;t++)if(this._gamepads[t].isDown(n)===!0)return!0;return!1},destroy:function(){this.stop();for(var n=0;n<this._gamepads.length;n++)this._gamepads[n].destroy()}};n.Gamepad.prototype.constructor=n.Gamepad;Object.defineProperty(n.Gamepad.prototype,"active",{get:function(){return this._active}});Object.defineProperty(n.Gamepad.prototype,"supported",{get:function(){return this._gamepadSupportAvailable}});Object.defineProperty(n.Gamepad.prototype,"padsConnected",{get:function(){return this._rawPads.length}});Object.defineProperty(n.Gamepad.prototype,"pad1",{get:function(){return this._gamepads[0]}});Object.defineProperty(n.Gamepad.prototype,"pad2",{get:function(){return this._gamepads[1]}});Object.defineProperty(n.Gamepad.prototype,"pad3",{get:function(){return this._gamepads[2]}});Object.defineProperty(n.Gamepad.prototype,"pad4",{get:function(){return this._gamepads[3]}});n.Gamepad.BUTTON_0=0;n.Gamepad.BUTTON_1=1;n.Gamepad.BUTTON_2=2;n.Gamepad.BUTTON_3=3;n.Gamepad.BUTTON_4=4;n.Gamepad.BUTTON_5=5;n.Gamepad.BUTTON_6=6;n.Gamepad.BUTTON_7=7;n.Gamepad.BUTTON_8=8;n.Gamepad.BUTTON_9=9;n.Gamepad.BUTTON_10=10;n.Gamepad.BUTTON_11=11;n.Gamepad.BUTTON_12=12;n.Gamepad.BUTTON_13=13;n.Gamepad.BUTTON_14=14;n.Gamepad.BUTTON_15=15;n.Gamepad.AXIS_0=0;n.Gamepad.AXIS_1=1;n.Gamepad.AXIS_2=2;n.Gamepad.AXIS_3=3;n.Gamepad.AXIS_4=4;n.Gamepad.AXIS_5=5;n.Gamepad.AXIS_6=6;n.Gamepad.AXIS_7=7;n.Gamepad.AXIS_8=8;n.Gamepad.AXIS_9=9;n.Gamepad.XBOX360_A=0;n.Gamepad.XBOX360_B=1;n.Gamepad.XBOX360_X=2;n.Gamepad.XBOX360_Y=3;n.Gamepad.XBOX360_LEFT_BUMPER=4;n.Gamepad.XBOX360_RIGHT_BUMPER=5;n.Gamepad.XBOX360_LEFT_TRIGGER=6;n.Gamepad.XBOX360_RIGHT_TRIGGER=7;n.Gamepad.XBOX360_BACK=8;n.Gamepad.XBOX360_START=9;n.Gamepad.XBOX360_STICK_LEFT_BUTTON=10;n.Gamepad.XBOX360_STICK_RIGHT_BUTTON=11;n.Gamepad.XBOX360_DPAD_LEFT=14;n.Gamepad.XBOX360_DPAD_RIGHT=15;n.Gamepad.XBOX360_DPAD_UP=12;n.Gamepad.XBOX360_DPAD_DOWN=13;n.Gamepad.XBOX360_STICK_LEFT_X=0;n.Gamepad.XBOX360_STICK_LEFT_Y=1;n.Gamepad.XBOX360_STICK_RIGHT_X=2;n.Gamepad.XBOX360_STICK_RIGHT_Y=3;n.Gamepad.PS3XC_X=0;n.Gamepad.PS3XC_CIRCLE=1;n.Gamepad.PS3XC_SQUARE=2;n.Gamepad.PS3XC_TRIANGLE=3;n.Gamepad.PS3XC_L1=4;n.Gamepad.PS3XC_R1=5;n.Gamepad.PS3XC_L2=6;n.Gamepad.PS3XC_R2=7;n.Gamepad.PS3XC_SELECT=8;n.Gamepad.PS3XC_START=9;n.Gamepad.PS3XC_STICK_LEFT_BUTTON=10;n.Gamepad.PS3XC_STICK_RIGHT_BUTTON=11;n.Gamepad.PS3XC_DPAD_UP=12;n.Gamepad.PS3XC_DPAD_DOWN=13;n.Gamepad.PS3XC_DPAD_LEFT=14;n.Gamepad.PS3XC_DPAD_RIGHT=15;n.Gamepad.PS3XC_STICK_LEFT_X=0;n.Gamepad.PS3XC_STICK_LEFT_Y=1;n.Gamepad.PS3XC_STICK_RIGHT_X=2;n.Gamepad.PS3XC_STICK_RIGHT_Y=3;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SinglePad=function(n,t){this.game=n;this.index=null;this.connected=!1;this.callbackContext=this;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null;this.deadZone=.26;this._padParent=t;this._rawPad=null;this._prevTimestamp=null;this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0};n.SinglePad.prototype={addCallbacks:function(n,t){typeof t!="undefined"&&(this.onConnectCallback=typeof t.onConnect=="function"?t.onConnect:this.onConnectCallback,this.onDisconnectCallback=typeof t.onDisconnect=="function"?t.onDisconnect:this.onDisconnectCallback,this.onDownCallback=typeof t.onDown=="function"?t.onDown:this.onDownCallback,this.onUpCallback=typeof t.onUp=="function"?t.onUp:this.onUpCallback,this.onAxisCallback=typeof t.onAxis=="function"?t.onAxis:this.onAxisCallback,this.onFloatCallback=typeof t.onFloat=="function"?t.onFloat:this.onFloatCallback)},getButton:function(n){return this._buttons[n]?this._buttons[n]:null},pollStatus:function(){var n,t,i,r;if(this.connected&&!this.game.input.disabled&&!this.game.input.gamepad.disabled&&(!this._rawPad.timestamp||this._rawPad.timestamp!==this._prevTimestamp)){for(n=0;n<this._buttonsLen;n++)t=isNaN(this._rawPad.buttons[n])?this._rawPad.buttons[n].value:this._rawPad.buttons[n],t!==this._buttons[n].value&&(t===1?this.processButtonDown(n,t):t===0?this.processButtonUp(n,t):this.processButtonFloat(n,t));for(i=0;i<this._axesLen;i++)r=this._rawPad.axes[i],r>0&&r>this.deadZone||r<0&&r<-this.deadZone?this.processAxisChange(i,r):this.processAxisChange(i,0);this._prevTimestamp=this._rawPad.timestamp}},connect:function(t){var u=!this.connected,i,r;for(this.connected=!0,this.index=t.index,this._rawPad=t,this._buttons=[],this._buttonsLen=t.buttons.length,this._axes=[],this._axesLen=t.axes.length,i=0;i<this._axesLen;i++)this._axes[i]=t.axes[i];for(r in t.buttons)r=parseInt(r,10),this._buttons[r]=new n.GamepadButton(this,r);u&&this._padParent.onConnectCallback&&this._padParent.onConnectCallback.call(this._padParent.callbackContext,this.index);u&&this.onConnectCallback&&this.onConnectCallback.call(this.callbackContext)},disconnect:function(){var t=this.connected,i=this.index,n;for(this.connected=!1,this.index=null,this._rawPad=undefined,n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;t&&this._padParent.onDisconnectCallback&&this._padParent.onDisconnectCallback.call(this._padParent.callbackContext,i);t&&this.onDisconnectCallback&&this.onDisconnectCallback.call(this.callbackContext)},destroy:function(){this._rawPad=undefined;for(var n=0;n<this._buttonsLen;n++)this._buttons[n].destroy();this._buttons=[];this._buttonsLen=0;this._axes=[];this._axesLen=0;this.onConnectCallback=null;this.onDisconnectCallback=null;this.onDownCallback=null;this.onUpCallback=null;this.onAxisCallback=null;this.onFloatCallback=null},processAxisChange:function(n,t){this._axes[n]!==t&&(this._axes[n]=t,this._padParent.onAxisCallback&&this._padParent.onAxisCallback.call(this._padParent.callbackContext,this,n,t),this.onAxisCallback&&this.onAxisCallback.call(this.callbackContext,this,n,t))},processButtonDown:function(n,t){this._padParent.onDownCallback&&this._padParent.onDownCallback.call(this._padParent.callbackContext,n,t,this.index);this.onDownCallback&&this.onDownCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonDown(t)},processButtonUp:function(n,t){this._padParent.onUpCallback&&this._padParent.onUpCallback.call(this._padParent.callbackContext,n,t,this.index);this.onUpCallback&&this.onUpCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonUp(t)},processButtonFloat:function(n,t){this._padParent.onFloatCallback&&this._padParent.onFloatCallback.call(this._padParent.callbackContext,n,t,this.index);this.onFloatCallback&&this.onFloatCallback.call(this.callbackContext,n,t);this._buttons[n]&&this._buttons[n].processButtonFloat(t)},axis:function(n){return this._axes[n]?this._axes[n]:!1},isDown:function(n){return this._buttons[n]?this._buttons[n].isDown:!1},isUp:function(n){return this._buttons[n]?this._buttons[n].isUp:!1},justReleased:function(n,t){if(this._buttons[n])return this._buttons[n].justReleased(t)},justPressed:function(n,t){if(this._buttons[n])return this._buttons[n].justPressed(t)},buttonValue:function(n){return this._buttons[n]?this._buttons[n].value:null},reset:function(){for(var n=0;n<this._axes.length;n++)this._axes[n]=0}};n.SinglePad.prototype.constructor=n.SinglePad;
/**
* @author       @karlmacklin <tacklemcclean@gmail.com>
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GamepadButton=function(t,i){this.pad=t;this.game=t.game;this.isDown=!1;this.isUp=!0;this.timeDown=0;this.duration=0;this.timeUp=0;this.repeats=0;this.value=0;this.buttonCode=i;this.onDown=new n.Signal;this.onUp=new n.Signal;this.onFloat=new n.Signal};n.GamepadButton.prototype={processButtonDown:function(n){this.isDown=!0;this.isUp=!1;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0;this.value=n;this.onDown.dispatch(this,n)},processButtonUp:function(n){this.isDown=!1;this.isUp=!0;this.timeUp=this.game.time.now;this.value=n;this.onUp.dispatch(this,n)},processButtonFloat:function(n){this.value=n;this.onFloat.dispatch(this,n)},justPressed:function(n){return n=n||250,this.isDown===!0&&this.timeDown+n>this.game.time.now},justReleased:function(n){return n=n||250,this.isUp===!0&&this.timeUp+n>this.game.time.now},reset:function(){this.isDown=!1;this.isUp=!0;this.timeDown=this.game.time.now;this.duration=0;this.repeats=0},destroy:function(){this.onDown.dispose();this.onUp.dispose();this.onFloat.dispose();this.pad=null;this.game=null}};n.GamepadButton.prototype.constructor=n.GamepadButton;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.InputHandler=function(t){this.sprite=t;this.game=t.game;this.enabled=!1;this.checked=!1;this.priorityID=0;this.useHandCursor=!1;this._setHandCursor=!1;this.isDragged=!1;this.allowHorizontalDrag=!0;this.allowVerticalDrag=!0;this.bringToTop=!1;this.snapOffset=null;this.snapOnDrag=!1;this.snapOnRelease=!1;this.snapX=0;this.snapY=0;this.snapOffsetX=0;this.snapOffsetY=0;this.pixelPerfectOver=!1;this.pixelPerfectClick=!1;this.pixelPerfectAlpha=255;this.draggable=!1;this.boundsRect=null;this.boundsSprite=null;this.consumePointerEvent=!1;this._dragPhase=!1;this._wasEnabled=!1;this._tempPoint=new n.Point;this._pointerData=[];this._pointerData.push({id:0,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1})};n.InputHandler.prototype={start:function(t,i){if(t=t||0,typeof i=="undefined"&&(i=!1),this.enabled===!1){this.game.input.interactiveItems.add(this);this.useHandCursor=i;this.priorityID=t;for(var r=0;r<10;r++)this._pointerData[r]={id:r,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1};this.snapOffset=new n.Point;this.enabled=!0;this._wasEnabled=!0;this.sprite.events&&this.sprite.events.onInputOver===null&&(this.sprite.events.onInputOver=new n.Signal,this.sprite.events.onInputOut=new n.Signal,this.sprite.events.onInputDown=new n.Signal,this.sprite.events.onInputUp=new n.Signal,this.sprite.events.onDragStart=new n.Signal,this.sprite.events.onDragStop=new n.Signal)}return this.sprite.events.onAddedToGroup.add(this.addedToGroup,this),this.sprite.events.onRemovedFromGroup.add(this.removedFromGroup,this),this.flagged=!1,this.sprite},addedToGroup:function(){this._dragPhase||this._wasEnabled&&!this.enabled&&this.start()},removedFromGroup:function(){this._dragPhase||(this.enabled?(this._wasEnabled=!0,this.stop()):this._wasEnabled=!1)},reset:function(){this.enabled=!1;this.flagged=!1;for(var n=0;n<10;n++)this._pointerData[n]={id:n,x:0,y:0,isDown:!1,isUp:!1,isOver:!1,isOut:!1,timeOver:0,timeOut:0,timeDown:0,timeUp:0,downDuration:0,isDragged:!1}},stop:function(){this.enabled!==!1&&(this.enabled=!1,this.game.input.interactiveItems.remove(this))},destroy:function(){this.sprite&&(this._setHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.enabled=!1,this.game.input.interactiveItems.remove(this),this._pointerData.length=0,this.boundsRect=null,this.boundsSprite=null,this.sprite=null)},validForInput:function(n,t,i){return(typeof i=="undefined"&&(i=!0),this.sprite.scale.x===0||this.sprite.scale.y===0||this.priorityID<this.game.input.minPriorityID)?!1:!i&&(this.pixelPerfectClick||this.pixelPerfectOver)?!1:this.priorityID>n||this.priorityID===n&&this.sprite._cache[3]<t?!0:!1},isPixelPerfect:function(){return this.pixelPerfectClick||this.pixelPerfectOver},pointerX:function(n){return n=n||0,this._pointerData[n].x},pointerY:function(n){return n=n||0,this._pointerData[n].y},pointerDown:function(n){return n=n||0,this._pointerData[n].isDown},pointerUp:function(n){return n=n||0,this._pointerData[n].isUp},pointerTimeDown:function(n){return n=n||0,this._pointerData[n].timeDown},pointerTimeUp:function(n){return n=n||0,this._pointerData[n].timeUp},pointerOver:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOver)return!0}else return this._pointerData[n].isOver;return!1},pointerOut:function(n){if(this.enabled)if(typeof n=="undefined"){for(var t=0;t<10;t++)if(this._pointerData[t].isOut)return!0}else return this._pointerData[n].isOut;return!1},pointerTimeOver:function(n){return n=n||0,this._pointerData[n].timeOver},pointerTimeOut:function(n){return n=n||0,this._pointerData[n].timeOut},pointerDragged:function(n){return n=n||0,this._pointerData[n].isDragged},checkPointerDown:function(n,t){return!n.isDown||!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(typeof t=="undefined"&&(t=!1),!t&&this.pixelPerfectClick?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPointerOver:function(n,t){return!this.enabled||!this.sprite||!this.sprite.parent||!this.sprite.visible||!this.sprite.parent.visible?!1:this.game.input.hitTest(this.sprite,n,this._tempPoint)?(typeof t=="undefined"&&(t=!1),!t&&this.pixelPerfectOver?this.checkPixel(this._tempPoint.x,this._tempPoint.y):!0):!1},checkPixel:function(n,t,i){var n,t,r;if(this.sprite.texture.baseTexture.source){if(n===null&&t===null&&(this.game.input.getLocalPosition(this.sprite,i,this._tempPoint),n=this._tempPoint.x,t=this._tempPoint.y),this.sprite.anchor.x!==0&&(n-=-this.sprite.texture.frame.width*this.sprite.anchor.x),this.sprite.anchor.y!==0&&(t-=-this.sprite.texture.frame.height*this.sprite.anchor.y),n+=this.sprite.texture.frame.x,t+=this.sprite.texture.frame.y,this.sprite.texture.trim&&(n-=this.sprite.texture.trim.x,t-=this.sprite.texture.trim.y,n<this.sprite.texture.crop.x||n>this.sprite.texture.crop.right||t<this.sprite.texture.crop.y||t>this.sprite.texture.crop.bottom))return this._dx=n,this._dy=t,!1;if(this._dx=n,this._dy=t,this.game.input.hitContext.clearRect(0,0,1,1),this.game.input.hitContext.drawImage(this.sprite.texture.baseTexture.source,n,t,1,1,0,0,1,1),r=this.game.input.hitContext.getImageData(0,0,1,1),r.data[3]>=this.pixelPerfectAlpha)return!0}return!1},update:function(n){if(this.sprite!==null&&this.sprite.parent!==undefined)return!this.enabled||!this.sprite.visible||!this.sprite.parent.visible?(this._pointerOutHandler(n),!1):this.draggable&&this._draggedPointerID==n.id?this.updateDrag(n):this._pointerData[n.id].isOver===!0?this.checkPointerOver(n)?(this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,!0):(this._pointerOutHandler(n),!1):void 0},_pointerOverHandler:function(n){this.sprite!==null&&(this._pointerData[n.id].isOver===!1||n.dirty)&&(this._pointerData[n.id].isOver=!0,this._pointerData[n.id].isOut=!1,this._pointerData[n.id].timeOver=this.game.time.now,this._pointerData[n.id].x=n.x-this.sprite.x,this._pointerData[n.id].y=n.y-this.sprite.y,this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="pointer",this._setHandCursor=!0),this.sprite&&this.sprite.events&&this.sprite.events.onInputOver.dispatch(this.sprite,n))},_pointerOutHandler:function(n){this.sprite!==null&&(this._pointerData[n.id].isOver=!1,this._pointerData[n.id].isOut=!0,this._pointerData[n.id].timeOut=this.game.time.now,this.useHandCursor&&this._pointerData[n.id].isDragged===!1&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1),this.sprite&&this.sprite.events&&this.sprite.events.onInputOut.dispatch(this.sprite,n))},_touchedHandler:function(n){if(this.sprite!==null){if(this._pointerData[n.id].isDown===!1&&this._pointerData[n.id].isOver===!0){if(this.pixelPerfectClick&&!this.checkPixel(null,null,n))return;this._pointerData[n.id].isDown=!0;this._pointerData[n.id].isUp=!1;this._pointerData[n.id].timeDown=this.game.time.now;this.sprite&&this.sprite.events&&this.sprite.events.onInputDown.dispatch(this.sprite,n);n.dirty=!0;this.draggable&&this.isDragged===!1&&this.startDrag(n);this.bringToTop&&this.sprite.bringToTop()}return this.consumePointerEvent}},_releasedHandler:function(n){this.sprite!==null&&this._pointerData[n.id].isDown&&n.isUp&&(this._pointerData[n.id].isDown=!1,this._pointerData[n.id].isUp=!0,this._pointerData[n.id].timeUp=this.game.time.now,this._pointerData[n.id].downDuration=this._pointerData[n.id].timeUp-this._pointerData[n.id].timeDown,this.checkPointerOver(n)?this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,n,!0):(this.sprite&&this.sprite.events&&this.sprite.events.onInputUp.dispatch(this.sprite,n,!1),this.useHandCursor&&(this.game.canvas.style.cursor="default",this._setHandCursor=!1)),n.dirty=!0,this.draggable&&this.isDragged&&this._draggedPointerID===n.id&&this.stopDrag(n))},updateDrag:function(n){return n.isUp?(this.stopDrag(n),!1):(this.sprite.fixedToCamera?(this.allowHorizontalDrag&&(this.sprite.cameraOffset.x=n.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.cameraOffset.y=n.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)):(this.allowHorizontalDrag&&(this.sprite.x=n.x+this._dragPoint.x+this.dragOffset.x),this.allowVerticalDrag&&(this.sprite.y=n.y+this._dragPoint.y+this.dragOffset.y),this.boundsRect&&this.checkBoundsRect(),this.boundsSprite&&this.checkBoundsSprite(),this.snapOnDrag&&(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY)),!0)},justOver:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOver&&this.overDuration(n)<t},justOut:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isOut&&this.game.time.now-this._pointerData[n].timeOut<t},justPressed:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isDown&&this.downDuration(n)<t},justReleased:function(n,t){return n=n||0,t=t||500,this._pointerData[n].isUp&&this.game.time.now-this._pointerData[n].timeUp<t},overDuration:function(n){return(n=n||0,this._pointerData[n].isOver)?this.game.time.now-this._pointerData[n].timeOver:-1},downDuration:function(n){return(n=n||0,this._pointerData[n].isDown)?this.game.time.now-this._pointerData[n].timeDown:-1},enableDrag:function(t,i,r,u,f,e){typeof t=="undefined"&&(t=!1);typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=255);typeof f=="undefined"&&(f=null);typeof e=="undefined"&&(e=null);this._dragPoint=new n.Point;this.draggable=!0;this.bringToTop=i;this.dragOffset=new n.Point;this.dragFromCenter=t;this.pixelPerfectClick=r;this.pixelPerfectAlpha=u;f&&(this.boundsRect=f);e&&(this.boundsSprite=e)},disableDrag:function(){if(this._pointerData)for(var n=0;n<10;n++)this._pointerData[n].isDragged=!1;this.draggable=!1;this.isDragged=!1;this._draggedPointerID=-1},startDrag:function(n){if(this.isDragged=!0,this._draggedPointerID=n.id,this._pointerData[n.id].isDragged=!0,this.sprite.fixedToCamera)this.dragFromCenter?(this.sprite.centerOn(n.x,n.y),this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y)):this._dragPoint.setTo(this.sprite.cameraOffset.x-n.x,this.sprite.cameraOffset.y-n.y);else if(this.dragFromCenter){var t=this.sprite.getBounds();this.sprite.x=n.x+(this.sprite.x-t.centerX);this.sprite.y=n.y+(this.sprite.y-t.centerY);this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y)}else this._dragPoint.setTo(this.sprite.x-n.x,this.sprite.y-n.y);this.updateDrag(n);this.bringToTop&&(this._dragPhase=!0,this.sprite.bringToTop());this.sprite.events.onDragStart.dispatch(this.sprite,n)},stopDrag:function(n){this.isDragged=!1;this._draggedPointerID=-1;this._pointerData[n.id].isDragged=!1;this._dragPhase=!1;this.snapOnRelease&&(this.sprite.fixedToCamera?(this.sprite.cameraOffset.x=Math.round((this.sprite.cameraOffset.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.cameraOffset.y=Math.round((this.sprite.cameraOffset.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY):(this.sprite.x=Math.round((this.sprite.x-this.snapOffsetX%this.snapX)/this.snapX)*this.snapX+this.snapOffsetX%this.snapX,this.sprite.y=Math.round((this.sprite.y-this.snapOffsetY%this.snapY)/this.snapY)*this.snapY+this.snapOffsetY%this.snapY));this.sprite.events.onDragStop.dispatch(this.sprite,n);this.checkPointerOver(n)===!1&&this._pointerOutHandler(n)},setDragLock:function(n,t){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=!0);this.allowHorizontalDrag=n;this.allowVerticalDrag=t},enableSnap:function(n,t,i,r,u,f){typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=0);this.snapX=n;this.snapY=t;this.snapOffsetX=u;this.snapOffsetY=f;this.snapOnDrag=i;this.snapOnRelease=r},disableSnap:function(){this.snapOnDrag=!1;this.snapOnRelease=!1},checkBoundsRect:function(){this.sprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsRect.left?this.sprite.cameraOffset.x=this.boundsRect.left:this.sprite.cameraOffset.x+this.sprite.width>this.boundsRect.right&&(this.sprite.cameraOffset.x=this.boundsRect.right-this.sprite.width),this.sprite.cameraOffset.y<this.boundsRect.top?this.sprite.cameraOffset.y=this.boundsRect.top:this.sprite.cameraOffset.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.cameraOffset.y=this.boundsRect.bottom-this.sprite.height)):(this.sprite.x<this.boundsRect.left?this.sprite.x=this.boundsRect.x:this.sprite.x+this.sprite.width>this.boundsRect.right&&(this.sprite.x=this.boundsRect.right-this.sprite.width),this.sprite.y<this.boundsRect.top?this.sprite.y=this.boundsRect.top:this.sprite.y+this.sprite.height>this.boundsRect.bottom&&(this.sprite.y=this.boundsRect.bottom-this.sprite.height))},checkBoundsSprite:function(){this.sprite.fixedToCamera&&this.boundsSprite.fixedToCamera?(this.sprite.cameraOffset.x<this.boundsSprite.camerOffset.x?this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x:this.sprite.cameraOffset.x+this.sprite.width>this.boundsSprite.camerOffset.x+this.boundsSprite.width&&(this.sprite.cameraOffset.x=this.boundsSprite.camerOffset.x+this.boundsSprite.width-this.sprite.width),this.sprite.cameraOffset.y<this.boundsSprite.camerOffset.y?this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y:this.sprite.cameraOffset.y+this.sprite.height>this.boundsSprite.camerOffset.y+this.boundsSprite.height&&(this.sprite.cameraOffset.y=this.boundsSprite.camerOffset.y+this.boundsSprite.height-this.sprite.height)):(this.sprite.x<this.boundsSprite.x?this.sprite.x=this.boundsSprite.x:this.sprite.x+this.sprite.width>this.boundsSprite.x+this.boundsSprite.width&&(this.sprite.x=this.boundsSprite.x+this.boundsSprite.width-this.sprite.width),this.sprite.y<this.boundsSprite.y?this.sprite.y=this.boundsSprite.y:this.sprite.y+this.sprite.height>this.boundsSprite.y+this.boundsSprite.height&&(this.sprite.y=this.boundsSprite.y+this.boundsSprite.height-this.sprite.height))}};n.InputHandler.prototype.constructor=n.InputHandler;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Events=function(t){this.parent=t;this.onAddedToGroup=new n.Signal;this.onRemovedFromGroup=new n.Signal;this.onDestroy=new n.Signal;this.onKilled=new n.Signal;this.onRevived=new n.Signal;this.onOutOfBounds=new n.Signal;this.onEnterBounds=new n.Signal;this.onInputOver=null;this.onInputOut=null;this.onInputDown=null;this.onInputUp=null;this.onDragStart=null;this.onDragStop=null;this.onAnimationStart=null;this.onAnimationComplete=null;this.onAnimationLoop=null};n.Events.prototype={destroy:function(){this.parent=null;this.onDestroy.dispose();this.onAddedToGroup.dispose();this.onRemovedFromGroup.dispose();this.onKilled.dispose();this.onRevived.dispose();this.onOutOfBounds.dispose();this.onInputOver&&(this.onInputOver.dispose(),this.onInputOut.dispose(),this.onInputDown.dispose(),this.onInputUp.dispose(),this.onDragStart.dispose(),this.onDragStop.dispose());this.onAnimationStart&&(this.onAnimationStart.dispose(),this.onAnimationComplete.dispose(),this.onAnimationLoop.dispose())}};n.Events.prototype.constructor=n.Events;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectFactory=function(n){this.game=n;this.world=this.game.world};n.GameObjectFactory.prototype={existing:function(n){return this.world.add(n)},image:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),f.add(new n.Image(this.game,t,i,r,u))},sprite:function(n,t,i,r,u){return typeof u=="undefined"&&(u=this.world),u.create(n,t,i,r)},tween:function(n){return this.game.tweens.create(n)},group:function(t,i,r,u,f){return new n.Group(this.game,t,i,r,u,f)},physicsGroup:function(t,i,r,u){return new n.Group(this.game,i,r,u,!0,t)},spriteBatch:function(t,i,r){return typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i="group"),typeof r=="undefined"&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},tileSprite:function(t,i,r,u,f,e,o){return typeof o=="undefined"&&(o=this.world),o.add(new n.TileSprite(this.game,t,i,r,u,f,e))},rope:function(t,i,r,u,f,e){return typeof e=="undefined"&&(e=this.world),e.add(new n.Rope(this.game,t,i,r,u,f))},text:function(t,i,r,u,f){return typeof f=="undefined"&&(f=this.world),f.add(new n.Text(this.game,t,i,r,u))},button:function(t,i,r,u,f,e,o,s,h,c){return typeof c=="undefined"&&(c=this.world),c.add(new n.Button(this.game,t,i,r,u,f,e,o,s,h))},graphics:function(t,i,r){return typeof r=="undefined"&&(r=this.world),r.add(new n.Graphics(this.game,t,i))},emitter:function(t,i,r){return this.game.particles.add(new n.Particles.Arcade.Emitter(this.game,t,i,r))},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f,e){return typeof e=="undefined"&&(e=this.world),e.add(new n.BitmapText(this.game,t,i,r,u,f))},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());typeof u=="undefined"&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},bitmapData:function(t,i,r,u){typeof u=="undefined"&&(u=!1);(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t},plugin:function(n){return this.game.plugins.add(n)}};n.GameObjectFactory.prototype.constructor=n.GameObjectFactory;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.GameObjectCreator=function(n){this.game=n;this.world=this.game.world};n.GameObjectCreator.prototype={image:function(t,i,r,u){return new n.Image(this.game,t,i,r,u)},sprite:function(t,i,r,u){return new n.Sprite(this.game,t,i,r,u)},tween:function(t){return new n.Tween(t,this.game)},group:function(t,i,r,u,f){return new n.Group(this.game,null,i,r,u,f)},spriteBatch:function(t,i,r){return typeof i=="undefined"&&(i="group"),typeof r=="undefined"&&(r=!1),new n.SpriteBatch(this.game,t,i,r)},audio:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},sound:function(n,t,i,r){return this.game.sound.add(n,t,i,r)},tileSprite:function(t,i,r,u,f,e){return new n.TileSprite(this.game,t,i,r,u,f,e)},rope:function(t,i,r,u,f){return new n.Rope(this.game,t,i,r,u,f)},text:function(t,i,r,u){return new n.Text(this.game,t,i,r,u)},button:function(t,i,r,u,f,e,o,s,h){return new n.Button(this.game,t,i,r,u,f,e,o,s,h)},graphics:function(t,i){return new n.Graphics(this.game,t,i)},emitter:function(t,i,r){return new n.Particles.Arcade.Emitter(this.game,t,i,r)},retroFont:function(t,i,r,u,f,e,o,s,h){return new n.RetroFont(this.game,t,i,r,u,f,e,o,s,h)},bitmapText:function(t,i,r,u,f){return new n.BitmapText(this.game,t,i,r,u,f)},tilemap:function(t,i,r,u,f){return new n.Tilemap(this.game,t,i,r,u,f)},renderTexture:function(t,i,r,u){(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());typeof u=="undefined"&&(u=!1);var f=new n.RenderTexture(this.game,t,i,r);return u&&this.game.cache.addRenderTexture(r,f),f},bitmapData:function(t,i,r,u){typeof u=="undefined"&&(u=!1);(typeof r=="undefined"||r==="")&&(r=this.game.rnd.uuid());var f=new n.BitmapData(this.game,r,t,i);return u&&this.game.cache.addBitmapData(r,f),f},filter:function(t){var i=Array.prototype.splice.call(arguments,1),t=new n.Filter[t](this.game);return t.init.apply(t,i),t}};n.GameObjectCreator.prototype.constructor=n.GameObjectCreator;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapData=function(t,i,r,u){typeof r=="undefined"&&(r=256);typeof u=="undefined"&&(u=256);this.game=t;this.key=i;this.width=r;this.height=u;this.canvas=n.Canvas.create(r,u,"",!0);this.context=this.canvas.getContext("2d");this.ctx=this.context;this.imageData=this.context.getImageData(0,0,r,u);this.data=this.imageData.data;this.pixels=null;this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data;this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,r,u,"bitmapData",t.rnd.uuid());this.texture.frame=this.textureFrame;this.type=n.BITMAPDATA;this.disableTextureUpload=!1;this.dirty=!1;this.cls=this.clear;this._image=null;this._pos=new n.Point;this._size=new n.Point;this._scale=new n.Point;this._rotate=0;this._alpha={prev:1,current:1};this._anchor=new n.Point;this._tempR=0;this._tempG=0;this._tempB=0};n.BitmapData.prototype={add:function(n){if(Array.isArray(n))for(var t=0;t<n.length;t++)n[t].loadTexture&&n[t].loadTexture(this);else n.loadTexture(this);return this},load:function(n){if(typeof n=="string"&&(n=this.game.cache.getImage(n)),n)this.resize(n.width,n.height),this.cls();else return;return this.draw(n),this.update(),this},clear:function(){return this.context.clearRect(0,0,this.width,this.height),this.dirty=!0,this},fill:function(n,t,i,r){return typeof r=="undefined"&&(r=1),this.context.fillStyle="rgba("+n+","+t+","+i+","+r+")",this.context.fillRect(0,0,this.width,this.height),this.dirty=!0,this},resize:function(n,t){return(n!==this.width||t!==this.height)&&(this.width=n,this.height=t,this.canvas.width=n,this.canvas.height=t,this.baseTexture.width=n,this.baseTexture.height=t,this.textureFrame.width=n,this.textureFrame.height=t,this.texture.width=n,this.texture.height=t,this.texture.crop.width=n,this.texture.crop.height=t,this.update(),this.dirty=!0),this},update:function(n,t,i,r){return typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=this.width),typeof r=="undefined"&&(r=this.height),this.imageData=this.context.getImageData(n,t,i,r),this.data=this.imageData.data,this.imageData.data.buffer?(this.buffer=this.imageData.data.buffer,this.pixels=new Uint32Array(this.buffer)):window.ArrayBuffer?(this.buffer=new ArrayBuffer(this.imageData.data.length),this.pixels=new Uint32Array(this.buffer)):this.pixels=this.imageData.data,this},processPixelRGB:function(t,i,r,u,f,e){var s,h;typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=this.width);typeof e=="undefined"&&(e=this.height);var a=r+f,v=u+e,c=n.Color.createColor(),o={r:0,g:0,b:0,a:0},l=!1;for(s=u;s<v;s++)for(h=r;h<a;h++)n.Color.unpackPixel(this.getPixel32(h,s),c),o=t.call(i,c,h,s),o!==!1&&o!==null&&o!==undefined&&(this.setPixel32(h,s,o.r,o.g,o.b,o.a,!1),l=!0);return l&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},processPixel:function(n,t,i,r,u,f){var e,o;typeof i=="undefined"&&(i=0);typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=this.width);typeof f=="undefined"&&(f=this.height);var l=i+u,a=r+f,s=0,h=0,c=!1;for(e=r;e<a;e++)for(o=i;o<l;o++)s=this.getPixel32(o,e),h=n.call(t,s,o,e),h!==s&&(this.pixels[e*this.width+o]=h,c=!0);return c&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0),this},replaceRGB:function(t,i,r,u,f,e,o,s,h){var a=0,v=0,y=this.width,p=this.height,w=n.Color.packPixel(t,i,r,u),c,l;for(h!==undefined&&h instanceof n.Rectangle&&(a=h.x,v=h.y,y=h.width,p=h.height),c=0;c<p;c++)for(l=0;l<y;l++)this.getPixel32(a+l,v+c)===w&&this.setPixel32(a+l,v+c,f,e,o,s,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this},setHSL:function(t,i,r,u){var f,e,o;if((typeof t=="undefined"||t===null)&&(t=!1),(typeof i=="undefined"||i===null)&&(i=!1),(typeof r=="undefined"||r===null)&&(r=!1),t||i||r){for(typeof u=="undefined"&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),t&&(f.h=t),i&&(f.s=i),r&&(f.l=r),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},shiftHSL:function(t,i,r,u){var f,e,o;if((typeof t=="undefined"||t===null)&&(t=!1),(typeof i=="undefined"||i===null)&&(i=!1),(typeof r=="undefined"||r===null)&&(r=!1),t||i||r){for(typeof u=="undefined"&&(u=new n.Rectangle(0,0,this.width,this.height)),f=n.Color.createColor(),e=u.y;e<u.bottom;e++)for(o=u.x;o<u.right;o++)n.Color.unpackPixel(this.getPixel32(o,e),f,!0),t&&(f.h=this.game.math.wrap(f.h+t,0,1)),i&&(f.s=this.game.math.limitValue(f.s+i,0,1)),r&&(f.l=this.game.math.limitValue(f.l+r,0,1)),n.Color.HSLtoRGB(f.h,f.s,f.l,f),this.setPixel32(o,e,f.r,f.g,f.b,f.a,!1);return this.context.putImageData(this.imageData,0,0),this.dirty=!0,this}},setPixel32:function(t,i,r,u,f,e,o){return typeof o=="undefined"&&(o=!0),t>=0&&t<=this.width&&i>=0&&i<=this.height&&(this.pixels[i*this.width+t]=n.Device.LITTLE_ENDIAN?e<<24|f<<16|u<<8|r:r<<24|u<<16|f<<8|e,o&&(this.context.putImageData(this.imageData,0,0),this.dirty=!0)),this},setPixel:function(n,t,i,r,u,f){return this.setPixel32(n,t,i,r,u,255,f)},getPixel:function(t,i,r){r||(r=n.Color.createColor());var u=~~(t+i*this.width);return u*=4,r.r=this.data[u],r.g=this.data[++u],r.b=this.data[++u],r.a=this.data[++u],r},getPixel32:function(n,t){if(n>=0&&n<=this.width&&t>=0&&t<=this.height)return this.pixels[t*this.width+n]},getPixelRGB:function(t,i,r,u,f){return n.Color.unpackPixel(this.getPixel32(t,i),r,u,f)},getPixels:function(n){return this.context.getImageData(n.x,n.y,n.width,n.height)},addToWorld:function(n,t,i,r,u,f){u=u||1;f=f||1;var e=this.game.add.image(n,t,this);return e.anchor.set(i,r),e.scale.set(u,f),e},copy:function(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b){if((typeof t=="undefined"||t===null)&&(t=this),this._image=t,t instanceof n.Sprite||t instanceof n.Image||t instanceof n.Text)this._pos.set(t.texture.crop.x,t.texture.crop.y),this._size.set(t.texture.crop.width,t.texture.crop.height),this._scale.set(t.scale.x,t.scale.y),this._anchor.set(t.anchor.x,t.anchor.y),this._rotate=t.rotation,this._alpha.current=t.alpha,this._image=t.texture.baseTexture.source,t.texture.trim&&(e+=t.texture.trim.x-t.anchor.x*t.texture.trim.width,o+=t.texture.trim.y-t.anchor.y*t.texture.trim.height);else{if(this._pos.set(0),this._scale.set(1),this._anchor.set(0),this._rotate=0,this._alpha.current=1,t instanceof n.BitmapData)this._image=t.canvas;else if(typeof t=="string"){if(t=this.game.cache.getImage(t),t===null)return;this._image=t}this._size.set(this._image.width,this._image.height)}if((typeof i=="undefined"||i===null)&&(i=0),(typeof r=="undefined"||r===null)&&(r=0),u&&(this._size.x=u),f&&(this._size.y=f),(typeof e=="undefined"||e===null)&&(e=i),(typeof o=="undefined"||o===null)&&(o=r),(typeof s=="undefined"||s===null)&&(s=this._size.x),(typeof h=="undefined"||h===null)&&(h=this._size.y),typeof c=="number"&&(this._rotate=c),typeof l=="number"&&(this._anchor.x=l),typeof a=="number"&&(this._anchor.y=a),typeof v=="number"&&(this._scale.x=v),typeof y=="number"&&(this._scale.y=y),typeof p=="number"&&(this._alpha.current=p),typeof w=="undefined"&&(w=null),typeof b=="undefined"&&(b=!1),!(this._alpha.current<=0)&&this._scale.x!==0&&this._scale.y!==0&&this._size.x!==0&&this._size.y!==0)return this._alpha.prev=this.context.globalAlpha,this.context.save(),this.context.globalAlpha=this._alpha.current,w&&(this.context.globalCompositeOperation=w),b&&(e|=0,o|=0),this.context.translate(e,o),this.context.scale(this._scale.x,this._scale.y),this.context.rotate(this._rotate),this.context.drawImage(this._image,this._pos.x+i,this._pos.y+r,this._size.x,this._size.y,-s*this._anchor.x,-h*this._anchor.y,s,h),this.context.restore(),this.context.globalAlpha=this._alpha.prev,this.dirty=!0,this},copyRect:function(n,t,i,r,u,f,e){return this.copy(n,t.x,t.y,t.width,t.height,i,r,t.width,t.height,0,0,0,1,1,u,f,e)},draw:function(n,t,i,r,u,f,e){return this.copy(n,null,null,null,null,t,i,r,u,null,null,null,null,null,null,f,e)},alphaMask:function(n,t){return this.draw(t).blendSourceAtop().draw(n).blendReset()},extract:function(n,t,i,r,u,f,e,o,s){return typeof u=="undefined"&&(u=255),typeof f=="undefined"&&(f=!1),typeof e=="undefined"&&(e=t),typeof o=="undefined"&&(o=i),typeof s=="undefined"&&(s=r),f&&n.resize(this.width,this.height),this.processPixelRGB(function(f,h,c){return f.r===t&&f.g===i&&f.b===r&&n.setPixel32(h,c,e,o,s,u,!1),!1},this),n.context.putImageData(n.imageData,0,0),n.dirty=!0,n},rect:function(n,t,i,r,u){return typeof u!="undefined"&&(this.context.fillStyle=u),this.context.fillRect(n,t,i,r),this},circle:function(n,t,i,r){return typeof r!="undefined"&&(this.context.fillStyle=r),this.context.beginPath(),this.context.arc(n,t,i,0,Math.PI*2,!1),this.context.closePath(),this.context.fill(),this},render:function(){return!this.disableTextureUpload&&this.game.renderType===n.WEBGL&&this.dirty&&(PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1),this},blendReset:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceOver:function(){return this.context.globalCompositeOperation="source-over",this},blendSourceIn:function(){return this.context.globalCompositeOperation="source-in",this},blendSourceOut:function(){return this.context.globalCompositeOperation="source-out",this},blendSourceAtop:function(){return this.context.globalCompositeOperation="source-atop",this},blendDestinationOver:function(){return this.context.globalCompositeOperation="destination-over",this},blendDestinationIn:function(){return this.context.globalCompositeOperation="destination-in",this},blendDestinationOut:function(){return this.context.globalCompositeOperation="destination-out",this},blendDestinationAtop:function(){return this.context.globalCompositeOperation="destination-atop",this},blendXor:function(){return this.context.globalCompositeOperation="xor",this},blendAdd:function(){return this.context.globalCompositeOperation="lighter",this},blendMultiply:function(){return this.context.globalCompositeOperation="multiply",this},blendScreen:function(){return this.context.globalCompositeOperation="screen",this},blendOverlay:function(){return this.context.globalCompositeOperation="overlay",this},blendDarken:function(){return this.context.globalCompositeOperation="darken",this},blendLighten:function(){return this.context.globalCompositeOperation="lighten",this},blendColorDodge:function(){return this.context.globalCompositeOperation="color-dodge",this},blendColorBurn:function(){return this.context.globalCompositeOperation="color-burn",this},blendHardLight:function(){return this.context.globalCompositeOperation="hard-light",this},blendSoftLight:function(){return this.context.globalCompositeOperation="soft-light",this},blendDifference:function(){return this.context.globalCompositeOperation="difference",this},blendExclusion:function(){return this.context.globalCompositeOperation="exclusion",this},blendHue:function(){return this.context.globalCompositeOperation="hue",this},blendSaturation:function(){return this.context.globalCompositeOperation="saturation",this},blendColor:function(){return this.context.globalCompositeOperation="color",this},blendLuminosity:function(){return this.context.globalCompositeOperation="luminosity",this}};Object.defineProperty(n.BitmapData.prototype,"smoothed",{get:function(){n.Canvas.getSmoothingEnabled(this.context)},set:function(t){n.Canvas.setSmoothingEnabled(this.context,t)}});n.BitmapData.getTransform=function(n,t,i,r,u,f){return typeof n!="number"&&(n=0),typeof t!="number"&&(t=0),typeof i!="number"&&(i=1),typeof r!="number"&&(r=1),typeof u!="number"&&(u=0),typeof f!="number"&&(f=0),{sx:i,sy:r,scaleX:i,scaleY:r,skewX:u,skewY:f,translateX:n,translateY:t,tx:n,ty:t}};n.BitmapData.prototype.constructor=n.BitmapData;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sprite=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.game=t;this.name="";this.type=n.SPRITE;this.z=0;this.events=new n.Events(this);this.animations=new n.AnimationManager(this);this.key=u;PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.position.set(i,r);this.world=new n.Point(i,r);this.autoCull=!1;this.input=null;this.body=null;this.alive=!0;this.health=1;this.lifespan=0;this.checkWorldBounds=!1;this.outOfBoundsKill=!1;this.debug=!1;this.cameraOffset=new n.Point;this.cropRect=null;this._cache=[0,0,0,0,1,0,1,0];this._crop=null;this._frame=null;this._bounds=new n.Rectangle;this.loadTexture(u,f)};n.Sprite.prototype=Object.create(PIXI.Sprite.prototype);n.Sprite.prototype.constructor=n.Sprite;n.Sprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;if(this.lifespan>0&&(this.lifespan-=this.game.time.elapsed,this.lifespan<=0))return this.kill(),!1;if((this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds()),this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds)),this.checkWorldBounds)if(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds))this._cache[5]=0,this.events.onEnterBounds.dispatch(this);else if(this._cache[5]===0&&!this.game.world.bounds.intersects(this._bounds)&&(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this),this.outOfBoundsKill))return this.kill(),!1;this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);this.animations.update();this.body&&this.body.preUpdate();for(var n=0,t=this.children.length;n<t;n++)this.children[n].preUpdate();return!0};n.Sprite.prototype.update=function(){};n.Sprite.prototype.postUpdate=function(){this.key instanceof n.BitmapData&&this.key.render();this.exists&&this.body&&this.body.postUpdate();this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0,i=this.children.length;t<i;t++)this.children[t].postUpdate()};n.Sprite.prototype.loadTexture=function(t,i,r){i=i||0;(r||typeof r=="undefined")&&this.animations.stop();this.key=t;var u=!0,f=this.smoothed;t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof n.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):t===null||typeof t=="undefined"?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):typeof t!="string"||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),u=!this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]));u&&(this._frame=n.Rectangle.clone(this.texture.frame));f||(this.smoothed=!1)};n.Sprite.prototype.setFrame=function(t){this._frame=t;this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;t.trimmed&&(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH);this.cropRect?this.updateCrop():this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)};n.Sprite.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)};n.Sprite.prototype.crop=function(t,i){typeof i=="undefined"&&(i=!1);t?(i&&this.cropRect!==null?this.cropRect.setTo(t.x,t.y,t.width,t.height):this.cropRect=i&&this.cropRect===null?new n.Rectangle(t.x,t.y,t.width,t.height):t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())};n.Sprite.prototype.updateCrop=function(){if(this.cropRect){this._crop=n.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-t,u=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t;this.texture.crop.y=i;this.texture.crop.width=r;this.texture.crop.height=u;this.texture.frame.width=Math.min(r,this.cropRect.width);this.texture.frame.height=Math.min(u,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)}};n.Sprite.prototype.revive=function(n){return typeof n=="undefined"&&(n=1),this.alive=!0,this.exists=!0,this.visible=!0,this.health=n,this.events&&this.events.onRevived.dispatch(this),this};n.Sprite.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this};n.Sprite.prototype.destroy=function(t){if(this.game!==null&&this._cache[8]!==1){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.events&&this.events.onDestroy.dispatch(this);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.input&&this.input.destroy();this.animations&&this.animations.destroy();this.body&&this.body.destroy();this.events&&this.events.destroy();var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this._crop&&(this._crop=null);this._frame&&(this._frame=null);this.alive=!1;this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};n.Sprite.prototype.damage=function(n){return this.alive&&(this.health-=n,this.health<=0&&this.kill()),this};n.Sprite.prototype.reset=function(n,t,i){return typeof i=="undefined"&&(i=1),this.world.setTo(n,t),this.position.x=n,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=i,this.body&&this.body.reset(n,t,!1,!1),this._cache[4]=1,this};n.Sprite.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this};n.Sprite.prototype.play=function(n,t,i,r){if(this.animations)return this.animations.play(n,t,i,r)};n.Sprite.prototype.overlap=function(t){return n.Rectangle.intersects(this.getBounds(),t.getBounds())};Object.defineProperty(n.Sprite.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.Sprite.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(n.Sprite.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(n.Sprite.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(n.Sprite.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(n.Sprite.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(n.Sprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(n){this.animations.frame=n}});Object.defineProperty(n.Sprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(n){this.animations.frameName=n}});Object.defineProperty(n.Sprite.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(n.Sprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.Sprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===n.Physics.P2JS&&this.body.removeFromWorld(),this.visible=!1)}});Object.defineProperty(n.Sprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.Sprite.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(n){n?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}});Object.defineProperty(n.Sprite.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.Sprite.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.Sprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Image=function(t,i,r,u,f){i=i||0;r=r||0;u=u||null;f=f||null;this.game=t;this.exists=!0;this.name="";this.type=n.IMAGE;this.z=0;this.events=new n.Events(this);this.animations=new n.AnimationManager(this);this.key=u;PIXI.Sprite.call(this,PIXI.TextureCache.__default);this.position.set(i,r);this.world=new n.Point(i,r);this.alive=!0;this.autoCull=!1;this.input=null;this.debug=!1;this.cameraOffset=new n.Point;this.cropRect=null;this._cache=[0,0,0,0,1,0,1,0,0];this._crop=null;this._frame=null;this._bounds=new n.Rectangle;this.loadTexture(u,f)};n.Image.prototype=Object.create(PIXI.Sprite.prototype);n.Image.prototype.constructor=n.Image;n.Image.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;this.autoCull&&(this._bounds.copyFrom(this.getBounds()),this.renderable=this.game.world.camera.screenView.intersects(this._bounds));this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var n=0,t=this.children.length;n<t;n++)this.children[n].preUpdate();return!0};n.Image.prototype.update=function(){};n.Image.prototype.postUpdate=function(){this.key instanceof n.BitmapData&&this.key.render();this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var t=0,i=this.children.length;t<i;t++)this.children[t].postUpdate()};n.Image.prototype.loadTexture=function(t,i){i=i||0;this.key=t;var r=!0,u=this.smoothed;t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof n.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):t===null||typeof t=="undefined"?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):typeof t!="string"||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),r=!this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]));r&&(this._frame=n.Rectangle.clone(this.texture.frame));u||(this.smoothed=!1)};n.Image.prototype.setFrame=function(t){this._frame=t;this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;t.trimmed&&(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH);this.cropRect?this.updateCrop():this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)};n.Image.prototype.resetFrame=function(){this._frame&&this.setFrame(this._frame)};n.Image.prototype.crop=function(t,i){typeof i=="undefined"&&(i=!1);t?(i&&this.cropRect!==null?this.cropRect.setTo(t.x,t.y,t.width,t.height):this.cropRect=i&&this.cropRect===null?new n.Rectangle(t.x,t.y,t.width,t.height):t,this.updateCrop()):(this._crop=null,this.cropRect=null,this.resetFrame())};n.Image.prototype.updateCrop=function(){if(this.cropRect){this._crop=n.Rectangle.clone(this.cropRect,this._crop);this._crop.x+=this._frame.x;this._crop.y+=this._frame.y;var t=Math.max(this._frame.x,this._crop.x),i=Math.max(this._frame.y,this._crop.y),r=Math.min(this._frame.right,this._crop.right)-t,u=Math.min(this._frame.bottom,this._crop.bottom)-i;this.texture.crop.x=t;this.texture.crop.y=i;this.texture.crop.width=r;this.texture.crop.height=u;this.texture.frame.width=Math.min(r,this.cropRect.width);this.texture.frame.height=Math.min(u,this.cropRect.height);this.texture.width=this.texture.frame.width;this.texture.height=this.texture.frame.height;this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)}};n.Image.prototype.revive=function(){return this.alive=!0,this.exists=!0,this.visible=!0,this.events&&this.events.onRevived.dispatch(this),this};n.Image.prototype.kill=function(){return this.alive=!1,this.exists=!1,this.visible=!1,this.events&&this.events.onKilled.dispatch(this),this};n.Image.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.events&&this.events.onDestroy.dispatch(this);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.events&&this.events.destroy();this.input&&this.input.destroy();this.animations&&this.animations.destroy();var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this.alive=!1;this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};n.Image.prototype.reset=function(n,t){return this.world.setTo(n,t),this.position.x=n,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this};n.Image.prototype.bringToTop=function(){return this.parent&&this.parent.bringToTop(this),this};Object.defineProperty(n.Image.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.Image.prototype,"deltaX",{get:function(){return this.world.x-this._cache[0]}});Object.defineProperty(n.Image.prototype,"deltaY",{get:function(){return this.world.y-this._cache[1]}});Object.defineProperty(n.Image.prototype,"deltaZ",{get:function(){return this.rotation-this._cache[2]}});Object.defineProperty(n.Image.prototype,"inWorld",{get:function(){return this.game.world.bounds.intersects(this.getBounds())}});Object.defineProperty(n.Image.prototype,"inCamera",{get:function(){return this.game.world.camera.screenView.intersects(this.getBounds())}});Object.defineProperty(n.Image.prototype,"frame",{get:function(){return this._frame},set:function(n){if(n!==this.frame){var t=this.game.cache.getFrameData(this.key);t&&n<t.total&&t.getFrame(n)&&(this.setTexture(PIXI.TextureCache[t.getFrame(n).uuid]),this._frame=n)}}});Object.defineProperty(n.Image.prototype,"frameName",{get:function(){return this._frameName},set:function(n){if(n!==this.frameName){var t=this.game.cache.getFrameData(this.key);t&&t.getFrameByName(n)&&(this.setTexture(PIXI.TextureCache[t.getFrameByName(n).uuid]),this._frameName=n)}}});Object.defineProperty(n.Image.prototype,"renderOrderID",{get:function(){return this._cache[3]}});Object.defineProperty(n.Image.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.Image.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.Image.prototype,"smoothed",{get:function(){return!this.texture.baseTexture.scaleMode},set:function(n){n?this.texture&&(this.texture.baseTexture.scaleMode=0):this.texture&&(this.texture.baseTexture.scaleMode=1)}});Object.defineProperty(n.Image.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TileSprite=function(t,i,r,u,f,e,o){i=i||0;r=r||0;u=u||256;f=f||256;e=e||null;o=o||null;this.game=t;this.name="";this.type=n.TILESPRITE;this.z=0;this.events=new n.Events(this);this.animations=new n.AnimationManager(this);this.key=e;this._frame=0;this._frameName="";this._scroll=new n.Point;PIXI.TilingSprite.call(this,PIXI.TextureCache.__default,u,f);this.position.set(i,r);this.input=null;this.world=new n.Point(i,r);this.autoCull=!1;this.checkWorldBounds=!1;this.cameraOffset=new n.Point;this.body=null;this.alive=!0;this._cache=[0,0,0,0,1,0,1,0,0];this.loadTexture(e,o)};n.TileSprite.prototype=Object.create(PIXI.TilingSprite.prototype);n.TileSprite.prototype.constructor=n.TileSprite;n.TileSprite.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds());this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds));this.checkWorldBounds&&(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):this._cache[5]!==0||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this)));this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);this.animations.update();this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed);this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed);this.body&&this.body.preUpdate();for(var n=0,t=this.children.length;n<t;n++)this.children[n].preUpdate();return!0};n.TileSprite.prototype.update=function(){};n.TileSprite.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate();this._cache[7]===1&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var n=0,t=this.children.length;n<t;n++)this.children[n].postUpdate()};n.TileSprite.prototype.autoScroll=function(n,t){this._scroll.set(n,t)};n.TileSprite.prototype.stopScroll=function(){this._scroll.set(0,0)};n.TileSprite.prototype.loadTexture=function(t,i){i=i||0;this.key=t;t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof n.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):t===null||typeof t=="undefined"?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):typeof t!="string"||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]))};n.TileSprite.prototype.setFrame=function(t){this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;t.trimmed&&(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH);this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)};n.TileSprite.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.events&&this.events.onDestroy.dispatch(this);this.filters&&(this.filters=null);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.animations.destroy();this.events.destroy();var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this.exists=!1;this.visible=!1;this.alive=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};n.TileSprite.prototype.play=function(n,t,i,r){return this.animations.play(n,t,i,r)};n.TileSprite.prototype.reset=function(n,t){return this.world.setTo(n,t),this.position.x=n,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(n,t,!1,!1),this._cache[4]=1,this};Object.defineProperty(n.TileSprite.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.TileSprite.prototype,"frame",{get:function(){return this.animations.frame},set:function(n){n!==this.animations.frame&&(this.animations.frame=n)}});Object.defineProperty(n.TileSprite.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(n){n!==this.animations.frameName&&(this.animations.frameName=n)}});Object.defineProperty(n.TileSprite.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.TileSprite.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===n.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}});Object.defineProperty(n.TileSprite.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.TileSprite.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.TileSprite.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.TileSprite.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Rope=function(t,i,r,u,f,e){this.points=[];this.points=e;this._hasUpdateAnimation=!1;this._updateAnimationCallback=null;i=i||0;r=r||0;u=u||null;f=f||null;this.game=t;this.name="";this.type=n.ROPE;this.z=0;this.events=new n.Events(this);this.animations=new n.AnimationManager(this);this.key=u;this._frame=0;this._frameName="";this._scroll=new n.Point;PIXI.Rope.call(this,u,this.points);this.position.set(i,r);this.input=null;this.world=new n.Point(i,r);this.autoCull=!1;this.checkWorldBounds=!1;this.cameraOffset=new n.Point;this.body=null;this._cache=[0,0,0,0,1,0,1,0,0];this.loadTexture(u,f)};n.Rope.prototype=Object.create(PIXI.Rope.prototype);n.Rope.prototype.constructor=n.Rope;n.Rope.prototype.preUpdate=function(){if(this._cache[4]===1&&this.exists)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,this.body&&this.body.preUpdate(),this._cache[4]=0,!1;if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this._cache[3]=-1,!1;(this.autoCull||this.checkWorldBounds)&&this._bounds.copyFrom(this.getBounds());this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this._bounds));this.checkWorldBounds&&(this._cache[5]===1&&this.game.world.bounds.intersects(this._bounds)?(this._cache[5]=0,this.events.onEnterBounds.dispatch(this)):this._cache[5]!==0||this.game.world.bounds.intersects(this._bounds)||(this._cache[5]=1,this.events.onOutOfBounds.dispatch(this)));this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);this.animations.update();this._scroll.x!==0&&(this.tilePosition.x+=this._scroll.x*this.game.time.physicsElapsed);this._scroll.y!==0&&(this.tilePosition.y+=this._scroll.y*this.game.time.physicsElapsed);this.body&&this.body.preUpdate();for(var n=0,t=this.children.length;n<t;n++)this.children[n].preUpdate();return!0};n.Rope.prototype.update=function(){this._hasUpdateAnimation&&this.updateAnimation.call(this)};n.Rope.prototype.postUpdate=function(){this.exists&&this.body&&this.body.postUpdate();this._cache[7]===1&&(this.position.x=this.game.camera.view.x+this.cameraOffset.x,this.position.y=this.game.camera.view.y+this.cameraOffset.y);for(var n=0,t=this.children.length;n<t;n++)this.children[n].postUpdate()};n.Rope.prototype.loadTexture=function(t,i){i=i||0;this.key=t;t instanceof n.RenderTexture?(this.key=t.key,this.setTexture(t)):t instanceof n.BitmapData?this.setTexture(t.texture):t instanceof PIXI.Texture?this.setTexture(t):t===null||typeof t=="undefined"?(this.key="__default",this.setTexture(PIXI.TextureCache[this.key])):typeof t!="string"||this.game.cache.checkImageKey(t)?(this.setTexture(new PIXI.Texture(PIXI.BaseTextureCache[t])),this.animations.loadFrameData(this.game.cache.getFrameData(t),i)):(console.warn("Texture with key '"+t+"' not found."),this.key="__missing",this.setTexture(PIXI.TextureCache[this.key]))};n.Rope.prototype.setFrame=function(t){this.texture.frame.x=t.x;this.texture.frame.y=t.y;this.texture.frame.width=t.width;this.texture.frame.height=t.height;this.texture.crop.x=t.x;this.texture.crop.y=t.y;this.texture.crop.width=t.width;this.texture.crop.height=t.height;t.trimmed&&(this.texture.trim?(this.texture.trim.x=t.spriteSourceSizeX,this.texture.trim.y=t.spriteSourceSizeY,this.texture.trim.width=t.sourceSizeW,this.texture.trim.height=t.sourceSizeH):this.texture.trim={x:t.spriteSourceSizeX,y:t.spriteSourceSizeY,width:t.sourceSizeW,height:t.sourceSizeH},this.texture.width=t.sourceSizeW,this.texture.height=t.sourceSizeH,this.texture.frame.width=t.sourceSizeW,this.texture.frame.height=t.sourceSizeH);this.game.renderType===n.WEBGL&&PIXI.WebGLRenderer.updateTextureFrame(this.texture)};n.Rope.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.events&&this.events.onDestroy.dispatch(this);this.filters&&(this.filters=null);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.animations.destroy();this.events.destroy();var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};n.Rope.prototype.play=function(n,t,i,r){return this.animations.play(n,t,i,r)};n.Rope.prototype.reset=function(n,t){return this.world.setTo(n,t),this.position.x=n,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.tilePosition.x=0,this.tilePosition.y=0,this.body&&this.body.reset(n,t,!1,!1),this._cache[4]=1,this};Object.defineProperty(n.Rope.prototype,"angle",{get:function(){return n.Math.wrapAngle(n.Math.radToDeg(this.rotation))},set:function(t){this.rotation=n.Math.degToRad(n.Math.wrapAngle(t))}});Object.defineProperty(n.Rope.prototype,"frame",{get:function(){return this.animations.frame},set:function(n){n!==this.animations.frame&&(this.animations.frame=n)}});Object.defineProperty(n.Rope.prototype,"frameName",{get:function(){return this.animations.frameName},set:function(n){n!==this.animations.frameName&&(this.animations.frameName=n)}});Object.defineProperty(n.Rope.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.Rope.prototype,"exists",{get:function(){return!!this._cache[6]},set:function(t){t?(this._cache[6]=1,this.body&&this.body.type===n.Physics.P2JS&&this.body.addToWorld(),this.visible=!0):(this._cache[6]=0,this.body&&this.body.type===n.Physics.P2JS&&(this.body.safeRemove=!0),this.visible=!1)}});Object.defineProperty(n.Rope.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.Rope.prototype,"x",{get:function(){return this.position.x},set:function(t){this.position.x=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.Rope.prototype,"y",{get:function(){return this.position.y},set:function(t){this.position.y=t;this.body&&this.body.type===n.Physics.ARCADE&&this.body.phase===2&&(this.body._reset=1)}});Object.defineProperty(n.Rope.prototype,"updateAnimation",{get:function(){return this._updateAnimation},set:function(n){n&&typeof n=="function"?(this._hasUpdateAnimation=!0,this._updateAnimation=n):(this._hasUpdateAnimation=!1,this._updateAnimation=null)}});Object.defineProperty(n.Rope.prototype,"segments",{get:function(){for(var f=[],t,i,r,e,o,s,h,c,u=0;u<this.points.length;u++)t=u*4,i=this.verticies[t],r=this.verticies[t+1],e=this.verticies[t+4],o=this.verticies[t+3],s=n.Math.difference(i,e),h=n.Math.difference(r,o),i+=this.world.x,r+=this.world.y,c=new n.Rectangle(i,r,s,h),f.push(c);return f}});Object.defineProperty(n.Rope.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Text=function(t,i,r,u,f){i=i||0;r=r||0;u=u||" ";f=f||{};u=u.length===0?" ":u.toString();this.game=t;this.exists=!0;this.name="";this.type=n.TEXT;this.z=0;this.world=new n.Point(i,r);this._text=u;this._font="";this._fontSize=32;this._fontWeight="normal";this._lineSpacing=0;this.events=new n.Events(this);this.input=null;this.cameraOffset=new n.Point;this.setStyle(f);PIXI.Text.call(this,u,this.style);this.position.set(i,r);this._cache=[0,0,0,0,1,0,1,0,0];u!==" "&&this.updateText()};n.Text.prototype=Object.create(PIXI.Text.prototype);n.Text.prototype.constructor=n.Text;n.Text.prototype.preUpdate=function(){if(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)return this.renderOrderID=-1,!1;this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds()));this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty);this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++);for(var n=0,t=this.children.length;n<t;n++)this.children[n].preUpdate();return!0};n.Text.prototype.update=function(){};n.Text.prototype.postUpdate=function(){this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y);for(var n=0,t=this.children.length;n<t;n++)this.children[n].postUpdate()};n.Text.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.events&&this.events.onDestroy.dispatch(this);this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));this.texture.destroy(!0);this.canvas.parentNode?this.canvas.parentNode.removeChild(this.canvas):(this.canvas=null,this.context=null);var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};n.Text.prototype.setShadow=function(n,t,i,r){this.style.shadowOffsetX=n||0;this.style.shadowOffsetY=t||0;this.style.shadowColor=i||"rgba(0,0,0,0)";this.style.shadowBlur=r||0;this.dirty=!0};n.Text.prototype.setStyle=function(n){n=n||{};n.font=n.font||"bold 20pt Arial";n.fill=n.fill||"black";n.align=n.align||"left";n.stroke=n.stroke||"black";n.strokeThickness=n.strokeThickness||0;n.wordWrap=n.wordWrap||!1;n.wordWrapWidth=n.wordWrapWidth||100;n.shadowOffsetX=n.shadowOffsetX||0;n.shadowOffsetY=n.shadowOffsetY||0;n.shadowColor=n.shadowColor||"rgba(0,0,0,0)";n.shadowBlur=n.shadowBlur||0;this.style=n;this.dirty=!0};n.Text.prototype.updateText=function(){var u,n,e,o,t;this.context.font=this.style.font;u=this.text;this.style.wordWrap&&(u=this.runWordWrap(this.text));var i=u.split(/(?:\r\n|\r|\n)/),f=[],r=0;for(n=0;n<i.length;n++)e=this.context.measureText(i[n]).width,f[n]=e,r=Math.max(r,e);for(this.canvas.width=r+this.style.strokeThickness,o=this.determineFontHeight("font: "+this.style.font+";")+this.style.strokeThickness+this._lineSpacing+this.style.shadowOffsetY,this.canvas.height=o*i.length,navigator.isCocoonJS&&this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.style.fill,this.context.font=this.style.font,this.context.strokeStyle=this.style.stroke,this.context.lineWidth=this.style.strokeThickness,this.context.shadowOffsetX=this.style.shadowOffsetX,this.context.shadowOffsetY=this.style.shadowOffsetY,this.context.shadowColor=this.style.shadowColor,this.context.shadowBlur=this.style.shadowBlur,this.context.textBaseline="top",this.context.lineCap="round",this.context.lineJoin="round",n=0;n<i.length;n++)t=new PIXI.Point(this.style.strokeThickness/2,this.style.strokeThickness/2+n*o),this.style.align==="right"?t.x+=r-f[n]:this.style.align==="center"&&(t.x+=(r-f[n])/2),t.y+=this._lineSpacing,this.style.stroke&&this.style.strokeThickness&&this.context.strokeText(i[n],t.x,t.y),this.style.fill&&this.context.fillText(i[n],t.x,t.y);this.updateTexture()};n.Text.prototype.runWordWrap=function(n){for(var f,r,t,o,s,i="",e=n.split("\n"),u=0;u<e.length;u++){for(f=this.style.wordWrapWidth,r=e[u].split(" "),t=0;t<r.length;t++)o=this.context.measureText(r[t]).width,s=o+this.context.measureText(" ").width,s>f?(t>0&&(i+="\n"),i+=r[t]+" ",f=this.style.wordWrapWidth-o):(f-=s,i+=r[t]+" ");u<e.length-1&&(i+="\n")}return i};Object.defineProperty(n.Text.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});Object.defineProperty(n.Text.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||" ",this.dirty=!0,this.updateTransform())}});Object.defineProperty(n.Text.prototype,"font",{get:function(){return this._font},set:function(n){n!==this._font&&(this._font=n.trim(),this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}});Object.defineProperty(n.Text.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){n=parseInt(n,10);n!==this._fontSize&&(this._fontSize=n,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}});Object.defineProperty(n.Text.prototype,"fontWeight",{get:function(){return this._fontWeight},set:function(n){n!==this._fontWeight&&(this._fontWeight=n,this.style.font=this._fontWeight+" "+this._fontSize+"px '"+this._font+"'",this.dirty=!0,this.updateTransform())}});Object.defineProperty(n.Text.prototype,"fill",{get:function(){return this.style.fill},set:function(n){n!==this.style.fill&&(this.style.fill=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"align",{get:function(){return this.style.align},set:function(n){n!==this.style.align&&(this.style.align=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"stroke",{get:function(){return this.style.stroke},set:function(n){n!==this.style.stroke&&(this.style.stroke=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"strokeThickness",{get:function(){return this.style.strokeThickness},set:function(n){n!==this.style.strokeThickness&&(this.style.strokeThickness=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrap",{get:function(){return this.style.wordWrap},set:function(n){n!==this.style.wordWrap&&(this.style.wordWrap=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"wordWrapWidth",{get:function(){return this.style.wordWrapWidth},set:function(n){n!==this.style.wordWrapWidth&&(this.style.wordWrapWidth=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"lineSpacing",{get:function(){return this._lineSpacing},set:function(n){n!==this._lineSpacing&&(this._lineSpacing=parseFloat(n),this.dirty=!0,this.updateTransform())}});Object.defineProperty(n.Text.prototype,"shadowOffsetX",{get:function(){return this.style.shadowOffsetX},set:function(n){n!==this.style.shadowOffsetX&&(this.style.shadowOffsetX=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowOffsetY",{get:function(){return this.style.shadowOffsetY},set:function(n){n!==this.style.shadowOffsetY&&(this.style.shadowOffsetY=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowColor",{get:function(){return this.style.shadowColor},set:function(n){n!==this.style.shadowColor&&(this.style.shadowColor=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"shadowBlur",{get:function(){return this.style.shadowBlur},set:function(n){n!==this.style.shadowBlur&&(this.style.shadowBlur=n,this.dirty=!0)}});Object.defineProperty(n.Text.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.Text.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.Text.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.BitmapText=function(t,i,r,u,f,e){i=i||0;r=r||0;u=u||"";f=f||"";e=e||32;this.game=t;this.exists=!0;this.name="";this.type=n.BITMAPTEXT;this.z=0;this.world=new n.Point(i,r);this._text=f;this._font=u;this._fontSize=e;this._align="left";this._tint=16777215;this.events=new n.Events(this);this.input=null;this.cameraOffset=new n.Point;PIXI.BitmapText.call(this,f);this.position.set(i,r);this._cache=[0,0,0,0,1,0,1,0,0]};n.BitmapText.prototype=Object.create(PIXI.BitmapText.prototype);n.BitmapText.prototype.constructor=n.BitmapText;n.BitmapText.prototype.setStyle=function(){this.style={align:this._align};this.fontName=this._font;this.fontSize=this._fontSize;this.dirty=!0};n.BitmapText.prototype.preUpdate=function(){return(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)?(this.renderOrderID=-1,!1):(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0)};n.BitmapText.prototype.update=function(){};n.BitmapText.prototype.postUpdate=function(){this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};n.BitmapText.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));var i=this.children.length;if(t)while(i--)this.children[i].destroy?this.children[i].destroy(t):this.removeChild(this.children[i]);else while(i--)this.removeChild(this.children[i]);this.exists=!1;this.visible=!1;this.filters=null;this.mask=null;this.game=null;this._cache[8]=0}};Object.defineProperty(n.BitmapText.prototype,"align",{get:function(){return this._align},set:function(n){n!==this._align&&(this._align=n,this.setStyle())}});Object.defineProperty(n.BitmapText.prototype,"tint",{get:function(){return this._tint},set:function(n){n!==this._tint&&(this._tint=n,this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});Object.defineProperty(n.BitmapText.prototype,"font",{get:function(){return this._font},set:function(n){n!==this._font&&(this._font=n.trim(),this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"fontSize",{get:function(){return this._fontSize},set:function(n){n=parseInt(n,10);n!==this._fontSize&&(this._fontSize=n,this.style.font=this._fontSize+"px '"+this._font+"'",this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"text",{get:function(){return this._text},set:function(n){n!==this._text&&(this._text=n.toString()||" ",this.dirty=!0)}});Object.defineProperty(n.BitmapText.prototype,"inputEnabled",{get:function(){return this.input&&this.input.enabled},set:function(t){t?this.input===null?(this.input=new n.InputHandler(this),this.input.start()):this.input&&!this.input.enabled&&this.input.start():this.input&&this.input.enabled&&this.input.stop()}});Object.defineProperty(n.BitmapText.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.BitmapText.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Button=function(t,i,r,u,f,e,o,s,h,c){i=i||0;r=r||0;u=u||null;f=f||null;e=e||this;n.Image.call(this,t,i,r,u,s);this.type=n.BUTTON;this._onOverFrameName=null;this._onOutFrameName=null;this._onDownFrameName=null;this._onUpFrameName=null;this._onOverFrameID=null;this._onOutFrameID=null;this._onDownFrameID=null;this._onUpFrameID=null;this.onOverMouseOnly=!1;this.onOverSound=null;this.onOutSound=null;this.onDownSound=null;this.onUpSound=null;this.onOverSoundMarker="";this.onOutSoundMarker="";this.onDownSoundMarker="";this.onUpSoundMarker="";this.onInputOver=new n.Signal;this.onInputOut=new n.Signal;this.onInputDown=new n.Signal;this.onInputUp=new n.Signal;this.freezeFrames=!1;this.forceOut=!1;this.inputEnabled=!0;this.input.start(0,!0);this.setFrames(o,s,h,c);f!==null&&this.onInputUp.add(f,e);this.events.onInputOver.add(this.onInputOverHandler,this);this.events.onInputOut.add(this.onInputOutHandler,this);this.events.onInputDown.add(this.onInputDownHandler,this);this.events.onInputUp.add(this.onInputUpHandler,this)};n.Button.prototype=Object.create(n.Image.prototype);n.Button.prototype.constructor=n.Button;n.Button.prototype.clearFrames=function(){this._onOverFrameName=null;this._onOverFrameID=null;this._onOutFrameName=null;this._onOutFrameID=null;this._onDownFrameName=null;this._onDownFrameID=null;this._onUpFrameName=null;this._onUpFrameID=null};n.Button.prototype.setFrames=function(n,t,i,r){this.clearFrames();n!==null&&(typeof n=="string"?(this._onOverFrameName=n,this.input.pointerOver()&&(this.frameName=n)):(this._onOverFrameID=n,this.input.pointerOver()&&(this.frame=n)));t!==null&&(typeof t=="string"?(this._onOutFrameName=t,this.input.pointerOver()===!1&&(this.frameName=t)):(this._onOutFrameID=t,this.input.pointerOver()===!1&&(this.frame=t)));i!==null&&(typeof i=="string"?(this._onDownFrameName=i,this.input.pointerDown()&&(this.frameName=i)):(this._onDownFrameID=i,this.input.pointerDown()&&(this.frame=i)));r!==null&&(typeof r=="string"?(this._onUpFrameName=r,this.input.pointerUp()&&(this.frameName=r)):(this._onUpFrameID=r,this.input.pointerUp()&&(this.frame=r)))};n.Button.prototype.setSounds=function(n,t,i,r,u,f,e,o){this.setOverSound(n,t);this.setOutSound(u,f);this.setDownSound(i,r);this.setUpSound(e,o)};n.Button.prototype.setOverSound=function(t,i){this.onOverSound=null;this.onOverSoundMarker="";t instanceof n.Sound&&(this.onOverSound=t);typeof i=="string"&&(this.onOverSoundMarker=i)};n.Button.prototype.setOutSound=function(t,i){this.onOutSound=null;this.onOutSoundMarker="";t instanceof n.Sound&&(this.onOutSound=t);typeof i=="string"&&(this.onOutSoundMarker=i)};n.Button.prototype.setDownSound=function(t,i){this.onDownSound=null;this.onDownSoundMarker="";t instanceof n.Sound&&(this.onDownSound=t);typeof i=="string"&&(this.onDownSoundMarker=i)};n.Button.prototype.setUpSound=function(t,i){this.onUpSound=null;this.onUpSoundMarker="";t instanceof n.Sound&&(this.onUpSound=t);typeof i=="string"&&(this.onUpSoundMarker=i)};n.Button.prototype.onInputOverHandler=function(n,t){(this.freezeFrames===!1&&this.setState(1),!this.onOverMouseOnly||t.isMouse)&&(this.onOverSound&&this.onOverSound.play(this.onOverSoundMarker),this.onInputOver&&this.onInputOver.dispatch(this,t))};n.Button.prototype.onInputOutHandler=function(n,t){this.freezeFrames===!1&&this.setState(2);this.onOutSound&&this.onOutSound.play(this.onOutSoundMarker);this.onInputOut&&this.onInputOut.dispatch(this,t)};n.Button.prototype.onInputDownHandler=function(n,t){this.freezeFrames===!1&&this.setState(3);this.onDownSound&&this.onDownSound.play(this.onDownSoundMarker);this.onInputDown&&this.onInputDown.dispatch(this,t)};n.Button.prototype.onInputUpHandler=function(n,t,i){(this.onUpSound&&this.onUpSound.play(this.onUpSoundMarker),this.onInputUp&&this.onInputUp.dispatch(this,t,i),this.freezeFrames)||(this.forceOut?this.setState(2):this._onUpFrameName!==null||this._onUpFrameID!==null?this.setState(4):i?this.setState(1):this.setState(2))};n.Button.prototype.setState=function(n){n===1?this._onOverFrameName!=null?this.frameName=this._onOverFrameName:this._onOverFrameID!=null&&(this.frame=this._onOverFrameID):n===2?this._onOutFrameName!=null?this.frameName=this._onOutFrameName:this._onOutFrameID!=null&&(this.frame=this._onOutFrameID):n===3?this._onDownFrameName!=null?this.frameName=this._onDownFrameName:this._onDownFrameID!=null&&(this.frame=this._onDownFrameID):n===4&&(this._onUpFrameName!=null?this.frameName=this._onUpFrameName:this._onUpFrameID!=null&&(this.frame=this._onUpFrameID))};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Graphics=function(t,i,r){i=i||0;r=r||0;this.game=t;this.exists=!0;this.name="";this.type=n.GRAPHICS;this.z=0;this.world=new n.Point(i,r);this.cameraOffset=new n.Point;PIXI.Graphics.call(this);this.position.set(i,r);this._cache=[0,0,0,0,1,0,1,0,0]};n.Graphics.prototype=Object.create(PIXI.Graphics.prototype);n.Graphics.prototype.constructor=n.Graphics;n.Graphics.prototype.preUpdate=function(){return(this._cache[0]=this.world.x,this._cache[1]=this.world.y,this._cache[2]=this.rotation,!this.exists||!this.parent.exists)?(this.renderOrderID=-1,!1):(this.autoCull&&(this.renderable=this.game.world.camera.screenView.intersects(this.getBounds())),this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.visible&&(this._cache[3]=this.game.stage.currentRenderOrderID++),!0)};n.Graphics.prototype.update=function(){};n.Graphics.prototype.postUpdate=function(){this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};n.Graphics.prototype.destroy=function(t){if(this.game!==null&&!this.destroyPhase){typeof t=="undefined"&&(t=!0);this._cache[8]=1;this.clear();this.parent&&(this.parent instanceof n.Group?this.parent.remove(this):this.parent.removeChild(this));var i=this.children.length;if(t)while(i--)this.children[i].destroy(t);else while(i--)this.removeChild(this.children[i]);this.exists=!1;this.visible=!1;this.game=null;this._cache[8]=0}};n.Graphics.prototype.drawPolygon=function(n){this.moveTo(n.points[0].x,n.points[0].y);for(var t=1;t<n.points.length;t+=1)this.lineTo(n.points[t].x,n.points[t].y);this.lineTo(n.points[0].x,n.points[0].y)};n.Graphics.prototype.drawTriangle=function(t,i){var r;if(typeof i=="undefined"&&(i=!1),r=new n.Polygon(t),i){var u=new n.Point(this.game.camera.x-t[0].x,this.game.camera.y-t[0].y),f=new n.Point(t[1].x-t[0].x,t[1].y-t[0].y),e=new n.Point(t[1].x-t[2].x,t[1].y-t[2].y),o=e.cross(f);u.dot(o)>0&&this.drawPolygon(r)}else this.drawPolygon(r)};n.Graphics.prototype.drawTriangles=function(t,i,r){typeof r=="undefined"&&(r=!1);var e=new n.Point,o=new n.Point,s=new n.Point,f=[],u;if(i)if(t[0]instanceof n.Point)for(u=0;u<i.length/3;u++)f.push(t[i[u*3]]),f.push(t[i[u*3+1]]),f.push(t[i[u*3+2]]),f.length===3&&(this.drawTriangle(f,r),f=[]);else for(u=0;u<i.length;u++)e.x=t[i[u]*2],e.y=t[i[u]*2+1],f.push(e.copyTo({})),f.length===3&&(this.drawTriangle(f,r),f=[]);else if(t[0]instanceof n.Point)for(u=0;u<t.length/3;u++)this.drawTriangle([t[u*3],t[u*3+1],t[u*3+2]],r);else for(u=0;u<t.length/6;u++)e.x=t[u*6+0],e.y=t[u*6+1],o.x=t[u*6+2],o.y=t[u*6+3],s.x=t[u*6+4],s.y=t[u*6+5],this.drawTriangle([e,o,s],r)};Object.defineProperty(n.Graphics.prototype,"angle",{get:function(){return n.Math.radToDeg(this.rotation)},set:function(t){this.rotation=n.Math.degToRad(t)}});Object.defineProperty(n.Graphics.prototype,"fixedToCamera",{get:function(){return!!this._cache[7]},set:function(n){n?(this._cache[7]=1,this.cameraOffset.set(this.x,this.y)):this._cache[7]=0}});Object.defineProperty(n.Graphics.prototype,"destroyPhase",{get:function(){return!!this._cache[8]}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RenderTexture=function(t,i,r,u,f){typeof u=="undefined"&&(u="");typeof f=="undefined"&&(f=n.scaleModes.DEFAULT);this.game=t;this.key=u;this.type=n.RENDERTEXTURE;this._temp=new n.Point;PIXI.RenderTexture.call(this,i,r,this.game.renderer,f)};n.RenderTexture.prototype=Object.create(PIXI.RenderTexture.prototype);n.RenderTexture.prototype.constructor=n.RenderTexture;n.RenderTexture.prototype.renderXY=function(n,t,i,r){this._temp.set(t,i);this.render(n,this._temp,r)};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SpriteBatch=function(t,i,r,u){(typeof i=="undefined"||i===null)&&(i=t.world);PIXI.SpriteBatch.call(this);n.Group.call(this,t,i,r,u);this.type=n.SPRITEBATCH};n.SpriteBatch.prototype=n.Utils.extend(!0,n.SpriteBatch.prototype,n.Group.prototype,PIXI.SpriteBatch.prototype);n.SpriteBatch.prototype.constructor=n.SpriteBatch;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RetroFont=function(t,i,r,u,f,e,o,s,h,c){var l,p,w;if(!t.cache.checkImageKey(i))return!1;(typeof e=="undefined"||e===null)&&(e=t.cache.getImage(i).width/r);this.characterWidth=r;this.characterHeight=u;this.characterSpacingX=o||0;this.characterSpacingY=s||0;this.characterPerRow=e;this.offsetX=h||0;this.offsetY=c||0;this.align="left";this.multiLine=!1;this.autoUpperCase=!0;this.customSpacingX=0;this.customSpacingY=0;this.fixedWidth=0;this.fontSet=t.cache.getImage(i);this._text="";this.grabData=[];this.frameData=new n.FrameData;var a=this.offsetX,v=this.offsetY,y=0;for(l=0;l<f.length;l++)p=t.rnd.uuid(),w=this.frameData.addFrame(new n.Frame(l,a,v,this.characterWidth,this.characterHeight,"",p)),this.grabData[f.charCodeAt(l)]=w.index,PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:a,y:v,width:this.characterWidth,height:this.characterHeight}),y++,y==this.characterPerRow?(y=0,a=this.offsetX,v+=this.characterHeight+this.characterSpacingY):a+=this.characterWidth+this.characterSpacingX;t.cache.updateFrameData(i,this.frameData);this.stamp=new n.Image(t,0,0,i,0);n.RenderTexture.call(this,t,100,100,"",n.scaleModes.NEAREST);this.type=n.RETROFONT};n.RetroFont.prototype=Object.create(n.RenderTexture.prototype);n.RetroFont.prototype.constructor=n.RetroFont;n.RetroFont.ALIGN_LEFT="left";n.RetroFont.ALIGN_RIGHT="right";n.RetroFont.ALIGN_CENTER="center";n.RetroFont.TEXT_SET1=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~";n.RetroFont.TEXT_SET2=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET3="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 ";n.RetroFont.TEXT_SET4="ABCDEFGHIJKLMNOPQRSTUVWXYZ 0123456789";n.RetroFont.TEXT_SET5="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,/() '!?-*:0123456789";n.RetroFont.TEXT_SET6="ABCDEFGHIJKLMNOPQRSTUVWXYZ!?:;0123456789\"(),-.' ";n.RetroFont.TEXT_SET7="AGMSY+:4BHNTZ!;5CIOU.?06DJPV,(17EKQW\")28FLRX-'39";n.RetroFont.TEXT_SET8="0123456789 .ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET9="ABCDEFGHIJKLMNOPQRSTUVWXYZ()-0123456789.:,'\"?!";n.RetroFont.TEXT_SET10="ABCDEFGHIJKLMNOPQRSTUVWXYZ";n.RetroFont.TEXT_SET11="ABCDEFGHIJKLMNOPQRSTUVWXYZ.,\"-+!?()':;0123456789";n.RetroFont.prototype.setFixedWidth=function(n,t){typeof t=="undefined"&&(t="left");this.fixedWidth=n;this.align=t};n.RetroFont.prototype.setText=function(n,t,i,r,u,f){this.multiLine=t||!1;this.customSpacingX=i||0;this.customSpacingY=r||0;this.align=u||"left";this.autoUpperCase=f?!1:!0;n.length>0&&(this.text=n)};n.RetroFont.prototype.buildRetroFontText=function(){var t=0,u=0,i,r;if(this.clear(),this.multiLine)for(i=this._text.split("\n"),this.fixedWidth>0?this.resize(this.fixedWidth,i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0):this.resize(this.getLongestLine()*(this.characterWidth+this.customSpacingX),i.length*(this.characterHeight+this.customSpacingY)-this.customSpacingY,!0),r=0;r<i.length;r++){switch(this.align){case n.RetroFont.ALIGN_LEFT:t=0;break;case n.RetroFont.ALIGN_RIGHT:t=this.width-i[r].length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:t=this.width/2-i[r].length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2}t<0&&(t=0);this.pasteLine(i[r],t,u,this.customSpacingX);u+=this.characterHeight+this.customSpacingY}else{this.fixedWidth>0?this.resize(this.fixedWidth,this.characterHeight,!0):this.resize(this._text.length*(this.characterWidth+this.customSpacingX),this.characterHeight,!0);switch(this.align){case n.RetroFont.ALIGN_LEFT:t=0;break;case n.RetroFont.ALIGN_RIGHT:t=this.width-this._text.length*(this.characterWidth+this.customSpacingX);break;case n.RetroFont.ALIGN_CENTER:t=this.width/2-this._text.length*(this.characterWidth+this.customSpacingX)/2+this.customSpacingX/2}this.textureBuffer.clear();this.pasteLine(this._text,t,0,this.customSpacingX)}};n.RetroFont.prototype.pasteLine=function(t,i,r,u){for(var e=new n.Point,f=0;f<t.length;f++)if(t.charAt(f)==" ")i+=this.characterWidth+u;else if(this.grabData[t.charCodeAt(f)]>=0&&(this.stamp.frame=this.grabData[t.charCodeAt(f)],e.set(i,r),this.render(this.stamp,e,!1),i+=this.characterWidth+u,i>this.width))break};n.RetroFont.prototype.getLongestLine=function(){var i=0,t,n;if(this._text.length>0)for(t=this._text.split("\n"),n=0;n<t.length;n++)t[n].length>i&&(i=t[n].length);return i};n.RetroFont.prototype.removeUnsupportedCharacters=function(n){for(var t,u,i="",r=0;r<this._text.length;r++)t=this._text[r],u=t.charCodeAt(0),(this.grabData[u]>=0||!n&&t==="\n")&&(i=i.concat(t));return i};n.RetroFont.prototype.updateOffset=function(n,t){if(this.offsetX!==n||this.offsetY!==t){for(var u=n-this.offsetX,f=t-this.offsetY,i=this.game.cache.getFrameData(this.stamp.key).getFrames(),r=i.length;r--;)i[r].x+=u,i[r].y+=f,PIXI.TextureCache[i[r].uuid].frame.x=i[r].x,PIXI.TextureCache[i[r].uuid].frame.y=i[r].y;this.buildRetroFontText()}};Object.defineProperty(n.RetroFont.prototype,"text",{get:function(){return this._text},set:function(n){var t;t=this.autoUpperCase?n.toUpperCase():n;t!==this._text&&(this._text=t,this.removeUnsupportedCharacters(this.multiLine),this.buildRetroFontText())}});Object.defineProperty(n.RetroFont.prototype,"smoothed",{get:function(){return this.stamp.smoothed},set:function(n){this.stamp.smoothed=n;this.buildRetroFontText()}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particle=function(t,i,r,u,f){n.Sprite.call(this,t,i,r,u,f);this.autoScale=!1;this.scaleData=null;this._s=0;this.autoAlpha=!1;this.alphaData=null;this._a=0};n.Particle.prototype=Object.create(n.Sprite.prototype);n.Particle.prototype.constructor=n.Particle;n.Particle.prototype.update=function(){this.autoScale&&(this._s--,this._s?this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y):this.autoScale=!1);this.autoAlpha&&(this._a--,this._a?this.alpha=this.alphaData[this._a].v:this.autoAlpha=!1)};n.Particle.prototype.onEmit=function(){};n.Particle.prototype.setAlphaData=function(n){this.alphaData=n;this._a=n.length-1;this.alpha=this.alphaData[this._a].v;this.autoAlpha=!0};n.Particle.prototype.setScaleData=function(n){this.scaleData=n;this._s=n.length-1;this.scale.set(this.scaleData[this._s].x,this.scaleData[this._s].y);this.autoScale=!0};n.Particle.prototype.reset=function(n,t,i){return typeof i=="undefined"&&(i=1),this.world.setTo(n,t),this.position.x=n,this.position.y=t,this.alive=!0,this.exists=!0,this.visible=!0,this.renderable=!0,this._outOfBoundsFired=!1,this.health=i,this.body&&this.body.reset(n,t,!1,!1),this._cache[4]=1,this.alpha=1,this.scale.set(1),this.autoScale=!1,this.autoAlpha=!1,this};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Canvas={create:function(n,t,i){n=n||256;t=t||256;var r=document.createElement("canvas");return typeof i=="string"&&i!==""&&(r.id=i),r.width=n,r.height=t,r.style.display="block",r},getOffset:function(t,i){i=i||new n.Point;var f=t.getBoundingClientRect(),e=t.clientTop||document.body.clientTop||0,o=t.clientLeft||document.body.clientLeft||0,r=0,u=0;return document.compatMode==="CSS1Compat"?(r=window.pageYOffset||document.documentElement.scrollTop||t.scrollTop||0,u=window.pageXOffset||document.documentElement.scrollLeft||t.scrollLeft||0):(r=window.pageYOffset||document.body.scrollTop||t.scrollTop||0,u=window.pageXOffset||document.body.scrollLeft||t.scrollLeft||0),i.x=f.left+u-o,i.y=f.top+r-e,i},getAspectRatio:function(n){return n.width/n.height},setBackgroundColor:function(n,t){return t=t||"rgb(0,0,0)",n.style.backgroundColor=t,n},setTouchAction:function(n,t){return t=t||"none",n.style.msTouchAction=t,n.style["ms-touch-action"]=t,n.style["touch-action"]=t,n},setUserSelect:function(n,t){return t=t||"none",n.style["-webkit-touch-callout"]=t,n.style["-webkit-user-select"]=t,n.style["-khtml-user-select"]=t,n.style["-moz-user-select"]=t,n.style["-ms-user-select"]=t,n.style["user-select"]=t,n.style["-webkit-tap-highlight-color"]="rgba(0, 0, 0, 0)",n},addToDOM:function(n,t,i){var r;return typeof i=="undefined"&&(i=!0),t&&(typeof t=="string"?r=document.getElementById(t):typeof t=="object"&&t.nodeType===1&&(r=t)),r||(r=document.body),i&&r.style&&(r.style.overflow="hidden"),r.appendChild(n),n},removeFromDOM:function(n){n.parentNode&&n.parentNode.removeChild(n)},setTransform:function(n,t,i,r,u,f,e){return n.setTransform(r,f,e,u,t,i),n},setSmoothingEnabled:function(n,t){return n.imageSmoothingEnabled=t,n.mozImageSmoothingEnabled=t,n.oImageSmoothingEnabled=t,n.webkitImageSmoothingEnabled=t,n.msImageSmoothingEnabled=t,n},getSmoothingEnabled:function(n){return n.imageSmoothingEnabled||n.mozImageSmoothingEnabled||n.oImageSmoothingEnabled||n.webkitImageSmoothingEnabled||n.msImageSmoothingEnabled},setImageRenderingCrisp:function(n){return n.style["image-rendering"]="optimizeSpeed",n.style["image-rendering"]="crisp-edges",n.style["image-rendering"]="-moz-crisp-edges",n.style["image-rendering"]="-webkit-optimize-contrast",n.style["image-rendering"]="optimize-contrast",n.style["image-rendering"]="pixelated",n.style.msInterpolationMode="nearest-neighbor",n},setImageRenderingBicubic:function(n){return n.style["image-rendering"]="auto",n.style.msInterpolationMode="bicubic",n}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Device=function(n){this.game=n;this.desktop=!1;this.iOS=!1;this.cocoonJS=!1;this.cocoonJSApp=!1;this.cordova=!1;this.node=!1;this.nodeWebkit=!1;this.ejecta=!1;this.crosswalk=!1;this.android=!1;this.chromeOS=!1;this.linux=!1;this.macOS=!1;this.windows=!1;this.windowsPhone=!1;this.canvas=!1;this.file=!1;this.fileSystem=!1;this.localStorage=!1;this.webGL=!1;this.worker=!1;this.touch=!1;this.mspointer=!1;this.css3D=!1;this.pointerLock=!1;this.typedArray=!1;this.vibration=!1;this.getUserMedia=!1;this.quirksMode=!1;this.arora=!1;this.chrome=!1;this.epiphany=!1;this.firefox=!1;this.ie=!1;this.ieVersion=0;this.trident=!1;this.tridentVersion=0;this.mobileSafari=!1;this.midori=!1;this.opera=!1;this.safari=!1;this.webApp=!1;this.silk=!1;this.audioData=!1;this.webAudio=!1;this.ogg=!1;this.opus=!1;this.mp3=!1;this.wav=!1;this.m4a=!1;this.webm=!1;this.iPhone=!1;this.iPhone4=!1;this.iPad=!1;this.pixelRatio=0;this.littleEndian=!1;this.support32bit=!1;this.fullscreen=!1;this.requestFullscreen="";this.cancelFullscreen="";this.fullscreenKeyboard=!1;this._checkOS();this._checkAudio();this._checkBrowser();this._checkCSS3D();this._checkDevice();this._checkFeatures()};n.Device.LITTLE_ENDIAN=!1;n.Device.prototype={_checkOS:function(){var n=navigator.userAgent;/Playstation Vita/.test(n)?this.vita=!0:/Kindle/.test(n)||/\bKF[A-Z][A-Z]+/.test(n)||/Silk.*Mobile Safari/.test(n)?this.kindle=!0:/Android/.test(n)?this.android=!0:/CrOS/.test(n)?this.chromeOS=!0:/iP[ao]d|iPhone/i.test(n)?this.iOS=!0:/Linux/.test(n)?this.linux=!0:/Mac OS/.test(n)?this.macOS=!0:/Windows/.test(n)&&(this.windows=!0,/Windows Phone/i.test(n)&&(this.windowsPhone=!0));(this.windows||this.macOS||this.linux&&this.silk===!1||this.chromeOS)&&(this.desktop=!0);(this.windowsPhone||/Windows NT/i.test(n)&&/Touch/i.test(n))&&(this.desktop=!1)},_checkFeatures:function(){this.canvas=!!window.CanvasRenderingContext2D||this.cocoonJS;try{this.localStorage=!!localStorage.getItem}catch(n){this.localStorage=!1}this.file=!!window.File&&!!window.FileReader&&!!window.FileList&&!!window.Blob;this.fileSystem=!!window.requestFileSystem;this.webGL=function(){try{var n=document.createElement("canvas");return n.screencanvas=!1,!!window.WebGLRenderingContext&&(n.getContext("webgl")||n.getContext("experimental-webgl"))}catch(t){return!1}}();this.webGL=this.webGL===null||this.webGL===!1?!1:!0;this.worker=!!window.Worker;("ontouchstart"in document.documentElement||window.navigator.maxTouchPoints&&window.navigator.maxTouchPoints>1)&&(this.touch=!0);(window.navigator.msPointerEnabled||window.navigator.pointerEnabled)&&(this.mspointer=!0);this.pointerLock="pointerLockElement"in document||"mozPointerLockElement"in document||"webkitPointerLockElement"in document;this.quirksMode=document.compatMode==="CSS1Compat"?!1:!0;this.getUserMedia=!!(navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)},checkFullScreenSupport:function(){for(var t,i=["requestFullscreen","requestFullScreen","webkitRequestFullscreen","webkitRequestFullScreen","msRequestFullscreen","msRequestFullScreen","mozRequestFullScreen","mozRequestFullscreen"],n=0;n<i.length;n++)if(this.game.canvas[i[n]]){this.fullscreen=!0;this.requestFullscreen=i[n];break}if(t=["cancelFullScreen","exitFullscreen","webkitCancelFullScreen","webkitExitFullscreen","msCancelFullScreen","msExitFullscreen","mozCancelFullScreen","mozExitFullscreen"],this.fullscreen)for(n=0;n<t.length;n++)if(document[t[n]]){this.cancelFullscreen=t[n];break}window.Element&&Element.ALLOW_KEYBOARD_INPUT&&(this.fullscreenKeyboard=!0)},_checkBrowser:function(){var n=navigator.userAgent;if(/Arora/.test(n)?this.arora=!0:/Chrome/.test(n)?this.chrome=!0:/Epiphany/.test(n)?this.epiphany=!0:/Firefox/.test(n)?this.firefox=!0:/AppleWebKit/.test(n)&&this.iOS?this.mobileSafari=!0:/MSIE (\d+\.\d+);/.test(n)?(this.ie=!0,this.ieVersion=parseInt(RegExp.$1,10)):/Midori/.test(n)?this.midori=!0:/Opera/.test(n)?this.opera=!0:/Safari/.test(n)?this.safari=!0:/Trident\/(\d+\.\d+)(.*)rv:(\d+\.\d+)/.test(n)&&(this.ie=!0,this.trident=!0,this.tridentVersion=parseInt(RegExp.$1,10),this.ieVersion=parseInt(RegExp.$3,10)),/Silk/.test(n)&&(this.silk=!0),navigator.standalone&&(this.webApp=!0),typeof cordova!="undefined"&&(this.cordova=!0),typeof process!="undefined"&&typeof require!="undefined"&&(this.node=!0),this.node)try{this.nodeWebkit=typeof require("nw.gui")!="undefined"}catch(t){this.nodeWebkit=!1}if(navigator.isCocoonJS&&(this.cocoonJS=!0),this.cocoonJS)try{this.cocoonJSApp=typeof CocoonJS!="undefined"}catch(t){this.cocoonJSApp=!1}typeof ejecta!="undefined"&&(this.ejecta=!0);/Crosswalk/.test(n)&&(this.crosswalk=!0)},_checkAudio:function(){this.audioData=!!window.Audio;this.webAudio=!!(window.webkitAudioContext||window.AudioContext);var n=document.createElement("audio"),t=!1;try{(t=!!n.canPlayType)&&(n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,"")&&(this.ogg=!0),n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,"")&&(this.opus=!0),n.canPlayType("audio/mpeg;").replace(/^no$/,"")&&(this.mp3=!0),n.canPlayType('audio/wav; codecs="1"').replace(/^no$/,"")&&(this.wav=!0),(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/aac;").replace(/^no$/,""))&&(this.m4a=!0),n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")&&(this.webm=!0))}catch(i){}},_checkDevice:function(){this.pixelRatio=window.devicePixelRatio||1;this.iPhone=navigator.userAgent.toLowerCase().indexOf("iphone")!=-1;this.iPhone4=this.pixelRatio==2&&this.iPhone;this.iPad=navigator.userAgent.toLowerCase().indexOf("ipad")!=-1;this.typedArray=typeof Int8Array!="undefined"?!0:!1;typeof ArrayBuffer!="undefined"&&typeof Uint8Array!="undefined"&&typeof Uint32Array!="undefined"&&(this.littleEndian=this._checkIsLittleEndian(),n.Device.LITTLE_ENDIAN=this.littleEndian);this.support32bit=typeof ArrayBuffer!="undefined"&&typeof Uint8ClampedArray!="undefined"&&typeof Int32Array!="undefined"&&this.littleEndian!==null&&this._checkIsUint8ClampedImageData();navigator.vibrate=navigator.vibrate||navigator.webkitVibrate||navigator.mozVibrate||navigator.msVibrate;navigator.vibrate&&(this.vibration=!0)},_checkIsLittleEndian:function(){var t=new ArrayBuffer(4),n=new Uint8Array(t),i=new Uint32Array(t);return(n[0]=161,n[1]=178,n[2]=195,n[3]=212,i[0]==3569595041)?!0:i[0]==2712847316?!1:null},_checkIsUint8ClampedImageData:function(){var t,n,i;return typeof Uint8ClampedArray=="undefined"?!1:(t=document.createElement("canvas"),n=t.getContext("2d"),!n)?!1:(i=n.createImageData(1,1),i.data instanceof Uint8ClampedArray)},_checkCSS3D:function(){var n=document.createElement("p"),t,r={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"},i;document.body.insertBefore(n,null);for(i in r)n.style[i]!==undefined&&(n.style[i]="translate3d(1px,1px,1px)",t=window.getComputedStyle(n).getPropertyValue(r[i]));document.body.removeChild(n);this.css3D=t!==undefined&&t.length>0&&t!=="none"},canPlayAudio:function(n){return n=="mp3"&&this.mp3?!0:n=="ogg"&&(this.ogg||this.opus)||n=="m4a"&&this.m4a||n=="wav"&&this.wav||n=="webm"&&this.webm?!0:!1},isConsoleOpen:function(){return window.console&&window.console.firebug?!0:window.console&&(console.profile(),console.profileEnd(),console.clear&&console.clear(),console.profiles)?console.profiles.length>0:!1}};n.Device.prototype.constructor=n.Device;n.Device.isAndroidStockBrowser=function(){var n=window.navigator.userAgent.match(/Android.*AppleWebKit\/([\d.]+)/);return n&&n[1]<537};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RequestAnimationFrame=function(n,t){var r,i;for(typeof t=="undefined"&&(t=!1),this.game=n,this.isRunning=!1,this.forceSetTimeOut=t,r=["ms","moz","webkit","o"],i=0;i<r.length&&!window.requestAnimationFrame;i++)window.requestAnimationFrame=window[r[i]+"RequestAnimationFrame"],window.cancelAnimationFrame=window[r[i]+"CancelAnimationFrame"];this._isSetTimeOut=!1;this._onLoop=null;this._timeOutID=null};n.RequestAnimationFrame.prototype={start:function(){this.isRunning=!0;var n=this;!window.requestAnimationFrame||this.forceSetTimeOut?(this._isSetTimeOut=!0,this._onLoop=function(){return n.updateSetTimeout()},this._timeOutID=window.setTimeout(this._onLoop,0)):(this._isSetTimeOut=!1,this._onLoop=function(t){return n.updateRAF(t)},this._timeOutID=window.requestAnimationFrame(this._onLoop))},updateRAF:function(){this.game.update(Date.now());this._timeOutID=window.requestAnimationFrame(this._onLoop)},updateSetTimeout:function(){this.game.update(Date.now());this._timeOutID=window.setTimeout(this._onLoop,this.game.time.timeToCall)},stop:function(){this._isSetTimeOut?clearTimeout(this._timeOutID):window.cancelAnimationFrame(this._timeOutID);this.isRunning=!1},isSetTimeOut:function(){return this._isSetTimeOut},isRAF:function(){return this._isSetTimeOut===!1}};n.RequestAnimationFrame.prototype.constructor=n.RequestAnimationFrame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Math={PI2:Math.PI*2,fuzzyEqual:function(n,t,i){return typeof i=="undefined"&&(i=.0001),Math.abs(n-t)<i},fuzzyLessThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n<t+i},fuzzyGreaterThan:function(n,t,i){return typeof i=="undefined"&&(i=.0001),n>t-i},fuzzyCeil:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.ceil(n-t)},fuzzyFloor:function(n,t){return typeof t=="undefined"&&(t=.0001),Math.floor(n+t)},average:function(){for(var r,i,n=[],t=0;t<arguments.length-0;t++)n[t]=arguments[t+0];for(r=0,i=0;i<n.length;i++)r+=n[i];return r/n.length},truncate:function(n){return n>0?Math.floor(n):Math.ceil(n)},shear:function(n){return n%1},snapTo:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.round(n/t),i+n)},snapToFloor:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.floor(n/t),i+n)},snapToCeil:function(n,t,i){return(typeof i=="undefined"&&(i=0),t===0)?n:(n-=i,n=t*Math.ceil(n/t),i+n)},snapToInArray:function(n,t,i){var r,u,f;if(typeof i=="undefined"&&(i=!0),i&&t.sort(),n<t[0])return t[0];for(r=1;t[r]<n;)r++;return u=t[r-1],f=r<t.length?t[r]:Number.POSITIVE_INFINITY,f-n<=n-u?f:u},roundTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.round(n*r)/r},floorTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.floor(n*r)/r},ceilTo:function(n,t,i){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=10);var r=Math.pow(i,-t);return Math.ceil(n*r)/r},interpolateFloat:function(n,t,i){return(t-n)*i+n},angleBetween:function(n,t,i,r){return Math.atan2(r-t,i-n)},angleBetweenY:function(n,t,i,r){return Math.atan2(i-n,r-t)},angleBetweenPoints:function(n,t){return Math.atan2(t.y-n.y,t.x-n.x)},angleBetweenPointsY:function(n,t){return Math.atan2(t.x-n.x,t.y-n.y)},reverseAngle:function(n){return this.normalizeAngle(n+Math.PI,!0)},normalizeAngle:function(n){return n=n%(2*Math.PI),n>=0?n:n+2*Math.PI},normalizeLatitude:function(n){return Math.max(-90,Math.min(90,n))},normalizeLongitude:function(n){return n%360==180?180:(n=n%360,n<-180?n+360:n>180?n-360:n)},chanceRoll:function(n){return typeof n=="undefined"&&(n=50),n<=0?!1:n>=100?!0:Math.random()*100>=n?!1:!0},numberArray:function(n,t){for(var r=[],i=n;i<=t;i++)r.push(i);return r},numberArrayStep:function(t,i,r){var u;t=+t||0;u=typeof i;(u==="number"||u==="string")&&r&&r[i]===t&&(i=r=null);r=r==null?1:+r||0;i===null?(i=t,t=0):i=+i||0;for(var f=-1,e=n.Math.max(n.Math.ceil((i-t)/(r||1)),0),o=new Array(e);++f<e;)o[f]=t,t+=r;return o},maxAdd:function(n,t,i){return n+=t,n>i&&(n=i),n},minSub:function(n,t,i){return n-=t,n<i&&(n=i),n},wrap:function(n,t,i){var u=i-t,r;return u<=0?0:(r=(n-t)%u,r<0&&(r+=u),r+t)},wrapValue:function(n,t,i){return n=Math.abs(n),t=Math.abs(t),i=Math.abs(i),(n+t)%i},limitValue:function(n,t,i){return n<t?t:n>i?i:n},randomSign:function(){return Math.random()>.5?1:-1},isOdd:function(n){return n&1},isEven:function(n){return n&1?!1:!0},min:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]<n[i]&&(i=t);return n[i]},max:function(){for(var n=arguments.length===1&&typeof arguments[0]=="object"?arguments[0]:arguments,t=1,i=0,r=n.length;t<r;t++)n[t]>n[i]&&(i=t);return n[i]},minProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]<t[r][n]&&(r=i);return t[r][n]},maxProperty:function(n){for(var t=arguments.length===2&&typeof arguments[1]=="object"?arguments[1]:arguments.slice(1),i=1,r=0,u=t.length;i<u;i++)t[i][n]>t[r][n]&&(r=i);return t[r][n]},wrapAngle:function(n,t){var i=t?Math.PI/180:1;return this.wrap(n,-180*i,180*i)},angleLimit:function(n,t,i){var r=n;return n>i?r=i:n<t&&(r=t),r},linearInterpolation:function(n,t){var i=n.length-1,r=i*t,u=Math.floor(r);return t<0?this.linear(n[0],n[1],r):t>1?this.linear(n[i],n[i-1],i-r):this.linear(n[u],n[u+1>i?i:u+1],r-u)},bezierInterpolation:function(n,t){for(var u=0,r=n.length-1,i=0;i<=r;i++)u+=Math.pow(1-t,r-i)*Math.pow(t,i)*n[i]*this.bernstein(r,i);return u},catmullRomInterpolation:function(n,t){var i=n.length-1,u=i*t,r=Math.floor(u);return n[0]===n[i]?(t<0&&(r=Math.floor(u=i*(1+t))),this.catmullRom(n[(r-1+i)%i],n[r],n[(r+1)%i],n[(r+2)%i],u-r)):t<0?n[0]-(this.catmullRom(n[0],n[0],n[1],n[1],-u)-n[0]):t>1?n[i]-(this.catmullRom(n[i],n[i],n[i-1],n[i-1],u-i)-n[i]):this.catmullRom(n[r?r-1:0],n[r],n[i<r+1?i:r+1],n[i<r+2?i:r+2],u-r)},linear:function(n,t,i){return(t-n)*i+n},bernstein:function(n,t){return this.factorial(n)/this.factorial(t)/this.factorial(n-t)},factorial:function(n){if(n===0)return 1;for(var t=n;--n;)t*=n;return t},catmullRom:function(n,t,i,r,u){var f=(i-n)*.5,e=(r-t)*.5,o=u*u,s=u*o;return(2*t-2*i+f+e)*s+(-3*t+3*i-2*f-e)*o+f*u+t},difference:function(n,t){return Math.abs(n-t)},getRandom:function(n,t,i){if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=0),n!=null){var r=i;if((r===0||r>n.length-t)&&(r=n.length-t),r>0)return n[t+Math.floor(Math.random()*r)]}return null},removeRandom:function(n,t,i){var r,u,f;return(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=0),n!=null&&(r=i,(r===0||r>n.length-t)&&(r=n.length-t),r>0))?(u=t+Math.floor(Math.random()*r),f=n.splice(u,1),f[0]):null},floor:function(n){var t=n|0;return n>0?t:t!=n?t-1:t},ceil:function(n){var t=n|0;return n>0?t!=n?t+1:t:t},sinCosGenerator:function(n,t,i,r){var u;typeof t=="undefined"&&(t=1);typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=1);var f=t,e=i,o=r*Math.PI/n,s=[],h=[];for(u=0;u<n;u++)e-=f*o,f+=e*o,s[u]=e,h[u]=f;return{sin:h,cos:s,length:n}},shift:function(n){var t=n.shift();return n.push(t),t},shuffleArray:function(n){for(var i,r,t=n.length-1;t>0;t--)i=Math.floor(Math.random()*(t+1)),r=n[t],n[t]=n[i],n[i]=r;return n},distance:function(n,t,i,r){var u=n-i,f=t-r;return Math.sqrt(u*u+f*f)},distancePow:function(n,t,i,r,u){return typeof u=="undefined"&&(u=2),Math.sqrt(Math.pow(i-n,u)+Math.pow(r-t,u))},distanceRounded:function(t,i,r,u){return Math.round(n.Math.distance(t,i,r,u))},clamp:function(n,t,i){return n<t?t:n>i?i:n},clampBottom:function(n,t){return n<t?t:n},within:function(n,t,i){return Math.abs(n-t)<=i},mapLinear:function(n,t,i,r,u){return r+(n-t)*(u-r)/(i-t)},smoothstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*(3-2*n)},smootherstep:function(n,t,i){return n=Math.max(0,Math.min(1,(n-t)/(i-t))),n*n*n*(n*(n*6-15)+10)},sign:function(n){return n<0?-1:n>0?1:0},percent:function(n,t,i){return typeof i=="undefined"&&(i=0),n>t||i>t?1:n<i||i>n?0:(n-i)/t},degToRad:function(){var n=Math.PI/180;return function(t){return t*n}}(),radToDeg:function(){var n=180/Math.PI;return function(t){return t*n}}()};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.RandomDataGenerator=function(n){typeof n=="undefined"&&(n=[]);this.c=1;this.s0=0;this.s1=0;this.s2=0;this.sow(n)};n.RandomDataGenerator.prototype={rnd:function(){var n=2091639*this.s0+this.c*23283064365386963e-26;return this.c=n|0,this.s0=this.s1,this.s1=this.s2,this.s2=n-this.c,this.s2},sow:function(n){var t,i;for(typeof n=="undefined"&&(n=[]),this.s0=this.hash(" "),this.s1=this.hash(this.s0),this.s2=this.hash(this.s1),this.c=1,i=0;t=n[i++];)this.s0-=this.hash(t),this.s0+=~~(this.s0<0),this.s1-=this.hash(t),this.s1+=~~(this.s1<0),this.s2-=this.hash(t),this.s2+=~~(this.s2<0)},hash:function(n){var i,r,t;for(t=4022871197,n=n.toString(),r=0;r<n.length;r++)t+=n.charCodeAt(r),i=.025196032824169379*t,t=i>>>0,i-=t,i*=t,t=i>>>0,i-=t,t+=i*4294967296;return(t>>>0)*23283064365386963e-26},integer:function(){return this.rnd.apply(this)*4294967296},frac:function(){return this.rnd.apply(this)+(this.rnd.apply(this)*2097152|0)*11102230246251565e-32},real:function(){return this.integer()+this.frac()},integerInRange:function(n,t){return Math.floor(this.realInRange(0,t-n+1)+n)},between:function(n,t){return this.integerInRange(n,t)},realInRange:function(n,t){return this.frac()*(t-n)+n},normal:function(){return 1-2*this.frac()},uuid:function(){for(var n="",t="",t=n="";n++<36;t+=~n%5|n*3&4?(n^15?8^this.frac()*(n^20?16:4):4).toString(16):"-");return t},pick:function(n){return n[this.integerInRange(0,n.length-1)]},weightedPick:function(n){return n[~~(Math.pow(this.frac(),2)*(n.length-1))]},timestamp:function(n,t){return this.realInRange(n||9466848e5,t||1577862e6)},angle:function(){return this.integerInRange(-180,180)}};n.RandomDataGenerator.prototype.constructor=n.RandomDataGenerator;
/**
 * @author       Richard Davey <rich@photonstorm.com>
 * @copyright    2014 Photon Storm Ltd.
 * @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
 */
n.QuadTree=function(n,t,i,r,u,f,e){this.maxObjects=10;this.maxLevels=4;this.level=0;this.bounds={};this.objects=[];this.nodes=[];this._empty=[];this.reset(n,t,i,r,u,f,e)};n.QuadTree.prototype={reset:function(n,t,i,r,u,f,e){this.maxObjects=u||10;this.maxLevels=f||4;this.level=e||0;this.bounds={x:Math.round(n),y:Math.round(t),width:i,height:r,subWidth:Math.floor(i/2),subHeight:Math.floor(r/2),right:Math.round(n)+Math.floor(i/2),bottom:Math.round(t)+Math.floor(r/2)};this.objects.length=0;this.nodes.length=0},populate:function(n){n.forEach(this.populateHandler,this,!0)},populateHandler:function(n){n.body&&n.exists&&this.insert(n.body)},split:function(){this.nodes[0]=new n.QuadTree(this.bounds.right,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[1]=new n.QuadTree(this.bounds.x,this.bounds.y,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[2]=new n.QuadTree(this.bounds.x,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1);this.nodes[3]=new n.QuadTree(this.bounds.right,this.bounds.bottom,this.bounds.subWidth,this.bounds.subHeight,this.maxObjects,this.maxLevels,this.level+1)},insert:function(n){var i=0,t;if(this.nodes[0]!=null&&(t=this.getIndex(n),t!==-1)){this.nodes[t].insert(n);return}if(this.objects.push(n),this.objects.length>this.maxObjects&&this.level<this.maxLevels)for(this.nodes[0]==null&&this.split();i<this.objects.length;)t=this.getIndex(this.objects[i]),t!==-1?this.nodes[t].insert(this.objects.splice(i,1)[0]):i++},getIndex:function(n){var t=-1;return n.x<this.bounds.right&&n.right<this.bounds.right?n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=1:n.y>this.bounds.bottom&&(t=2):n.x>this.bounds.right&&(n.y<this.bounds.bottom&&n.bottom<this.bounds.bottom?t=0:n.y>this.bounds.bottom&&(t=3)),t},retrieve:function(t){var i,r;if(t instanceof n.Rectangle)i=this.objects,r=this.getIndex(t);else{if(!t.body)return this._empty;i=this.objects;r=this.getIndex(t.body)}return this.nodes[0]&&(r!==-1?i=i.concat(this.nodes[r].retrieve(t)):(i=i.concat(this.nodes[0].retrieve(t)),i=i.concat(this.nodes[1].retrieve(t)),i=i.concat(this.nodes[2].retrieve(t)),i=i.concat(this.nodes[3].retrieve(t)))),i},clear:function(){this.objects.length=0;for(var n=this.nodes.length;n--;)this.nodes[n].clear(),this.nodes.splice(n,1);this.nodes.length=0}};n.QuadTree.prototype.constructor=n.QuadTree;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Net=function(n){this.game=n};n.Net.prototype={getHostName:function(){return window.location&&window.location.hostname?window.location.hostname:null},checkDomainName:function(n){return window.location.hostname.indexOf(n)!==-1},updateQueryString:function(n,t,i,r){var u,f,o,e;if(typeof i=="undefined"&&(i=!1),(typeof r=="undefined"||r==="")&&(r=window.location.href),u="",f=new RegExp("([?|&])"+n+"=.*?(&|#|$)(.*)","gi"),f.test(r)?u=typeof t!="undefined"&&t!==null?r.replace(f,"$1"+n+"="+t+"$2$3"):r.replace(f,"$1$3").replace(/(&|\?)$/,""):typeof t!="undefined"&&t!==null?(o=r.indexOf("?")!==-1?"&":"?",e=r.split("#"),r=e[0]+o+n+"="+t,e[1]&&(r+="#"+e[1]),u=r):u=r,i)window.location.href=u;else return u},getQueryString:function(n){var i,r,u,t;typeof n=="undefined"&&(n="");i={};r=location.search.substring(1).split("&");for(u in r)if(t=r[u].split("="),t.length>1){if(n&&n==this.decodeURI(t[0]))return this.decodeURI(t[1]);i[this.decodeURI(t[0])]=this.decodeURI(t[1])}return i},decodeURI:function(n){return decodeURIComponent(n.replace(/\+/g," "))}};n.Net.prototype.constructor=n.Net;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TweenManager=function(n){this.game=n;this._tweens=[];this._add=[];this.game.onPause.add(this._pauseAll,this);this.game.onResume.add(this._resumeAll,this)};n.TweenManager.prototype={getAll:function(){return this._tweens},removeAll:function(){for(var n=0;n<this._tweens.length;n++)this._tweens[n].pendingDelete=!0;this._add=[]},add:function(n){n._manager=this;this._add.push(n)},create:function(t){return new n.Tween(t,this.game,this)},remove:function(n){var t=this._tweens.indexOf(n);t!==-1?this._tweens[t].pendingDelete=!0:(t=this._add.indexOf(n),t!==-1&&(this._add[t].pendingDelete=!0))},update:function(){var i=this._add.length,t=this._tweens.length,n;if(t===0&&i===0)return!1;for(n=0;n<t;)this._tweens[n].update(this.game.time.now)?n++:(this._tweens.splice(n,1),t--);return i>0&&(this._tweens=this._tweens.concat(this._add),this._add.length=0),!0},isTweening:function(n){return this._tweens.some(function(t){return t._object===n})},_pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._pause()},_resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n]._resume()},pauseAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].pause()},resumeAll:function(){for(var n=this._tweens.length-1;n>=0;n--)this._tweens[n].resume(!0)}};n.TweenManager.prototype.constructor=n.TweenManager;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tween=function(t,i,r){this._object=t;this.game=i;this._manager=r;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._yoyo=!1;this._reversed=!1;this._delayTime=0;this._startTime=null;this._easingFunction=n.Easing.Default;this._interpolationFunction=n.Math.linearInterpolation;this._chainedTweens=[];this._onStartCallbackFired=!1;this._onUpdateCallback=null;this._onUpdateCallbackContext=null;this._paused=!1;this._pausedTime=0;this._codePaused=!1;this.pendingDelete=!1;this.onStart=new n.Signal;this.onLoop=new n.Signal;this.onComplete=new n.Signal;this.isRunning=!1};n.Tween.prototype={to:function(n,t,i,r,u,f,e){t=t||1e3;i=i||null;r=r||!1;u=u||0;f=f||0;e=e||!1;e&&f===0&&(f=1);var o;return this._parent?(o=this._manager.create(this._object),this._lastChild.chain(o),this._lastChild=o):(o=this,this._parent=this,this._lastChild=this),o._repeat=f,o._duration=t,o._valuesEnd=n,i!==null&&(o._easingFunction=i),u>0&&(o._delayTime=u),o._yoyo=e,r?this.start():this},from:function(n,t,i,r,u,f,e){var s={};for(var o in n)s[o]=this._object[o],this._object[o]=n[o];return this.to(s,t,i,r,u,f,e)},start:function(){if(this.game!==null&&this._object!==null){this._manager.add(this);this.isRunning=!0;this._onStartCallbackFired=!1;this._startTime=this.game.time.now+this._delayTime;for(var n in this._valuesEnd){if(Array.isArray(this._valuesEnd[n])){if(this._valuesEnd[n].length===0)continue;this._valuesEnd[n]=[this._object[n]].concat(this._valuesEnd[n])}this._valuesStart[n]=this._object[n];Array.isArray(this._valuesStart[n])||(this._valuesStart[n]*=1);this._valuesStartRepeat[n]=this._valuesStart[n]||0}return this}},generateData:function(n,t){var i,e,s,o,r,f,h;if(this.game===null||this._object===null)return null;this._startTime=0;for(i in this._valuesEnd){if(Array.isArray(this._valuesEnd[i])){if(this._valuesEnd[i].length===0)continue;this._valuesEnd[i]=[this._object[i]].concat(this._valuesEnd[i])}this._valuesStart[i]=this._object[i];Array.isArray(this._valuesStart[i])||(this._valuesStart[i]*=1);this._valuesStartRepeat[i]=this._valuesStart[i]||0}for(var c=0,l=Math.floor(n*(this._duration/1e3)),a=this._duration/l,u=[];l--;){e=(c-this._startTime)/this._duration;e=e>1?1:e;s=this._easingFunction(e);f={};for(i in this._valuesEnd)o=this._valuesStart[i]||0,r=this._valuesEnd[i],r instanceof Array?f[i]=this._interpolationFunction(r,s):typeof r=="string"?r=o+parseFloat(r,10):typeof r=="number"&&(f[i]=o+(r-o)*s);u.push(f);c+=a}f={};for(i in this._valuesEnd)f[i]=this._valuesEnd[i];return u.push(f),this._yoyo&&(h=u.slice(),h.reverse(),u=u.concat(h)),typeof t!="undefined"?t.concat(u):u},stop:function(){return this.isRunning=!1,this._onUpdateCallback=null,this._manager.remove(this),this},delay:function(n){return this._delayTime=n,this},repeat:function(n){return this._repeat=n,this},yoyo:function(n){return this._yoyo=n,n&&this._repeat===0&&(this._repeat=1),this},easing:function(n){return this._easingFunction=n,this},interpolation:function(n){return this._interpolationFunction=n,this},chain:function(){return this._chainedTweens=arguments,this},loop:function(){return this._lastChild.chain(this),this},onUpdateCallback:function(n,t){return this._onUpdateCallback=n,this._onUpdateCallbackContext=t,this},pause:function(){this._codePaused=!0;this._paused=!0;this._pausedTime=this.game.time.now},_pause:function(){this._codePaused||(this._paused=!0,this._pausedTime=this.game.time.now)},resume:function(){this._paused&&(this._paused=!1,this._codePaused=!1,this._startTime+=this.game.time.now-this._pausedTime)},_resume:function(){this._codePaused||(this._startTime+=this.game.time.pauseDuration,this._paused=!1)},update:function(n){var t,r,u,f,i,o,e,s;if(this.pendingDelete)return!1;if(this._paused||n<this._startTime||n<this._startTime)return!0;this._onStartCallbackFired===!1&&(this.onStart.dispatch(this._object),this._onStartCallbackFired=!0);r=(n-this._startTime)/this._duration;r=r>1?1:r;u=this._easingFunction(r);for(t in this._valuesEnd)f=this._valuesStart[t]||0,i=this._valuesEnd[t],i instanceof Array?this._object[t]=this._interpolationFunction(i,u):(typeof i=="string"&&(i=f+parseFloat(i,10)),typeof i=="number"&&(this._object[t]=f+(i-f)*u));if(this._onUpdateCallback!==null&&(this._onUpdateCallback.call(this._onUpdateCallbackContext,this,u),!this.isRunning))return!1;if(r==1){if(this._repeat>0){isFinite(this._repeat)&&this._repeat--;for(t in this._valuesStartRepeat)typeof this._valuesEnd[t]=="string"&&(this._valuesStartRepeat[t]=this._valuesStartRepeat[t]+parseFloat(this._valuesEnd[t],10)),this._yoyo&&(o=this._valuesStartRepeat[t],this._valuesStartRepeat[t]=this._valuesEnd[t],this._valuesEnd[t]=o),this._valuesStart[t]=this._valuesStartRepeat[t];return this._yoyo&&(this._reversed=!this._reversed),this._startTime=n+this._delayTime,this.onLoop.dispatch(this._object),!0}for(this.isRunning=!1,this.onComplete.dispatch(this._object),e=0,s=this._chainedTweens.length;e<s;e++)this._chainedTweens[e].start(n);return!1}return!0}};n.Tween.prototype.constructor=n.Tween;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Easing={Linear:{None:function(n){return n}},Quadratic:{In:function(n){return n*n},Out:function(n){return n*(2-n)},InOut:function(n){return(n*=2)<1?.5*n*n:-.5*(--n*(n-2)-1)}},Cubic:{In:function(n){return n*n*n},Out:function(n){return--n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n:.5*((n-=2)*n*n+2)}},Quartic:{In:function(n){return n*n*n*n},Out:function(n){return 1- --n*n*n*n},InOut:function(n){return(n*=2)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2)}},Quintic:{In:function(n){return n*n*n*n*n},Out:function(n){return--n*n*n*n*n+1},InOut:function(n){return(n*=2)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2)}},Sinusoidal:{In:function(n){return 1-Math.cos(n*Math.PI/2)},Out:function(n){return Math.sin(n*Math.PI/2)},InOut:function(n){return.5*(1-Math.cos(Math.PI*n))}},Exponential:{In:function(n){return n===0?0:Math.pow(1024,n-1)},Out:function(n){return n===1?1:1-Math.pow(2,-10*n)},InOut:function(n){return n===0?0:n===1?1:(n*=2)<1?.5*Math.pow(1024,n-1):.5*(-Math.pow(2,-10*(n-1))+2)}},Circular:{In:function(n){return 1-Math.sqrt(1-n*n)},Out:function(n){return Math.sqrt(1- --n*n)},InOut:function(n){return(n*=2)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1)}},Elastic:{In:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),-(t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)))},Out:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),t*Math.pow(2,-10*n)*Math.sin((n-i)*2*Math.PI/r)+1)},InOut:function(n){var i,t=.1,r=.4;return n===0?0:n===1?1:(!t||t<1?(t=1,i=r/4):i=r*Math.asin(1/t)/(2*Math.PI),(n*=2)<1)?-.5*t*Math.pow(2,10*(n-=1))*Math.sin((n-i)*2*Math.PI/r):t*Math.pow(2,-10*(n-=1))*Math.sin((n-i)*2*Math.PI/r)*.5+1}},Back:{In:function(n){var t=1.70158;return n*n*((t+1)*n-t)},Out:function(n){var t=1.70158;return--n*n*((t+1)*n+t)+1},InOut:function(n){var t=1.70158*1.525;return(n*=2)<1?.5*n*n*((t+1)*n-t):.5*((n-=2)*n*((t+1)*n+t)+2)}},Bounce:{In:function(t){return 1-n.Easing.Bounce.Out(1-t)},Out:function(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},InOut:function(t){return t<.5?n.Easing.Bounce.In(t*2)*.5:n.Easing.Bounce.Out(t*2-1)*.5+.5}}};n.Easing.Default=n.Easing.Linear.None;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Time=function(t){this.game=t;this.time=0;this.now=0;this.elapsed=0;this.pausedTime=0;this.advancedTiming=!1;this.fps=0;this.fpsMin=1e3;this.fpsMax=0;this.msMin=1e3;this.msMax=0;this.physicsElapsed=0;this.deltaCap=0;this.timeCap=1/60*1e3;this.frames=0;this.pauseDuration=0;this.timeToCall=0;this.lastTime=0;this.events=new n.Timer(this.game,!1);this._started=0;this._timeLastSecond=0;this._pauseStarted=0;this._justResumed=!1;this._timers=[];this._len=0;this._i=0};n.Time.prototype={boot:function(){this._started=Date.now();this.events.start()},add:function(n){return this._timers.push(n),n},create:function(t){typeof t=="undefined"&&(t=!0);var i=new n.Timer(this.game,t);return this._timers.push(i),i},removeAll:function(){for(var n=0;n<this._timers.length;n++)this._timers[n].destroy();this._timers=[];this.events.removeAll()},update:function(n){if(this.now=n,this.timeToCall=this.game.math.max(0,16-(n-this.lastTime)),this.elapsed=this.now-this.time,this.elapsed>this.timeCap&&(this.elapsed=this.timeCap),this.physicsElapsed=this.elapsed/1e3||1/60,this.deltaCap>0&&this.physicsElapsed>this.deltaCap&&(this.physicsElapsed=this.deltaCap),this.advancedTiming&&(this.msMin=this.game.math.min(this.msMin,this.elapsed),this.msMax=this.game.math.max(this.msMax,this.elapsed),this.frames++,this.now>this._timeLastSecond+1e3&&(this.fps=Math.round(this.frames*1e3/(this.now-this._timeLastSecond)),this.fpsMin=this.game.math.min(this.fpsMin,this.fps),this.fpsMax=this.game.math.max(this.fpsMax,this.fps),this._timeLastSecond=this.now,this.frames=0)),this.time=this.now,this.lastTime=n+this.timeToCall,!this.game.paused)for(this.events.update(this.now),this._i=0,this._len=this._timers.length;this._i<this._len;)this._timers[this._i].update(this.now)?this._i++:(this._timers.splice(this._i,1),this._len--)},gamePaused:function(){this._pauseStarted=this.now;this.events.pause();for(var n=this._timers.length;n--;)this._timers[n]._pause()},gameResumed:function(){this.time=this.now=Date.now();this.pauseDuration=this.time-this._pauseStarted;this.events.resume();for(var n=this._timers.length;n--;)this._timers[n]._resume()},totalElapsedSeconds:function(){return(this.now-this._started)*.001},elapsedSince:function(n){return this.now-n},elapsedSecondsSince:function(n){return(this.now-n)*.001},reset:function(){this._started=this.now;this.removeAll()}};n.Time.prototype.constructor=n.Time;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Timer=function(t,i){typeof i=="undefined"&&(i=!0);this.game=t;this.running=!1;this.autoDestroy=i;this.expired=!1;this.elapsed=0;this.events=[];this.onComplete=new n.Signal;this.nextTick=0;this.timeCap=1e3;this.paused=!1;this._codePaused=!1;this._started=0;this._pauseStarted=0;this._pauseTotal=0;this._now=Date.now();this._len=0;this._marked=0;this._i=0;this._diff=0;this._newTick=0};n.Timer.MINUTE=6e4;n.Timer.SECOND=1e3;n.Timer.HALF=500;n.Timer.QUARTER=250;n.Timer.prototype={create:function(t,i,r,u,f,e){var s=t,o;return s+=this._now===0?this.game.time.now:this._now,o=new n.TimerEvent(this,t,s,r,i,u,f,e),this.events.push(o),this.order(),this.expired=!1,o},add:function(n,t,i){return this.create(n,!1,0,t,i,Array.prototype.splice.call(arguments,3))},repeat:function(n,t,i,r){return this.create(n,!1,t,i,r,Array.prototype.splice.call(arguments,4))},loop:function(n,t,i){return this.create(n,!0,0,t,i,Array.prototype.splice.call(arguments,3))},start:function(n){if(!this.running){this._started=this.game.time.now+(n||0);this.running=!0;for(var t=0;t<this.events.length;t++)this.events[t].tick=this.events[t].delay+this._started}},stop:function(n){this.running=!1;typeof n=="undefined"&&(n=!0);n&&(this.events.length=0)},remove:function(n){for(var t=0;t<this.events.length;t++)if(this.events[t]===n)return this.events[t].pendingDelete=!0,!0;return!1},order:function(){this.events.length>0&&(this.events.sort(this.sortHandler),this.nextTick=this.events[0].tick)},sortHandler:function(n,t){return n.tick<t.tick?-1:n.tick>t.tick?1:0},clearPendingEvents:function(){for(this._i=this.events.length;this._i--;)this.events[this._i].pendingDelete&&this.events.splice(this._i,1);this._len=this.events.length;this._i=0},update:function(n){if(this.paused)return!0;if(this.elapsed=n-this._now,this._now=n,this.elapsed>this.timeCap&&this.adjustEvents(n-this.elapsed),this._marked=0,this.clearPendingEvents(),this.running&&this._now>=this.nextTick&&this._len>0){while(this._i<this._len&&this.running)if(this._now>=this.events[this._i].tick)this._newTick=this._now+this.events[this._i].delay-(this._now-this.events[this._i].tick),this._newTick<0&&(this._newTick=this._now+this.events[this._i].delay),this.events[this._i].loop===!0?(this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):this.events[this._i].repeatCount>0?(this.events[this._i].repeatCount--,this.events[this._i].tick=this._newTick,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)):(this._marked++,this.events[this._i].pendingDelete=!0,this.events[this._i].callback.apply(this.events[this._i].callbackContext,this.events[this._i].args)),this._i++;else break;this.events.length>this._marked?this.order():(this.expired=!0,this.onComplete.dispatch(this))}return this.expired&&this.autoDestroy?!1:!0},pause:function(){this.running&&((this._codePaused=!0,this.paused)||(this._pauseStarted=this.game.time.now,this.paused=!0))},_pause:function(){!this.paused&&this.running&&(this._pauseStarted=this.game.time.now,this.paused=!0)},adjustEvents:function(n){for(var i,r,t=0;t<this.events.length;t++)this.events[t].pendingDelete||(i=this.events[t].tick-n,i<0&&(i=0),this.events[t].tick=this._now+i);r=this.nextTick-n;this.nextTick=r<0?this._now:this._now+r},resume:function(){if(this.paused){var n=this.game.time.now;this._pauseTotal+=n-this._now;this._now=n;this.adjustEvents(this._pauseStarted);this.paused=!1;this._codePaused=!1}},_resume:function(){this._codePaused||this.resume()},removeAll:function(){this.onComplete.removeAll();this.events.length=0;this._len=0;this._i=0},destroy:function(){this.onComplete.removeAll();this.running=!1;this.events=[];this._len=0;this._i=0}};Object.defineProperty(n.Timer.prototype,"next",{get:function(){return this.nextTick}});Object.defineProperty(n.Timer.prototype,"duration",{get:function(){return this.running&&this.nextTick>this._now?this.nextTick-this._now:0}});Object.defineProperty(n.Timer.prototype,"length",{get:function(){return this.events.length}});Object.defineProperty(n.Timer.prototype,"ms",{get:function(){return this.running?this._now-this._started-this._pauseTotal:0}});Object.defineProperty(n.Timer.prototype,"seconds",{get:function(){return this.running?this.ms*.001:0}});n.Timer.prototype.constructor=n.Timer;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TimerEvent=function(n,t,i,r,u,f,e,o){this.timer=n;this.delay=t;this.tick=i;this.repeatCount=r-1;this.loop=u;this.callback=f;this.callbackContext=e;this.args=o;this.pendingDelete=!1};n.TimerEvent.prototype.constructor=n.TimerEvent;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationManager=function(n){this.sprite=n;this.game=n.game;this.currentFrame=null;this.currentAnim=null;this.updateIfVisible=!0;this.isLoaded=!1;this._frameData=null;this._anims={};this._outputFrames=[]};n.AnimationManager.prototype={loadFrameData:function(n,t){if(this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(n);return this._frameData=n,typeof t=="undefined"||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},copyFrameData:function(n,t){if(this._frameData=n.clone(),this.isLoaded)for(var i in this._anims)this._anims[i].updateFrameData(this._frameData);return typeof t=="undefined"||t===null?this.frame=0:typeof t=="string"?this.frameName=t:this.frame=t,this.isLoaded=!0,!0},add:function(t,i,r,u,f){return i=i||[],r=r||60,typeof u=="undefined"&&(u=!1),typeof f=="undefined"&&(f=i&&typeof i[0]=="number"?!0:!1),this.sprite.events.onAnimationStart===null&&(this.sprite.events.onAnimationStart=new n.Signal,this.sprite.events.onAnimationComplete=new n.Signal,this.sprite.events.onAnimationLoop=new n.Signal),this._outputFrames.length=0,this._frameData.getFrameIndexes(i,f,this._outputFrames),this._anims[t]=new n.Animation(this.game,this.sprite,t,this._frameData,this._outputFrames,r,u),this.currentAnim=this._anims[t],this.currentFrame=this.currentAnim.currentFrame,this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[t]},validateFrames:function(n,t){typeof t=="undefined"&&(t=!0);for(var i=0;i<n.length;i++)if(t===!0){if(n[i]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(n[i])===!1)return!1;return!0},play:function(n,t,i,r){if(this._anims[n])return this.currentAnim===this._anims[n]?this.currentAnim.isPlaying===!1?(this.currentAnim.paused=!1,this.currentAnim.play(t,i,r)):this.currentAnim:(this.currentAnim&&this.currentAnim.isPlaying&&this.currentAnim.stop(),this.currentAnim=this._anims[n],this.currentAnim.paused=!1,this.currentFrame=this.currentAnim.currentFrame,this.currentAnim.play(t,i,r))},stop:function(n,t){typeof t=="undefined"&&(t=!1);typeof n=="string"?this._anims[n]&&(this.currentAnim=this._anims[n],this.currentAnim.stop(t)):this.currentAnim&&this.currentAnim.stop(t)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()===!0?(this.currentFrame=this.currentAnim.currentFrame,!0):!1},next:function(n){this.currentAnim&&(this.currentAnim.next(n),this.currentFrame=this.currentAnim.currentFrame)},previous:function(n){this.currentAnim&&(this.currentAnim.previous(n),this.currentFrame=this.currentAnim.currentFrame)},getAnimation:function(n){return typeof n=="string"&&this._anims[n]?this._anims[n]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]);this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){for(var n in this._anims)this._anims.hasOwnProperty(n)&&this._anims[n].destroy();this._anims={};this._frameData=null;this._frameIndex=0;this.currentAnim=null;this.currentFrame=null}};n.AnimationManager.prototype.constructor=n.AnimationManager;Object.defineProperty(n.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}});Object.defineProperty(n.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}});Object.defineProperty(n.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(n){this.currentAnim.paused=n}});Object.defineProperty(n.AnimationManager.prototype,"frame",{get:function(){if(this.currentFrame)return this._frameIndex},set:function(n){typeof n=="number"&&this._frameData.getFrame(n)!==null&&(this.currentFrame=this._frameData.getFrame(n),this.currentFrame&&(this._frameIndex=n,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}});Object.defineProperty(n.AnimationManager.prototype,"frameName",{get:function(){if(this.currentFrame)return this.currentFrame.name},set:function(n){typeof n=="string"&&this._frameData.getFrameByName(n)!==null?(this.currentFrame=this._frameData.getFrameByName(n),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Animation=function(t,i,r,u,f,e,o){this.game=t;this._parent=i;this._frameData=u;this.name=r;this._frames=[];this._frames=this._frames.concat(f);this.delay=1e3/e;this.loop=o;this.loopCount=0;this.killOnComplete=!1;this.isFinished=!1;this.isPlaying=!1;this.isPaused=!1;this._pauseStartTime=0;this._frameIndex=0;this._frameDiff=0;this._frameSkip=1;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this.onStart=new n.Signal;this.onUpdate=null;this.onComplete=new n.Signal;this.onLoop=new n.Signal;this.game.onPause.add(this.onPause,this);this.game.onResume.add(this.onResume,this)};n.Animation.prototype={play:function(n,t,i){return typeof n=="number"&&(this.delay=1e3/n),typeof t=="boolean"&&(this.loop=t),typeof i!="undefined"&&(this.killOnComplete=i),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.now,this._timeNextFrame=this.game.time.now+this.delay,this._frameIndex=0,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this._parent.events.onAnimationStart.dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this},restart:function(){this.isPlaying=!0;this.isFinished=!1;this.paused=!1;this.loopCount=0;this._timeLastFrame=this.game.time.now;this._timeNextFrame=this.game.time.now+this.delay;this._frameIndex=0;this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]);this._parent.setFrame(this.currentFrame);this.onStart.dispatch(this._parent,this)},setFrame:function(n,t){var r,i;if(typeof t=="undefined"&&(t=!1),typeof n=="string")for(i=0;i<this._frames.length;i++)this._frameData.getFrame(this._frames[i]).name===n&&(r=i);else if(typeof n=="number")if(t)r=n;else for(i=0;i<this._frames.length;i++)this.frames[i]===r&&(r=i);r&&(this._frameIndex=r-1,this._timeNextFrame=this.game.time.now,this.update())},stop:function(n,t){typeof n=="undefined"&&(n=!1);typeof t=="undefined"&&(t=!1);this.isPlaying=!1;this.isFinished=!0;this.paused=!1;n&&(this.currentFrame=this._frameData.getFrame(this._frames[0]),this._parent.setFrame(this.currentFrame));t&&(this._parent.events.onAnimationComplete.dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.now)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.now+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.now>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.now-this._timeNextFrame,this._timeLastFrame=this.game.time.now,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay),this._timeNextFrame=this.game.time.now+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length&&(this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.loopCount++,this._parent.events.onAnimationLoop.dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this)):this.complete()),this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame)),!0):!1},next:function(n){typeof n=="undefined"&&(n=1);var t=this._frameIndex+n;t>=this._frames.length&&(this.loop?t%=this._frames.length:t=this._frames.length-1);t!==this._frameIndex&&(this._frameIndex=t,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))},previous:function(n){typeof n=="undefined"&&(n=1);var t=this._frameIndex-n;t<0&&(this.loop?t=this._frames.length+t:t++);t!==this._frameIndex&&(this._frameIndex=t,this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))},updateFrameData:function(n){this._frameData=n;this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):null},destroy:function(){this.game.onPause.remove(this.onPause,this);this.game.onResume.remove(this.onResume,this);this.game=null;this._parent=null;this._frames=null;this._frameData=null;this.currentFrame=null;this.isPlaying=!1;this.onStart.dispose();this.onLoop.dispose();this.onComplete.dispose();this.onUpdate&&this.onUpdate.dispose()},complete:function(){this.isPlaying=!1;this.isFinished=!0;this.paused=!1;this._parent.events.onAnimationComplete.dispatch(this._parent,this);this.onComplete.dispatch(this._parent,this);this.killOnComplete&&this._parent.kill()}};n.Animation.prototype.constructor=n.Animation;Object.defineProperty(n.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(n){this.isPaused=n;n?this._pauseStartTime=this.game.time.now:this.isPlaying&&(this._timeNextFrame=this.game.time.now+this.delay)}});Object.defineProperty(n.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}});Object.defineProperty(n.Animation.prototype,"frame",{get:function(){return this.currentFrame!==null?this.currentFrame.index:this._frameIndex},set:function(n){this.currentFrame=this._frameData.getFrame(this._frames[n]);this.currentFrame!==null&&(this._frameIndex=n,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}});Object.defineProperty(n.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(n){n>=1&&(this.delay=1e3/n)}});Object.defineProperty(n.Animation.prototype,"enableUpdate",{get:function(){return this.onUpdate!==null},set:function(t){t&&this.onUpdate===null?this.onUpdate=new n.Signal:t||this.onUpdate===null||(this.onUpdate.dispose(),this.onUpdate=null)}});n.Animation.generateFrameNames=function(t,i,r,u,f){var s,o,e;if(typeof u=="undefined"&&(u=""),s=[],o="",i<r)for(e=i;e<=r;e++)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);else for(e=i;e>=r;e--)o=typeof f=="number"?n.Utils.pad(e.toString(),f,"0",1):e.toString(),o=t+o+u,s.push(o);return s};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Frame=function(t,i,r,u,f,e,o){this.index=t;this.x=i;this.y=r;this.width=u;this.height=f;this.name=e;this.uuid=o;this.centerX=Math.floor(u/2);this.centerY=Math.floor(f/2);this.distance=n.Math.distance(0,0,u,f);this.rotated=!1;this.rotationDirection="cw";this.trimmed=!1;this.sourceSizeW=u;this.sourceSizeH=f;this.spriteSourceSizeX=0;this.spriteSourceSizeY=0;this.spriteSourceSizeW=0;this.spriteSourceSizeH=0;this.right=this.x+this.width;this.bottom=this.y+this.height};n.Frame.prototype={setTrim:function(n,t,i,r,u,f,e){this.trimmed=n;n&&(this.sourceSizeW=t,this.sourceSizeH=i,this.centerX=Math.floor(t/2),this.centerY=Math.floor(i/2),this.spriteSourceSizeX=r,this.spriteSourceSizeY=u,this.spriteSourceSizeW=f,this.spriteSourceSizeH=e)},clone:function(){var i=new n.Frame(this.index,this.x,this.y,this.width,this.height,this.name,this.uuid);for(var t in this)this.hasOwnProperty(t)&&(i[t]=this[t]);return i},getRect:function(t){return typeof t=="undefined"?t=new n.Rectangle(this.x,this.y,this.width,this.height):t.setTo(this.x,this.y,this.width,this.height),t}};n.Frame.prototype.constructor=n.Frame;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.FrameData=function(){this._frames=[];this._frameNames=[]};n.FrameData.prototype={addFrame:function(n){return n.index=this._frames.length,this._frames.push(n),n.name!==""&&(this._frameNames[n.name]=n.index),n},getFrame:function(n){return n>this._frames.length&&(n=0),this._frames[n]},getFrameByName:function(n){return typeof this._frameNames[n]=="number"?this._frames[this._frameNames[n]]:null},checkFrameName:function(n){return this._frameNames[n]==null?!1:!0},clone:function(){for(var i=new n.FrameData,t=0;t<this._frames.length;t++)i._frames.push(this._frames[t].clone());for(t=0;t<this._frameNames.length;t++)i._frameNames.push(this._frameNames[t]);return i},getFrameRange:function(n,t,i){typeof i=="undefined"&&(i=[]);for(var r=n;r<=t;r++)i.push(this._frames[r]);return i},getFrames:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0;r<this._frames.length;r++)i.push(this._frames[r]);else for(r=0,u=n.length;r<u;r++)t?i.push(this.getFrame(n[r])):i.push(this.getFrameByName(n[r]));return i},getFrameIndexes:function(n,t,i){var r,u;if(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=[]),typeof n=="undefined"||n.length===0)for(r=0,u=this._frames.length;r<u;r++)i.push(this._frames[r].index);else for(r=0,u=n.length;r<u;r++)t?i.push(n[r]):this.getFrameByName(n[r])&&i.push(this.getFrameByName(n[r]).index);return i}};n.FrameData.prototype.constructor=n.FrameData;Object.defineProperty(n.FrameData.prototype,"total",{get:function(){return this._frames.length}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.AnimationParser={spriteSheet:function(t,i,r,u,f,e,o){var a=t.cache.getImage(i),s,h,l,p;if(a==null)return null;s=a.width;h=a.height;r<=0&&(r=Math.floor(-s/Math.min(-1,r)));u<=0&&(u=Math.floor(-h/Math.min(-1,u)));var b=Math.floor((s-e)/(r+o)),k=Math.floor((h-e)/(u+o)),v=b*k;if(f!==-1&&(v=f),s===0||h===0||s<r||h<u||v===0)return console.warn("Phaser.AnimationParser.spriteSheet: '"+i+"'s width/height zero or width/height < given frameWidth/frameHeight"),null;var w=new n.FrameData,c=e,y=e;for(l=0;l<v;l++)p=t.rnd.uuid(),w.addFrame(new n.Frame(l,c,y,r,u,"",p)),PIXI.TextureCache[p]=new PIXI.Texture(PIXI.BaseTextureCache[i],{x:c,y:y,width:r,height:u}),c+=r+o,c+r>s&&(c=e,y+=u+o);return w},JSONData:function(t,i,r){var e,f,s,u,o;if(!i.frames){console.warn("Phaser.AnimationParser.JSONData: Invalid Texture Atlas JSON given, missing 'frames' array");console.log(i);return}for(e=new n.FrameData,f=i.frames,u=0;u<f.length;u++)o=t.rnd.uuid(),s=e.addFrame(new n.Frame(u,f[u].frame.x,f[u].frame.y,f[u].frame.w,f[u].frame.h,f[u].filename,o)),PIXI.TextureCache[o]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:f[u].frame.x,y:f[u].frame.y,width:f[u].frame.w,height:f[u].frame.h}),f[u].trimmed&&s.setTrim(f[u].trimmed,f[u].sourceSize.w,f[u].sourceSize.h,f[u].spriteSourceSize.x,f[u].spriteSourceSize.y,f[u].spriteSourceSize.w,f[u].spriteSourceSize.h);return e},JSONDataHash:function(t,i,r){var u,e;if(!i.frames){console.warn("Phaser.AnimationParser.JSONDataHash: Invalid Texture Atlas JSON given, missing 'frames' object");console.log(i);return}var o=new n.FrameData,f=i.frames,s,h=0;for(u in f)e=t.rnd.uuid(),s=o.addFrame(new n.Frame(h,f[u].frame.x,f[u].frame.y,f[u].frame.w,f[u].frame.h,u,e)),PIXI.TextureCache[e]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:f[u].frame.x,y:f[u].frame.y,width:f[u].frame.w,height:f[u].frame.h}),f[u].trimmed&&s.setTrim(f[u].trimmed,f[u].sourceSize.w,f[u].sourceSize.h,f[u].spriteSourceSize.x,f[u].spriteSourceSize.y,f[u].spriteSourceSize.w,f[u].spriteSourceSize.h),h++;return o},XMLData:function(t,i,r){var c,l,p,a,w,u,v,y,e,o,s,h,b,k,f;if(!i.getElementsByTagName("TextureAtlas")){console.warn("Phaser.AnimationParser.XMLData: Invalid Texture Atlas XML given, missing <TextureAtlas> tag");return}for(c=new n.FrameData,l=i.getElementsByTagName("SubTexture"),f=0;f<l.length;f++)a=t.rnd.uuid(),u=l[f].attributes,w=u.name.nodeValue,v=parseInt(u.x.nodeValue,10),y=parseInt(u.y.nodeValue,10),e=parseInt(u.width.nodeValue,10),o=parseInt(u.height.nodeValue,10),s=null,h=null,u.frameX&&(s=Math.abs(parseInt(u.frameX.nodeValue,10)),h=Math.abs(parseInt(u.frameY.nodeValue,10)),b=parseInt(u.frameWidth.nodeValue,10),k=parseInt(u.frameHeight.nodeValue,10)),p=c.addFrame(new n.Frame(f,v,y,e,o,w,a)),PIXI.TextureCache[a]=new PIXI.Texture(PIXI.BaseTextureCache[r],{x:v,y:y,width:e,height:o}),(s!==null||h!==null)&&p.setTrim(!0,e,o,s,h,b,k);return c}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Cache=function(t){this.game=t;this._canvases={};this._images={};this._textures={};this._sounds={};this._text={};this._json={};this._physics={};this._tilemaps={};this._binary={};this._bitmapDatas={};this._bitmapFont={};this.addDefaultImage();this.addMissingImage();this.onSoundUnlock=new n.Signal;this._cacheMap=[];this._cacheMap[n.Cache.CANVAS]=this._canvases;this._cacheMap[n.Cache.IMAGE]=this._images;this._cacheMap[n.Cache.TEXTURE]=this._textures;this._cacheMap[n.Cache.SOUND]=this._sounds;this._cacheMap[n.Cache.TEXT]=this._text;this._cacheMap[n.Cache.PHYSICS]=this._physics;this._cacheMap[n.Cache.TILEMAP]=this._tilemaps;this._cacheMap[n.Cache.BINARY]=this._binary;this._cacheMap[n.Cache.BITMAPDATA]=this._bitmapDatas;this._cacheMap[n.Cache.BITMAPFONT]=this._bitmapFont;this._cacheMap[n.Cache.JSON]=this._json};n.Cache.CANVAS=1;n.Cache.IMAGE=2;n.Cache.TEXTURE=3;n.Cache.SOUND=4;n.Cache.TEXT=5;n.Cache.PHYSICS=6;n.Cache.TILEMAP=7;n.Cache.BINARY=8;n.Cache.BITMAPDATA=9;n.Cache.BITMAPFONT=10;n.Cache.JSON=11;n.Cache.prototype={addCanvas:function(n,t,i){this._canvases[n]={canvas:t,context:i}},addBinary:function(n,t){this._binary[n]=t},addBitmapData:function(n,t){return this._bitmapDatas[n]=t,t},addRenderTexture:function(t,i){var r=new n.Frame(0,0,0,i.width,i.height,"","");this._textures[t]={texture:i,frame:r}},addSpriteSheet:function(t,i,r,u,f,e,o,s){this._images[t]={url:i,data:r,frameWidth:u,frameHeight:f,margin:o,spacing:s};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);this._images[t].frameData=n.AnimationParser.spriteSheet(this.game,t,u,f,e,o,s)},addTilemap:function(n,t,i,r){this._tilemaps[n]={url:t,data:i,format:r}},addTextureAtlas:function(t,i,r,u,f){this._images[t]={url:i,data:r};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);f==n.Loader.TEXTURE_ATLAS_JSON_ARRAY?this._images[t].frameData=n.AnimationParser.JSONData(this.game,u,t):f==n.Loader.TEXTURE_ATLAS_JSON_HASH?this._images[t].frameData=n.AnimationParser.JSONDataHash(this.game,u,t):f==n.Loader.TEXTURE_ATLAS_XML_STARLING&&(this._images[t].frameData=n.AnimationParser.XMLData(this.game,u,t))},addBitmapFont:function(t,i,r,u,f,e){this._images[t]={url:i,data:r};PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t]);n.LoaderParser.bitmapFont(this.game,u,t,f,e);this._bitmapFont[t]=PIXI.BitmapText.fonts[t]},addPhysicsData:function(n,t,i,r){this._physics[n]={url:t,data:i,format:r}},addDefaultImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgAQMAAABJtOi3AAAAA1BMVEX///+nxBvIAAAAAXRSTlMAQObYZgAAABVJREFUeF7NwIEAAAAAgKD9qdeocAMAoAABm3DkcAAAAABJRU5ErkJggg==";this._images.__default={url:null,data:t};this._images.__default.frame=new n.Frame(0,0,0,32,32,"","");this._images.__default.frameData=new n.FrameData;this._images.__default.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__default=new PIXI.BaseTexture(t);PIXI.TextureCache.__default=new PIXI.Texture(PIXI.BaseTextureCache.__default)},addMissingImage:function(){var t=new Image;t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAIAAAD8GO2jAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJ9JREFUeNq01ssOwyAMRFG46v//Mt1ESmgh+DFmE2GPOBARKb2NVjo+17PXLD8a1+pl5+A+wSgFygymWYHBb0FtsKhJDdZlncG2IzJ4ayoMDv20wTmSMzClEgbWYNTAkQ0Z+OJ+A/eWnAaR9+oxCF4Os0H8htsMUp+pwcgBBiMNnAwF8GqIgL2hAzaGFFgZauDPKABmowZ4GL369/0rwACp2yA/ttmvsQAAAABJRU5ErkJggg==";this._images.__missing={url:null,data:t};this._images.__missing.frame=new n.Frame(0,0,0,32,32,"","");this._images.__missing.frameData=new n.FrameData;this._images.__missing.frameData.addFrame(new n.Frame(0,0,0,32,32,null,this.game.rnd.uuid()));PIXI.BaseTextureCache.__missing=new PIXI.BaseTexture(t);PIXI.TextureCache.__missing=new PIXI.Texture(PIXI.BaseTextureCache.__missing)},addText:function(n,t,i){this._text[n]={url:t,data:i}},addJSON:function(n,t,i){this._json[n]={url:t,data:i}},addImage:function(t,i,r){this._images[t]={url:i,data:r};this._images[t].frame=new n.Frame(0,0,0,r.width,r.height,t,this.game.rnd.uuid());this._images[t].frameData=new n.FrameData;this._images[t].frameData.addFrame(new n.Frame(0,0,0,r.width,r.height,i,this.game.rnd.uuid()));PIXI.BaseTextureCache[t]=new PIXI.BaseTexture(r);PIXI.TextureCache[t]=new PIXI.Texture(PIXI.BaseTextureCache[t])},addSound:function(n,t,i,r,u){r=r||!0;u=u||!1;var f=!1;u&&(f=!0);this._sounds[n]={url:t,data:i,isDecoding:!1,decoded:f,webAudio:r,audioTag:u,locked:this.game.sound.touchLocked}},reloadSound:function(n){var t=this;this._sounds[n]&&(this._sounds[n].data.src=this._sounds[n].url,this._sounds[n].data.addEventListener("canplaythrough",function(){return t.reloadSoundComplete(n)},!1),this._sounds[n].data.load())},reloadSoundComplete:function(n){this._sounds[n]&&(this._sounds[n].locked=!1,this.onSoundUnlock.dispatch(n))},updateSound:function(n,t,i){this._sounds[n]&&(this._sounds[n][t]=i)},decodedSound:function(n,t){this._sounds[n].data=t;this._sounds[n].decoded=!0;this._sounds[n].isDecoding=!1},getCanvas:function(n){if(this._canvases[n])return this._canvases[n].canvas;console.warn('Phaser.Cache.getCanvas: Invalid key: "'+n+'"')},getBitmapData:function(n){if(this._bitmapDatas[n])return this._bitmapDatas[n];console.warn('Phaser.Cache.getBitmapData: Invalid key: "'+n+'"')},getBitmapFont:function(n){if(this._bitmapFont[n])return this._bitmapFont[n];console.warn('Phaser.Cache.getBitmapFont: Invalid key: "'+n+'"')},getPhysicsData:function(n,t,i){var r,u;if(typeof t=="undefined"||t===null){if(this._physics[n])return this._physics[n].data;console.warn('Phaser.Cache.getPhysicsData: Invalid key: "'+n+'"')}else if(this._physics[n]&&this._physics[n].data[t])if(r=this._physics[n].data[t],r&&i){for(u in r)if(u=r[u],u.fixtureKey===i)return u;console.warn('Phaser.Cache.getPhysicsData: Could not find given fixtureKey: "'+i+" in "+n+'"')}else return r;else console.warn('Phaser.Cache.getPhysicsData: Invalid key/object: "'+n+" / "+t+'"');return null},checkKey:function(n,t){return this._cacheMap[n][t]?!0:!1},checkCanvasKey:function(t){return this.checkKey(n.Cache.CANVAS,t)},checkImageKey:function(t){return this.checkKey(n.Cache.IMAGE,t)},checkTextureKey:function(t){return this.checkKey(n.Cache.TEXTURE,t)},checkSoundKey:function(t){return this.checkKey(n.Cache.SOUND,t)},checkTextKey:function(t){return this.checkKey(n.Cache.TEXT,t)},checkPhysicsKey:function(t){return this.checkKey(n.Cache.PHYSICS,t)},checkTilemapKey:function(t){return this.checkKey(n.Cache.TILEMAP,t)},checkBinaryKey:function(t){return this.checkKey(n.Cache.BINARY,t)},checkBitmapDataKey:function(t){return this.checkKey(n.Cache.BITMAPDATA,t)},checkBitmapFontKey:function(t){return this.checkKey(n.Cache.BITMAPFONT,t)},checkJSONKey:function(t){return this.checkKey(n.Cache.JSON,t)},getImage:function(n){return this._images[n]?this._images[n].data:(console.warn('Phaser.Cache.getImage: Invalid key: "'+n+'"'),null)},getTilemapData:function(n){if(this._tilemaps[n])return this._tilemaps[n];console.warn('Phaser.Cache.getTilemapData: Invalid key: "'+n+'"')},getFrameData:function(n){return this._images[n]?this._images[n].frameData:null},updateFrameData:function(n,t){this._images[n]&&(this._images[n].frameData=t)},getFrameByIndex:function(n,t){return this._images[n]?this._images[n].frameData.getFrame(t):null},getFrameByName:function(n,t){return this._images[n]?this._images[n].frameData.getFrameByName(t):null},getFrame:function(n){return this._images[n]?this._images[n].frame:null},getTextureFrame:function(n){return this._textures[n]?this._textures[n].frame:null},getTexture:function(n){if(this._textures[n])return this._textures[n];console.warn('Phaser.Cache.getTexture: Invalid key: "'+n+'"')},getSound:function(n){if(this._sounds[n])return this._sounds[n];console.warn('Phaser.Cache.getSound: Invalid key: "'+n+'"')},getSoundData:function(n){if(this._sounds[n])return this._sounds[n].data;console.warn('Phaser.Cache.getSoundData: Invalid key: "'+n+'"')},isSoundDecoded:function(n){if(this._sounds[n])return this._sounds[n].decoded},isSoundReady:function(n){return this._sounds[n]&&this._sounds[n].decoded&&this.game.sound.touchLocked===!1},getFrameCount:function(n){return this._images[n]?this._images[n].frameData.total:0},getText:function(n){if(this._text[n])return this._text[n].data;console.warn('Phaser.Cache.getText: Invalid key: "'+n+'"')},getJSON:function(n){if(this._json[n])return this._json[n].data;console.warn('Phaser.Cache.getJSON: Invalid key: "'+n+'"')},getBinary:function(n){if(this._binary[n])return this._binary[n];console.warn('Phaser.Cache.getBinary: Invalid key: "'+n+'"')},getKeys:function(t){var i=null,u,r;switch(t){case n.Cache.CANVAS:i=this._canvases;break;case n.Cache.IMAGE:i=this._images;break;case n.Cache.TEXTURE:i=this._textures;break;case n.Cache.SOUND:i=this._sounds;break;case n.Cache.TEXT:i=this._text;break;case n.Cache.PHYSICS:i=this._physics;break;case n.Cache.TILEMAP:i=this._tilemaps;break;case n.Cache.BINARY:i=this._binary;break;case n.Cache.BITMAPDATA:i=this._bitmapDatas;break;case n.Cache.BITMAPFONT:i=this._bitmapFont;break;case n.Cache.JSON:i=this._json}if(i){u=[];for(r in i)r!=="__default"&&r!=="__missing"&&u.push(r);return u}},removeCanvas:function(n){delete this._canvases[n]},removeImage:function(n){delete this._images[n]},removeSound:function(n){delete this._sounds[n]},removeText:function(n){delete this._text[n]},removeJSON:function(n){delete this._json[n]},removePhysics:function(n){delete this._physics[n]},removeTilemap:function(n){delete this._tilemaps[n]},removeBinary:function(n){delete this._binary[n]},removeBitmapData:function(n){delete this._bitmapDatas[n]},removeBitmapFont:function(n){delete this._bitmapFont[n]},destroy:function(){for(var n in this._canvases)delete this._canvases[n];for(n in this._images)n!=="__default"&&n!=="__missing"&&delete this._images[n];for(n in this._sounds)delete this._sounds[n];for(n in this._text)delete this._text[n];for(n in this._json)delete this._json[n];for(n in this._textures)delete this._textures[n];for(n in this._physics)delete this._physics[n];for(n in this._tilemaps)delete this._tilemaps[n];for(n in this._binary)delete this._binary[n];for(n in this._bitmapDatas)delete this._bitmapDatas[n];for(n in this._bitmapFont)delete this._bitmapFont[n]}};n.Cache.prototype.constructor=n.Cache;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Loader=function(t){this.game=t;this.isLoading=!1;this.hasLoaded=!1;this.progress=0;this.progressFloat=0;this.preloadSprite=null;this.crossOrigin=!1;this.baseURL="";this.onLoadStart=new n.Signal;this.onFileStart=new n.Signal;this.onFileComplete=new n.Signal;this.onFileError=new n.Signal;this.onLoadComplete=new n.Signal;this.onPackComplete=new n.Signal;this.useXDomainRequest=this.game.device.ieVersion===9;this._packList=[];this._packIndex=0;this._fileList=[];this._fileIndex=0;this._progressChunk=0;this._xhr=new XMLHttpRequest;this._ajax=null};n.Loader.TEXTURE_ATLAS_JSON_ARRAY=0;n.Loader.TEXTURE_ATLAS_JSON_HASH=1;n.Loader.TEXTURE_ATLAS_XML_STARLING=2;n.Loader.PHYSICS_LIME_CORONA_JSON=3;n.Loader.PHYSICS_PHASER_JSON=4;n.Loader.prototype={setPreloadSprite:function(t,i){i=i||0;this.preloadSprite={sprite:t,direction:i,width:t.width,height:t.height,rect:null};this.preloadSprite.rect=i===0?new n.Rectangle(0,0,1,t.height):new n.Rectangle(0,0,t.width,1);t.crop(this.preloadSprite.rect);t.visible=!0},checkKeyExists:function(n,t){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===n&&this._fileList[i].key===t)return!0;return!1},getAssetIndex:function(n,t){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===n&&this._fileList[i].key===t)return i;return-1},getAsset:function(n,t){if(this._fileList.length>0)for(var i=0;i<this._fileList.length;i++)if(this._fileList[i].type===n&&this._fileList[i].key===t)return{index:i,file:this._fileList[i]};return!1},reset:function(){this.preloadSprite=null;this.isLoading=!1;this._packList.length=0;this._packIndex=0;this._fileList.length=0;this._fileIndex=0},addToFileList:function(n,t,i,r){var f={type:n,key:t,url:i,data:null,error:!1,loaded:!1},u;if(typeof r!="undefined")for(u in r)f[u]=r[u];this.checkKeyExists(n,t)===!1&&this._fileList.push(f)},replaceInFileList:function(n,t,i,r){var u={type:n,key:t,url:i,data:null,error:!1,loaded:!1},f,e;if(typeof r!="undefined")for(f in r)u[f]=r[f];e=this.getAssetIndex(n,t);e===-1?this._fileList.push(u):this._fileList[e]=u},pack:function(n,t,i,r){return(typeof t=="undefined"&&(t=null),typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=this),t===null&&i===null)?(console.warn("Phaser.Loader.pack - Both url and data are null. One must be set."),this):(i&&typeof i=="string"&&(i=JSON.parse(i)),this._packList.push({key:n,url:t,data:i,loaded:!1,error:!1,callbackContext:r}),this)},image:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.replaceInFileList("image",n,t):this.addToFileList("image",n,t),this},text:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.replaceInFileList("text",n,t):this.addToFileList("text",n,t),this},json:function(n,t,i){return typeof i=="undefined"&&(i=!1),i?this.replaceInFileList("json",n,t):this.addToFileList("json",n,t),this},script:function(n,t,i,r){return typeof i=="undefined"&&(i=!1),i!==!1&&typeof r=="undefined"&&(r=i),this.addToFileList("script",n,t,{callback:i,callbackContext:r}),this},binary:function(n,t,i,r){return typeof i=="undefined"&&(i=!1),i!==!1&&typeof r=="undefined"&&(r=i),this.addToFileList("binary",n,t,{callback:i,callbackContext:r}),this},spritesheet:function(n,t,i,r,u,f,e){return typeof u=="undefined"&&(u=-1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),this.addToFileList("spritesheet",n,t,{frameWidth:i,frameHeight:r,frameMax:u,margin:f,spacing:e}),this},audio:function(n,t,i){return typeof i=="undefined"&&(i=!0),this.addToFileList("audio",n,t,{buffer:null,autoDecode:i}),this},tilemap:function(t,i,r,u){if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=n.Tilemap.CSV),i==null&&r==null)return console.warn("Phaser.Loader.tilemap - Both url and data are null. One must be set."),this;if(r){switch(u){case n.Tilemap.TILED_JSON:typeof r=="string"&&(r=JSON.parse(r))}this.game.cache.addTilemap(t,null,r,u)}else this.addToFileList("tilemap",t,i,{format:u});return this},physics:function(t,i,r,u){return(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=n.Physics.LIME_CORONA_JSON),i==null&&r==null)?(console.warn("Phaser.Loader.physics - Both url and data are null. One must be set."),this):(r?(typeof r=="string"&&(r=JSON.parse(r)),this.game.cache.addPhysicsData(t,null,r,u)):this.addToFileList("physics",t,i,{format:u}),this)},bitmapFont:function(n,t,i,r,u,f){var e,o;if(typeof i=="undefined"&&(i=null),typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=0),typeof f=="undefined"&&(f=0),i)this.addToFileList("bitmapfont",n,t,{xmlURL:i,xSpacing:u,ySpacing:f});else if(typeof r=="string"){try{window.DOMParser?(o=new DOMParser,e=o.parseFromString(r,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(r))}catch(s){e=undefined}if(e&&e.documentElement&&!e.getElementsByTagName("parsererror").length)this.addToFileList("bitmapfont",n,t,{xmlURL:null,xmlData:e,xSpacing:u,ySpacing:f});else throw new Error("Phaser.Loader. Invalid Bitmap Font XML given");}return this},atlasJSONArray:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_ARRAY)},atlasJSONHash:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_JSON_HASH)},atlasXML:function(t,i,r,u){return this.atlas(t,i,r,u,n.Loader.TEXTURE_ATLAS_XML_STARLING)},atlas:function(t,i,r,u,f){var e,o;if(typeof r=="undefined"&&(r=null),typeof u=="undefined"&&(u=null),typeof f=="undefined"&&(f=n.Loader.TEXTURE_ATLAS_JSON_ARRAY),r)this.addToFileList("textureatlas",t,i,{atlasURL:r,format:f});else{switch(f){case n.Loader.TEXTURE_ATLAS_JSON_ARRAY:typeof u=="string"&&(u=JSON.parse(u));break;case n.Loader.TEXTURE_ATLAS_XML_STARLING:if(typeof u=="string"){try{window.DOMParser?(o=new DOMParser,e=o.parseFromString(u,"text/xml")):(e=new ActiveXObject("Microsoft.XMLDOM"),e.async="false",e.loadXML(u))}catch(s){e=undefined}if(e&&e.documentElement&&!e.getElementsByTagName("parsererror").length)u=e;else throw new Error("Phaser.Loader. Invalid Texture Atlas XML given");}}this.addToFileList("textureatlas",t,i,{atlasURL:null,atlasData:u,format:f})}return this},removeFile:function(n,t){var i=this.getAsset(n,t);i!==!1&&this._fileList.splice(i.index,1)},removeAll:function(){this._fileList.length=0},start:function(){this.isLoading||(this._packList.length>0?(this._packIndex=0,this.loadPack()):this.beginLoad())},beginLoad:function(){this.progress=0;this.progressFloat=0;this.hasLoaded=!1;this.isLoading=!0;this.onLoadStart.dispatch(this._fileList.length);this._fileList.length>0?(this._fileIndex=0,this._progressChunk=100/this._fileList.length,this.loadFile()):(this.progress=100,this.progressFloat=100,this.hasLoaded=!0,this.isLoading=!1,this.onLoadComplete.dispatch())},loadPack:function(){if(!this._packList[this._packIndex]){console.warn("Phaser.Loader loadPackList invalid index "+this._packIndex);return}var n=this._packList[this._packIndex];n.data!==null?this.packLoadComplete(this._packIndex,!1):this.xhrLoad(this._packIndex,this.baseURL+n.url,"text","packLoadComplete","packLoadError")},packLoadComplete:function(t,i){var u,f,r,e;if(typeof i=="undefined"&&(i=!0),!this._packList[t]){console.warn("Phaser.Loader packLoadComplete invalid index "+t);return}if(u=this._packList[t],u.loaded=!0,f=i?JSON.parse(this._xhr.responseText):this._packList[t].data,f[u.key])for(e=0;e<f[u.key].length;e++){r=f[u.key][e];switch(r.type){case"image":this.image(r.key,r.url,r.overwrite);break;case"text":this.text(r.key,r.url,r.overwrite);break;case"json":this.json(r.key,r.url,r.overwrite);break;case"script":this.script(r.key,r.url,r.callback,u.callbackContext);break;case"binary":this.binary(r.key,r.url,r.callback,u.callbackContext);break;case"spritesheet":this.spritesheet(r.key,r.url,r.frameWidth,r.frameHeight,r.frameMax,r.margin,r.spacing);break;case"audio":this.audio(r.key,r.urls,r.autoDecode);break;case"tilemap":this.tilemap(r.key,r.url,r.data,n.Tilemap[r.format]);break;case"physics":this.physics(r.key,r.url,r.data,n.Loader[r.format]);break;case"bitmapFont":this.bitmapFont(r.key,r.textureURL,r.xmlURL,r.xmlData,r.xSpacing,r.ySpacing);break;case"atlasJSONArray":this.atlasJSONArray(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasJSONHash":this.atlasJSONHash(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlasXML":this.atlasXML(r.key,r.textureURL,r.atlasURL,r.atlasData);break;case"atlas":this.atlas(r.key,r.textureURL,r.atlasURL,r.atlasData,n.Loader[r.format])}}this.nextPack(t,!0)},packError:function(n){this._packList[n].loaded=!0;this._packList[n].error=!0;this.onFileError.dispatch(this._packList[n].key,this._packList[n]);console.warn("Phaser.Loader error loading pack file: "+this._packList[n].key+" from URL "+this._packList[n].url);this.nextPack(n,!1)},nextPack:function(n,t){this.onPackComplete.dispatch(this._packList[n].key,t,this.totalLoadedPacks(),this._packList.length);this._packIndex++;this._packIndex<this._packList.length?this.loadPack():this.beginLoad()},loadFile:function(){if(!this._fileList[this._fileIndex]){console.warn("Phaser.Loader loadFile invalid index "+this._fileIndex);return}var t=this._fileList[this._fileIndex],i=this;this.onFileStart.dispatch(this.progress,t.key);switch(t.type){case"image":case"spritesheet":case"textureatlas":case"bitmapfont":t.data=new Image;t.data.name=t.key;t.data.onload=function(){return i.fileComplete(i._fileIndex)};t.data.onerror=function(){return i.fileError(i._fileIndex)};this.crossOrigin&&(t.data.crossOrigin=this.crossOrigin);t.data.src=this.baseURL+t.url;break;case"audio":t.url=this.getAudioURL(t.url);t.url!==null?this.game.sound.usingWebAudio?this.xhrLoad(this._fileIndex,this.baseURL+t.url,"arraybuffer","fileComplete","fileError"):this.game.sound.usingAudioTag&&(this.game.sound.touchLocked?(t.data=new Audio,t.data.name=t.key,t.data.preload="auto",t.data.src=this.baseURL+t.url,this.fileComplete(this._fileIndex)):(t.data=new Audio,t.data.name=t.key,t.data.onerror=function(){return i.fileError(i._fileIndex)},t.data.preload="auto",t.data.src=this.baseURL+t.url,t.data.addEventListener("canplaythrough",n.GAMES[this.game.id].load.fileComplete(this._fileIndex),!1),t.data.load())):this.fileError(this._fileIndex);break;case"json":this.useXDomainRequest&&window.XDomainRequest?(this._ajax=new window.XDomainRequest,this._ajax.timeout=3e3,this._ajax.onerror=function(){return i.dataLoadError(i._fileIndex)},this._ajax.ontimeout=function(){return i.dataLoadError(i._fileIndex)},this._ajax.onprogress=function(){},this._ajax.onload=function(){return i.jsonLoadComplete(i._fileIndex)},this._ajax.open("GET",this.baseURL+t.url,!0),setTimeout(function(){this._ajax.send()},0)):this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","jsonLoadComplete","dataLoadError");break;case"tilemap":if(t.format===n.Tilemap.TILED_JSON)this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","jsonLoadComplete","dataLoadError");else if(t.format===n.Tilemap.CSV)this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","csvLoadComplete","dataLoadError");else throw new Error("Phaser.Loader. Invalid Tilemap format: "+t.format);break;case"text":case"script":case"physics":this.xhrLoad(this._fileIndex,this.baseURL+t.url,"text","fileComplete","fileError");break;case"binary":this.xhrLoad(this._fileIndex,this.baseURL+t.url,"arraybuffer","fileComplete","fileError")}},xhrLoad:function(n,t,i,r,u){this._xhr.open("GET",t,!0);this._xhr.responseType=i;var f=this;this._xhr.onload=function(){return f[r](n)};this._xhr.onerror=function(){return f[u](n)};this._xhr.send()},getAudioURL:function(n){var t,i;for(typeof n=="string"&&(n=[n]),i=0;i<n.length;i++)if(t=n[i].toLowerCase(),t=t.substr((Math.max(0,t.lastIndexOf("."))||Infinity)+1),this.game.device.canPlayAudio(t))return n[i];return null},fileError:function(n){this._fileList[n].loaded=!0;this._fileList[n].error=!0;this.onFileError.dispatch(this._fileList[n].key,this._fileList[n]);console.warn("Phaser.Loader error loading file: "+this._fileList[n].key+" from URL "+this._fileList[n].url);this.nextFile(n,!1)},fileComplete:function(t){var i,u,f,r,e;if(!this._fileList[t]){console.warn("Phaser.Loader fileComplete invalid index "+t);return}i=this._fileList[t];i.loaded=!0;u=!0;switch(i.type){case"image":this.game.cache.addImage(i.key,i.url,i.data);break;case"spritesheet":this.game.cache.addSpriteSheet(i.key,i.url,i.data,i.frameWidth,i.frameHeight,i.frameMax,i.margin,i.spacing);break;case"textureatlas":if(i.atlasURL==null)this.game.cache.addTextureAtlas(i.key,i.url,i.data,i.atlasData,i.format);else if(u=!1,i.format==n.Loader.TEXTURE_ATLAS_JSON_ARRAY||i.format==n.Loader.TEXTURE_ATLAS_JSON_HASH)this.xhrLoad(this._fileIndex,this.baseURL+i.atlasURL,"text","jsonLoadComplete","dataLoadError");else if(i.format==n.Loader.TEXTURE_ATLAS_XML_STARLING)this.xhrLoad(this._fileIndex,this.baseURL+i.atlasURL,"text","xmlLoadComplete","dataLoadError");else throw new Error("Phaser.Loader. Invalid Texture Atlas format: "+i.format);break;case"bitmapfont":i.xmlURL==null?this.game.cache.addBitmapFont(i.key,i.url,i.data,i.xmlData,i.xSpacing,i.ySpacing):(u=!1,this.xhrLoad(this._fileIndex,this.baseURL+i.xmlURL,"text","xmlLoadComplete","dataLoadError"));break;case"audio":this.game.sound.usingWebAudio?(i.data=this._xhr.response,this.game.cache.addSound(i.key,i.url,i.data,!0,!1),i.autoDecode&&(f=this,r=i.key,this.game.cache.updateSound(r,"isDecoding",!0),this.game.sound.context.decodeAudioData(i.data,function(n){n&&(f.game.cache.decodedSound(r,n),f.game.sound.onSoundDecode.dispatch(r,f.game.cache.getSound(r)))}))):(i.data.removeEventListener("canplaythrough",n.GAMES[this.game.id].load.fileComplete),this.game.cache.addSound(i.key,i.url,i.data,!1,!0));break;case"text":i.data=this._xhr.responseText;this.game.cache.addText(i.key,i.url,i.data);break;case"physics":e=JSON.parse(this._xhr.responseText);this.game.cache.addPhysicsData(i.key,i.url,e,i.format);break;case"script":i.data=document.createElement("script");i.data.language="javascript";i.data.type="text/javascript";i.data.defer=!1;i.data.text=this._xhr.responseText;document.head.appendChild(i.data);i.callback&&(i.data=i.callback.call(i.callbackContext,i.key,this._xhr.responseText));break;case"binary":i.data=i.callback?i.callback.call(i.callbackContext,i.key,this._xhr.response):this._xhr.response;this.game.cache.addBinary(i.key,i.data)}u&&this.nextFile(t,!0)},jsonLoadComplete:function(n){var t,i;if(!this._fileList[n]){console.warn("Phaser.Loader jsonLoadComplete invalid index "+n);return}t=this._fileList[n];i=this._ajax&&this._ajax.responseText?JSON.parse(this._ajax.responseText):JSON.parse(this._xhr.responseText);t.loaded=!0;t.type==="tilemap"?this.game.cache.addTilemap(t.key,t.url,i,t.format):t.type==="json"?this.game.cache.addJSON(t.key,t.url,i):this.game.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format);this.nextFile(n,!0)},csvLoadComplete:function(n){if(!this._fileList[n]){console.warn("Phaser.Loader csvLoadComplete invalid index "+n);return}var t=this._fileList[n],i=this._xhr.responseText;t.loaded=!0;this.game.cache.addTilemap(t.key,t.url,i,t.format);this.nextFile(n,!0)},dataLoadError:function(n){var t=this._fileList[n];t.loaded=!0;t.error=!0;console.warn("Phaser.Loader dataLoadError: "+t.key);this.nextFile(n,!0)},xmlLoadComplete:function(n){var r=this._xhr.responseText,i,u,t;try{window.DOMParser?(u=new DOMParser,i=u.parseFromString(r,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(r))}catch(f){i=undefined}if(!i||!i.documentElement||i.getElementsByTagName("parsererror").length)throw new Error("Phaser.Loader. Invalid XML given");t=this._fileList[n];t.loaded=!0;t.type=="bitmapfont"?this.game.cache.addBitmapFont(t.key,t.url,t.data,i,t.xSpacing,t.ySpacing):t.type=="textureatlas"&&this.game.cache.addTextureAtlas(t.key,t.url,t.data,i,t.format);this.nextFile(n,!0)},nextFile:function(n,t){this.progressFloat+=this._progressChunk;this.progress=Math.round(this.progressFloat);this.progress>100&&(this.progress=100);this.preloadSprite!==null&&(this.preloadSprite.direction===0?this.preloadSprite.rect.width=Math.floor(this.preloadSprite.width/100*this.progress):this.preloadSprite.rect.height=Math.floor(this.preloadSprite.height/100*this.progress),this.preloadSprite.sprite.updateCrop());this.onFileComplete.dispatch(this.progress,this._fileList[n].key,t,this.totalLoadedFiles(),this._fileList.length);this.totalQueuedFiles()>0?(this._fileIndex++,this.loadFile()):(this.hasLoaded=!0,this.isLoading=!1,this.removeAll(),this.onLoadComplete.dispatch())},totalLoadedFiles:function(){for(var t=0,n=0;n<this._fileList.length;n++)this._fileList[n].loaded&&t++;return t},totalQueuedFiles:function(){for(var t=0,n=0;n<this._fileList.length;n++)this._fileList[n].loaded===!1&&t++;return t},totalLoadedPacks:function(){for(var t=0,n=0;n<this._packList.length;n++)this._packList[n].loaded&&t++;return t},totalQueuedPacks:function(){for(var t=0,n=0;n<this._packList.length;n++)this._packList[n].loaded===!1&&t++;return t}};n.Loader.prototype.constructor=n.Loader;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.LoaderParser={bitmapFont:function(n,t,i,r,u){var o={},h=t.getElementsByTagName("info")[0],a=t.getElementsByTagName("common")[0],e,f,c,l,s;for(o.font=h.getAttribute("face"),o.size=parseInt(h.getAttribute("size"),10),o.lineHeight=parseInt(a.getAttribute("lineHeight"),10)+u,o.chars={},e=t.getElementsByTagName("char"),f=0;f<e.length;f++)c=parseInt(e[f].getAttribute("id"),10),l=new PIXI.Rectangle(parseInt(e[f].getAttribute("x"),10),parseInt(e[f].getAttribute("y"),10),parseInt(e[f].getAttribute("width"),10),parseInt(e[f].getAttribute("height"),10)),o.chars[c]={xOffset:parseInt(e[f].getAttribute("xoffset"),10),yOffset:parseInt(e[f].getAttribute("yoffset"),10),xAdvance:parseInt(e[f].getAttribute("xadvance"),10)+r,kerning:{},texture:PIXI.TextureCache[i]=new PIXI.Texture(PIXI.BaseTextureCache[i],l)};for(s=t.getElementsByTagName("kerning"),f=0;f<s.length;f++){var v=parseInt(s[f].getAttribute("first"),10),y=parseInt(s[f].getAttribute("second"),10),p=parseInt(s[f].getAttribute("amount"),10);o.chars[y].kerning[v]=p}PIXI.BitmapText.fonts[i]=o}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Sound=function(t,i,r,u,f){typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=!1);typeof f=="undefined"&&(f=t.sound.connectToMaster);this.game=t;this.name=i;this.key=i;this.loop=u;this.volume=r;this.markers={};this.context=null;this.autoplay=!1;this.totalDuration=0;this.startTime=0;this.currentTime=0;this.duration=0;this.durationMS=0;this.position=0;this.stopTime=0;this.paused=!1;this.pausedPosition=0;this.pausedTime=0;this.isPlaying=!1;this.currentMarker="";this.pendingPlayback=!1;this.override=!1;this.usingWebAudio=this.game.sound.usingWebAudio;this.usingAudioTag=this.game.sound.usingAudioTag;this.externalNode=null;this.masterGainNode=null;this.gainNode=null;this.usingWebAudio?(this.context=this.game.sound.context,this.masterGainNode=this.game.sound.masterGain,this.gainNode=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.gainNode.gain.value=r*this.game.sound.volume,f&&this.gainNode.connect(this.masterGainNode)):this.game.cache.getSound(i)&&this.game.cache.isSoundReady(i)?(this._sound=this.game.cache.getSoundData(i),this.totalDuration=0,this._sound.duration&&(this.totalDuration=this._sound.duration)):this.game.cache.onSoundUnlock.add(this.soundHasUnlocked,this);this.onDecoded=new n.Signal;this.onPlay=new n.Signal;this.onPause=new n.Signal;this.onResume=new n.Signal;this.onLoop=new n.Signal;this.onStop=new n.Signal;this.onMute=new n.Signal;this.onMarkerComplete=new n.Signal;this._volume=r;this._buffer=null;this._muted=!1;this._tempMarker=0;this._tempPosition=0;this._tempVolume=0;this._muteVolume=0;this._tempLoop=0;this._paused=!1;this._onDecodedEventDispatched=!1};n.Sound.prototype={soundHasUnlocked:function(n){n===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this._sound.duration)},addMarker:function(n,t,i,r,u){typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=!1);this.markers[n]={name:n,start:t,stop:t+i,volume:r,duration:i,durationMS:i*1e3,loop:u}},removeMarker:function(n){delete this.markers[n]},update:function(){this.isDecoded&&!this._onDecodedEventDispatched&&(this.onDecoded.dispatch(this),this._onDecodedEventDispatched=!0);this.pendingPlayback&&this.game.cache.isSoundReady(this.key)&&(this.pendingPlayback=!1,this.play(this._tempMarker,this._tempPosition,this._tempVolume,this._tempLoop));this.isPlaying&&(this.currentTime=this.game.time.now-this.startTime,this.currentTime>=this.durationMS&&(this.usingWebAudio?this.loop?(this.onLoop.dispatch(this),this.currentMarker===""?(this.currentTime=0,this.startTime=this.game.time.now):(this.onMarkerComplete.dispatch(this.currentMarker,this),this.play(this.currentMarker,0,this.volume,!0,!0))):this.stop():this.loop?(this.onLoop.dispatch(this),this.play(this.currentMarker,0,this.volume,!0,!0)):this.stop()))},play:function(n,t,i,r,u){if(typeof n=="undefined"&&(n=""),typeof u=="undefined"&&(u=!0),this.isPlaying&&!u&&!this.override)return this;if(this.isPlaying&&(this.override||u)&&(this.usingWebAudio?typeof this._sound.stop=="undefined"?this._sound.noteOff(0):this._sound.stop(0):this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0)),this.currentMarker=n,n!=="")if(this.markers[n])this.position=this.markers[n].start,this.volume=this.markers[n].volume,this.loop=this.markers[n].loop,this.duration=this.markers[n].duration,this.durationMS=this.markers[n].durationMS,typeof i!="undefined"&&(this.volume=i),typeof r!="undefined"&&(this.loop=r),this._tempMarker=n,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop;else return console.warn("Phaser.Sound.play: audio marker "+n+" doesn't exist"),this;else t=t||0,typeof i=="undefined"&&(i=this._volume),typeof r=="undefined"&&(r=this.loop),this.position=t,this.volume=i,this.loop=r,this.duration=0,this.durationMS=0,this._tempMarker=n,this._tempPosition=t,this._tempVolume=i,this._tempLoop=r;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(this._buffer===null&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode),this.totalDuration=this._sound.buffer.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this.loop&&n===""&&(this._sound.loop=!0),typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,this.position,this.duration):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||this._sound.readyState===4)?(this._sound.play(),this.totalDuration=this._sound.duration,this.duration===0&&(this.duration=this.totalDuration,this.durationMS=this.totalDuration*1e3),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.now,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},restart:function(n,t,i,r){n=n||"";t=t||0;i=i||1;typeof r=="undefined"&&(r=!1);this.play(n,t,i,r,!0)},pause:function(){this.isPlaying&&this._sound&&(this.paused=!0,this.pausedPosition=this.currentTime,this.pausedTime=this.game.time.now,this.onPause.dispatch(this),this.stop())},resume:function(){if(this.paused&&this._sound){if(this.usingWebAudio){var n=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource();this._sound.buffer=this._buffer;this.externalNode?this._sound.connect(this.externalNode):this._sound.connect(this.gainNode);this.loop&&(this._sound.loop=!0);typeof this._sound.start=="undefined"?this._sound.noteGrainOn(0,n,this.duration):this._sound.start(0,n,this.duration)}else this._sound.play();this.isPlaying=!0;this.paused=!1;this.startTime+=this.game.time.now-this.pausedTime;this.onResume.dispatch(this)}},stop:function(){if(this.isPlaying&&this._sound)if(this.usingWebAudio)if(typeof this._sound.stop=="undefined")this._sound.noteOff(0);else try{this._sound.stop(0)}catch(t){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);this.isPlaying=!1;var n=this.currentMarker;this.currentMarker!==""&&this.onMarkerComplete.dispatch(this.currentMarker,this);this.currentMarker="";this.paused||this.onStop.dispatch(this,n)},destroy:function(n){typeof n=="undefined"&&(n=!0);this.stop();n?this.game.sound.remove(this):(this.markers={},this.context=null,this._buffer=null,this.externalNode=null,this.onDecoded.dispose(),this.onPlay.dispose(),this.onPause.dispose(),this.onResume.dispose(),this.onLoop.dispose(),this.onStop.dispose(),this.onMute.dispose(),this.onMarkerComplete.dispose())}};n.Sound.prototype.constructor=n.Sound;Object.defineProperty(n.Sound.prototype,"isDecoding",{get:function(){return this.game.cache.getSound(this.key).isDecoding}});Object.defineProperty(n.Sound.prototype,"isDecoded",{get:function(){return this.game.cache.isSoundDecoded(this.key)}});Object.defineProperty(n.Sound.prototype,"mute",{get:function(){return this._muted||this.game.sound.mute},set:function(n){n=n||null;n?(this._muted=!0,this.usingWebAudio?(this._muteVolume=this.gainNode.gain.value,this.gainNode.gain.value=0):this.usingAudioTag&&this._sound&&(this._muteVolume=this._sound.volume,this._sound.volume=0)):(this._muted=!1,this.usingWebAudio?this.gainNode.gain.value=this._muteVolume:this.usingAudioTag&&this._sound&&(this._sound.volume=this._muteVolume));this.onMute.dispatch(this)}});Object.defineProperty(n.Sound.prototype,"volume",{get:function(){return this._volume},set:function(n){this.usingWebAudio?(this._volume=n,this.gainNode.gain.value=n):this.usingAudioTag&&this._sound&&n>=0&&n<=1&&(this._volume=n,this._sound.volume=n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.SoundManager=function(t){this.game=t;this.onSoundDecode=new n.Signal;this._codeMuted=!1;this._muted=!1;this._unlockSource=null;this._volume=1;this._sounds=[];this.context=null;this.usingWebAudio=!0;this.usingAudioTag=!1;this.noAudio=!1;this.connectToMaster=!0;this.touchLocked=!1;this.channels=32};n.SoundManager.prototype={boot:function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),!this.game.device.cocoonJS&&this.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(this.game.input.touch.callbackContext=this,this.game.input.touch.touchStartCallback=this.unlock,this.game.input.mouse.callbackContext=this,this.game.input.mouse.mouseDownCallback=this.unlock,this.touchLocked=!0):this.touchLocked=!1,window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0){this.usingWebAudio=!1;this.noAudio=!0;return}if(window.PhaserGlobal.disableWebAudio===!0){this.usingWebAudio=!1;this.usingAudioTag=!0;this.noAudio=!1;return}}if(!window.AudioContext){if(!!window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(n){this.context=null;this.usingWebAudio=!1;this.noAudio=!0}}else try{this.context=new window.AudioContext}catch(n){this.context=null;this.usingWebAudio=!1;this.noAudio=!0}!window.Audio||this.context!==null||(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1);this.context!==null&&(this.masterGain=typeof this.context.createGain=="undefined"?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},unlock:function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null,this.game.input.mouse.callbackContext=null,this.game.input.mouse.mouseDownCallback=null;else{var n=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource();this._unlockSource.buffer=n;this._unlockSource.connect(this.context.destination);this._unlockSource.noteOn(0)}},stopAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].stop()},pauseAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].pause()},resumeAll:function(){for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].resume()},decode:function(n,t){var i,r;t=t||null;i=this.game.cache.getSoundData(n);i&&this.game.cache.isSoundDecoded(n)===!1&&(this.game.cache.updateSound(n,"isDecoding",!0),r=this,this.context.decodeAudioData(i,function(i){r.game.cache.decodedSound(n,i);t&&r.onSoundDecode.dispatch(n,t)}))},update:function(){this.touchLocked&&this.game.device.webAudio&&this._unlockSource!==null&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input.touch.callbackContext=null,this.game.input.touch.touchStartCallback=null);for(var n=0;n<this._sounds.length;n++)this._sounds[n].update()},add:function(t,i,r,u){typeof i=="undefined"&&(i=1);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=this.connectToMaster);var f=new n.Sound(this.game,t,i,r,u);return this._sounds.push(f),f},remove:function(n){for(var t=this._sounds.length;t--;)if(this._sounds[t]===n)return this._sounds[t].destroy(!1),this._sounds.splice(t,1),!0;return!1},removeByKey:function(n){for(var t=this._sounds.length,i=0;t--;)this._sounds[t].key===n&&(this._sounds[t].destroy(!1),this._sounds.splice(t,1),i++);return i},play:function(n,t,i){var r=this.add(n,t,i);return r.play(),r},setMute:function(){if(!this._muted){this._muted=!0;this.usingWebAudio&&(this._muteVolume=this.masterGain.gain.value,this.masterGain.gain.value=0);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!0)}},unsetMute:function(){if(this._muted&&!this._codeMuted){this._muted=!1;this.usingWebAudio&&(this.masterGain.gain.value=this._muteVolume);for(var n=0;n<this._sounds.length;n++)this._sounds[n].usingAudioTag&&(this._sounds[n].mute=!1)}},destroy:function(){this.stopAll();for(var n=0;n<this._sounds.length;n++)this._sounds[n]&&this._sounds[n].destroy();this._sounds=[];this.onSoundDecode.dispose()}};n.SoundManager.prototype.constructor=n.SoundManager;Object.defineProperty(n.SoundManager.prototype,"mute",{get:function(){return this._muted},set:function(n){if(n=n||null,n){if(this._muted)return;this._codeMuted=!0;this.setMute()}else{if(!this._muted)return;this._codeMuted=!1;this.unsetMute()}}});Object.defineProperty(n.SoundManager.prototype,"volume",{get:function(){return this.usingWebAudio?this.masterGain.gain.value:this._volume},set:function(n){if(this._volume=n,this.usingWebAudio)this.masterGain.gain.value=n;else for(var t=0;t<this._sounds.length;t++)this._sounds[t].usingAudioTag&&(this._sounds[t].volume=this._sounds[t].volume*n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Utils.Debug=function(n){this.game=n;this.sprite=null;this.canvas=null;this.baseTexture=null;this.texture=null;this.textureFrame=null;this.context=null;this.font="14px Courier";this.columnWidth=100;this.lineHeight=16;this.renderShadow=!0;this.currentX=0;this.currentY=0;this.currentAlpha=1;this.dirty=!1};n.Utils.Debug.prototype={boot:function(){this.game.renderType===n.CANVAS?this.context=this.game.context:(this.canvas=n.Canvas.create(this.game.width,this.game.height,"",!0),this.context=this.canvas.getContext("2d"),this.baseTexture=new PIXI.BaseTexture(this.canvas),this.texture=new PIXI.Texture(this.baseTexture),this.textureFrame=new n.Frame(0,0,0,this.game.width,this.game.height,"debug",this.game.rnd.uuid()),this.sprite=this.game.make.image(0,0,this.texture,this.textureFrame),this.game.stage.addChild(this.sprite))},preUpdate:function(){this.dirty&&this.sprite&&(this.context.clearRect(0,0,this.game.width,this.game.height),this.dirty=!1)},reset:function(){this.context&&this.context.clearRect(0,0,this.game.width,this.game.height);this.sprite&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)},start:function(n,t,i,r){typeof n!="number"&&(n=0);typeof t!="number"&&(t=0);i=i||"rgb(255,255,255)";typeof r=="undefined"&&(r=0);this.currentX=n;this.currentY=t;this.currentColor=i;this.currentAlpha=this.context.globalAlpha;this.columnWidth=r;this.sprite&&(this.dirty=!0);this.context.save();this.context.setTransform(1,0,0,1,0,0);this.context.strokeStyle=i;this.context.fillStyle=i;this.context.font=this.font;this.context.globalAlpha=1},stop:function(){this.context.restore();this.context.globalAlpha=this.currentAlpha;this.sprite&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl)},line:function(){for(var t=this.currentX,n=0;n<arguments.length;n++)this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(arguments[n],t+1,this.currentY+1),this.context.fillStyle=this.currentColor),this.context.fillText(arguments[n],t,this.currentY),t+=this.columnWidth;this.currentY+=this.lineHeight},soundInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sound: "+n.key+" Locked: "+n.game.sound.touchLocked);this.line("Is Ready?: "+this.game.cache.isSoundReady(n.key)+" Pending Playback: "+n.pendingPlayback);this.line("Decoded: "+n.isDecoded+" Decoding: "+n.isDecoding);this.line("Total Duration: "+n.totalDuration+" Playing: "+n.isPlaying);this.line("Time: "+n.currentTime);this.line("Volume: "+n.volume+" Muted: "+n.mute);this.line("WebAudio: "+n.usingWebAudio+" Audio: "+n.usingAudioTag);n.currentMarker!==""&&(this.line("Marker: "+n.currentMarker+" Duration: "+n.duration+" (ms: "+n.durationMS+")"),this.line("Start: "+n.markers[n.currentMarker].start+" Stop: "+n.markers[n.currentMarker].stop),this.line("Position: "+n.position));this.stop()},cameraInfo:function(n,t,i,r){this.start(t,i,r);this.line("Camera ("+n.width+" x "+n.height+")");this.line("X: "+n.x+" Y: "+n.y);n.bounds&&this.line("Bounds x: "+n.bounds.x+" Y: "+n.bounds.y+" w: "+n.bounds.width+" h: "+n.bounds.height);this.line("View x: "+n.view.x+" Y: "+n.view.y+" w: "+n.view.width+" h: "+n.view.height);this.stop()},timer:function(n,t,i,r){this.start(t,i,r);this.line("Timer (running: "+n.running+" expired: "+n.expired+")");this.line("Next Tick: "+n.next+" Duration: "+n.duration);this.line("Paused: "+n.paused+" Length: "+n.length);this.stop()},pointer:function(n,t,i,r,u){n!=null&&(typeof t=="undefined"&&(t=!1),i=i||"rgba(0,255,0,0.5)",r=r||"rgba(255,0,0,0.5)",t!==!0||n.isUp!==!0)&&(this.start(n.x,n.y-100,u),this.context.beginPath(),this.context.arc(n.x,n.y,n.circle.radius,0,Math.PI*2),this.context.fillStyle=n.active?i:r,this.context.fill(),this.context.closePath(),this.context.beginPath(),this.context.moveTo(n.positionDown.x,n.positionDown.y),this.context.lineTo(n.position.x,n.position.y),this.context.lineWidth=2,this.context.stroke(),this.context.closePath(),this.line("ID: "+n.id+" Active: "+n.active),this.line("World X: "+n.worldX+" World Y: "+n.worldY),this.line("Screen X: "+n.x+" Screen Y: "+n.y),this.line("Duration: "+n.duration+" ms"),this.line("is Down: "+n.isDown+" is Up: "+n.isUp),this.stop())},spriteInputInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite Input: ("+n.width+" x "+n.height+")");this.line("x: "+n.input.pointerX().toFixed(1)+" y: "+n.input.pointerY().toFixed(1));this.line("over: "+n.input.pointerOver()+" duration: "+n.input.overDuration().toFixed(0));this.line("down: "+n.input.pointerDown()+" duration: "+n.input.downDuration().toFixed(0));this.line("just over: "+n.input.justOver()+" just out: "+n.input.justOut());this.stop()},key:function(n,t,i,r){this.start(t,i,r,150);this.line("Key:",n.keyCode,"isDown:",n.isDown);this.line("justPressed:",n.justPressed(),"justReleased:",n.justReleased());this.line("Time Down:",n.timeDown.toFixed(0),"duration:",n.duration.toFixed(0));this.stop()},inputInfo:function(n,t,i){this.start(n,t,i);this.line("Input");this.line("X: "+this.game.input.x+" Y: "+this.game.input.y);this.line("World X: "+this.game.input.worldX+" World Y: "+this.game.input.worldY);this.line("Scale X: "+this.game.input.scale.x.toFixed(1)+" Scale Y: "+this.game.input.scale.x.toFixed(1));this.line("Screen X: "+this.game.input.activePointer.screenX+" Screen Y: "+this.game.input.activePointer.screenY);this.stop()},spriteBounds:function(n,t,i){var r=n.getBounds();r.x+=this.game.camera.x;r.y+=this.game.camera.y;this.rectangle(r,t,i)},ropeSegments:function(n,t,i){var r=n.segments;r.forEach(function(n){this.rectangle(n,t,i)},this)},spriteInfo:function(n,t,i,r){this.start(t,i,r);this.line("Sprite:  ("+n.width+" x "+n.height+") anchor: "+n.anchor.x+" x "+n.anchor.y);this.line("x: "+n.x.toFixed(1)+" y: "+n.y.toFixed(1));this.line("angle: "+n.angle.toFixed(1)+" rotation: "+n.rotation.toFixed(1));this.line("visible: "+n.visible+" in camera: "+n.inCamera);this.stop()},spriteCoords:function(n,t,i,r){this.start(t,i,r,100);n.name&&this.line(n.name);this.line("x:",n.x.toFixed(2),"y:",n.y.toFixed(2));this.line("pos x:",n.position.x.toFixed(2),"pos y:",n.position.y.toFixed(2));this.line("world x:",n.world.x.toFixed(2),"world y:",n.world.y.toFixed(2));this.stop()},lineInfo:function(n,t,i,r){this.start(t,i,r,80);this.line("start.x:",n.start.x.toFixed(2),"start.y:",n.start.y.toFixed(2));this.line("end.x:",n.end.x.toFixed(2),"end.y:",n.end.y.toFixed(2));this.line("length:",n.length.toFixed(2),"angle:",n.angle);this.stop()},pixel:function(n,t,i,r){r=r||2;this.start();this.context.fillStyle=i;this.context.fillRect(n,t,r,r);this.stop()},geom:function(t,i,r,u){typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=0);i=i||"rgba(0,255,0,0.4)";this.start();this.context.fillStyle=i;this.context.strokeStyle=i;t instanceof n.Rectangle||u===1?r?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):this.context.strokeRect(t.x-this.game.camera.x,t.y-this.game.camera.y,t.width,t.height):t instanceof n.Circle||u===2?(this.context.beginPath(),this.context.arc(t.x-this.game.camera.x,t.y-this.game.camera.y,t.radius,0,Math.PI*2,!1),this.context.closePath(),r?this.context.fill():this.context.stroke()):t instanceof n.Point||u===3?this.context.fillRect(t.x-this.game.camera.x,t.y-this.game.camera.y,4,4):(t instanceof n.Line||u===4)&&(this.context.lineWidth=1,this.context.beginPath(),this.context.moveTo(t.start.x+.5-this.game.camera.x,t.start.y+.5-this.game.camera.y),this.context.lineTo(t.end.x+.5-this.game.camera.x,t.end.y+.5-this.game.camera.y),this.context.closePath(),this.context.stroke());this.stop()},rectangle:function(n,t,i){typeof i=="undefined"&&(i=!0);t=t||"rgba(0, 255, 0, 0.4)";this.start();i?(this.context.fillStyle=t,this.context.fillRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height)):(this.context.strokeStyle=t,this.context.strokeRect(n.x-this.game.camera.x,n.y-this.game.camera.y,n.width,n.height));this.stop()},text:function(n,t,i,r,u){r=r||"rgb(255,255,255)";u=u||"16px Courier";this.start();this.context.font=u;this.renderShadow&&(this.context.fillStyle="rgb(0,0,0)",this.context.fillText(n,t+1,i+1));this.context.fillStyle=r;this.context.fillText(n,t,i);this.stop()},quadTree:function(n,t){var r,i;if(t=t||"rgba(255,0,0,0.3)",this.start(),r=n.bounds,n.nodes.length===0)for(this.context.strokeStyle=t,this.context.strokeRect(r.x,r.y,r.width,r.height),this.text("size: "+n.objects.length,r.x+4,r.y+16,"rgb(0,200,0)","12px Courier"),this.context.strokeStyle="rgb(0,255,0)",i=0;i<n.objects.length;i++)this.context.strokeRect(n.objects[i].x,n.objects[i].y,n.objects[i].width,n.objects[i].height);else for(i=0;i<n.nodes.length;i++)this.quadTree(n.nodes[i]);this.stop()},body:function(t,i,r){t.body&&(t.body.type===n.Physics.ARCADE?(this.start(),n.Physics.Arcade.Body.render(this.context,t.body,i,r),this.stop()):t.body.type===n.Physics.NINJA&&(this.start(),n.Physics.Ninja.Body.render(this.context,t.body,i,r),this.stop()))},bodyInfo:function(t,i,r,u){t.body&&t.body.type===n.Physics.ARCADE&&(this.start(i,r,u,210),n.Physics.Arcade.Body.renderBodyInfo(this,t.body),this.stop())}};n.Utils.Debug.prototype.constructor=n.Utils.Debug;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Color={packPixel:function(t,i,r,u){return n.Device.LITTLE_ENDIAN?(u<<24|r<<16|i<<8|t)>>>0:(t<<24|i<<16|r<<8|u)>>>0},unpackPixel:function(t,i,r,u){return(typeof i=="undefined"||i===null)&&(i=n.Color.createColor()),(typeof r=="undefined"||r===null)&&(r=!1),(typeof u=="undefined"||u===null)&&(u=!1),n.Device.LITTLE_ENDIAN?(i.a=(t&4278190080)>>>24,i.b=(t&16711680)>>>16,i.g=(t&65280)>>>8,i.r=t&255):(i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255),i.color=t,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a/255+")",r&&n.Color.RGBtoHSL(i.r,i.g,i.b,i),u&&n.Color.RGBtoHSV(i.r,i.g,i.b,i),i},fromRGBA:function(t,i){return i||(i=n.Color.createColor()),i.r=(t&4278190080)>>>24,i.g=(t&16711680)>>>16,i.b=(t&65280)>>>8,i.a=t&255,i.rgba="rgba("+i.r+","+i.g+","+i.b+","+i.a+")",i},toRGBA:function(n,t,i,r){return n<<24|t<<16|i<<8|r},RGBtoHSL:function(t,i,r,u){var e,f,o;return u||(u=n.Color.createColor(t,i,r,1)),t/=255,i/=255,r/=255,e=Math.min(t,i,r),f=Math.max(t,i,r),u.h=0,u.s=0,u.l=(f+e)/2,f!==e&&(o=f-e,u.s=u.l>.5?o/(2-f-e):o/(f+e),f===t?u.h=(i-r)/o+(i<r?6:0):f===i?u.h=(r-t)/o+2:f===r&&(u.h=(t-i)/o+4),u.h/=6),u},HSLtoRGB:function(t,i,r,u){if(u?(u.r=r,u.g=r,u.b=r):u=n.Color.createColor(r,r,r),i!==0){var f=r<.5?r*(1+i):r+i-r*i,e=2*r-f;u.r=n.Color.hueToColor(e,f,t+1/3);u.g=n.Color.hueToColor(e,f,t);u.b=n.Color.hueToColor(e,f,t-1/3)}return u.r=Math.floor(u.r*255|0),u.g=Math.floor(u.g*255|0),u.b=Math.floor(u.b*255|0),n.Color.updateColor(u),u},RGBtoHSV:function(t,i,r,u){u||(u=n.Color.createColor(t,i,r,255));t/=255;i/=255;r/=255;var o=Math.min(t,i,r),f=Math.max(t,i,r),e=f-o;return u.h=0,u.s=f===0?0:e/f,u.v=f,f!==o&&(f===t?u.h=(i-r)/e+(i<r?6:0):f===i?u.h=(r-t)/e+2:f===r&&(u.h=(t-i)/e+4),u.h/=6),u},HSVtoRGB:function(t,i,r,u){typeof u=="undefined"&&(u=n.Color.createColor(0,0,0,1,t,i,0,r));var f,e,o,l=Math.floor(t*6),a=t*6-l,s=r*(1-i),h=r*(1-a*i),c=r*(1-(1-a)*i);switch(l%6){case 0:f=r;e=c;o=s;break;case 1:f=h;e=r;o=s;break;case 2:f=s;e=r;o=c;break;case 3:f=s;e=h;o=r;break;case 4:f=c;e=s;o=r;break;case 5:f=r;e=s;o=h}return u.r=Math.floor(f*255),u.g=Math.floor(e*255),u.b=Math.floor(o*255),n.Color.updateColor(u),u},hueToColor:function(n,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n},createColor:function(n,t,i,r,u,f,e,o){var s={r:n||0,g:t||0,b:i||0,a:r||1,h:u||0,s:f||0,l:e||0,v:o||0,color:0};return s.rgba="rgba("+s.r+","+s.g+","+s.b+","+s.a+")",s},updateColor:function(n){return n.rgba="rgba("+n.r+","+n.g+","+n.b+","+n.a+")",n},getColor32:function(n,t,i,r){return n<<24|t<<16|i<<8|r},getColor:function(n,t,i){return n<<16|t<<8|i},RGBtoString:function(t,i,r,u,f){return typeof u=="undefined"&&(u=255),typeof f=="undefined"&&(f="#"),f==="#"?"#"+(16777216+(t<<16)+(i<<8)+r).toString(16).slice(1):"0x"+n.Color.componentToHex(u)+n.Color.componentToHex(t)+n.Color.componentToHex(i)+n.Color.componentToHex(r)},hexToRGB:function(t){var i=n.Color.hexToColor(t);if(i)return n.Color.getColor32(i.a,i.r,i.g,i.b)},hexToColor:function(t,i){var u,r;return i||(i=n.Color.createColor()),u=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,t=t.replace(u,function(n,t,i,r){return t+t+i+i+r+r}),r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t),r&&(i.r=parseInt(r[1],16),i.g=parseInt(r[2],16),i.b=parseInt(r[3],16)),i},componentToHex:function(n){var t=n.toString(16);return t.length==1?"0"+t:t},HSVColorWheel:function(t,i){var u,r;for(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),u=[],r=0;r<=359;r++)u.push(n.Color.HSVtoRGB(r/359,t,i));return u},HSLColorWheel:function(t,i){var u,r;for(typeof t=="undefined"&&(t=.5),typeof i=="undefined"&&(i=.5),u=[],r=0;r<=359;r++)u.push(n.Color.HSLtoRGB(r/359,t,i));return u},interpolateColor:function(t,i,r,u,f){typeof f=="undefined"&&(f=255);var e=n.Color.getRGB(t),o=n.Color.getRGB(i),s=(o.red-e.red)*u/r+e.red,h=(o.green-e.green)*u/r+e.green,c=(o.blue-e.blue)*u/r+e.blue;return n.Color.getColor32(f,s,h,c)},interpolateColorWithRGB:function(t,i,r,u,f,e){var o=n.Color.getRGB(t),s=(i-o.red)*e/f+o.red,h=(r-o.green)*e/f+o.green,c=(u-o.blue)*e/f+o.blue;return n.Color.getColor(s,h,c)},interpolateRGB:function(t,i,r,u,f,e,o,s){var h=(u-t)*s/o+t,c=(f-i)*s/o+i,l=(e-r)*s/o+r;return n.Color.getColor(h,c,l)},getRandomColor:function(t,i,r){if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=255),typeof r=="undefined"&&(r=255),i>255||t>i)return n.Color.getColor(255,255,255);var u=t+Math.round(Math.random()*(i-t)),f=t+Math.round(Math.random()*(i-t)),e=t+Math.round(Math.random()*(i-t));return n.Color.getColor32(r,u,f,e)},getRGB:function(n){return n>16777215?{alpha:n>>>24,red:n>>16&255,green:n>>8&255,blue:n&255,a:n>>>24,r:n>>16&255,g:n>>8&255,b:n&255}:{alpha:255,red:n>>16&255,green:n>>8&255,blue:n&255,a:255,r:n>>16&255,g:n>>8&255,b:n&255}},getWebRGB:function(t){if(typeof t=="object")return"rgba("+t.r.toString()+","+t.g.toString()+","+t.b.toString()+","+(t.a/255).toString()+")";var i=n.Color.getRGB(t);return"rgba("+i.r.toString()+","+i.g.toString()+","+i.b.toString()+","+(i.a/255).toString()+")"},getAlpha:function(n){return n>>>24},getAlphaFloat:function(n){return(n>>>24)/255},getRed:function(n){return n>>16&255},getGreen:function(n){return n>>8&255},getBlue:function(n){return n&255}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics=function(n,t){t=t||{};this.game=n;this.config=t;this.arcade=null;this.p2=null;this.ninja=null;this.box2d=null;this.chipmunk=null;this.parseConfig()};n.Physics.ARCADE=0;n.Physics.P2JS=1;n.Physics.NINJA=2;n.Physics.BOX2D=3;n.Physics.CHIPMUNK=5;n.Physics.prototype={parseConfig:function(){(!this.config.hasOwnProperty("arcade")||this.config.arcade===!0)&&n.Physics.hasOwnProperty("Arcade")&&(this.arcade=new n.Physics.Arcade(this.game),this.game.time.deltaCap=.2);this.config.hasOwnProperty("ninja")&&this.config.ninja===!0&&n.Physics.hasOwnProperty("Ninja")&&(this.ninja=new n.Physics.Ninja(this.game));this.config.hasOwnProperty("p2")&&this.config.p2===!0&&n.Physics.hasOwnProperty("P2")&&(this.p2=new n.Physics.P2(this.game,this.config))},startSystem:function(t){if(t===n.Physics.ARCADE?this.arcade=new n.Physics.Arcade(this.game):t===n.Physics.P2JS&&(this.p2=new n.Physics.P2(this.game,this.config)),t===n.Physics.NINJA)this.ninja=new n.Physics.Ninja(this.game);else if(t===n.Physics.BOX2D&&this.box2d===null)throw new Error("The Box2D physics system has not been implemented yet.");else if(t===n.Physics.CHIPMUNK&&this.chipmunk===null)throw new Error("The Chipmunk physics system has not been implemented yet.");},enable:function(t,i,r){typeof i=="undefined"&&(i=n.Physics.ARCADE);typeof r=="undefined"&&(r=!1);i===n.Physics.ARCADE?this.arcade.enable(t):i===n.Physics.P2JS&&this.p2?this.p2.enable(t,r):i===n.Physics.NINJA&&this.ninja&&this.ninja.enableAABB(t)},preUpdate:function(){this.p2&&this.p2.preUpdate()},update:function(){this.p2&&this.p2.update()},setBoundsToWorld:function(){this.arcade&&this.arcade.setBoundsToWorld();this.ninja&&this.ninja.setBoundsToWorld();this.p2&&this.p2.setBoundsToWorld()},clear:function(){this.p2&&this.p2.clear()},destroy:function(){this.p2&&this.p2.destroy();this.arcade=null;this.ninja=null;this.p2=null}};n.Physics.prototype.constructor=n.Physics;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade=function(t){this.game=t;this.gravity=new n.Point;this.bounds=new n.Rectangle(0,0,t.world.width,t.world.height);this.checkCollision={up:!0,down:!0,left:!0,right:!0};this.maxObjects=10;this.maxLevels=4;this.OVERLAP_BIAS=4;this.TILE_BIAS=16;this.forceX=!1;this.skipQuadTree=!1;this.quadTree=new n.QuadTree(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels);this._overlap=0;this._maxOverlap=0;this._velocity1=0;this._velocity2=0;this._newVelocity1=0;this._newVelocity2=0;this._average=0;this._mapData=[];this._result=!1;this._total=0;this._angle=0;this._dx=0;this._dy=0;this.setBoundsToWorld()};n.Physics.Arcade.prototype.constructor=n.Physics.Arcade;n.Physics.Arcade.prototype={setBounds:function(n,t,i,r){this.bounds.setTo(n,t,i,r)},setBoundsToWorld:function(){this.bounds.setTo(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height)},enable:function(t,i){typeof i=="undefined"&&(i=!0);var r=1;if(Array.isArray(t))for(r=t.length;r--;)t[r]instanceof n.Group?this.enable(t[r].children,i):(this.enableBody(t[r]),i&&t[r].hasOwnProperty("children")&&t[r].children.length>0&&this.enable(t[r],!0));else t instanceof n.Group?this.enable(t.children,i):(this.enableBody(t),i&&t.hasOwnProperty("children")&&t.children.length>0&&this.enable(t.children,!0))},enableBody:function(t){t.hasOwnProperty("body")&&t.body===null&&(t.body=new n.Physics.Arcade.Body(t))},updateMotion:function(n){this._velocityDelta=this.computeVelocity(0,n,n.angularVelocity,n.angularAcceleration,n.angularDrag,n.maxAngular)-n.angularVelocity;n.angularVelocity+=this._velocityDelta;n.rotation+=n.angularVelocity*this.game.time.physicsElapsed;n.velocity.x=this.computeVelocity(1,n,n.velocity.x,n.acceleration.x,n.drag.x,n.maxVelocity.x);n.velocity.y=this.computeVelocity(2,n,n.velocity.y,n.acceleration.y,n.drag.y,n.maxVelocity.y)},computeVelocity:function(n,t,i,r,u,f){return f=f||1e4,n==1&&t.allowGravity?i+=(this.gravity.x+t.gravity.x)*this.game.time.physicsElapsed:n==2&&t.allowGravity&&(i+=(this.gravity.y+t.gravity.y)*this.game.time.physicsElapsed),r?i+=r*this.game.time.physicsElapsed:u&&(this._drag=u*this.game.time.physicsElapsed,i-this._drag>0?i-=this._drag:i+this._drag<0?i+=this._drag:i=0),i>f?i=f:i<-f&&(i=-f),i},overlap:function(n,t,i,r,u){var f,e,o,s;if(i=i||null,r=r||null,u=u||i,this._result=!1,this._total=0,!Array.isArray(n)&&Array.isArray(t))for(f=0,e=t.length;f<e;f++)this.collideHandler(n,t[f],i,r,u,!0);else if(Array.isArray(n)&&!Array.isArray(t))for(f=0,e=n.length;f<e;f++)this.collideHandler(n[f],t,i,r,u,!0);else if(Array.isArray(n)&&Array.isArray(t))for(f=0,e=n.length;f<e;f++)for(o=0,s=t.length;o<s;o++)this.collideHandler(n[f],t[o],i,r,u,!0);else this.collideHandler(n,t,i,r,u,!0);return this._total>0},collide:function(n,t,i,r,u){var e,f,s,o,h;if(i=i||null,r=r||null,u=u||i,this._result=!1,this._total=0,!Array.isArray(n)&&Array.isArray(t))for(f=0,e=t.length;f<e;f++)this.collideHandler(n,t[f],i,r,u,!1);else if(Array.isArray(n)&&!Array.isArray(t))for(f=0,e=n.length;f<e;f++)this.collideHandler(n[f],t,i,r,u,!1);else if(Array.isArray(n)&&Array.isArray(t))for(f=0,s=n.length;f<s;f++)for(o=0,h=t.length;o<h;o++)this.collideHandler(n[f],t[o],i,r,u,!1);else this.collideHandler(n,t,i,r,u,!1);return this._total>0},collideHandler:function(t,i,r,u,f,e){if(typeof i=="undefined"&&(t.type===n.GROUP||t.type===n.EMITTER)){this.collideGroupVsSelf(t,r,u,f,e);return}t&&i&&t.exists&&i.exists&&(t.type==n.SPRITE||t.type==n.TILESPRITE?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsSprite(t,i,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideSpriteVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideSpriteVsTilemapLayer(t,i,r,u,f):t.type==n.GROUP?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideGroupVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f):t.type==n.TILEMAPLAYER?i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsTilemapLayer(i,t,r,u,f):(i.type==n.GROUP||i.type==n.EMITTER)&&this.collideGroupVsTilemapLayer(i,t,r,u,f):t.type==n.EMITTER&&(i.type==n.SPRITE||i.type==n.TILESPRITE?this.collideSpriteVsGroup(i,t,r,u,f,e):i.type==n.GROUP||i.type==n.EMITTER?this.collideGroupVsGroup(t,i,r,u,f,e):i.type==n.TILEMAPLAYER&&this.collideGroupVsTilemapLayer(t,i,r,u,f)))},collideSpriteVsSprite:function(n,t,i,r,u,f){return!n.body||!t.body?!1:(this.separate(n.body,t.body,r,u,f)&&(i&&i.call(u,n,t),this._total++),!0)},collideSpriteVsGroup:function(n,t,i,r,u,f){var e,o;if(t.length!==0&&n.body)if(n.body.skipQuadTree||this.skipQuadTree)for(e=0,o=t.children.length;e<o;e++)t.children[e]&&t.children[e].exists&&this.collideSpriteVsSprite(n,t.children[e],i,r,u,f);else for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(t),this._potentials=this.quadTree.retrieve(n),e=0,o=this._potentials.length;e<o;e++)this.separate(n.body,this._potentials[e],r,u,f)&&(i&&i.call(u,n,this._potentials[e].sprite),this._total++)},collideGroupVsSelf:function(n,t,i,r,u){var o,f,e;if(n.length!==0)for(o=n.children.length,f=0;f<o;f++)for(e=f+1;e<=o;e++)n.children[f]&&n.children[e]&&n.children[f].exists&&n.children[e].exists&&this.collideSpriteVsSprite(n.children[f],n.children[e],t,i,r,u)},collideGroupVsGroup:function(t,i,r,u,f,e){if(t.length!==0&&i.length!==0)for(var o=0,s=t.children.length;o<s;o++)t.children[o].exists&&(t.children[o].type===n.GROUP?this.collideGroupVsGroup(t.children[o],i,r,u,f,e):this.collideSpriteVsGroup(t.children[o],i,r,u,f,e))},collideSpriteVsTilemapLayer:function(n,t,i,r,u){if(n.body&&(this._mapData=t.getTiles(n.body.position.x-n.body.tilePadding.x,n.body.position.y-n.body.tilePadding.y,n.body.width+n.body.tilePadding.x,n.body.height+n.body.tilePadding.y,!1,!1),this._mapData.length!==0))for(var f=0;f<this._mapData.length;f++)r?r.call(u,n,this._mapData[f])&&this.separateTile(f,n.body,this._mapData[f])&&(this._total++,i&&i.call(u,n,this._mapData[f])):this.separateTile(f,n.body,this._mapData[f])&&(this._total++,i&&i.call(u,n,this._mapData[f]))},collideGroupVsTilemapLayer:function(n,t,i,r,u){if(n.length!==0)for(var f=0,e=n.children.length;f<e;f++)n.children[f].exists&&this.collideSpriteVsTilemapLayer(n.children[f],t,i,r,u)},separate:function(n,t,i,r,u){return!n.enable||!t.enable||!this.intersects(n,t)?!1:i&&i.call(r,n.sprite,t.sprite)===!1?!1:(this._result=this.forceX||Math.abs(this.gravity.y+n.gravity.y)<Math.abs(this.gravity.x+n.gravity.x)?this.separateX(n,t,u)||this.separateY(n,t,u):this.separateY(n,t,u)||this.separateX(n,t,u),u?!0:this._result)},intersects:function(n,t){return n.right<=t.position.x?!1:n.bottom<=t.position.y?!1:n.position.x>=t.right?!1:n.position.y>=t.bottom?!1:!0},separateX:function(n,t,i){return n.immovable&&t.immovable?!1:(this._overlap=0,this.intersects(n,t)&&(this._maxOverlap=n.deltaAbsX()+t.deltaAbsX()+this.OVERLAP_BIAS,n.deltaX()===0&&t.deltaX()===0?(n.embedded=!0,t.embedded=!0):n.deltaX()>t.deltaX()?(this._overlap=n.right-t.x,this._overlap>this._maxOverlap||n.checkCollision.right===!1||t.checkCollision.left===!1?this._overlap=0:(n.touching.none=!1,n.touching.right=!0,t.touching.none=!1,t.touching.left=!0)):n.deltaX()<t.deltaX()&&(this._overlap=n.x-t.width-t.x,-this._overlap>this._maxOverlap||n.checkCollision.left===!1||t.checkCollision.right===!1?this._overlap=0:(n.touching.none=!1,n.touching.left=!0,t.touching.none=!1,t.touching.right=!0)),n.overlapX=this._overlap,t.overlapX=this._overlap,this._overlap!==0))?i||n.customSeparateX||t.customSeparateX?!0:(this._velocity1=n.velocity.x,this._velocity2=t.velocity.x,n.immovable||t.immovable?n.immovable?t.immovable||(t.x+=this._overlap,t.velocity.x=this._velocity1-this._velocity2*t.bounce.x):(n.x=n.x-this._overlap,n.velocity.x=this._velocity2-this._velocity1*n.bounce.x):(this._overlap*=.5,n.x=n.x-this._overlap,t.x+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/n.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*n.mass/t.mass)*(this._velocity1>0?1:-1),this._average=(this._newVelocity1+this._newVelocity2)*.5,this._newVelocity1-=this._average,this._newVelocity2-=this._average,n.velocity.x=this._average+this._newVelocity1*n.bounce.x,t.velocity.x=this._average+this._newVelocity2*t.bounce.x),!0):!1},separateY:function(n,t,i){return n.immovable&&t.immovable?!1:(this._overlap=0,this.intersects(n,t)&&(this._maxOverlap=n.deltaAbsY()+t.deltaAbsY()+this.OVERLAP_BIAS,n.deltaY()===0&&t.deltaY()===0?(n.embedded=!0,t.embedded=!0):n.deltaY()>t.deltaY()?(this._overlap=n.bottom-t.y,this._overlap>this._maxOverlap||n.checkCollision.down===!1||t.checkCollision.up===!1?this._overlap=0:(n.touching.none=!1,n.touching.down=!0,t.touching.none=!1,t.touching.up=!0)):n.deltaY()<t.deltaY()&&(this._overlap=n.y-t.bottom,-this._overlap>this._maxOverlap||n.checkCollision.up===!1||t.checkCollision.down===!1?this._overlap=0:(n.touching.none=!1,n.touching.up=!0,t.touching.none=!1,t.touching.down=!0)),n.overlapY=this._overlap,t.overlapY=this._overlap,this._overlap!==0))?i||n.customSeparateY||t.customSeparateY?!0:(this._velocity1=n.velocity.y,this._velocity2=t.velocity.y,n.immovable||t.immovable?n.immovable?t.immovable||(t.y+=this._overlap,t.velocity.y=this._velocity1-this._velocity2*t.bounce.y,n.moves&&(t.x+=n.x-n.prev.x)):(n.y=n.y-this._overlap,n.velocity.y=this._velocity2-this._velocity1*n.bounce.y,t.moves&&(n.x+=t.x-t.prev.x)):(this._overlap*=.5,n.y=n.y-this._overlap,t.y+=this._overlap,this._newVelocity1=Math.sqrt(this._velocity2*this._velocity2*t.mass/n.mass)*(this._velocity2>0?1:-1),this._newVelocity2=Math.sqrt(this._velocity1*this._velocity1*n.mass/t.mass)*(this._velocity1>0?1:-1),this._average=(this._newVelocity1+this._newVelocity2)*.5,this._newVelocity1-=this._average,this._newVelocity2-=this._average,n.velocity.y=this._average+this._newVelocity1*n.bounce.y,t.velocity.y=this._average+this._newVelocity2*t.bounce.y),!0):!1},separateTile:function(n,t,i){if(!t.enable||!i.intersects(t.position.x,t.position.y,t.right,t.bottom)||i.collisionCallback&&!i.collisionCallback.call(i.collisionCallbackContext,t.sprite,i)||i.layer.callbacks[i.index]&&!i.layer.callbacks[i.index].callback.call(i.layer.callbacks[i.index].callbackContext,t.sprite,i)||!i.faceLeft&&!i.faceRight&&!i.faceTop&&!i.faceBottom)return!1;var r=0,u=0,f=0,e=1;if(t.deltaAbsX()>t.deltaAbsY()?f=-1:t.deltaAbsX()<t.deltaAbsY()&&(e=-1),t.deltaX()!==0&&t.deltaY()!==0&&(i.faceLeft||i.faceRight)&&(i.faceTop||i.faceBottom)&&(f=Math.min(Math.abs(t.position.x-i.right),Math.abs(t.right-i.left)),e=Math.min(Math.abs(t.position.y-i.bottom),Math.abs(t.bottom-i.top))),f<e){if((i.faceLeft||i.faceRight)&&(r=this.tileCheckX(t,i),r!==0&&!i.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(i.faceTop||i.faceBottom)&&(u=this.tileCheckY(t,i))}else{if((i.faceTop||i.faceBottom)&&(u=this.tileCheckY(t,i),u!==0&&!i.intersects(t.position.x,t.position.y,t.right,t.bottom)))return!0;(i.faceLeft||i.faceRight)&&(r=this.tileCheckX(t,i))}return r!==0||u!==0},tileCheckX:function(n,t){var i=0;return n.deltaX()<0&&!n.blocked.left&&t.collideRight&&n.checkCollision.left?t.faceRight&&n.x<t.right&&(i=n.x-t.right,i<-this.TILE_BIAS&&(i=0)):n.deltaX()>0&&!n.blocked.right&&t.collideLeft&&n.checkCollision.right&&t.faceLeft&&n.right>t.left&&(i=n.right-t.left,i>this.TILE_BIAS&&(i=0)),i!==0&&this.processTileSeparationX(n,i),i},tileCheckY:function(n,t){var i=0;return n.deltaY()<0&&!n.blocked.up&&t.collideDown&&n.checkCollision.up?t.faceBottom&&n.y<t.bottom&&(i=n.y-t.bottom,i<-this.TILE_BIAS&&(i=0)):n.deltaY()>0&&!n.blocked.down&&t.collideUp&&n.checkCollision.down&&t.faceTop&&n.bottom>t.top&&(i=n.bottom-t.top,i>this.TILE_BIAS&&(i=0)),i!==0&&this.processTileSeparationY(n,i),i},processTileSeparationX:function(n,t){t<0?n.blocked.left=!0:t>0&&(n.blocked.right=!0);n.position.x-=t;n.velocity.x=n.bounce.x===0?0:-n.velocity.x*n.bounce.x},processTileSeparationY:function(n,t){t<0?n.blocked.up=!0:t>0&&(n.blocked.down=!0);n.position.y-=t;n.velocity.y=n.bounce.y===0?0:-n.velocity.y*n.bounce.y},getObjectsUnderPointer:function(t,i,r,u){var o,e,f,s;if(i.length!==0&&t.exists){for(this.quadTree.clear(),this.quadTree.reset(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,this.maxObjects,this.maxLevels),this.quadTree.populate(i),o=new n.Rectangle(t.x,t.y,1,1),e=[],this._potentials=this.quadTree.retrieve(o),f=0,s=this._potentials.length;f<s;f++)this._potentials[f].hitTest(t.x,t.y)&&(r&&r.call(u,t,this._potentials[f].sprite),e.push(this._potentials[f].sprite));return e}},moveToObject:function(n,t,i,r){return typeof i=="undefined"&&(i=60),typeof r=="undefined"&&(r=0),this._angle=Math.atan2(t.y-n.y,t.x-n.x),r>0&&(i=this.distanceBetween(n,t)/(r/1e3)),n.body.velocity.x=Math.cos(this._angle)*i,n.body.velocity.y=Math.sin(this._angle)*i,this._angle},moveToPointer:function(n,t,i,r){return typeof t=="undefined"&&(t=60),i=i||this.game.input.activePointer,typeof r=="undefined"&&(r=0),this._angle=this.angleToPointer(n,i),r>0&&(t=this.distanceToPointer(n,i)/(r/1e3)),n.body.velocity.x=Math.cos(this._angle)*t,n.body.velocity.y=Math.sin(this._angle)*t,this._angle},moveToXY:function(n,t,i,r,u){return typeof r=="undefined"&&(r=60),typeof u=="undefined"&&(u=0),this._angle=Math.atan2(i-n.y,t-n.x),u>0&&(r=this.distanceToXY(n,t,i)/(u/1e3)),n.body.velocity.x=Math.cos(this._angle)*r,n.body.velocity.y=Math.sin(this._angle)*r,this._angle},velocityFromAngle:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(this.game.math.degToRad(t))*i,Math.sin(this.game.math.degToRad(t))*i)},velocityFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerationFromRotation:function(t,i,r){return typeof i=="undefined"&&(i=60),r=r||new n.Point,r.setTo(Math.cos(t)*i,Math.sin(t)*i)},accelerateToObject:function(n,t,i,r,u){return typeof i=="undefined"&&(i=60),typeof r=="undefined"&&(r=1e3),typeof u=="undefined"&&(u=1e3),this._angle=this.angleBetween(n,t),n.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),n.body.maxVelocity.setTo(r,u),this._angle},accelerateToPointer:function(n,t,i,r,u){return typeof i=="undefined"&&(i=60),typeof t=="undefined"&&(t=this.game.input.activePointer),typeof r=="undefined"&&(r=1e3),typeof u=="undefined"&&(u=1e3),this._angle=this.angleToPointer(n,t),n.body.acceleration.setTo(Math.cos(this._angle)*i,Math.sin(this._angle)*i),n.body.maxVelocity.setTo(r,u),this._angle},accelerateToXY:function(n,t,i,r,u,f){return typeof r=="undefined"&&(r=60),typeof u=="undefined"&&(u=1e3),typeof f=="undefined"&&(f=1e3),this._angle=this.angleToXY(n,t,i),n.body.acceleration.setTo(Math.cos(this._angle)*r,Math.sin(this._angle)*r),n.body.maxVelocity.setTo(u,f),this._angle},distanceBetween:function(n,t){return this._dx=n.x-t.x,this._dy=n.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToXY:function(n,t,i){return this._dx=n.x-t,this._dy=n.y-i,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},distanceToPointer:function(n,t){return t=t||this.game.input.activePointer,this._dx=n.x-t.x,this._dy=n.y-t.y,Math.sqrt(this._dx*this._dx+this._dy*this._dy)},angleBetween:function(n,t){return this._dx=t.x-n.x,this._dy=t.y-n.y,Math.atan2(this._dy,this._dx)},angleToXY:function(n,t,i){return this._dx=t-n.x,this._dy=i-n.y,Math.atan2(this._dy,this._dx)},angleToPointer:function(n,t){return t=t||this.game.input.activePointer,this._dx=t.worldX-n.x,this._dy=t.worldY-n.y,Math.atan2(this._dy,this._dx)}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Physics.Arcade.Body=function(t){this.sprite=t;this.game=t.game;this.type=n.Physics.ARCADE;this.enable=!0;this.offset=new n.Point;this.position=new n.Point(t.x,t.y);this.prev=new n.Point(this.position.x,this.position.y);this.allowRotation=!0;this.rotation=t.rotation;this.preRotation=t.rotation;this.sourceWidth=t.texture.frame.width;this.sourceHeight=t.texture.frame.height;this.width=t.width;this.height=t.height;this.halfWidth=Math.abs(t.width/2);this.halfHeight=Math.abs(t.height/2);this.center=new n.Point(t.x+this.halfWidth,t.y+this.halfHeight);this.velocity=new n.Point;this.newVelocity=new n.Point(0,0);this.deltaMax=new n.Point(0,0);this.acceleration=new n.Point;this.drag=new n.Point;this.allowGravity=!0;this.gravity=new n.Point(0,0);this.bounce=new n.Point;this.maxVelocity=new n.Point(1e4,1e4);this.angularVelocity=0;this.angularAcceleration=0;this.angularDrag=0;this.maxAngular=1e3;this.mass=1;this.angle=0;this.speed=0;this.facing=n.NONE;this.immovable=!1;this.moves=!0;this.customSeparateX=!1;this.customSeparateY=!1;this.overlapX=0;this.overlapY=0;this.embedded=!1;this.collideWorldBounds=!1;this.checkCollision={none:!1,any:!0,up:!0,down:!0,left:!0,right:!0};this.touching={none:!0,up:!1,down:!1,left:!1,right:!1};this.wasTouching={none:!0,up:!1,down:!1,left:!1,right:!1};this.blocked={up:!1,down:!1,left:!1,right:!1};this.tilePadding=new n.Point;this.phase=0;this.skipQuadTree=!1;this._reset=!0;this._sx=t.scale.x;this._sy=t.scale.y;this._dx=0;this._dy=0};n.Physics.Arcade.Body.prototype={updateBounds:function(){var n=Math.abs(this.sprite.scale.x),t=Math.abs(this.sprite.scale.y);(n!==this._sx||t!==this._sy)&&(this.width=this.sourceWidth*n,this.height=this.sourceHeight*t,this.halfWidth=Math.floor(this.width/2),this.halfHeight=Math.floor(this.height/2),this._sx=n,this._sy=t,this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this._reset=!0)},preUpdate:function(){this.enable&&(this.phase=1,this.wasTouching.none=this.touching.none,this.wasTouching.up=this.touching.up,this.wasTouching.down=this.touching.down,this.wasTouching.left=this.touching.left,this.wasTouching.right=this.touching.right,this.touching.none=!0,this.touching.up=!1,this.touching.down=!1,this.touching.left=!1,this.touching.right=!1,this.blocked.up=!1,this.blocked.down=!1,this.blocked.left=!1,this.blocked.right=!1,this.embedded=!1,this.updateBounds(),this.position.x=this.sprite.world.x-this.sprite.anchor.x*this.width+this.offset.x,this.position.y=this.sprite.world.y-this.sprite.anchor.y*this.height+this.offset.y,this.rotation=this.sprite.angle,this.preRotation=this.rotation,(this._reset||this.sprite._cache[4]===1)&&(this.prev.x=this.position.x,this.prev.y=this.position.y),this.moves&&(this.game.physics.arcade.updateMotion(this),this.newVelocity.set(this.velocity.x*this.game.time.physicsElapsed,this.velocity.y*this.game.time.physicsElapsed),this.position.x+=this.newVelocity.x,this.position.y+=this.newVelocity.y,(this.position.x!==this.prev.x||this.position.y!==this.prev.y)&&(this.speed=Math.sqrt(this.velocity.x*this.velocity.x+this.velocity.y*this.velocity.y),this.angle=Math.atan2(this.velocity.y,this.velocity.x)),this.collideWorldBounds&&this.checkWorldBounds()),this._dx=this.deltaX(),this._dy=this.deltaY(),this._reset=!1)},postUpdate:function(){this.enable&&this.phase!==2&&(this.phase=2,this.deltaX()<0?this.facing=n.LEFT:this.deltaX()>0&&(this.facing=n.RIGHT),this.deltaY()<0?this.facing=n.UP:this.deltaY()>0&&(this.facing=n.DOWN),this.moves&&(this._dx=this.deltaX(),this._dy=this.deltaY(),this.deltaMax.x!==0&&this._dx!==0&&(this._dx<0&&this._dx<-this.deltaMax.x?this._dx=-this.deltaMax.x:this._dx>0&&this._dx>this.deltaMax.x&&(this._dx=this.deltaMax.x)),this.deltaMax.y!==0&&this._dy!==0&&(this._dy<0&&this._dy<-this.deltaMax.y?this._dy=-this.deltaMax.y:this._dy>0&&this._dy>this.deltaMax.y&&(this._dy=this.deltaMax.y)),this.sprite.x+=this._dx,this.sprite.y+=this._dy),this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight),this.allowRotation&&(this.sprite.angle+=this.deltaZ()),this.prev.x=this.position.x,this.prev.y=this.position.y)},destroy:function(){this.sprite.body=null;this.sprite=null},checkWorldBounds:function(){this.position.x<this.game.physics.arcade.bounds.x&&this.game.physics.arcade.checkCollision.left?(this.position.x=this.game.physics.arcade.bounds.x,this.velocity.x*=-this.bounce.x,this.blocked.left=!0):this.right>this.game.physics.arcade.bounds.right&&this.game.physics.arcade.checkCollision.right&&(this.position.x=this.game.physics.arcade.bounds.right-this.width,this.velocity.x*=-this.bounce.x,this.blocked.right=!0);this.position.y<this.game.physics.arcade.bounds.y&&this.game.physics.arcade.checkCollision.up?(this.position.y=this.game.physics.arcade.bounds.y,this.velocity.y*=-this.bounce.y,this.blocked.up=!0):this.bottom>this.game.physics.arcade.bounds.bottom&&this.game.physics.arcade.checkCollision.down&&(this.position.y=this.game.physics.arcade.bounds.bottom-this.height,this.velocity.y*=-this.bounce.y,this.blocked.down=!0)},setSize:function(n,t,i,r){typeof i=="undefined"&&(i=this.offset.x);typeof r=="undefined"&&(r=this.offset.y);this.sourceWidth=n;this.sourceHeight=t;this.width=this.sourceWidth*this._sx;this.height=this.sourceHeight*this._sy;this.halfWidth=Math.floor(this.width/2);this.halfHeight=Math.floor(this.height/2);this.offset.setTo(i,r);this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},reset:function(n,t){this.velocity.set(0);this.acceleration.set(0);this.angularVelocity=0;this.angularAcceleration=0;this.position.x=n-this.sprite.anchor.x*this.width+this.offset.x;this.position.y=t-this.sprite.anchor.y*this.height+this.offset.y;this.prev.x=this.position.x;this.prev.y=this.position.y;this.rotation=this.sprite.angle;this.preRotation=this.rotation;this._sx=this.sprite.scale.x;this._sy=this.sprite.scale.y;this.center.setTo(this.position.x+this.halfWidth,this.position.y+this.halfHeight)},hitTest:function(t,i){return n.Rectangle.contains(this,t,i)},onFloor:function(){return this.blocked.down},onWall:function(){return this.blocked.left||this.blocked.right},deltaAbsX:function(){return this.deltaX()>0?this.deltaX():-this.deltaX()},deltaAbsY:function(){return this.deltaY()>0?this.deltaY():-this.deltaY()},deltaX:function(){return this.position.x-this.prev.x},deltaY:function(){return this.position.y-this.prev.y},deltaZ:function(){return this.rotation-this.preRotation}};Object.defineProperty(n.Physics.Arcade.Body.prototype,"bottom",{get:function(){return this.position.y+this.height}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"right",{get:function(){return this.position.x+this.width}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"x",{get:function(){return this.position.x},set:function(n){this.position.x=n}});Object.defineProperty(n.Physics.Arcade.Body.prototype,"y",{get:function(){return this.position.y},set:function(n){this.position.y=n}});n.Physics.Arcade.Body.render=function(n,t,i,r){typeof r=="undefined"&&(r=!0);i=i||"rgba(0,255,0,0.4)";r?(n.fillStyle=i,n.fillRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height)):(n.strokeStyle=i,n.strokeRect(t.position.x-t.game.camera.x,t.position.y-t.game.camera.y,t.width,t.height))};n.Physics.Arcade.Body.renderBodyInfo=function(n,t){n.line("x: "+t.x.toFixed(2),"y: "+t.y.toFixed(2),"width: "+t.width,"height: "+t.height);n.line("velocity x: "+t.velocity.x.toFixed(2),"y: "+t.velocity.y.toFixed(2),"deltaX: "+t._dx.toFixed(2),"deltaY: "+t._dy.toFixed(2));n.line("acceleration x: "+t.acceleration.x.toFixed(2),"y: "+t.acceleration.y.toFixed(2),"speed: "+t.speed.toFixed(2),"angle: "+t.angle.toFixed(2));n.line("gravity x: "+t.gravity.x,"y: "+t.gravity.y,"bounce x: "+t.bounce.x.toFixed(2),"y: "+t.bounce.y.toFixed(2));n.line("touching left: "+t.touching.left,"right: "+t.touching.right,"up: "+t.touching.up,"down: "+t.touching.down);n.line("blocked left: "+t.blocked.left,"right: "+t.blocked.right,"up: "+t.blocked.up,"down: "+t.blocked.down)};n.Physics.Arcade.Body.prototype.constructor=n.Physics.Arcade.Body;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles=function(n){this.game=n;this.emitters={};this.ID=0};n.Particles.prototype={add:function(n){return this.emitters[n.name]=n,n},remove:function(n){delete this.emitters[n.name]},update:function(){for(var n in this.emitters)this.emitters[n].exists&&this.emitters[n].update()}};n.Particles.prototype.constructor=n.Particles;n.Particles.Arcade={};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Particles.Arcade.Emitter=function(t,i,r,u){this.maxParticles=u||50;n.Group.call(this,t);this.name="emitter"+this.game.particles.ID++;this.type=n.EMITTER;this.area=new n.Rectangle(i,r,1,1);this.minParticleSpeed=new n.Point(-100,-100);this.maxParticleSpeed=new n.Point(100,100);this.minParticleScale=1;this.maxParticleScale=1;this.scaleData=null;this.minRotation=-360;this.maxRotation=360;this.minParticleAlpha=1;this.maxParticleAlpha=1;this.alphaData=null;this.gravity=100;this.particleClass=n.Particle;this.particleDrag=new n.Point;this.angularDrag=0;this.frequency=100;this.lifespan=2e3;this.bounce=new n.Point;this.on=!1;this.particleAnchor=new n.Point(.5,.5);this.blendMode=n.blendModes.NORMAL;this.emitX=i;this.emitY=r;this.autoScale=!1;this.autoAlpha=!1;this.particleBringToTop=!1;this.particleSendToBack=!1;this._minParticleScale=new n.Point(1,1);this._maxParticleScale=new n.Point(1,1);this._quantity=0;this._timer=0;this._counter=0;this._explode=!0;this._frames=null};n.Particles.Arcade.Emitter.prototype=Object.create(n.Group.prototype);n.Particles.Arcade.Emitter.prototype.constructor=n.Particles.Arcade.Emitter;n.Particles.Arcade.Emitter.prototype.update=function(){if(this.on)if(this._explode){this._counter=0;do this.emitParticle(),this._counter++;while(this._counter<this._quantity);this.on=!1}else this.game.time.now>=this._timer&&(this.emitParticle(),this._counter++,this._quantity>0&&this._counter>=this._quantity&&(this.on=!1),this._timer=this.game.time.now+this.frequency);for(var n=this.children.length;n--;)this.children[n].exists&&this.children[n].update()};n.Particles.Arcade.Emitter.prototype.makeParticles=function(n,t,i,r,u){typeof t=="undefined"&&(t=0);typeof i=="undefined"&&(i=this.maxParticles);typeof r=="undefined"&&(r=!1);typeof u=="undefined"&&(u=!1);var f,e=0,o=n,s=t;for(this._frames=t;e<i;)Array.isArray(n)&&(o=this.game.rnd.pick(n)),Array.isArray(t)&&(s=this.game.rnd.pick(t)),f=new this.particleClass(this.game,0,0,o,s),this.game.physics.arcade.enable(f,!1),r?(f.body.checkCollision.any=!0,f.body.checkCollision.none=!1):f.body.checkCollision.none=!0,f.body.collideWorldBounds=u,f.exists=!1,f.visible=!1,f.anchor.copyFrom(this.particleAnchor),this.add(f),e++;return this};n.Particles.Arcade.Emitter.prototype.kill=function(){this.on=!1;this.alive=!1;this.exists=!1};n.Particles.Arcade.Emitter.prototype.revive=function(){this.alive=!0;this.exists=!0};n.Particles.Arcade.Emitter.prototype.explode=function(n,t){this.start(!0,n,0,t,!1)};n.Particles.Arcade.Emitter.prototype.flow=function(n,t,i){this.start(!1,n,t,i,!0)};n.Particles.Arcade.Emitter.prototype.start=function(n,t,i,r,u){typeof n=="undefined"&&(n=!0);typeof t=="undefined"&&(t=0);(typeof i=="undefined"||i===null)&&(i=250);typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=!1);this.revive();this.visible=!0;this.on=!0;this._explode=n;this.lifespan=t;this.frequency=i;n||u?this._quantity=r:this._quantity+=r;this._counter=0;this._timer=this.game.time.now+i};n.Particles.Arcade.Emitter.prototype.emitParticle=function(){var n=this.getFirstExists(!1);n!==null&&(this.width>1||this.height>1?n.reset(this.game.rnd.integerInRange(this.left,this.right),this.game.rnd.integerInRange(this.top,this.bottom)):n.reset(this.emitX,this.emitY),n.angle=0,n.lifespan=this.lifespan,this.particleBringToTop?this.bringToTop(n):this.particleSendToBack&&this.sendToBack(n),this.autoScale?n.setScaleData(this.scaleData):this.minParticleScale!==1||this.maxParticleScale!==1?n.scale.set(this.game.rnd.realInRange(this.minParticleScale,this.maxParticleScale)):(this._minParticleScale.x!==this._maxParticleScale.x||this._minParticleScale.y!==this._maxParticleScale.y)&&n.scale.set(this.game.rnd.realInRange(this._minParticleScale.x,this._maxParticleScale.x),this.game.rnd.realInRange(this._minParticleScale.y,this._maxParticleScale.y)),n.frame=Array.isArray(this._frames==="object")?this.game.rnd.pick(this._frames):this._frames,this.autoAlpha?n.setAlphaData(this.alphaData):n.alpha=this.game.rnd.realInRange(this.minParticleAlpha,this.maxParticleAlpha),n.blendMode=this.blendMode,n.body.updateBounds(),n.body.bounce.setTo(this.bounce.x,this.bounce.y),n.body.velocity.x=this.game.rnd.integerInRange(this.minParticleSpeed.x,this.maxParticleSpeed.x),n.body.velocity.y=this.game.rnd.integerInRange(this.minParticleSpeed.y,this.maxParticleSpeed.y),n.body.angularVelocity=this.game.rnd.integerInRange(this.minRotation,this.maxRotation),n.body.gravity.y=this.gravity,n.body.drag.x=this.particleDrag.x,n.body.drag.y=this.particleDrag.y,n.body.angularDrag=this.angularDrag,n.onEmit())};n.Particles.Arcade.Emitter.prototype.setSize=function(n,t){this.area.width=n;this.area.height=t};n.Particles.Arcade.Emitter.prototype.setXSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.x=n;this.maxParticleSpeed.x=t};n.Particles.Arcade.Emitter.prototype.setYSpeed=function(n,t){n=n||0;t=t||0;this.minParticleSpeed.y=n;this.maxParticleSpeed.y=t};n.Particles.Arcade.Emitter.prototype.setRotation=function(n,t){n=n||0;t=t||0;this.minRotation=n;this.maxRotation=t};n.Particles.Arcade.Emitter.prototype.setAlpha=function(t,i,r,u,f){if(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),typeof r=="undefined"&&(r=0),typeof u=="undefined"&&(u=n.Easing.Linear.None),typeof f=="undefined"&&(f=!1),this.minParticleAlpha=t,this.maxParticleAlpha=i,this.autoAlpha=!1,r>0&&t!==i){var o={v:t},e=this.game.make.tween(o).to({v:i},r,u);e.yoyo(f);this.alphaData=e.generateData(60);this.alphaData.reverse();this.autoAlpha=!0}};n.Particles.Arcade.Emitter.prototype.setScale=function(t,i,r,u,f,e,o){if(typeof t=="undefined"&&(t=1),typeof i=="undefined"&&(i=1),typeof r=="undefined"&&(r=1),typeof u=="undefined"&&(u=1),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=n.Easing.Linear.None),typeof o=="undefined"&&(o=!1),this.minParticleScale=1,this.maxParticleScale=1,this._minParticleScale.set(t,r),this._maxParticleScale.set(i,u),this.autoScale=!1,f>0&&t!==i||r!==u){var h={x:t,y:r},s=this.game.make.tween(h).to({x:i,y:u},f,e);s.yoyo(o);this.scaleData=s.generateData(60);this.scaleData.reverse();this.autoScale=!0}};n.Particles.Arcade.Emitter.prototype.at=function(n){n.center?(this.emitX=n.center.x,this.emitY=n.center.y):(this.emitX=n.world.x+n.anchor.x*n.width,this.emitY=n.world.y+n.anchor.y*n.height)};Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"width",{get:function(){return this.area.width},set:function(n){this.area.width=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"height",{get:function(){return this.area.height},set:function(n){this.area.height=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"x",{get:function(){return this.emitX},set:function(n){this.emitX=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"y",{get:function(){return this.emitY},set:function(n){this.emitY=n}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"left",{get:function(){return Math.floor(this.x-this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"right",{get:function(){return Math.floor(this.x+this.area.width/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"top",{get:function(){return Math.floor(this.y-this.area.height/2)}});Object.defineProperty(n.Particles.Arcade.Emitter.prototype,"bottom",{get:function(){return Math.floor(this.y+this.area.height/2)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tile=function(n,t,i,r,u,f){this.layer=n;this.index=t;this.x=i;this.y=r;this.worldX=i*u;this.worldY=r*f;this.width=u;this.height=f;this.centerX=Math.abs(u/2);this.centerY=Math.abs(f/2);this.alpha=1;this.properties={};this.scanned=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1;this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.collisionCallback=null;this.collisionCallbackContext=this};n.Tile.prototype={containsPoint:function(n,t){return!(n<this.worldX||t<this.worldY||n>this.right||t>this.bottom)},intersects:function(n,t,i,r){return i<=this.worldX?!1:r<=this.worldY?!1:n>=this.worldX+this.width?!1:t>=this.worldY+this.height?!1:!0},setCollisionCallback:function(n,t){this.collisionCallback=n;this.collisionCallbackContext=t},destroy:function(){this.collisionCallback=null;this.collisionCallbackContext=null;this.properties=null},setCollision:function(n,t,i,r){this.collideLeft=n;this.collideRight=t;this.collideUp=i;this.collideDown=r;this.faceLeft=n;this.faceRight=t;this.faceTop=i;this.faceBottom=r},resetCollision:function(){this.collideLeft=!1;this.collideRight=!1;this.collideUp=!1;this.collideDown=!1;this.faceTop=!1;this.faceBottom=!1;this.faceLeft=!1;this.faceRight=!1},isInteresting:function(n,t){return n&&t?this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.faceTop||this.faceBottom||this.faceLeft||this.faceRight||this.collisionCallback:n?this.collideLeft||this.collideRight||this.collideUp||this.collideDown:t?this.faceTop||this.faceBottom||this.faceLeft||this.faceRight:!1},copy:function(n){this.index=n.index;this.alpha=n.alpha;this.properties=n.properties;this.collideUp=n.collideUp;this.collideDown=n.collideDown;this.collideLeft=n.collideLeft;this.collideRight=n.collideRight;this.collisionCallback=n.collisionCallback;this.collisionCallbackContext=n.collisionCallbackContext}};n.Tile.prototype.constructor=n.Tile;Object.defineProperty(n.Tile.prototype,"collides",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown}});Object.defineProperty(n.Tile.prototype,"canCollide",{get:function(){return this.collideLeft||this.collideRight||this.collideUp||this.collideDown||this.collisionCallback}});Object.defineProperty(n.Tile.prototype,"left",{get:function(){return this.worldX}});Object.defineProperty(n.Tile.prototype,"right",{get:function(){return this.worldX+this.width}});Object.defineProperty(n.Tile.prototype,"top",{get:function(){return this.worldY}});Object.defineProperty(n.Tile.prototype,"bottom",{get:function(){return this.worldY+this.height}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tilemap=function(t,i,r,u,f,e){this.game=t;this.key=i;var o=n.TilemapParser.parse(this.game,i,r,u,f,e);o!==null&&(this.width=o.width,this.height=o.height,this.tileWidth=o.tileWidth,this.tileHeight=o.tileHeight,this.orientation=o.orientation,this.format=o.format,this.version=o.version,this.properties=o.properties,this.widthInPixels=o.widthInPixels,this.heightInPixels=o.heightInPixels,this.layers=o.layers,this.tilesets=o.tilesets,this.tiles=o.tiles,this.objects=o.objects,this.collideIndexes=[],this.collision=o.collision,this.images=o.images,this.currentLayer=0,this.debugMap=[],this._results=[],this._tempA=0,this._tempB=0)};n.Tilemap.CSV=0;n.Tilemap.TILED_JSON=1;n.Tilemap.NORTH=0;n.Tilemap.EAST=1;n.Tilemap.SOUTH=2;n.Tilemap.WEST=3;n.Tilemap.prototype={create:function(n,t,i,r,u,f){return typeof f=="undefined"&&(f=this.game.world),this.width=t,this.height=i,this.setTileSize(r,u),this.layers.length=0,this.createBlankLayer(n,t,i,r,u,f)},setTileSize:function(n,t){this.tileWidth=n;this.tileHeight=t;this.widthInPixels=this.width*n;this.heightInPixels=this.height*t},addTilesetImage:function(t,i,r,u,f,e,o){var s,h;if(typeof r=="undefined"&&(r=this.tileWidth),typeof u=="undefined"&&(u=this.tileHeight),typeof f=="undefined"&&(f=0),typeof e=="undefined"&&(e=0),typeof o=="undefined"&&(o=0),r===0&&(r=32),u===0&&(u=32),typeof i=="undefined")if(typeof t=="string"){if(i=t,!this.game.cache.checkImageKey(i))return console.warn('Phaser.Tilemap.addTilesetImage: Invalid image key given: "'+i+'"'),null}else return null;if(typeof t=="string"&&(t=this.getTilesetIndex(t),t===null&&this.format===n.Tilemap.TILED_JSON))return console.warn('Phaser.Tilemap.addTilesetImage: No data found in the JSON matching the tileset name: "'+i+'"'),null;if(this.tilesets[t])return this.tilesets[t].setImage(this.game.cache.getImage(i)),this.tilesets[t];s=new n.Tileset(i,o,r,u,f,e,{});s.setImage(this.game.cache.getImage(i));this.tilesets.push(s);var p=this.tilesets.length-1,c=f,a=f,v=0,l=0,y=0;for(h=o;h<o+s.total;h++){if(this.tiles[h]=[c,a,p],c+=r+e,v++,v===s.total)break;if(l++,l===s.columns&&(c=f,a+=u+e,l=0,y++,y===s.rows))break}return s},createFromObjects:function(t,i,r,u,f,e,o,s,h){var l,c,v,a;if(typeof f=="undefined"&&(f=!0),typeof e=="undefined"&&(e=!1),typeof o=="undefined"&&(o=this.game.world),typeof s=="undefined"&&(s=n.Sprite),typeof h=="undefined"&&(h=!0),!this.objects[t]){console.warn("Tilemap.createFromObjects: Invalid objectgroup name given: "+t);return}for(c=0,v=this.objects[t].length;c<v;c++)if(this.objects[t][c].gid===i){l=new s(this.game,this.objects[t][c].x,this.objects[t][c].y,r,u);l.name=this.objects[t][c].name;l.visible=this.objects[t][c].visible;l.autoCull=e;l.exists=f;h&&(l.y-=l.height);o.add(l);for(a in this.objects[t][c].properties)o.set(l,a,this.objects[t][c].properties[a],!1,!1,0,!0)}},createLayer:function(t,i,r,u){typeof i=="undefined"&&(i=this.game.width);typeof r=="undefined"&&(r=this.game.height);typeof u=="undefined"&&(u=this.game.world);var f=t;if(typeof t=="string"&&(f=this.getLayerIndex(t)),f===null||f>this.layers.length){console.warn("Tilemap.createLayer: Invalid layer ID given: "+f);return}return u.add(new n.TilemapLayer(this.game,this,f,i,r))},createBlankLayer:function(t,i,r,u,f,e){var o,v,h,c,l,a,s;if(typeof e=="undefined"&&(e=this.game.world),this.getLayerIndex(t)!==null){console.warn("Tilemap.createBlankLayer: Layer with matching name already exists");return}for(o={name:t,x:0,y:0,width:i,height:r,widthInPixels:i*u,heightInPixels:r*f,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:null},s=[],h=0;h<r;h++){for(v=[],c=0;c<i;c++)v.push(new n.Tile(o,-1,c,h,u,f));s.push(v)}return o.data=s,this.layers.push(o),this.currentLayer=this.layers.length-1,l=o.widthInPixels,a=o.heightInPixels,l>this.game.width&&(l=this.game.width),a>this.game.height&&(a=this.game.height),s=new n.TilemapLayer(this.game,this,this.layers.length-1,l,a),s.name=t,e.add(s)},getIndex:function(n,t){for(var i=0;i<n.length;i++)if(n[i].name===t)return i;return null},getLayerIndex:function(n){return this.getIndex(this.layers,n)},getTilesetIndex:function(n){return this.getIndex(this.tilesets,n)},getImageIndex:function(n){return this.getIndex(this.images,n)},getObjectIndex:function(n){return this.getIndex(this.objects,n)},setTileIndexCallback:function(n,t,i,r){if(r=this.getLayer(r),typeof n=="number")this.layers[r].callbacks[n]={callback:t,callbackContext:i};else for(var u=0,f=n.length;u<f;u++)this.layers[r].callbacks[n[u]]={callback:t,callbackContext:i}},setTileLocationCallback:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(n,t,i,r,e),!(this._results.length<2))for(var o=1;o<this._results.length;o++)this._results[o].setCollisionCallback(u,f)},setCollision:function(n,t,i,r){if(typeof t=="undefined"&&(t=!0),typeof r=="undefined"&&(r=!0),i=this.getLayer(i),typeof n=="number")return this.setCollisionByIndex(n,t,i,!0);for(var u=0,f=n.length;u<f;u++)this.setCollisionByIndex(n[u],t,i,!1);r&&this.calculateFaces(i)},setCollisionBetween:function(n,t,i,r,u){if(typeof i=="undefined"&&(i=!0),typeof u=="undefined"&&(u=!0),r=this.getLayer(r),!(n>t)){for(var f=n;f<=t;f++)this.setCollisionByIndex(f,i,r,!1);u&&this.calculateFaces(r)}},setCollisionByExclusion:function(n,t,i,r){typeof t=="undefined"&&(t=!0);typeof r=="undefined"&&(r=!0);i=this.getLayer(i);for(var u=0,f=this.tiles.length;u<f;u++)n.indexOf(u)===-1&&this.setCollisionByIndex(u,t,i,!1);r&&this.calculateFaces(i)},setCollisionByIndex:function(n,t,i,r){var o,f,e,u;for(typeof t=="undefined"&&(t=!0),typeof i=="undefined"&&(i=this.currentLayer),typeof r=="undefined"&&(r=!0),t?this.collideIndexes.push(n):(o=this.collideIndexes.indexOf(n),o>-1&&this.collideIndexes.splice(o,1)),f=0;f<this.layers[i].height;f++)for(e=0;e<this.layers[i].width;e++)u=this.layers[i].data[f][e],u&&u.index===n&&(t?u.setCollision(!0,!0,!0,!0):u.resetCollision(),u.faceTop=t,u.faceBottom=t,u.faceLeft=t,u.faceRight=t);return r&&this.calculateFaces(i),i},getLayer:function(t){return typeof t=="undefined"?t=this.currentLayer:typeof t=="string"?t=this.getLayerIndex(t):t instanceof n.TilemapLayer&&(t=t.index),t},setPreventRecalculate:function(n){if(n===!0&&this.preventingRecalculate!==!0&&(this.preventingRecalculate=!0,this.needToRecalculate={}),n===!1&&this.preventingRecalculate===!0){this.preventingRecalculate=!1;for(var t in this.needToRecalculate)this.calculateFaces(t);this.needToRecalculate=!1}},calculateFaces:function(n){var i,s,r,h,t;if(this.preventingRecalculate){this.needToRecalculate[n]=!0;return}var u=null,f=null,e=null,o=null;for(i=0,s=this.layers[n].height;i<s;i++)for(r=0,h=this.layers[n].width;r<h;r++)t=this.layers[n].data[i][r],t&&(u=this.getTileAbove(n,r,i),f=this.getTileBelow(n,r,i),e=this.getTileLeft(n,r,i),o=this.getTileRight(n,r,i),t.collides&&(t.faceTop=!0,t.faceBottom=!0,t.faceLeft=!0,t.faceRight=!0),u&&u.collides&&(t.faceTop=!1),f&&f.collides&&(t.faceBottom=!1),e&&e.collides&&(t.faceLeft=!1),o&&o.collides&&(t.faceRight=!1))},getTileAbove:function(n,t,i){return i>0?this.layers[n].data[i-1][t]:null},getTileBelow:function(n,t,i){return i<this.layers[n].height-1?this.layers[n].data[i+1][t]:null},getTileLeft:function(n,t,i){return t>0?this.layers[n].data[i][t-1]:null},getTileRight:function(n,t,i){return t<this.layers[n].width-1?this.layers[n].data[i][t+1]:null},setLayer:function(n){n=this.getLayer(n);this.layers[n]&&(this.currentLayer=n)},hasTile:function(n,t,i){return i=this.getLayer(i),this.layers[i].data[t][n].index>-1},removeTile:function(t,i,r){if(r=this.getLayer(r),t>=0&&t<this.layers[r].width&&i>=0&&i<this.layers[r].height&&this.hasTile(t,i,r)){var u=this.layers[r].data[i][t];return this.layers[r].data[i][t]=new n.Tile(this.layers[r],-1,t,i,this.tileWidth,this.tileHeight),this.layers[r].dirty=!0,this.calculateFaces(r),u}},removeTileWorldXY:function(n,t,i,r,u){return u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.removeTile(n,t,u)},putTile:function(t,i,r,u){if(t===null)return this.removeTile(i,r,u);if(u=this.getLayer(u),i>=0&&i<this.layers[u].width&&r>=0&&r<this.layers[u].height){var f;return t instanceof n.Tile?(f=t.index,this.hasTile(i,r,u)?this.layers[u].data[r][i].copy(t):this.layers[u].data[r][i]=new n.Tile(u,f,i,r,t.width,t.height)):(f=t,this.hasTile(i,r,u)?this.layers[u].data[r][i].index=f:this.layers[u].data[r][i]=new n.Tile(this.layers[u],f,i,r,this.tileWidth,this.tileHeight)),this.collideIndexes.indexOf(f)>-1?this.layers[u].data[r][i].setCollision(!0,!0,!0,!0):this.layers[u].data[r][i].resetCollision(),this.layers[u].dirty=!0,this.calculateFaces(u),this.layers[u].data[r][i]}return null},putTileWorldXY:function(n,t,i,r,u,f){return f=this.getLayer(f),t=this.game.math.snapToFloor(t,r)/r,i=this.game.math.snapToFloor(i,u)/u,this.putTile(n,t,i,f)},searchTileIndex:function(n,t,i,r){var e,u,f;if(typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=!1),r=this.getLayer(r),e=0,i){for(u=this.layers[r].height-1;u>=0;u--)for(f=this.layers[r].width-1;f>=0;f--)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}}else for(u=0;u<this.layers[r].height;u++)for(f=0;f<this.layers[r].width;f++)if(this.layers[r].data[u][f].index===n){if(e===t)return this.layers[r].data[u][f];e++}return null},getTile:function(n,t,i,r){return typeof r=="undefined"&&(r=!1),i=this.getLayer(i),n>=0&&n<this.layers[i].width&&t>=0&&t<this.layers[i].height?this.layers[i].data[t][n].index===-1?r?this.layers[i].data[t][n]:null:this.layers[i].data[t][n]:null},getTileWorldXY:function(n,t,i,r,u){return typeof i=="undefined"&&(i=this.tileWidth),typeof r=="undefined"&&(r=this.tileHeight),u=this.getLayer(u),n=this.game.math.snapToFloor(n,i)/i,t=this.game.math.snapToFloor(t,r)/r,this.getTile(n,t,u)},copy:function(n,t,i,r,u){var f,e;if(u=this.getLayer(u),!this.layers[u]){this._results.length=0;return}for(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=this.layers[u].width),typeof r=="undefined"&&(r=this.layers[u].height),n<0&&(n=0),t<0&&(t=0),i>this.layers[u].width&&(i=this.layers[u].width),r>this.layers[u].height&&(r=this.layers[u].height),this._results.length=0,this._results.push({x:n,y:t,width:i,height:r,layer:u}),f=t;f<t+r;f++)for(e=n;e<n+i;e++)this._results.push(this.layers[u].data[f][e]);return this._results},paste:function(n,t,i,r){var f,e,u;if(typeof n=="undefined"&&(n=0),typeof t=="undefined"&&(t=0),r=this.getLayer(r),i&&!(i.length<2)){for(f=i[1].x-n,e=i[1].y-t,u=1;u<i.length;u++)this.layers[r].data[e+i[u].y][f+i[u].x].copy(i[u]);this.layers[r].dirty=!0;this.calculateFaces(r)}},swap:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._tempA=n,this._tempB=t,this._results.forEach(this.swapHandler,this),this.paste(i,r,this._results,e))},swapHandler:function(n){n.index===this._tempA?n.index=this._tempB:n.index===this._tempB&&(n.index=this._tempA)},forEach:function(n,t,i,r,u,f,e){(e=this.getLayer(e),this.copy(i,r,u,f,e),this._results.length<2)||(this._results.forEach(n,t),this.paste(i,r,this._results,e))},replace:function(n,t,i,r,u,f,e){if(e=this.getLayer(e),this.copy(i,r,u,f,e),!(this._results.length<2)){for(var o=1;o<this._results.length;o++)this._results[o].index===n&&(this._results[o].index=t);this.paste(i,r,this._results,e)}},random:function(n,t,i,r,u){var e,f,s,o;if(u=this.getLayer(u),this.copy(n,t,i,r,u),!(this._results.length<2)){for(e=[],f=1;f<this._results.length;f++)this._results[f].index&&(s=this._results[f].index,e.indexOf(s)===-1&&e.push(s));for(o=1;o<this._results.length;o++)this._results[o].index=this.game.rnd.pick(e);this.paste(n,t,this._results,u)}},shuffle:function(t,i,r,u,f){var s,e,o;if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(s=[],e=1;e<this._results.length;e++)this._results[e].index&&s.push(this._results[e].index);for(n.Utils.shuffle(s),o=1;o<this._results.length;o++)this._results[o].index=s[o-1];this.paste(t,i,this._results,f)}},fill:function(n,t,i,r,u,f){if(f=this.getLayer(f),this.copy(t,i,r,u,f),!(this._results.length<2)){for(var e=1;e<this._results.length;e++)this._results[e].index=n;this.paste(t,i,this._results,f)}},removeAllLayers:function(){this.layers.length=0;this.currentLayer=0},dump:function(){for(var n,r="",t=[""],i=0;i<this.layers[this.currentLayer].height;i++){for(n=0;n<this.layers[this.currentLayer].width;n++)r+="%c  ",this.layers[this.currentLayer].data[i][n]>1?this.debugMap[this.layers[this.currentLayer].data[i][n]]?t.push("background: "+this.debugMap[this.layers[this.currentLayer].data[i][n]]):t.push("background: #ffffff"):t.push("background: rgb(0, 0, 0)");r+="\n"}t[0]=r;console.log.apply(console,t)},destroy:function(){this.removeAllLayers();this.data=[];this.game=null}};n.Tilemap.prototype.constructor=n.Tilemap;Object.defineProperty(n.Tilemap.prototype,"layer",{get:function(){return this.layers[this.currentLayer]},set:function(n){n!==this.currentLayer&&this.setLayer(n)}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapLayer=function(t,i,r,u,f){this.game=t;this.map=i;this.index=r;this.layer=i.layers[r];this.canvas=n.Canvas.create(u,f,"",!0);this.context=this.canvas.getContext("2d");this.baseTexture=new PIXI.BaseTexture(this.canvas);this.texture=new PIXI.Texture(this.baseTexture);this.textureFrame=new n.Frame(0,0,0,u,f,"tilemapLayer",t.rnd.uuid());n.Image.call(this,this.game,0,0,this.texture,this.textureFrame);this.name="";this.type=n.TILEMAPLAYER;this.fixedToCamera=!0;this.cameraOffset=new n.Point(0,0);this.tileColor="rgb(255, 255, 255)";this.debug=!1;this.debugAlpha=.5;this.debugColor="rgba(0, 255, 0, 1)";this.debugFill=!1;this.debugFillColor="rgba(0, 255, 0, 0.2)";this.debugCallbackColor="rgba(255, 0, 0, 1)";this.scrollFactorX=1;this.scrollFactorY=1;this.dirty=!0;this.rayStepRate=4;this.wrap=!1;this._mc={cw:i.tileWidth,ch:i.tileHeight,ga:1,dx:0,dy:0,dw:0,dh:0,tx:0,ty:0,tw:0,th:0,tl:0,maxX:0,maxY:0,startX:0,startY:0,x:0,y:0,prevX:0,prevY:0};this._results=[];this.updateMax()};n.TilemapLayer.prototype=Object.create(n.Image.prototype);n.TilemapLayer.prototype.constructor=n.TilemapLayer;n.TilemapLayer.prototype.postUpdate=function(){n.Image.prototype.postUpdate.call(this);this.scrollX=this.game.camera.x*this.scrollFactorX;this.scrollY=this.game.camera.y*this.scrollFactorY;this.render();this._cache[7]===1&&(this.position.x=(this.game.camera.view.x+this.cameraOffset.x)/this.game.camera.scale.x,this.position.y=(this.game.camera.view.y+this.cameraOffset.y)/this.game.camera.scale.y)};n.TilemapLayer.prototype.resizeWorld=function(){this.game.world.setBounds(0,0,this.layer.widthInPixels,this.layer.heightInPixels)};n.TilemapLayer.prototype._fixX=function(n){return(n<0&&(n=0),this.scrollFactorX===1)?n:this._mc.x+(n-this._mc.x/this.scrollFactorX)};n.TilemapLayer.prototype._unfixX=function(n){return this.scrollFactorX===1?n:this._mc.x/this.scrollFactorX+(n-this._mc.x)};n.TilemapLayer.prototype._fixY=function(n){return(n<0&&(n=0),this.scrollFactorY===1)?n:this._mc.y+(n-this._mc.y/this.scrollFactorY)};n.TilemapLayer.prototype._unfixY=function(n){return this.scrollFactorY===1?n:this._mc.y/this.scrollFactorY+(n-this._mc.y)};n.TilemapLayer.prototype.getTileX=function(n){return this.game.math.snapToFloor(this._fixX(n),this.map.tileWidth)/this.map.tileWidth};n.TilemapLayer.prototype.getTileY=function(n){return this.game.math.snapToFloor(this._fixY(n),this.map.tileHeight)/this.map.tileHeight};n.TilemapLayer.prototype.getTileXY=function(n,t,i){return i.x=this.getTileX(n),i.y=this.getTileY(t),i};n.TilemapLayer.prototype.getRayCastTiles=function(n,t,i,r){var u,f,e;if((typeof t=="undefined"||t===null)&&(t=this.rayStepRate),typeof i=="undefined"&&(i=!1),typeof r=="undefined"&&(r=!1),u=this.getTiles(n.x,n.y,n.width,n.height,i,r),u.length===0)return[];var o=n.coordinatesOnLine(t),h=o.length,s=[];for(f=0;f<u.length;f++)for(e=0;e<h;e++)if(u[f].containsPoint(o[e][0],o[e][1])){s.push(u[f]);break}return s};n.TilemapLayer.prototype.getTiles=function(n,t,i,r,u,f){var e,o;for(typeof u=="undefined"&&(u=!1),typeof f=="undefined"&&(f=!1),n=this._fixX(n),t=this._fixY(t),i>this.layer.widthInPixels&&(i=this.layer.widthInPixels),r>this.layer.heightInPixels&&(r=this.layer.heightInPixels),this._mc.tx=this.game.math.snapToFloor(n,this._mc.cw)/this._mc.cw,this._mc.ty=this.game.math.snapToFloor(t,this._mc.ch)/this._mc.ch,this._mc.tw=(this.game.math.snapToCeil(i,this._mc.cw)+this._mc.cw)/this._mc.cw,this._mc.th=(this.game.math.snapToCeil(r,this._mc.ch)+this._mc.ch)/this._mc.ch,this._results.length=0,e=this._mc.ty;e<this._mc.ty+this._mc.th;e++)for(o=this._mc.tx;o<this._mc.tx+this._mc.tw;o++)this.layer.data[e]&&this.layer.data[e][o]&&((u||f)&&!this.layer.data[e][o].isInteresting(u,f)||this._results.push(this.layer.data[e][o]));return this._results};n.TilemapLayer.prototype.updateMax=function(){this._mc.maxX=this.game.math.ceil(this.canvas.width/this.map.tileWidth)+1;this._mc.maxY=this.game.math.ceil(this.canvas.height/this.map.tileHeight)+1;this.dirty=!0};n.TilemapLayer.prototype.render=function(){var u,i,f,r,e,t;if(this.layer.dirty&&(this.dirty=!0),this.dirty&&this.visible){for(this._mc.prevX=this._mc.dx,this._mc.prevY=this._mc.dy,this._mc.dx=-(this._mc.x-this._mc.startX*this.map.tileWidth),this._mc.dy=-(this._mc.y-this._mc.startY*this.map.tileHeight),this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.fillStyle=this.tileColor,this.debug&&(this.context.globalAlpha=this.debugAlpha),i=this._mc.startY,f=this._mc.startY+this._mc.maxY;i<f;i++){if(this._column=null,i<0&&this.wrap?this._column=this.layer.data[i+this.map.height]:i>=this.map.height&&this.wrap?this._column=this.layer.data[i-this.map.height]:this.layer.data[i]&&(this._column=this.layer.data[i]),this._column)for(r=this._mc.startX,e=this._mc.startX+this._mc.maxX;r<e;r++)t=null,r<0&&this.wrap?t=this._column[r+this.map.width]:r>=this.map.width&&this.wrap?t=this._column[r-this.map.width]:this._column[r]&&(t=this._column[r]),t&&t.index>-1&&(u=this.map.tilesets[this.map.tiles[t.index][2]],this.debug===!1&&t.alpha!==this.context.globalAlpha&&(this.context.globalAlpha=t.alpha),u.draw(this.context,Math.floor(this._mc.tx),Math.floor(this._mc.ty),t.index),t.debug&&(this.context.fillStyle="rgba(0, 255, 0, 0.4)",this.context.fillRect(Math.floor(this._mc.tx),Math.floor(this._mc.ty),this.map.tileWidth,this.map.tileHeight))),this._mc.tx+=this.map.tileWidth;this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}return this.debug&&(this.context.globalAlpha=1,this.renderDebug()),this.game.renderType===n.WEBGL&&PIXI.updateWebGLTexture(this.baseTexture,this.game.renderer.gl),this.dirty=!1,this.layer.dirty=!1,!0}};n.TilemapLayer.prototype.renderDebug=function(){var t,r,i,u,n;for(this._mc.tx=this._mc.dx,this._mc.ty=this._mc.dy,this.context.strokeStyle=this.debugColor,this.context.fillStyle=this.debugFillColor,t=this._mc.startY,r=this._mc.startY+this._mc.maxY;t<r;t++){if(this._column=null,t<0&&this.wrap?this._column=this.layer.data[t+this.map.height]:t>=this.map.height&&this.wrap?this._column=this.layer.data[t-this.map.height]:this.layer.data[t]&&(this._column=this.layer.data[t]),this._column)for(i=this._mc.startX,u=this._mc.startX+this._mc.maxX;i<u;i++)n=null,i<0&&this.wrap?n=this._column[i+this.map.width]:i>=this.map.width&&this.wrap?n=this._column[i-this.map.width]:this._column[i]&&(n=this._column[i]),n&&(n.faceTop||n.faceBottom||n.faceLeft||n.faceRight)&&(this._mc.tx=Math.floor(this._mc.tx),this.debugFill&&this.context.fillRect(this._mc.tx,this._mc.ty,this._mc.cw,this._mc.ch),this.context.beginPath(),n.faceTop&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty)),n.faceBottom&&(this.context.moveTo(this._mc.tx,this._mc.ty+this._mc.ch),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),n.faceLeft&&(this.context.moveTo(this._mc.tx,this._mc.ty),this.context.lineTo(this._mc.tx,this._mc.ty+this._mc.ch)),n.faceRight&&(this.context.moveTo(this._mc.tx+this._mc.cw,this._mc.ty),this.context.lineTo(this._mc.tx+this._mc.cw,this._mc.ty+this._mc.ch)),this.context.stroke()),this._mc.tx+=this.map.tileWidth;this._mc.tx=this._mc.dx;this._mc.ty+=this.map.tileHeight}};Object.defineProperty(n.TilemapLayer.prototype,"scrollX",{get:function(){return this._mc.x},set:function(n){n!==this._mc.x&&(this._mc.x=n,this._mc.startX=this.game.math.floor(this._mc.x/this.map.tileWidth),this.dirty=!0)}});Object.defineProperty(n.TilemapLayer.prototype,"scrollY",{get:function(){return this._mc.y},set:function(n){n!==this._mc.y&&(this._mc.y=n,this._mc.startY=this.game.math.floor(this._mc.y/this.map.tileHeight),this.dirty=!0)}});Object.defineProperty(n.TilemapLayer.prototype,"collisionWidth",{get:function(){return this._mc.cw},set:function(n){this._mc.cw=n;this.dirty=!0}});Object.defineProperty(n.TilemapLayer.prototype,"collisionHeight",{get:function(){return this._mc.ch},set:function(n){this._mc.ch=n;this.dirty=!0}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.TilemapParser={parse:function(t,i,r,u,f,e){if(typeof r=="undefined"&&(r=32),typeof u=="undefined"&&(u=32),typeof f=="undefined"&&(f=10),typeof e=="undefined"&&(e=10),typeof i=="undefined")return this.getEmptyData();if(i===null)return this.getEmptyData(r,u,f,e);var o=t.cache.getTilemapData(i);if(o){if(o.format===n.Tilemap.CSV)return this.parseCSV(i,o.data,r,u);if(!o.format||o.format===n.Tilemap.TILED_JSON)return this.parseTiledJSON(o.data)}else console.warn("Phaser.TilemapParser.parse - No map data found for key "+i)},parseCSV:function(t,i,r,u){var f=this.getEmptyData(),e,h,o;i=i.trim();var c=[],l=i.split("\n"),a=l.length,s=0;for(e=0;e<l.length;e++){for(c[e]=[],h=l[e].split(","),o=0;o<h.length;o++)c[e][o]=new n.Tile(f.layers[0],parseInt(h[o],10),o,e,r,u);s===0&&(s=h.length)}return f.format=n.Tilemap.CSV,f.name=t,f.width=s,f.height=a,f.tileWidth=r,f.tileHeight=u,f.widthInPixels=s*r,f.heightInPixels=a*u,f.layers[0].width=s,f.layers[0].height=a,f.layers[0].widthInPixels=f.widthInPixels,f.layers[0].heightInPixels=f.heightInPixels,f.layers[0].data=c,f},getEmptyData:function(n,t,i,r){var u={},f,e;return u.width=0,u.height=0,u.tileWidth=0,u.tileHeight=0,typeof n!="undefined"&&n!==null&&(u.tileWidth=n),typeof t!="undefined"&&t!==null&&(u.tileHeight=t),typeof i!="undefined"&&i!==null&&(u.width=i),typeof r!="undefined"&&r!==null&&(u.height=r),u.orientation="orthogonal",u.version="1",u.properties={},u.widthInPixels=0,u.heightInPixels=0,f=[],e={name:"layer",x:0,y:0,width:0,height:0,widthInPixels:0,heightInPixels:0,alpha:1,visible:!0,properties:{},indexes:[],callbacks:[],bodies:[],data:[]},f.push(e),u.layers=f,u.images=[],u.objects={},u.collision={},u.tilesets=[],u.tiles=[],u},parseTiledJSON:function(t){function rt(n,t){var r={},u,i;for(u in t)i=t[u],r[i]=n[i];return r}var f,g,nt,tt,it,o,a,b,u,w,s,e,c,i,k,d,h,y,st,r;if(t.orientation!=="orthogonal")return console.warn("TilemapParser.parseTiledJSON: Only orthogonal map types are supported in this version of Phaser"),null;for(f={},f.width=t.width,f.height=t.height,f.tileWidth=t.tilewidth,f.tileHeight=t.tileheight,f.orientation=t.orientation,f.format=n.Tilemap.TILED_JSON,f.version=t.version,f.properties=t.properties,f.widthInPixels=f.width*f.tileWidth,f.heightInPixels=f.height*f.tileHeight,g=[],i=0;i<t.layers.length;i++)if(t.layers[i].type==="tilelayer"){h={name:t.layers[i].name,x:t.layers[i].x,y:t.layers[i].y,width:t.layers[i].width,height:t.layers[i].height,widthInPixels:t.layers[i].width*t.tilewidth,heightInPixels:t.layers[i].height*t.tileheight,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{},indexes:[],callbacks:[],bodies:[]};t.layers[i].properties&&(h.properties=t.layers[i].properties);var l=0,v=[],p=[];for(c=0,w=t.layers[i].data.length;c<w;c++)t.layers[i].data[c]>0?v.push(new n.Tile(h,t.layers[i].data[c],l,p.length,t.tilewidth,t.tileheight)):v.push(new n.Tile(h,-1,l,p.length,t.tilewidth,t.tileheight)),l++,l===t.layers[i].width&&(p.push(v),l=0,v=[]);h.data=p;g.push(h)}for(f.layers=g,nt=[],i=0;i<t.layers.length;i++)t.layers[i].type==="imagelayer"&&(tt={name:t.layers[i].name,image:t.layers[i].image,x:t.layers[i].x,y:t.layers[i].y,alpha:t.layers[i].opacity,visible:t.layers[i].visible,properties:{}},t.layers[i].properties&&(tt.properties=t.layers[i].properties),nt.push(tt));for(f.images=nt,it=[],i=0;i<t.tilesets.length;i++)r=t.tilesets[i],o=new n.Tileset(r.name,r.firstgid,r.tilewidth,r.tileheight,r.margin,r.spacing,r.properties),r.tileproperties&&(o.tileProperties=r.tileproperties),o.rows=Math.round((r.imageheight-r.margin)/(r.tileheight+r.spacing)),o.columns=Math.round((r.imagewidth-r.margin)/(r.tilewidth+r.spacing)),o.total=o.rows*o.columns,o.rows%1!=0||o.columns%1!=0?console.warn("TileSet image dimensions do not match expected dimensions. Tileset width/height must be evenly divisible by Tilemap tile width/height."):it.push(o);for(f.tilesets=it,a={},b={},i=0;i<t.layers.length;i++)if(t.layers[i].type==="objectgroup")for(a[t.layers[i].name]=[],b[t.layers[i].name]=[],u=0,w=t.layers[i].objects.length;u<w;u++)if(t.layers[i].objects[u].gid)e={gid:t.layers[i].objects[u].gid,name:t.layers[i].objects[u].name,x:t.layers[i].objects[u].x,y:t.layers[i].objects[u].y,visible:t.layers[i].objects[u].visible,properties:t.layers[i].objects[u].properties},a[t.layers[i].name].push(e);else if(t.layers[i].objects[u].polyline){for(e={name:t.layers[i].objects[u].name,type:t.layers[i].objects[u].type,x:t.layers[i].objects[u].x,y:t.layers[i].objects[u].y,width:t.layers[i].objects[u].width,height:t.layers[i].objects[u].height,visible:t.layers[i].objects[u].visible,properties:t.layers[i].objects[u].properties},e.polyline=[],s=0;s<t.layers[i].objects[u].polyline.length;s++)e.polyline.push([t.layers[i].objects[u].polyline[s].x,t.layers[i].objects[u].polyline[s].y]);b[t.layers[i].name].push(e);a[t.layers[i].name].push(e)}else if(t.layers[i].objects[u].polygon){for(e=rt(t.layers[i].objects[u],["name","type","x","y","visible","properties"]),e.polygon=[],s=0;s<t.layers[i].objects[u].polygon.length;s++)e.polygon.push([t.layers[i].objects[u].polygon[s].x,t.layers[i].objects[u].polygon[s].y]);a[t.layers[i].name].push(e)}else t.layers[i].objects[u].ellipse?(e=rt(t.layers[i].objects[u],["name","type","ellipse","x","y","width","height","visible","properties"]),a[t.layers[i].name].push(e)):(e=rt(t.layers[i].objects[u],["name","type","x","y","width","height","visible","properties"]),e.rectangle=!0,a[t.layers[i].name].push(e));for(f.objects=a,f.collision=b,f.tiles=[],i=0;i<f.tilesets.length;i++){var r=f.tilesets[i],l=r.tileMargin,ft=r.tileMargin,et=0,ut=0,ot=0;for(c=r.firstgid;c<r.firstgid+r.total;c++){if(f.tiles[c]=[l,ft,i],l+=r.tileWidth+r.tileSpacing,et++,et===r.total)break;if(ut++,ut===r.columns&&(l=r.tileMargin,ft+=r.tileHeight+r.tileSpacing,ut=0,ot++,ot===r.rows))break}}for(i=0;i<f.layers.length;i++)for(h=f.layers[i],k=0;k<h.data.length;k++)for(v=h.data[k],d=0;d<v.length;d++)(y=v[d],y.index<0)||(st=f.tiles[y.index][2],r=f.tilesets[st],r.tileProperties&&r.tileProperties[y.index-r.firstgid]&&(y.properties=r.tileProperties[y.index-r.firstgid]));return f}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
n.Tileset=function(n,t,i,r,u,f,e){(typeof i=="undefined"||i<=0)&&(i=32);(typeof r=="undefined"||r<=0)&&(r=32);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=0);this.name=n;this.firstgid=t;this.tileWidth=i;this.tileHeight=r;this.tileMargin=u;this.tileSpacing=f;this.properties=e;this.image=null;this.rows=0;this.columns=0;this.total=0;this.drawCoords=[]};n.Tileset.prototype={draw:function(n,t,i,r){this.image&&this.drawCoords[r]&&n.drawImage(this.image,this.drawCoords[r][0],this.drawCoords[r][1],this.tileWidth,this.tileHeight,t,i,this.tileWidth,this.tileHeight)},setImage:function(n){var i,r;this.image=n;this.rows=Math.round((n.height-this.tileMargin)/(this.tileHeight+this.tileSpacing));this.columns=Math.round((n.width-this.tileMargin)/(this.tileWidth+this.tileSpacing));this.total=this.rows*this.columns;this.drawCoords.length=0;var t=this.tileMargin,u=this.tileMargin,f=this.firstgid;for(i=0;i<this.rows;i++){for(r=0;r<this.columns;r++)this.drawCoords[f]=[t,u],t+=this.tileWidth+this.tileSpacing,f++;t=this.tileMargin;u+=this.tileHeight+this.tileSpacing}},setSpacing:function(n,t){this.tileMargin=n;this.tileSpacing=t;this.setImage(this.image)}};n.Tileset.prototype.constructor=n.Tileset;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
typeof exports!="undefined"?(typeof module!="undefined"&&module.exports&&(exports=module.exports=n),exports.Phaser=n):typeof define!="undefined"&&define.amd?define("Phaser",function(){return i.Phaser=n}()):i.Phaser=n}).call(this);!function(n){"object"==typeof exports?module.exports=n():"function"==typeof define&&define.amd?define("p2",function(){return this.p2=n()}()):"undefined"!=typeof window?window.p2=n():"undefined"!=typeof global?self.p2=n():"undefined"!=typeof self&&(self.p2=n())}(function(){return function n(t,i,r){function u(f,o){var h,s;if(!i[f]){if(!t[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);throw new Error("Cannot find module '"+f+"'");}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){n=function i(t,r,u){function f(e,s){var c,h;if(!r[e]){if(!t[e]){if(c=typeof n=="function"&&n,!s&&c)return c(e,!0);if(o)return o(e,!0);throw new Error("Cannot find module '"+e+"'");}h=r[e]={exports:{}};t[e][0].call(h.exports,function(n){var i=t[e][1][n];return f(i?i:n)},h,h.exports,i,t,r,u)}return r[e].exports}for(var o=typeof n=="function"&&n,e=0;e<u.length;e++)f(u[e]);return f}({PcZj9L:[function(n,t,i){function f(n,t){var r=typeof n,u,e,i;if(t==="base64"&&r==="string")for(n=kr(n);n.length%4!=0;)n=n+"=";if(r==="number")u=ur(n);else if(r==="string")u=f.byteLength(n,t);else if(r==="object")u=ur(n.length);else throw new Error("First argument needs to be a number, array or string.");if(e=ir(new y(u)),f.isBuffer(n))e.set(n);else if(gr(n))for(i=0;i<u;i++)e[i]=f.isBuffer(n)?n.readUInt8(i):n[i];else r==="string"&&e.write(n,0,t);return e}function cr(n,t,i,r){var e,o,u,s;if(i=Number(i)||0,e=n.length-i,r?(r=Number(r),r>e&&(r=e)):r=e,o=t.length,o%2!=0)throw new Error("Invalid hex string");for(r>o/2&&(r=o/2),u=0;u<r;u++){if(s=parseInt(t.substr(u*2,2),16),isNaN(s))throw new Error("Invalid hex string");n[i+u]=s}return f._charsWritten=u*2,u}function lr(n,t,i,r){return f._charsWritten=l(er(t),n,i,r)}function p(n,t,i,r){return f._charsWritten=l(nu(t),n,i,r)}function ar(n,t,i,r){return p(n,t,i,r)}function vr(n,t,i,r){return f._charsWritten=l(or(t),n,i,r)}function w(n,t,i,r){var f,u;isFinite(t)?isFinite(i)||(r=i,i=undefined):(f=r,r=t,t=i,i=f);t=Number(t)||0;u=this.length-t;i?(i=Number(i),i>u&&(i=u)):i=u;r=String(r||"utf8").toLowerCase();switch(r){case"hex":return cr(this,n,t,i);case"utf8":case"utf-8":return lr(this,n,t,i);case"ascii":return p(this,n,t,i);case"binary":return ar(this,n,t,i);case"base64":return vr(this,n,t,i);default:throw new Error("Unknown encoding");}}function s(n,t,i){var r=this instanceof u?this._proxy:this;if(n=String(n||"utf8").toLowerCase(),t=Number(t)||0,i=i!==undefined?Number(i):i=r.length,i===t)return"";switch(n){case"hex":return br(r,t,i);case"utf8":case"utf-8":return pr(r,t,i);case"ascii":return d(r,t,i);case"binary":return wr(r,t,i);case"base64":return yr(r,t,i);default:throw new Error("Unknown encoding");}}function b(){return{type:"Buffer",data:Array.prototype.slice.call(this,0)}}function k(n,t,i,r){var f=this,u;if((i||(i=0),r||r===0||(r=this.length),t||(t=0),r!==i)&&n.length!==0&&f.length!==0){if(r<i)throw new Error("sourceEnd < sourceStart");if(t<0||t>=n.length)throw new Error("targetStart out of bounds");if(i<0||i>=f.length)throw new Error("sourceStart out of bounds");if(r<0||r>f.length)throw new Error("sourceEnd out of bounds");for(r>this.length&&(r=this.length),n.length-t<r-i&&(r=n.length-t+i),u=0;u<r-i;u++)n[u+t]=this[u+i]}}function yr(t,i,r){var u=t.slice(i,r);return n("base64-js").fromByteArray(u)}function pr(n,t,i){for(var u=n.slice(t,i),e="",f="",r=0;r<u.length;)u[r]<=127?(e+=sr(f)+String.fromCharCode(u[r]),f=""):f+="%"+u[r].toString(16),r++;return e+sr(f)}function d(n,t,i){for(var u=n.slice(t,i),f="",r=0;r<u.length;r++)f+=String.fromCharCode(u[r]);return f}function wr(n,t,i){return d(n,t,i)}function br(n,t,i){var f=n.length,u,r;for((!t||t<0)&&(t=0),(!i||i<0||i>f)&&(i=f),u="",r=t;r<i;r++)u+=fr(n[r]);return u}function g(n,t){var i=this.length;return n=rr(n,i,0),t=rr(t,i,i),ir(this.subarray(n,t))}function nt(n,t){var i=this;if(t||(r(n!==undefined&&n!==null,"missing offset"),r(n<i.length,"Trying to read beyond buffer length")),!(n>=i.length))return i[n]}function tt(n,t,i,u){var f,s;if(u||(r(typeof i=="boolean","missing or invalid endian"),r(t!==undefined&&t!==null,"missing offset"),r(t+1<n.length,"Trying to read beyond buffer length")),f=n.length,!(t>=f))return t+1===f?(s=new e(new o(2)),s.setUint8(0,n[f-1]),s.getUint16(0,i)):n._dataview.getUint16(t,i)}function it(n,t){return tt(this,n,!0,t)}function rt(n,t){return tt(this,n,!1,t)}function ut(n,t,i,u){var s,h,f;if(u||(r(typeof i=="boolean","missing or invalid endian"),r(t!==undefined&&t!==null,"missing offset"),r(t+3<n.length,"Trying to read beyond buffer length")),s=n.length,!(t>=s)){if(t+3>=s){for(h=new e(new o(4)),f=0;f+t<s;f++)h.setUint8(f,n[f+t]);return h.getUint32(0,i)}return n._dataview.getUint32(t,i)}}function ft(n,t){return ut(this,n,!0,t)}function et(n,t){return ut(this,n,!1,t)}function ot(n,t){var i=this;if(t||(r(n!==undefined&&n!==null,"missing offset"),r(n<i.length,"Trying to read beyond buffer length")),!(n>=i.length))return i._dataview.getInt8(n)}function st(n,t,i,u){var f,s;if(u||(r(typeof i=="boolean","missing or invalid endian"),r(t!==undefined&&t!==null,"missing offset"),r(t+1<n.length,"Trying to read beyond buffer length")),f=n.length,!(t>=f))return t+1===f?(s=new e(new o(2)),s.setUint8(0,n[f-1]),s.getInt16(0,i)):n._dataview.getInt16(t,i)}function ht(n,t){return st(this,n,!0,t)}function ct(n,t){return st(this,n,!1,t)}function lt(n,t,i,u){var s,h,f;if(u||(r(typeof i=="boolean","missing or invalid endian"),r(t!==undefined&&t!==null,"missing offset"),r(t+3<n.length,"Trying to read beyond buffer length")),s=n.length,!(t>=s)){if(t+3>=s){for(h=new e(new o(4)),f=0;f+t<s;f++)h.setUint8(f,n[f+t]);return h.getInt32(0,i)}return n._dataview.getInt32(t,i)}}function at(n,t){return lt(this,n,!0,t)}function vt(n,t){return lt(this,n,!1,t)}function yt(n,t,i,u){return u||(r(typeof i=="boolean","missing or invalid endian"),r(t+3<n.length,"Trying to read beyond buffer length")),n._dataview.getFloat32(t,i)}function pt(n,t){return yt(this,n,!0,t)}function wt(n,t){return yt(this,n,!1,t)}function bt(n,t,i,u){return u||(r(typeof i=="boolean","missing or invalid endian"),r(t+7<n.length,"Trying to read beyond buffer length")),n._dataview.getFloat64(t,i)}function kt(n,t){return bt(this,n,!0,t)}function dt(n,t){return bt(this,n,!1,t)}function gt(n,t,i){var u=this;(i||(r(n!==undefined&&n!==null,"missing value"),r(t!==undefined&&t!==null,"missing offset"),r(t<u.length,"trying to write beyond buffer length"),a(n,255)),t>=u.length)||(u[t]=n)}function ni(n,t,i,u,f){var s,h;(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+1<n.length,"trying to write beyond buffer length"),a(t,65535)),s=n.length,i>=s)||(i+1===s?(h=new e(new o(2)),h.setUint16(0,t,u),n[i]=h.getUint8(0)):n._dataview.setUint16(i,t,u))}function ti(n,t,i){ni(this,n,t,!0,i)}function ii(n,t,i){ni(this,n,t,!1,i)}function ri(n,t,i,u,f){var h,c,s;if(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+3<n.length,"trying to write beyond buffer length"),a(t,4294967295)),h=n.length,!(i>=h))if(i+3>=h)for(c=new e(new o(4)),c.setUint32(0,t,u),s=0;s+i<h;s++)n[s+i]=c.getUint8(s);else n._dataview.setUint32(i,t,u)}function ui(n,t,i){ri(this,n,t,!0,i)}function fi(n,t,i){ri(this,n,t,!1,i)}function ei(n,t,i){var u=this;(i||(r(n!==undefined&&n!==null,"missing value"),r(t!==undefined&&t!==null,"missing offset"),r(t<u.length,"Trying to write beyond buffer length"),v(n,127,-128)),t>=u.length)||u._dataview.setInt8(t,n)}function oi(n,t,i,u,f){var s,h;(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+1<n.length,"Trying to write beyond buffer length"),v(t,32767,-32768)),s=n.length,i>=s)||(i+1===s?(h=new e(new o(2)),h.setInt16(0,t,u),n[i]=h.getUint8(0)):n._dataview.setInt16(i,t,u))}function si(n,t,i){oi(this,n,t,!0,i)}function hi(n,t,i){oi(this,n,t,!1,i)}function ci(n,t,i,u,f){var h,c,s;if(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+3<n.length,"Trying to write beyond buffer length"),v(t,2147483647,-2147483648)),h=n.length,!(i>=h))if(i+3>=h)for(c=new e(new o(4)),c.setInt32(0,t,u),s=0;s+i<h;s++)n[s+i]=c.getUint8(s);else n._dataview.setInt32(i,t,u)}function li(n,t,i){ci(this,n,t,!0,i)}function ai(n,t,i){ci(this,n,t,!1,i)}function vi(n,t,i,u,f){var h,c,s;if(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+3<n.length,"Trying to write beyond buffer length"),hr(t,34028234663852886e22,-34028234663852886e22)),h=n.length,!(i>=h))if(i+3>=h)for(c=new e(new o(4)),c.setFloat32(0,t,u),s=0;s+i<h;s++)n[s+i]=c.getUint8(s);else n._dataview.setFloat32(i,t,u)}function yi(n,t,i){vi(this,n,t,!0,i)}function pi(n,t,i){vi(this,n,t,!1,i)}function wi(n,t,i,u,f){var h,c,s;if(f||(r(t!==undefined&&t!==null,"missing value"),r(typeof u=="boolean","missing or invalid endian"),r(i!==undefined&&i!==null,"missing offset"),r(i+7<n.length,"Trying to write beyond buffer length"),hr(t,17976931348623157e292,-17976931348623157e292)),h=n.length,!(i>=h))if(i+7>=h)for(c=new e(new o(8)),c.setFloat64(0,t,u),s=0;s+i<h;s++)n[s+i]=c.getUint8(s);else n._dataview.setFloat64(i,t,u)}function bi(n,t,i){wi(this,n,t,!0,i)}function ki(n,t,i){wi(this,n,t,!1,i)}function di(n,t,i){if(n||(n=0),t||(t=0),i||(i=this.length),typeof n=="string"&&(n=n.charCodeAt(0)),typeof n!="number"||isNaN(n))throw new Error("value is not a number");if(i<t)throw new Error("end < start");if(i!==t&&this.length!==0){if(t<0||t>=this.length)throw new Error("start out of bounds");if(i<0||i>this.length)throw new Error("end out of bounds");for(var r=t;r<i;r++)this[r]=n}}function gi(){for(var t=[],r=this.length,n=0;n<r;n++)if(t[n]=fr(this[n]),n===i.INSPECT_MAX_BYTES){t[n+1]="...";break}return"<Buffer "+t.join(" ")+">"}function nr(){return new f(this).buffer}function kr(n){return n.trim?n.trim():n.replace(/^\s+|\s+$/g,"")}function dr(){var n=new y(0);n.foo=function(){return 42};try{return 42===n.foo()}catch(t){return!1}}function u(n){this._arr=n;n.byteLength!==0&&(this._dataview=new e(n.buffer,n.byteOffset,n.byteLength))}function ir(n){if(c===undefined&&(c=dr()),c)return n.write=w,n.toString=s,n.toLocaleString=s,n.toJSON=b,n.copy=k,n.slice=g,n.readUInt8=nt,n.readUInt16LE=it,n.readUInt16BE=rt,n.readUInt32LE=ft,n.readUInt32BE=et,n.readInt8=ot,n.readInt16LE=ht,n.readInt16BE=ct,n.readInt32LE=at,n.readInt32BE=vt,n.readFloatLE=pt,n.readFloatBE=wt,n.readDoubleLE=kt,n.readDoubleBE=dt,n.writeUInt8=gt,n.writeUInt16LE=ti,n.writeUInt16BE=ii,n.writeUInt32LE=ui,n.writeUInt32BE=fi,n.writeInt8=ei,n.writeInt16LE=si,n.writeInt16BE=hi,n.writeInt32LE=li,n.writeInt32BE=ai,n.writeFloatLE=yi,n.writeFloatBE=pi,n.writeDoubleLE=bi,n.writeDoubleBE=ki,n.fill=di,n.inspect=gi,n.toArrayBuffer=nr,n._isBuffer=!0,n.byteLength!==0&&(n._dataview=new e(n.buffer,n.byteOffset,n.byteLength)),n;var t=new u(n),i=new Proxy(t,tr);return t._proxy=i,i}function rr(n,t,i){return typeof n!="number"?i:(n=~~n,n>=t)?t:n>=0?n:(n+=t,n>=0)?n:0}function ur(n){return n=~~Math.ceil(+n),n<0?0:n}function gr(n){return Array.isArray(n)||f.isBuffer(n)||n&&typeof n=="object"&&typeof n.length=="number"}function fr(n){return n<16?"0"+n.toString(16):n.toString(16)}function er(n){for(var u,i,r=[],t=0;t<n.length;t++)if(n.charCodeAt(t)<=127)r.push(n.charCodeAt(t));else for(u=encodeURIComponent(n.charAt(t)).substr(1).split("%"),i=0;i<u.length;i++)r.push(parseInt(u[i],16));return r}function nu(n){for(var i=[],t=0;t<n.length;t++)i.push(n.charCodeAt(t)&255);return i}function or(t){return n("base64-js").toByteArray(t)}function l(n,t,i,r){for(var u=0;u<r;){if(u+i>=t.length||u>=n.length)break;t[u+i]=n[u];u++}return u}function sr(n){try{return decodeURIComponent(n)}catch(t){return String.fromCharCode(65533)}}function a(n,t){r(typeof n=="number","cannot write a non-number as a number");r(n>=0,"specified a negative value for writing an unsigned value");r(n<=t,"value is larger than maximum value for type");r(Math.floor(n)===n,"value has a fractional component")}function v(n,t,i){r(typeof n=="number","cannot write a non-number as a number");r(n<=t,"value larger than maximum allowed value");r(n>=i,"value smaller than minimum allowed value");r(Math.floor(n)===n,"value has a fractional component")}function hr(n,t,i){r(typeof n=="number","cannot write a non-number as a number");r(n<=t,"value larger than maximum allowed value");r(n>=i,"value smaller than minimum allowed value")}function r(n,t){if(!n)throw new Error(t||"Failed assertion");}var h=n("typedarray"),e=typeof DataView=="undefined"?h.DataView:DataView,o=typeof ArrayBuffer=="undefined"?h.ArrayBuffer:ArrayBuffer,y=typeof Uint8Array=="undefined"?h.Uint8Array:Uint8Array,c,tr;i.Buffer=f;i.SlowBuffer=f;i.INSPECT_MAX_BYTES=50;f.poolSize=8192;f.isEncoding=function(n){switch((n+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};f.isBuffer=function(n){return n&&n._isBuffer};f.byteLength=function(n,t){switch(t||"utf8"){case"hex":return n.length/2;case"utf8":case"utf-8":return er(n).length;case"ascii":case"binary":return n.length;case"base64":return or(n).length;default:throw new Error("Unknown encoding");}};f.concat=function(n,t){var i,r,u,e;if(!Array.isArray(n))throw new Error("Usage: Buffer.concat(list, [totalLength])\nlist should be an Array.");if(n.length===0)return new f(0);if(n.length===1)return n[0];if(typeof t!="number")for(t=0,i=0;i<n.length;i++)r=n[i],t+=r.length;for(u=new f(t),e=0,i=0;i<n.length;i++)r=n[i],r.copy(u,e),e+=r.length;return u};u.prototype.write=w;u.prototype.toString=s;u.prototype.toLocaleString=s;u.prototype.toJSON=b;u.prototype.copy=k;u.prototype.slice=g;u.prototype.readUInt8=nt;u.prototype.readUInt16LE=it;u.prototype.readUInt16BE=rt;u.prototype.readUInt32LE=ft;u.prototype.readUInt32BE=et;u.prototype.readInt8=ot;u.prototype.readInt16LE=ht;u.prototype.readInt16BE=ct;u.prototype.readInt32LE=at;u.prototype.readInt32BE=vt;u.prototype.readFloatLE=pt;u.prototype.readFloatBE=wt;u.prototype.readDoubleLE=kt;u.prototype.readDoubleBE=dt;u.prototype.writeUInt8=gt;u.prototype.writeUInt16LE=ti;u.prototype.writeUInt16BE=ii;u.prototype.writeUInt32LE=ui;u.prototype.writeUInt32BE=fi;u.prototype.writeInt8=ei;u.prototype.writeInt16LE=si;u.prototype.writeInt16BE=hi;u.prototype.writeInt32LE=li;u.prototype.writeInt32BE=ai;u.prototype.writeFloatLE=yi;u.prototype.writeFloatBE=pi;u.prototype.writeDoubleLE=bi;u.prototype.writeDoubleBE=ki;u.prototype.fill=di;u.prototype.inspect=gi;u.prototype.toArrayBuffer=nr;u.prototype._isBuffer=!0;u.prototype.subarray=function(){return this._arr.subarray.apply(this._arr,arguments)};u.prototype.set=function(){return this._arr.set.apply(this._arr,arguments)};tr={get:function(n,t){return t in n?n[t]:n._arr[t]},set:function(n,t,i){n._arr[t]=i}}},{"base64-js":3,typedarray:4}],"native-buffer-browserify":[function(n,t){t.exports=n("PcZj9L")},{}],3:[function(n,t){(function(){"use strict";function i(t){var i,e,o,r,f,u;if(t.length%4>0)throw"Invalid string. Length must be a multiple of 4";for(f=t.indexOf("="),f=f>0?t.length-f:0,u=[],o=f>0?t.length-4:t.length,i=0,e=0;i<o;i+=4,e+=3)r=n.indexOf(t[i])<<18|n.indexOf(t[i+1])<<12|n.indexOf(t[i+2])<<6|n.indexOf(t[i+3]),u.push((r&16711680)>>16),u.push((r&65280)>>8),u.push(r&255);return f===2?(r=n.indexOf(t[i])<<2|n.indexOf(t[i+1])>>4,u.push(r&255)):f===1&&(r=n.indexOf(t[i])<<10|n.indexOf(t[i+1])<<4|n.indexOf(t[i+2])>>2,u.push(r>>8&255),u.push(r&255)),u}function r(t){function o(t){return n[t>>18&63]+n[t>>12&63]+n[t>>6&63]+n[t&63]}for(var f=t.length%3,i="",r,u=0,e=t.length-f;u<e;u+=3)r=(t[u]<<16)+(t[u+1]<<8)+t[u+2],i+=o(r);switch(f){case 1:r=t[t.length-1];i+=n[r>>2];i+=n[r<<4&63];i+="==";break;case 2:r=(t[t.length-2]<<8)+t[t.length-1];i+=n[r>>10];i+=n[r>>4&63];i+=n[r<<2&63];i+="="}return i}var n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";t.exports.toByteArray=i;t.exports.fromByteArray=r})()},{}],4:[function(n,t,i){function o(n){if(l&&e)for(var i=l(n),t=0;t<i.length;t+=1)e(n,i[t],{value:n[i[t]],writable:!1,enumerable:!1,configurable:!1})}function nt(n){function i(t){e(n,t,{get:function(){return n._getter(t)},set:function(i){n._setter(t,i)},enumerable:!0,configurable:!1})}if(e){if(n.length>p)throw new RangeError("Array too large for polyfill");for(var t=0;t<n.length;t+=1)i(t)}}function s(n,t){var i=32-t;return n<<i>>i}function h(n,t){var i=32-t;return n<<i>>>i}function tt(n){return[n&255]}function it(n){return s(n[0],8)}function rt(n){return[n&255]}function a(n){return h(n[0],8)}function ut(n){return n=g(Number(n)),[n<0?0:n>255?255:n&255]}function ft(n){return[n>>8&255,n&255]}function et(n){return s(n[0]<<8|n[1],16)}function ot(n){return[n>>8&255,n&255]}function st(n){return h(n[0]<<8|n[1],16)}function ht(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}function ct(n){return s(n[0]<<24|n[1]<<16|n[2]<<8|n[3],32)}function lt(n){return[n>>24&255,n>>16&255,n>>8&255,n&255]}function at(n){return h(n[0]<<24|n[1]<<16|n[2]<<8|n[3],32)}function v(n,t,i){function v(n){var t=f(n),i=n-t;return i<.5?t:i>.5?t+1:t%2?t+1:t}var l=(1<<t-1)-1,h,r,e,o,s,c,a;for(n!==n?(r=(1<<t)-1,e=u(2,i-1),h=0):n===Infinity||n===-Infinity?(r=(1<<t)-1,e=0,h=n<0?1:0):n===0?(r=0,e=0,h=1/n==-Infinity?1:0):(h=n<0,n=b(n),n>=u(2,1-l)?(r=d(f(k(n)/w),1023),e=v(n/u(2,r)*u(2,i)),e/u(2,i)>=2&&(r=r+1,e=1),r>l?(r=(1<<t)-1,e=0):(r=r+l,e=e-u(2,i))):(r=0,e=v(n/u(2,1-l-i)))),s=[],o=i;o;o-=1)s.push(e%2?1:0),e=f(e/2);for(o=t;o;o-=1)s.push(r%2?1:0),r=f(r/2);for(s.push(h?1:0),s.reverse(),c=s.join(""),a=[];c.length;)a.push(parseInt(c.substring(0,8),2)),c=c.substring(8);return a}function y(n,t,i){for(var c=[],l,o,s,a,r,h,f,e=n.length;e;e-=1)for(o=n[e-1],l=8;l;l-=1)c.push(o%2?1:0),o=o>>1;return c.reverse(),s=c.join(""),a=(1<<t-1)-1,r=parseInt(s.substring(0,1),2)?-1:1,h=parseInt(s.substring(1,1+t),2),f=parseInt(s.substring(1+t),2),h===(1<<t)-1?f!==0?NaN:r*Infinity:h>0?r*u(2,h-a)*(1+f/u(2,i)):f!==0?r*u(2,-(a-1))*(f/u(2,i)):r<0?-0:0}function vt(n){return y(n,11,52)}function yt(n){return v(n,11,52)}function pt(n){return y(n,8,23)}function wt(n){return v(n,8,23)}var c=void 0,p=1e5,r=function(){var n=Object.prototype.toString,t=Object.prototype.hasOwnProperty;return{Class:function(t){return n.call(t).replace(/^\[object *|\]$/g,"")},HasProperty:function(n,t){return t in n},HasOwnProperty:function(n,i){return t.call(n,i)},IsCallable:function(n){return typeof n=="function"},ToInt32:function(n){return n>>0},ToUint32:function(n){return n>>>0}}}(),w=Math.LN2,b=Math.abs,f=Math.floor,k=Math.log,d=Math.min,u=Math.pow,g=Math.round,e=Object.defineProperty||function(n,t,i){if(!n===Object(n))throw new TypeError("Object.defineProperty called on non-object");return r.HasProperty(i,"get")&&Object.prototype.__defineGetter__&&Object.prototype.__defineGetter__.call(n,t,i.get),r.HasProperty(i,"set")&&Object.prototype.__defineSetter__&&Object.prototype.__defineSetter__.call(n,t,i.set),r.HasProperty(i,"value")&&(n[t]=i.value),n},l=Object.getOwnPropertyNames||function(n){if(n!==Object(n))throw new TypeError("Object.getOwnPropertyNames called on non-object");var t=[];for(var i in n)r.HasOwnProperty(n,i)&&t.push(i);return t};(function(){function n(n,i,f){var e;return e=function(n,i,u){var s,h,f,c;if(arguments.length&&typeof arguments[0]!="number")if(typeof arguments[0]=="object"&&arguments[0].constructor===e)for(s=arguments[0],this.length=s.length,this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new t(this.byteLength),this.byteOffset=0,f=0;f<this.length;f+=1)this._setter(f,s._getter(f));else if(typeof arguments[0]!="object"||arguments[0]instanceof t||r.Class(arguments[0])==="ArrayBuffer")if(typeof arguments[0]=="object"&&(arguments[0]instanceof t||r.Class(arguments[0])==="ArrayBuffer")){if(this.buffer=n,this.byteOffset=r.ToUint32(i),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteOffset%this.BYTES_PER_ELEMENT)throw new RangeError("ArrayBuffer length minus the byteOffset is not a multiple of the element size.");if(arguments.length<3){if(this.byteLength=this.buffer.byteLength-this.byteOffset,this.byteLength%this.BYTES_PER_ELEMENT)throw new RangeError("length of buffer minus byteOffset not a multiple of the element size");this.length=this.byteLength/this.BYTES_PER_ELEMENT}else this.length=r.ToUint32(u),this.byteLength=this.length*this.BYTES_PER_ELEMENT;if(this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer");}else throw new TypeError("Unexpected argument type(s)");else for(h=arguments[0],this.length=r.ToUint32(h.length),this.byteLength=this.length*this.BYTES_PER_ELEMENT,this.buffer=new t(this.byteLength),this.byteOffset=0,f=0;f<this.length;f+=1)c=h[f],this._setter(f,Number(c));else{if(this.length=r.ToInt32(arguments[0]),u<0)throw new RangeError("ArrayBufferView size is not a small enough positive integer");this.byteLength=this.length*this.BYTES_PER_ELEMENT;this.buffer=new t(this.byteLength);this.byteOffset=0}this.constructor=e;o(this);nt(this)},e.prototype=new u,e.prototype.BYTES_PER_ELEMENT=n,e.prototype._pack=i,e.prototype._unpack=f,e.BYTES_PER_ELEMENT=n,e.prototype._getter=function(n){if(arguments.length<1)throw new SyntaxError("Not enough arguments");if(n=r.ToUint32(n),n>=this.length)return c;for(var u=[],t=0,i=this.byteOffset+n*this.BYTES_PER_ELEMENT;t<this.BYTES_PER_ELEMENT;t+=1,i+=1)u.push(this.buffer._bytes[i]);return this._unpack(u)},e.prototype.get=e.prototype._getter,e.prototype._setter=function(n,t){if(arguments.length<2)throw new SyntaxError("Not enough arguments");if(n=r.ToUint32(n),n>=this.length)return c;for(var f=this._pack(t),i=0,u=this.byteOffset+n*this.BYTES_PER_ELEMENT;i<this.BYTES_PER_ELEMENT;i+=1,u+=1)this.buffer._bytes[u]=f[i]},e.prototype.set=function(){if(arguments.length<1)throw new SyntaxError("Not enough arguments");var t,o,u,s,n,i,f,h,e,c;if(typeof arguments[0]=="object"&&arguments[0].constructor===this.constructor){if(t=arguments[0],u=r.ToUint32(arguments[1]),u+t.length>this.length)throw new RangeError("Offset plus length of array is out of range");if(h=this.byteOffset+u*this.BYTES_PER_ELEMENT,e=t.length*this.BYTES_PER_ELEMENT,t.buffer===this.buffer){for(c=[],n=0,i=t.byteOffset;n<e;n+=1,i+=1)c[n]=t.buffer._bytes[i];for(n=0,f=h;n<e;n+=1,f+=1)this.buffer._bytes[f]=c[n]}else for(n=0,i=t.byteOffset,f=h;n<e;n+=1,i+=1,f+=1)this.buffer._bytes[f]=t.buffer._bytes[i]}else if(typeof arguments[0]=="object"&&typeof arguments[0].length!="undefined"){if(o=arguments[0],s=r.ToUint32(o.length),u=r.ToUint32(arguments[1]),u+s>this.length)throw new RangeError("Offset plus length of array is out of range");for(n=0;n<s;n+=1)i=o[n],this._setter(u+n,Number(i))}else throw new TypeError("Unexpected argument type(s)");},e.prototype.subarray=function(n,t){function u(n,t,i){return n<t?t:n>i?i:n}n=r.ToInt32(n);t=r.ToInt32(t);arguments.length<1&&(n=0);arguments.length<2&&(t=this.length);n<0&&(n=this.length+n);t<0&&(t=this.length+t);n=u(n,0,this.length);t=u(t,0,this.length);var i=t-n;return i<0&&(i=0),new this.constructor(this.buffer,this.byteOffset+n*this.BYTES_PER_ELEMENT,i)},e}var t=function(n){if(n=r.ToInt32(n),n<0)throw new RangeError("ArrayBuffer size is not a small enough positive integer");this.byteLength=n;this._bytes=[];this._bytes.length=n;for(var t=0;t<this.byteLength;t+=1)this._bytes[t]=0;o(this)},u;i.ArrayBuffer=i.ArrayBuffer||t;u=function(){};var f=n(1,tt,it),e=n(1,rt,a),s=n(1,ut,a),h=n(2,ft,et),l=n(2,ot,st),v=n(4,ht,ct),y=n(4,lt,at),p=n(4,wt,pt),w=n(8,yt,vt);i.Int8Array=i.Int8Array||f;i.Uint8Array=i.Uint8Array||e;i.Uint8ClampedArray=i.Uint8ClampedArray||s;i.Int16Array=i.Int16Array||h;i.Uint16Array=i.Uint16Array||l;i.Int32Array=i.Int32Array||v;i.Uint32Array=i.Uint32Array||y;i.Float32Array=i.Float32Array||p;i.Float64Array=i.Float64Array||w})(),function(){function f(n,t){return r.IsCallable(n.get)?n.get(t):n[t]}function t(n){return function(t,i){if(t=r.ToUint32(t),t+n.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");t+=this.byteOffset;for(var s=new Uint8Array(this.buffer,t,n.BYTES_PER_ELEMENT),o=[],u=0;u<n.BYTES_PER_ELEMENT;u+=1)o.push(f(s,u));return Boolean(i)===Boolean(e)&&o.reverse(),f(new n(new Uint8Array(o).buffer),0)}}function u(n){return function(t,i,u){if(t=r.ToUint32(t),t+n.BYTES_PER_ELEMENT>this.byteLength)throw new RangeError("Array index out of range");for(var c=new n([i]),l=new Uint8Array(c.buffer),s=[],h,o=0;o<n.BYTES_PER_ELEMENT;o+=1)s.push(f(l,o));Boolean(u)===Boolean(e)&&s.reverse();h=new Uint8Array(this.buffer,t,n.BYTES_PER_ELEMENT);h.set(s)}}var e=function(){var n=new i.Uint16Array([4660]),t=new i.Uint8Array(n.buffer);return f(t,0)===18}(),n=function(n,t,i){if(arguments.length===0)n=new ArrayBuffer(0);else if(!(n instanceof ArrayBuffer||r.Class(n)==="ArrayBuffer"))throw new TypeError("TypeError");if(this.buffer=n||new ArrayBuffer(0),this.byteOffset=r.ToUint32(t),this.byteOffset>this.buffer.byteLength)throw new RangeError("byteOffset out of range");if(this.byteLength=arguments.length<3?this.buffer.byteLength-this.byteOffset:r.ToUint32(i),this.byteOffset+this.byteLength>this.buffer.byteLength)throw new RangeError("byteOffset and length reference an area beyond the end of the buffer");o(this)};n.prototype.getUint8=t(i.Uint8Array);n.prototype.getInt8=t(i.Int8Array);n.prototype.getUint16=t(i.Uint16Array);n.prototype.getInt16=t(i.Int16Array);n.prototype.getUint32=t(i.Uint32Array);n.prototype.getInt32=t(i.Int32Array);n.prototype.getFloat32=t(i.Float32Array);n.prototype.getFloat64=t(i.Float64Array);n.prototype.setUint8=u(i.Uint8Array);n.prototype.setInt8=u(i.Int8Array);n.prototype.setUint16=u(i.Uint16Array);n.prototype.setInt16=u(i.Int16Array);n.prototype.setUint32=u(i.Uint32Array);n.prototype.setInt32=u(i.Int32Array);n.prototype.setFloat32=u(i.Float32Array);n.prototype.setFloat64=u(i.Float64Array);i.DataView=i.DataView||n}()},{}]},{},[]);t.exports=n("native-buffer-browserify").Buffer},{}],2:[function(n,t){var i=t.exports={};i.nextTick=function(){var t=typeof window!="undefined"&&window.setImmediate,i=typeof window!="undefined"&&window.postMessage&&window.addEventListener,n;return t?function(n){return window.setImmediate(n)}:i?(n=[],window.addEventListener("message",function(t){if(t.source===window&&t.data==="process-tick"&&(t.stopPropagation(),n.length>0)){var i=n.shift();i()}},!0),function(t){n.push(t);window.postMessage("process-tick","*")}):function(n){setTimeout(n,0)}}();i.title="browser";i.browser=!0;i.env={};i.argv=[];i.binding=function(){throw new Error("process.binding is not supported");};i.cwd=function(){return"/"};i.chdir=function(){throw new Error("process.chdir is not supported");}},{}],3:[function(n,t){function i(){}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),r=n("./Scalar");t.exports=i;i.lineInt=function(n,t,i){i=i||0;var h=[0,0],u,f,c,e,o,l,s;return u=n[1][1]-n[0][1],f=n[0][0]-n[1][0],c=u*n[0][0]+f*n[0][1],e=t[1][1]-t[0][1],o=t[0][0]-t[1][0],l=e*t[0][0]+o*t[0][1],s=u*o-e*f,r.eq(s,0,i)||(h[0]=(o*c-f*l)/s,h[1]=(u*l-e*c)/s),h};i.segmentsIntersect=function(n,t,i,r){var u=t[0]-n[0],f=t[1]-n[1],e=r[0]-i[0],o=r[1]-i[1],s,h;return e*f-o*u==0?!1:(s=(u*(i[1]-n[1])+f*(n[0]-i[0]))/(e*f-o*u),h=(e*(n[1]-i[1])+o*(i[0]-n[0]))/(o*u-e*f),s>=0&&s<=1&&h>=0&&h<=1)}},{"./Scalar":6,__browserify_Buffer:1,__browserify_process:2}],4:[function(n,t){function i(){}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r,u;t.exports=i;i.area=function(n,t,i){return(t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1])};i.left=function(n,t,r){return i.area(n,t,r)>0};i.leftOn=function(n,t,r){return i.area(n,t,r)>=0};i.right=function(n,t,r){return i.area(n,t,r)<0};i.rightOn=function(n,t,r){return i.area(n,t,r)<=0};r=[];u=[];i.collinear=function(n,t,f,e){var o,s;if(e){o=r;s=u;o[0]=t[0]-n[0];o[1]=t[1]-n[1];s[0]=f[0]-t[0];s[1]=f[1]-t[1];var h=o[0]*s[0]+o[1]*s[1],c=Math.sqrt(o[0]*o[0]+o[1]*o[1]),l=Math.sqrt(s[0]*s[0]+s[1]*s[1]),a=Math.acos(h/(c*l));return a<e}return i.area(n,t,f)==0};i.sqdist=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r}},{__browserify_Buffer:1,__browserify_process:2}],5:[function(n,t){function i(){this.vertices=[]}function o(n,t,i,r,u){u=u||0;var f=t[1]-n[1],e=n[0]-t[0],l=f*n[0]+e*n[1],o=r[1]-i[1],h=i[0]-r[0],a=o*i[0]+h*i[1],c=f*h-o*e;return s.eq(c,0,u)?[0,0]:[(h*l-e*a)/c,(f*a-o*l)/c]}var h=n("__browserify_process"),c=typeof self!="undefined"?self:typeof window!="undefined"?window:{},l=n("__browserify_Buffer"),u=n("./Line"),r=n("./Point"),s=n("./Scalar"),f,e;t.exports=i;i.prototype.at=function(n){var i=this.vertices,t=i.length;return i[n<0?n%t+t:n%t]};i.prototype.first=function(){return this.vertices[0]};i.prototype.last=function(){return this.vertices[this.vertices.length-1]};i.prototype.clear=function(){this.vertices.length=0};i.prototype.append=function(n,t,i){if(typeof t=="undefined")throw new Error("From is not given!");if(typeof i=="undefined")throw new Error("To is not given!");if(i-1<t)throw new Error("lol1");if(i>n.vertices.length)throw new Error("lol2");if(t<0)throw new Error("lol3");for(var r=t;r<i;r++)this.vertices.push(n.vertices[r])};i.prototype.makeCCW=function(){for(var n=0,t=this.vertices,i=1;i<this.vertices.length;++i)(t[i][1]<t[n][1]||t[i][1]==t[n][1]&&t[i][0]>t[n][0])&&(n=i);r.left(this.at(n-1),this.at(n),this.at(n+1))||this.reverse()};i.prototype.reverse=function(){for(var n=[],t=0,i=this.vertices.length;t!==i;t++)n.push(this.vertices.pop());this.vertices=n};i.prototype.isReflex=function(n){return r.right(this.at(n-1),this.at(n),this.at(n+1))};f=[];e=[];i.prototype.canSee=function(n,t){var h,c,o=f,s=e,i;if(r.leftOn(this.at(n+1),this.at(n),this.at(t))&&r.rightOn(this.at(n-1),this.at(n),this.at(t)))return!1;for(c=r.sqdist(this.at(n),this.at(t)),i=0;i!==this.vertices.length;++i)if((i+1)%this.vertices.length!==n&&i!==n&&r.leftOn(this.at(n),this.at(t),this.at(i+1))&&r.rightOn(this.at(n),this.at(t),this.at(i))&&(o[0]=this.at(n),o[1]=this.at(t),s[0]=this.at(i),s[1]=this.at(i+1),h=u.lineInt(o,s),r.sqdist(this.at(n),h)<c))return!1;return!0};i.prototype.copy=function(n,t,r){var f=r||new i,u;if(f.clear(),n<t)for(u=n;u<=t;u++)f.vertices.push(this.vertices[u]);else{for(u=0;u<=t;u++)f.vertices.push(this.vertices[u]);for(u=n;u<this.vertices.length;u++)f.vertices.push(this.vertices[u])}return f};i.prototype.getCutEdges=function(){for(var t,u,f=[],r=[],e=[],o=new i,s=Number.MAX_VALUE,n=0;n<this.vertices.length;++n)if(this.isReflex(n))for(t=0;t<this.vertices.length;++t)if(this.canSee(n,t)){for(r=this.copy(n,t,o).getCutEdges(),e=this.copy(t,n,o).getCutEdges(),u=0;u<e.length;u++)r.push(e[u]);r.length<s&&(f=r,s=r.length,f.push([this.at(n),this.at(t)]))}return f};i.prototype.decomp=function(){var n=this.getCutEdges();return n.length>0?this.slice(n):[this]};i.prototype.slice=function(n){var r,i,u,t,e,f;if(n.length==0)return[this];if(n instanceof Array&&n.length&&n[0]instanceof Array&&n[0].length==2&&n[0][0]instanceof Array){for(r=[this],i=0;i<n.length;i++)for(u=n[i],t=0;t<r.length;t++)if(e=r[t],f=e.slice(u),f){r.splice(t,1);r.push(f[0],f[1]);break}return r}var u=n,i=this.vertices.indexOf(u[0]),t=this.vertices.indexOf(u[1]);return i!=-1&&t!=-1?[this.copy(i,t),this.copy(t,i)]:!1};i.prototype.isSimple=function(){for(var i,n=this.vertices,t=0;t<n.length-1;t++)for(i=0;i<t-1;i++)if(u.segmentsIntersect(n[t],n[t+1],n[i],n[i+1]))return!1;for(t=1;t<n.length-2;t++)if(u.segmentsIntersect(n[0],n[n.length-1],n[t],n[t+1]))return!1;return!0};i.prototype.quickDecomp=function(n,t,u,f,e,s){var c,l;e=e||100;s=s||0;f=f||25;n=typeof n!="undefined"?n:[];t=t||[];u=u||[];var d=[0,0],g=[0,0],a=[0,0],nt=0,tt=0,p=0,it=0,w=0,b=0,k=0,v=new i,y=new i,h=this,rt=this.vertices;if(rt.length<3)return n;if(s++,s>e)return console.warn("quickDecomp: max level ("+e+") reached."),n;for(c=0;c<this.vertices.length;++c)if(h.isReflex(c)){for(t.push(h.vertices[c]),nt=tt=Number.MAX_VALUE,l=0;l<this.vertices.length;++l)r.left(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c-1),h.at(c),h.at(l-1))&&(a=o(h.at(c-1),h.at(c),h.at(l),h.at(l-1)),r.right(h.at(c+1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<tt&&(tt=p,g=a,b=l))),r.left(h.at(c+1),h.at(c),h.at(l+1))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(a=o(h.at(c+1),h.at(c),h.at(l),h.at(l+1)),r.left(h.at(c-1),h.at(c),a)&&(p=r.sqdist(h.vertices[c],a),p<nt&&(nt=p,d=a,w=l)));if(b==(w+1)%this.vertices.length)a[0]=(g[0]+d[0])/2,a[1]=(g[1]+d[1])/2,u.push(a),c<w?(v.append(h,c,w+1),v.vertices.push(a),y.vertices.push(a),b!=0&&y.append(h,b,h.vertices.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,h.vertices.length),v.append(h,0,w+1),v.vertices.push(a),y.vertices.push(a),y.append(h,b,c+1));else{if(b>w&&(w+=this.vertices.length),it=Number.MAX_VALUE,w<b)return n;for(l=b;l<=w;++l)r.leftOn(h.at(c-1),h.at(c),h.at(l))&&r.rightOn(h.at(c+1),h.at(c),h.at(l))&&(p=r.sqdist(h.at(c),h.at(l)),p<it&&(it=p,k=l%this.vertices.length));c<k?(v.append(h,c,k+1),k!=0&&y.append(h,k,rt.length),y.append(h,0,c+1)):(c!=0&&v.append(h,c,rt.length),v.append(h,0,k+1),y.append(h,k,c+1))}return v.vertices.length<y.vertices.length?(v.quickDecomp(n,t,u,f,e,s),y.quickDecomp(n,t,u,f,e,s)):(y.quickDecomp(n,t,u,f,e,s),v.quickDecomp(n,t,u,f,e,s)),n}return n.push(this),n};i.prototype.removeCollinearPoints=function(n){for(var i=0,t=this.vertices.length-1;this.vertices.length>3&&t>=0;--t)r.collinear(this.at(t-1),this.at(t),this.at(t+1),n)&&(this.vertices.splice(t%this.vertices.length,1),t--,i++);return i}},{"./Line":3,"./Point":4,"./Scalar":6,__browserify_Buffer:1,__browserify_process:2}],6:[function(n,t){function i(){}var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer");t.exports=i;i.eq=function(n,t,i){return i=i||0,Math.abs(n-t)<i}},{__browserify_Buffer:1,__browserify_process:2}],7:[function(n,t){var i=n("__browserify_process"),r=typeof self!="undefined"?self:typeof window!="undefined"?window:{},u=n("__browserify_Buffer");t.exports={Polygon:n("./Polygon"),Point:n("./Point")}},{"./Point":4,"./Polygon":5,__browserify_Buffer:1,__browserify_process:2}],8:[function(n,t){var i=n("__browserify_process"),r=typeof self!="undefined"?self:typeof window!="undefined"?window:{},u=n("__browserify_Buffer");t.exports={name:"p2",version:"0.6.0",description:"A JavaScript 2D physics engine.",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["p2.js","p2","physics","engine","2d"],main:"./src/p2.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/p2.js.git"},bugs:{url:"https://github.com/schteppe/p2.js/issues"},licenses:[{type:"MIT"}],devDependencies:{grunt:"~0.4.0","grunt-contrib-jshint":"~0.9.2","grunt-contrib-nodeunit":"~0.1.2","grunt-contrib-uglify":"~0.4.0","grunt-contrib-watch":"~0.5.0","grunt-browserify":"~2.0.1","grunt-contrib-concat":"^0.4.0"},dependencies:{"poly-decomp":"0.1.0"}}},{__browserify_Buffer:1,__browserify_process:2}],9:[function(n,t){function r(n){this.lowerBound=i.create();n&&n.lowerBound&&i.copy(this.lowerBound,n.lowerBound);this.upperBound=i.create();n&&n.upperBound&&i.copy(this.upperBound,n.upperBound)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),i=n("../math/vec2"),s=n("../utils/Utils"),u;t.exports=r;u=i.create();r.prototype.setFromPoints=function(n,t,r,f){var s=this.lowerBound,c=this.upperBound,l,a,h,o,v,y,e;for(typeof r!="number"&&(r=0),r!==0?i.rotate(s,n[0],r):i.copy(s,n[0]),i.copy(c,s),l=Math.cos(r),a=Math.sin(r),h=1;h<n.length;h++)for(o=n[h],r!==0&&(v=o[0],y=o[1],u[0]=l*v-a*y,u[1]=a*v+l*y,o=u),e=0;e<2;e++)o[e]>c[e]&&(c[e]=o[e]),o[e]<s[e]&&(s[e]=o[e]);t&&(i.add(this.lowerBound,this.lowerBound,t),i.add(this.upperBound,this.upperBound,t));f&&(this.lowerBound[0]-=f,this.lowerBound[1]-=f,this.upperBound[0]+=f,this.upperBound[1]+=f)};r.prototype.copy=function(n){i.copy(this.lowerBound,n.lowerBound);i.copy(this.upperBound,n.upperBound)};r.prototype.extend=function(n){for(var t=2,i,r;t--;)i=n.lowerBound[t],this.lowerBound[t]>i&&(this.lowerBound[t]=i),r=n.upperBound[t],this.upperBound[t]<r&&(this.upperBound[t]=r)};r.prototype.overlaps=function(n){var r=this.lowerBound,t=this.upperBound,u=n.lowerBound,i=n.upperBound;return(u[0]<=t[0]&&t[0]<=i[0]||r[0]<=i[0]&&i[0]<=t[0])&&(u[1]<=t[1]&&t[1]<=i[1]||r[1]<=i[1]&&i[1]<=t[1])}},{"../math/vec2":31,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],10:[function(n,t){function i(n){this.type=n;this.result=[];this.world=null;this.boundingVolumeType=i.AABB}var e=n("__browserify_process"),o=typeof self!="undefined"?self:typeof window!="undefined"?window:{},s=n("__browserify_Buffer"),u=n("../math/vec2"),r=n("../objects/Body"),f;t.exports=i;i.AABB=1;i.BOUNDING_CIRCLE=2;i.prototype.setWorld=function(n){this.world=n};i.prototype.getCollisionPairs=function(){throw new Error("getCollisionPairs must be implemented in a subclass!");};f=u.create();i.boundingRadiusCheck=function(n,t){u.sub(f,n.position,t.position);var r=u.squaredLength(f),i=n.boundingRadius+t.boundingRadius;return r<=i*i};i.aabbCheck=function(n,t){return n.getAABB().overlaps(t.getAABB())};i.prototype.boundingVolumeCheck=function(n,t){var r;switch(this.boundingVolumeType){case i.BOUNDING_CIRCLE:r=i.boundingRadiusCheck(n,t);break;case i.AABB:r=i.aabbCheck(n,t);break;default:throw new Error("Bounding volume type not recognized: "+this.boundingVolumeType);}return r};i.canCollide=function(n,t){return n.type===r.STATIC&&t.type===r.STATIC?!1:n.type===r.KINEMATIC&&t.type===r.STATIC||n.type===r.STATIC&&t.type===r.KINEMATIC?!1:n.type===r.KINEMATIC&&t.type===r.KINEMATIC?!1:n.sleepState===r.SLEEPING&&t.sleepState===r.SLEEPING?!1:n.sleepState===r.SLEEPING&&t.type===r.STATIC||t.sleepState===r.SLEEPING&&n.type===r.STATIC?!1:!0};i.NAIVE=1;i.SAP=2},{"../math/vec2":31,"../objects/Body":32,__browserify_Buffer:1,__browserify_process:2}],11:[function(n,t){function r(n){i.apply(this);n=u.defaults(n,{xmin:-100,xmax:100,ymin:-100,ymax:100,nx:10,ny:10});this.xmin=n.xmin;this.ymin=n.ymin;this.xmax=n.xmax;this.ymax=n.ymax;this.nx=n.nx;this.ny=n.ny;this.binsizeX=(this.xmax-this.xmin)/this.nx;this.binsizeY=(this.ymax-this.ymin)/this.ny}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),s=n("../shapes/Circle"),h=n("../shapes/Plane"),c=n("../shapes/Particle"),i=n("../collision/Broadphase"),l=n("../math/vec2"),u=n("../utils/Utils");t.exports=r;r.prototype=new i;r.prototype.getCollisionPairs=function(n){for(var y,p,h,r,tt,f,u,c,b=[],k=n.bodies,it=k.length,vt=this.binsizeX,yt=this.binsizeY,d=this.nx,l=this.ny,e=this.xmin,o=this.ymin,g=this.xmax,nt=this.ymax,a=[],v=d*l,t=0;t<v;t++)a.push([]);for(y=d/(g-e),p=l/(nt-o),t=0;t!==it;t++){var f=k[t],s=f.aabb,rt=Math.max(s.lowerBound[0],e),ut=Math.max(s.lowerBound[1],o),ft=Math.min(s.upperBound[0],g),et=Math.min(s.upperBound[1],nt),ot=Math.floor(y*(rt-e)),st=Math.floor(p*(ut-o)),ht=Math.floor(y*(ft-e)),ct=Math.floor(p*(et-o));for(r=ot;r<=ht;r++)for(u=st;u<=ct;u++){var lt=r,at=u,w=lt*(l-1)+at;w>=0&&w<v&&a[w].push(f)}}for(t=0;t!==v;t++)for(h=a[t],r=0,tt=h.length;r!==tt;r++)for(f=h[r],u=0;u!==r;u++)c=h[u],i.canCollide(f,c)&&this.boundingVolumeCheck(f,c)&&b.push(f,c);return b}},{"../collision/Broadphase":10,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],12:[function(n,t){function r(){i.call(this,i.NAIVE)}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),o=n("../shapes/Circle"),s=n("../shapes/Plane"),h=n("../shapes/Shape"),c=n("../shapes/Particle"),i=n("../collision/Broadphase"),l=n("../math/vec2");t.exports=r;r.prototype=new i;r.prototype.getCollisionPairs=function(n){var e=n.bodies,o=this.result,t,s,r,u,f;for(o.length=0,t=0,s=e.length;t!==s;t++)for(r=e[t],u=0;u<t;u++)f=e[u],i.canCollide(r,f)&&this.boundingVolumeCheck(r,f)&&o.push(r,f);return o}},{"../collision/Broadphase":10,"../math/vec2":31,"../shapes/Circle":38,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Shape":45,__browserify_Buffer:1,__browserify_process:2}],13:[function(n,t){function u(){this.contactEquations=[];this.frictionEquations=[];this.enableFriction=!0;this.slipForce=10;this.frictionCoefficient=.3;this.surfaceVelocity=0;this.reuseObjects=!0;this.reusableContactEquations=[];this.reusableFrictionEquations=[];this.restitution=0;this.stiffness=b.DEFAULT_STIFFNESS;this.relaxation=b.DEFAULT_RELAXATION;this.frictionStiffness=b.DEFAULT_STIFFNESS;this.frictionRelaxation=b.DEFAULT_RELAXATION;this.enableFrictionReduction=!0;this.collidingBodiesLastStep=new vt;this.contactSkinSize=.01}function ut(n,t){i.set(n.vertices[0],-t.length*.5,-t.radius);i.set(n.vertices[1],t.length*.5,-t.radius);i.set(n.vertices[2],t.length*.5,t.radius);i.set(n.vertices[3],-t.length*.5,t.radius)}function lt(n,t,u,f){for(var w,b,a,s=ii,h=ri,v=ui,y=fi,p=n,o=t.vertices,c=null,l=0;l!==o.length+1;l++){if(w=o[l%o.length],b=o[(l+1)%o.length],i.rotate(s,w,f),i.rotate(h,b,f),e(s,s,u),e(h,h,u),r(v,s,p),r(y,h,p),a=i.crossLength(v,y),c===null&&(c=a),a*c<=0)return!1;c=a}return!0}var hr=n("__browserify_process"),cr=typeof self!="undefined"?self:typeof window!="undefined"?window:{},lr=n("__browserify_Buffer"),i=n("../math/vec2"),r=i.sub,e=i.add,o=i.dot,ft=n("../utils/Utils"),vt=n("../utils/TupleDictionary"),b=n("../equations/Equation"),yt=n("../equations/ContactEquation"),pt=n("../equations/FrictionEquation"),wt=n("../shapes/Circle"),bt=n("../shapes/Convex"),f=n("../shapes/Shape"),ar=n("../objects/Body"),k=n("../shapes/Rectangle"),ht,ct,at;t.exports=u;var d=i.fromValues(0,1),s=i.fromValues(0,0),h=i.fromValues(0,0),c=i.fromValues(0,0),l=i.fromValues(0,0),a=i.fromValues(0,0),v=i.fromValues(0,0),y=i.fromValues(0,0),p=i.fromValues(0,0),w=i.fromValues(0,0),g=i.fromValues(0,0),nt=i.fromValues(0,0),tt=i.fromValues(0,0),it=i.fromValues(0,0),rt=i.fromValues(0,0),et=i.fromValues(0,0),ot=i.fromValues(0,0),kt=i.fromValues(0,0),dt=i.fromValues(0,0),st=[];u.prototype.collidedLastStep=function(n,t){var i=n.id|0,r=t.id|0;return!!this.collidingBodiesLastStep.get(i,r)};u.prototype.reset=function(){var n,t;for(this.collidingBodiesLastStep.reset(),n=this.contactEquations,t=n.length;t--;){var i=n[t],r=i.bodyA.id,u=i.bodyB.id;this.collidingBodiesLastStep.set(r,u,!0)}if(this.reuseObjects){var f=this.contactEquations,e=this.frictionEquations,o=this.reusableFrictionEquations,s=this.reusableContactEquations;ft.appendArray(s,f);ft.appendArray(o,e)}this.contactEquations.length=this.frictionEquations.length=0};u.prototype.createContactEquation=function(n,t,i,r){var u=this.reusableContactEquations.length?this.reusableContactEquations.pop():new yt(n,t);return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.restitution=this.restitution,u.firstImpact=!this.collidedLastStep(n,t),u.stiffness=this.stiffness,u.relaxation=this.relaxation,u.needsUpdate=!0,u.enabled=!0,u.offset=this.contactSkinSize,u};u.prototype.createFrictionEquation=function(n,t,i,r){var u=this.reusableFrictionEquations.length?this.reusableFrictionEquations.pop():new pt(n,t);return u.bodyA=n,u.bodyB=t,u.shapeA=i,u.shapeB=r,u.setSlipForce(this.slipForce),u.frictionCoefficient=this.frictionCoefficient,u.relativeVelocity=this.surfaceVelocity,u.enabled=!0,u.needsUpdate=!0,u.stiffness=this.frictionStiffness,u.relaxation=this.frictionRelaxation,u.contactEquations.length=0,u};u.prototype.createFrictionFromContact=function(n){var t=this.createFrictionEquation(n.bodyA,n.bodyB,n.shapeA,n.shapeB);return i.copy(t.contactPointA,n.contactPointA),i.copy(t.contactPointB,n.contactPointB),i.rotate90cw(t.t,n.normalA),t.contactEquations.push(n),t};u.prototype.createFrictionFromAverage=function(n){var u,f;if(!n)throw new Error("numContacts == 0!");var r=this.contactEquations[this.contactEquations.length-1],t=this.createFrictionEquation(r.bodyA,r.bodyB,r.shapeA,r.shapeB),e=r.bodyA,o=r.bodyB;for(i.set(t.contactPointA,0,0),i.set(t.contactPointB,0,0),i.set(t.t,0,0),u=0;u!==n;u++)r=this.contactEquations[this.contactEquations.length-1-u],r.bodyA===e?(i.add(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointA),i.add(t.contactPointB,t.contactPointB,r.contactPointB)):(i.sub(t.t,t.t,r.normalA),i.add(t.contactPointA,t.contactPointA,r.contactPointB),i.add(t.contactPointB,t.contactPointB,r.contactPointA)),t.contactEquations.push(r);return f=1/n,i.scale(t.contactPointA,t.contactPointA,f),i.scale(t.contactPointB,t.contactPointB,f),i.normalize(t.t,t.t),i.rotate90cw(t.t,t.t),t};u.prototype[f.LINE|f.CONVEX]=u.prototype.convexLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.LINE|f.RECTANGLE]=u.prototype.lineRectangle=function(n,t,i,r,u,f,e,o,s){return s?!1:0};ht=new k(1,1);ct=i.create();u.prototype[f.CAPSULE|f.CONVEX]=u.prototype[f.CAPSULE|f.RECTANGLE]=u.prototype.convexCapsule=function(n,t,r,u,f,e,o,s,h){var c=ct,l,a,v,y;return(i.set(c,e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),l=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),i.set(c,-e.length/2,0),i.rotate(c,c,s),i.add(c,c,o),a=this.circleConvex(f,e,c,s,n,t,r,u,h,e.radius),h&&(l||a))?!0:(v=ht,ut(v,e),y=this.convexConvex(n,t,r,u,f,v,o,s,h),y+l+a)};u.prototype[f.CAPSULE|f.LINE]=u.prototype.lineCapsule=function(n,t,i,r,u,f,e,o,s){return s?!1:0};var gt=i.create(),ni=i.create(),ti=new k(1,1);u.prototype[f.CAPSULE|f.CAPSULE]=u.prototype.capsuleCapsule=function(n,t,r,u,f,e,o,s,h){for(var p,b,y,k,c,d,l=gt,a=ni,v=0,w=0;w<2;w++)for(i.set(l,(w===0?-1:1)*t.length/2,0),i.rotate(l,l,u),i.add(l,l,r),p=0;p<2;p++){if(i.set(a,(p===0?-1:1)*e.length/2,0),i.rotate(a,a,s),i.add(a,a,o),this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),b=this.circleCircle(n,t,l,u,f,e,a,s,h,t.radius,e.radius),this.enableFrictionReduction&&(this.enableFriction=c),h&&b)return!0;v+=b}return(this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),y=ti,ut(y,t),k=this.convexCapsule(n,y,r,u,f,e,o,s,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&k)?!0:(v+=k,this.enableFrictionReduction&&(c=this.enableFriction,this.enableFriction=!1),ut(y,e),d=this.convexCapsule(f,y,o,s,n,t,r,u,h),this.enableFrictionReduction&&(this.enableFriction=c),h&&d)?!0:(v+=d,this.enableFrictionReduction&&v&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.LINE|f.LINE]=u.prototype.lineLine=function(n,t,i,r,u,f,e,o,s){return s?!1:0};u.prototype[f.PLANE|f.LINE]=u.prototype.planeLine=function(n,t,u,f,b,k,g,nt,tt){var rt=s,ut=h,ft=c,et=l,pt=a,wt=v,ot=y,ht=p,bt=w,ct=st,lt=0,at,vt,yt,it;for(i.set(rt,-k.length/2,0),i.set(ut,k.length/2,0),i.rotate(ft,rt,nt),i.rotate(et,ut,nt),e(ft,ft,g),e(et,et,g),i.copy(rt,ft),i.copy(ut,et),r(pt,ut,rt),i.normalize(wt,pt),i.rotate90cw(bt,wt),i.rotate(ht,d,f),ct[0]=rt,ct[1]=ut,at=0;at<ct.length;at++)if(vt=ct[at],r(ot,vt,u),yt=o(ot,ht),yt<0){if(tt)return!0;it=this.createContactEquation(n,b,t,k);lt++;i.copy(it.normalA,ht);i.normalize(it.normalA,it.normalA);i.scale(ot,ht,yt);r(it.contactPointA,vt,ot);r(it.contactPointA,it.contactPointA,n.position);r(it.contactPointB,vt,g);e(it.contactPointB,it.contactPointB,g);r(it.contactPointB,it.contactPointB,b.position);this.contactEquations.push(it);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(it))}return tt?!1:(this.enableFrictionReduction||lt&&this.enableFriction&&this.frictionEquations.push(this.createFrictionFromAverage(lt)),lt)};u.prototype[f.PARTICLE|f.CAPSULE]=u.prototype.particleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius,0)};u.prototype[f.CIRCLE|f.LINE]=u.prototype.circleLine=function(n,t,u,f,b,k,d,ut,ft,et,ot){var et=et||0,ot=typeof ot!="undefined"?ot:t.radius,ni=s,lt=h,vt=c,si=l,yt=a,ui=v,pt=y,ct=p,at=w,bt=g,kt=nt,wt=tt,fi=it,ei=rt,dt=st,ti,ii,gt,ri,ht;if(i.set(ct,-k.length/2,0),i.set(at,k.length/2,0),i.rotate(bt,ct,ut),i.rotate(kt,at,ut),e(bt,bt,d),e(kt,kt,d),i.copy(ct,bt),i.copy(at,kt),r(ui,at,ct),i.normalize(pt,ui),i.rotate90cw(yt,pt),r(wt,u,ct),ti=o(wt,yt),r(si,ct,d),r(fi,u,d),ii=ot+et,Math.abs(ti)<ii){i.scale(ni,yt,ti);r(vt,u,ni);i.scale(lt,yt,o(yt,fi));i.normalize(lt,lt);i.scale(lt,lt,et);e(vt,vt,lt);var oi=o(pt,vt),hi=o(pt,ct),ci=o(pt,at);if(oi>hi&&oi<ci)return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.scale(ht.normalA,ni,-1),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,ot),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,vt,d),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1)}for(dt[0]=ct,dt[1]=at,gt=0;gt<dt.length;gt++)if(ri=dt[gt],r(wt,ri,u),i.squaredLength(wt)<Math.pow(ii,2))return ft?!0:(ht=this.createContactEquation(n,b,t,k),i.copy(ht.normalA,wt),i.normalize(ht.normalA,ht.normalA),i.scale(ht.contactPointA,ht.normalA,ot),e(ht.contactPointA,ht.contactPointA,u),r(ht.contactPointA,ht.contactPointA,n.position),r(ht.contactPointB,ri,d),i.scale(ei,ht.normalA,-et),e(ht.contactPointB,ht.contactPointB,ei),e(ht.contactPointB,ht.contactPointB,d),r(ht.contactPointB,ht.contactPointB,b.position),this.contactEquations.push(ht),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(ht)),1);return 0};u.prototype[f.CIRCLE|f.CAPSULE]=u.prototype.circleCapsule=function(n,t,i,r,u,f,e,o,s){return this.circleLine(n,t,i,r,u,f,e,o,s,f.radius)};u.prototype[f.CIRCLE|f.CONVEX]=u.prototype[f.CIRCLE|f.RECTANGLE]=u.prototype.circleConvex=function(n,t,u,f,o,b,k,d,ut,ft){for(var fi,ei,kt,oi,st,ft=typeof ft=="number"?ft:t.radius,vt=s,pt=h,gt=c,ni=l,wt=a,si=v,hi=y,ci=p,li=w,dt=g,yt=nt,ai=tt,bt=it,ct=rt,ti=et,ii=ot,ri=!1,ui=Number.MAX_VALUE,at=b.vertices,ht=0;ht!==at.length+1;ht++)fi=at[ht%at.length],ei=at[(ht+1)%at.length],i.rotate(vt,fi,d),i.rotate(pt,ei,d),e(vt,vt,k),e(pt,pt,k),r(gt,pt,vt),i.normalize(ni,gt),i.rotate90cw(wt,ni),i.scale(ct,wt,-t.radius),e(ct,ct,u),lt(ct,b,k,d)&&(i.sub(ti,vt,ct),kt=Math.abs(i.dot(ti,wt)),kt<ui&&(i.copy(ii,ct),ui=kt,i.scale(bt,wt,kt),i.add(bt,bt,ct),ri=!0));if(ri)return ut?!0:(st=this.createContactEquation(n,o,t,b),i.sub(st.normalA,ii,u),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ft),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,bt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);if(ft>0)for(ht=0;ht<at.length;ht++)if(oi=at[ht],i.rotate(yt,oi,d),e(yt,yt,k),r(dt,yt,u),i.squaredLength(dt)<Math.pow(ft,2))return ut?!0:(st=this.createContactEquation(n,o,t,b),i.copy(st.normalA,dt),i.normalize(st.normalA,st.normalA),i.scale(st.contactPointA,st.normalA,ft),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,yt,k),e(st.contactPointB,st.contactPointB,k),r(st.contactPointB,st.contactPointB,o.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1);return 0};var ii=i.create(),ri=i.create(),ui=i.create(),fi=i.create();u.prototype[f.PARTICLE|f.CONVEX]=u.prototype[f.PARTICLE|f.RECTANGLE]=u.prototype.particleConvex=function(n,t,u,f,b,k,d,ut,ft){var ht=s,yt=h,bt=c,gt=l,ct=a,oi=v,si=y,li=p,ai=w,ni=g,vi=nt,yi=tt,pt=it,pi=rt,wi=et,bi=ot,ti=kt,ii=dt,ri=Number.MAX_VALUE,ui=!1,at=k.vertices,hi,vt,fi,ei,ci,wt,st;if(!lt(u,k,d,ut))return 0;if(ft)return!0;for(hi=null,vt=0;vt!==at.length+1;vt++)fi=at[vt%at.length],ei=at[(vt+1)%at.length],i.rotate(ht,fi,ut),i.rotate(yt,ei,ut),e(ht,ht,d),e(yt,yt,d),r(bt,yt,ht),i.normalize(gt,bt),i.rotate90cw(ct,gt),r(ni,u,ht),ci=o(ni,ct),r(oi,ht,d),r(si,u,d),i.sub(ti,ht,u),wt=Math.abs(i.dot(ti,ct)),wt<ri&&(ri=wt,i.scale(pt,ct,wt),i.add(pt,pt,u),i.copy(ii,ct),ui=!0);return ui?(st=this.createContactEquation(n,b,t,k),i.scale(st.normalA,ii,-1),i.normalize(st.normalA,st.normalA),i.set(st.contactPointA,0,0),e(st.contactPointA,st.contactPointA,u),r(st.contactPointA,st.contactPointA,n.position),r(st.contactPointB,pt,d),e(st.contactPointB,st.contactPointB,d),r(st.contactPointB,st.contactPointB,b.position),this.contactEquations.push(st),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(st)),1):0};u.prototype[f.CIRCLE]=u.prototype.circleCircle=function(n,t,u,f,o,h,c,l,a,v,y){var w=s,v=v||t.radius,y=y||h.radius,b,p;return(r(w,u,c),b=v+y,i.squaredLength(w)>Math.pow(b,2))?0:a?!0:(p=this.createContactEquation(n,o,t,h),r(p.normalA,c,u),i.normalize(p.normalA,p.normalA),i.scale(p.contactPointA,p.normalA,v),i.scale(p.contactPointB,p.normalA,-y),e(p.contactPointA,p.contactPointA,u),r(p.contactPointA,p.contactPointA,n.position),e(p.contactPointB,p.contactPointB,c),r(p.contactPointB,p.contactPointB,o.position),this.contactEquations.push(p),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(p)),1)};u.prototype[f.PLANE|f.CONVEX]=u.prototype[f.PLANE|f.RECTANGLE]=u.prototype.planeConvex=function(n,t,u,f,l,a,v,y,p){var b=s,tt=h,k=c,g=0,nt,it,w,rt;for(i.rotate(tt,d,f),nt=0;nt!==a.vertices.length;nt++)if(it=a.vertices[nt],i.rotate(b,it,y),e(b,b,v),r(k,b,u),o(k,tt)<=0){if(p)return!0;g++;w=this.createContactEquation(n,l,t,a);r(k,b,u);i.copy(w.normalA,tt);rt=o(k,w.normalA);i.scale(k,w.normalA,rt);r(w.contactPointB,b,l.position);r(w.contactPointA,b,k);r(w.contactPointA,w.contactPointA,n.position);this.contactEquations.push(w);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w))}return this.enableFrictionReduction&&this.enableFriction&&g&&this.frictionEquations.push(this.createFrictionFromAverage(g)),g};u.prototype[f.PARTICLE|f.PLANE]=u.prototype.particlePlane=function(n,t,u,f,e,c,l,a,v){var p=s,w=h,b,y;return(a=a||0,r(p,u,l),i.rotate(w,d,a),b=o(p,w),b>0)?0:v?!0:(y=this.createContactEquation(e,n,c,t),i.copy(y.normalA,w),i.scale(p,y.normalA,b),r(y.contactPointA,u,p),r(y.contactPointA,y.contactPointA,e.position),r(y.contactPointB,u,n.position),this.contactEquations.push(y),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(y)),1)};u.prototype[f.CIRCLE|f.PARTICLE]=u.prototype.circleParticle=function(n,t,u,f,o,h,c,l,a){var y=s,v;return(r(y,c,u),i.squaredLength(y)>Math.pow(t.radius,2))?0:a?!0:(v=this.createContactEquation(n,o,t,h),i.copy(v.normalA,y),i.normalize(v.normalA,v.normalA),i.scale(v.contactPointA,v.normalA,t.radius),e(v.contactPointA,v.contactPointA,u),r(v.contactPointA,v.contactPointA,n.position),r(v.contactPointB,c,o.position),this.contactEquations.push(v),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v)),1)};var ei=new wt(1),oi=i.create(),si=i.create(),hi=i.create();u.prototype[f.PLANE|f.CAPSULE]=u.prototype.planeCapsule=function(n,t,r,u,f,o,s,h,c){var l=oi,a=si,y=ei,k=hi,b,p,w,v;return i.set(l,-o.length/2,0),i.rotate(l,l,h),e(l,l,s),i.set(a,o.length/2,0),i.rotate(a,a,h),e(a,a,s),y.radius=o.radius,this.enableFrictionReduction&&(b=this.enableFriction,this.enableFriction=!1),p=this.circlePlane(f,y,l,0,n,t,r,u,c),w=this.circlePlane(f,y,a,0,n,t,r,u,c),this.enableFrictionReduction&&(this.enableFriction=b),c?p||w:(v=p+w,this.enableFrictionReduction&&v&&this.frictionEquations.push(this.createFrictionFromAverage(v)),v)};u.prototype[f.CIRCLE|f.PLANE]=u.prototype.circlePlane=function(n,t,u,f,l,a,v,y,p){var tt=n,it=t,rt=u,ut=l,ot=a,ft=v,b=y,nt,w;b=b||0;var k=s,g=h,et=c;return(r(k,rt,ft),i.rotate(g,d,b),nt=o(g,k),nt>it.radius)?0:p?!0:(w=this.createContactEquation(ut,tt,a,t),i.copy(w.normalA,g),i.scale(w.contactPointB,w.normalA,-it.radius),e(w.contactPointB,w.contactPointB,rt),r(w.contactPointB,w.contactPointB,tt.position),i.scale(et,w.normalA,nt),r(w.contactPointA,k,et),e(w.contactPointA,w.contactPointA,ft),r(w.contactPointA,w.contactPointA,ut.position),this.contactEquations.push(w),this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(w)),1)};u.prototype[f.CONVEX]=u.prototype[f.CONVEX|f.RECTANGLE]=u.prototype[f.RECTANGLE]=u.prototype.convexConvex=function(n,t,f,b,k,d,g,nt,tt,it){var at=s,ct=h,ft=c,ot=l,kt=a,yi=v,li=y,vt=p,dt=w,gt=0,it=typeof it=="number"?it:0,vi=u.findSeparatingAxis(t,f,b,d,g,nt,at),oi,si,ni,et,ui,ai,ci,lt,rt,fi,ei,bt;if(!vi||(r(vt,g,f),o(at,vt)>0&&i.scale(at,at,-1),oi=u.getClosestEdge(t,b,at,!0),si=u.getClosestEdge(d,nt,at),oi===-1||si===-1))return 0;for(ni=0;ni<2;ni++){var st=oi,ti=si,ut=t,yt=d,ht=f,wt=g,pt=b,hi=nt,ii=n,ri=k;for(ni===0&&(et=st,st=ti,ti=et,et=ut,ut=yt,yt=et,et=ht,ht=wt,wt=et,et=pt,pt=hi,hi=et,et=ii,ii=ri,ri=et),ui=ti;ui<ti+2;ui++){for(ai=yt.vertices[(ui+yt.vertices.length)%yt.vertices.length],i.rotate(ct,ai,hi),e(ct,ct,wt),ci=0,lt=st-1;lt<st+2;lt++)fi=ut.vertices[(lt+ut.vertices.length)%ut.vertices.length],ei=ut.vertices[(lt+1+ut.vertices.length)%ut.vertices.length],i.rotate(ft,fi,pt),i.rotate(ot,ei,pt),e(ft,ft,ht),e(ot,ot,ht),r(kt,ot,ft),i.rotate90cw(dt,kt),i.normalize(dt,dt),r(vt,ct,ft),bt=o(dt,vt),(lt===st&&bt<=it||lt!==st&&bt<=0)&&ci++;if(ci>=3){if(tt)return!0;rt=this.createContactEquation(ii,ri,ut,yt);gt++;fi=ut.vertices[st%ut.vertices.length];ei=ut.vertices[(st+1)%ut.vertices.length];i.rotate(ft,fi,pt);i.rotate(ot,ei,pt);e(ft,ft,ht);e(ot,ot,ht);r(kt,ot,ft);i.rotate90cw(rt.normalA,kt);i.normalize(rt.normalA,rt.normalA);r(vt,ct,ft);bt=o(rt.normalA,vt);i.scale(li,rt.normalA,bt);r(rt.contactPointA,ct,ht);r(rt.contactPointA,rt.contactPointA,li);e(rt.contactPointA,rt.contactPointA,ht);r(rt.contactPointA,rt.contactPointA,ii.position);r(rt.contactPointB,ct,wt);e(rt.contactPointB,rt.contactPointB,wt);r(rt.contactPointB,rt.contactPointB,ri.position);this.contactEquations.push(rt);this.enableFrictionReduction||this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(rt))}}}return this.enableFrictionReduction&&this.enableFriction&&gt&&this.frictionEquations.push(this.createFrictionFromAverage(gt)),gt};at=i.fromValues(0,0);u.projectConvexOntoAxis=function(n,t,r,u,f){var e=null,s=null,a,h,v=at,c,y,l;for(i.rotate(v,u,-r),c=0;c<n.vertices.length;c++)a=n.vertices[c],h=o(a,v),(e===null||h>e)&&(e=h),(s===null||h<s)&&(s=h);s>e&&(y=s,s=e,e=y);l=o(t,u);i.set(f,s+l,e+l)};var ci=i.fromValues(0,0),li=i.fromValues(0,0),ai=i.fromValues(0,0),vi=i.fromValues(0,0),yi=i.fromValues(0,0),pi=i.fromValues(0,0);u.findSeparatingAxis=function(n,t,f,e,o,s,h){var d=null,g=!1,it=!1,rt=ci,ut=li,ft=ai,c=vi,a=yi,v=pi,y,p,w,l,b;if(n instanceof k&&e instanceof k)for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==2;l++){l===0?i.set(c,0,1):l===1&&i.set(c,1,0);w!==0&&i.rotate(c,c,w);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}else for(y=0;y!==2;y++)for(p=n,w=f,y===1&&(p=e,w=s),l=0;l!==p.vertices.length;l++){i.rotate(ut,p.vertices[l],w);i.rotate(ft,p.vertices[(l+1)%p.vertices.length],w);r(rt,ft,ut);i.rotate90cw(c,rt);i.normalize(c,c);u.projectConvexOntoAxis(n,t,f,c,a);u.projectConvexOntoAxis(e,o,s,c,v);var nt=a,tt=v,et=!1;a[0]>v[0]&&(tt=a,nt=v,et=!0);b=tt[0]-nt[1];g=b<=0;(d===null||b>d)&&(i.copy(h,c),d=b,it=g)}return it};var wi=i.fromValues(0,0),bi=i.fromValues(0,0),ki=i.fromValues(0,0);u.getClosestEdge=function(n,t,u,f){var s=wi,v=bi,h=ki,e,a;i.rotate(s,u,-t);f&&i.scale(s,s,-1);var l=-1,c=n.vertices.length,y=-1;for(e=0;e!==c;e++)r(v,n.vertices[(e+1)%c],n.vertices[e%c]),i.rotate90cw(h,v),i.normalize(h,h),a=o(h,s),(l===-1||a>y)&&(l=e%c,y=a);return l};var di=i.create(),gi=i.create(),nr=i.create(),tr=i.create(),ir=i.create(),rr=i.create(),ur=i.create();u.prototype[f.CIRCLE|f.HEIGHTFIELD]=u.prototype.circleHeightfield=function(n,t,u,f,o,s,h,c,l,a){var p=s.data,a=a||t.radius,tt=s.elementWidth,k=gi,d=di,ot=ir,st=ur,b=rr,w=nr,it=tr,g=Math.floor((u[0]-a-h[0])/tt),nt=Math.ceil((u[0]+a-h[0])/tt),ut,ft,rt,et,y,v;for(g<0&&(g=0),nt>=p.length&&(nt=p.length-1),ut=p[g],ft=p[nt],y=g;y<nt;y++)p[y]<ft&&(ft=p[y]),p[y]>ut&&(ut=p[y]);if(u[1]-a>ut)return l?!1:0;for(rt=!1,y=g;y<nt;y++)if(i.set(w,y*tt,p[y]),i.set(it,(y+1)*tt,p[y+1]),i.add(w,w,h),i.add(it,it,h),i.sub(b,it,w),i.rotate(b,b,Math.PI/2),i.normalize(b,b),i.scale(d,b,-a),i.add(d,d,u),i.sub(k,d,w),et=i.dot(k,b),d[0]>=w[0]&&d[0]<it[0]&&et<=0){if(l)return!0;rt=!0;i.scale(k,b,-et);i.add(ot,d,k);i.copy(st,b);v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,st);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);i.copy(v.contactPointA,ot);i.sub(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}if(rt=!1,a>0)for(y=g;y<=nt;y++)if(i.set(w,y*tt,p[y]),i.add(w,w,h),i.sub(k,u,w),i.squaredLength(k)<Math.pow(a,2)){if(l)return!0;rt=!0;v=this.createContactEquation(o,n,s,t);i.copy(v.normalA,k);i.normalize(v.normalA,v.normalA);i.scale(v.contactPointB,v.normalA,-a);e(v.contactPointB,v.contactPointB,u);r(v.contactPointB,v.contactPointB,n.position);r(v.contactPointA,w,h);e(v.contactPointA,v.contactPointA,h);r(v.contactPointA,v.contactPointA,o.position);this.contactEquations.push(v);this.enableFriction&&this.frictionEquations.push(this.createFrictionFromContact(v))}return rt?1:0};var fr=i.create(),er=i.create(),or=i.create(),sr=new bt([i.create(),i.create(),i.create(),i.create()]);u.prototype[f.RECTANGLE|f.HEIGHTFIELD]=u.prototype[f.CONVEX|f.HEIGHTFIELD]=u.prototype.convexHeightfield=function(n,t,r,u,f,e,o,s,h){var l=e.data,b=e.elementWidth,v=fr,y=er,k=or,a=sr,p=Math.floor((n.aabb.lowerBound[0]-o[0])/b),w=Math.ceil((n.aabb.upperBound[0]-o[0])/b),d,nt,it,tt,c,g;for(p<0&&(p=0),w>=l.length&&(w=l.length-1),d=l[p],nt=l[w],c=p;c<w;c++)l[c]<nt&&(nt=l[c]),l[c]>d&&(d=l[c]);if(n.aabb.lowerBound[1]>d)return h?!1:0;for(it=!1,tt=0,c=p;c<w;c++)i.set(v,c*b,l[c]),i.set(y,(c+1)*b,l[c+1]),i.add(v,v,o),i.add(y,y,o),g=100,i.set(k,(y[0]+v[0])*.5,(y[1]+v[1]-g)*.5),i.sub(a.vertices[0],y,k),i.sub(a.vertices[1],v,k),i.copy(a.vertices[2],a.vertices[1]),i.copy(a.vertices[3],a.vertices[0]),a.vertices[2][1]-=g,a.vertices[3][1]-=g,tt+=this.convexConvex(n,t,r,u,f,a,k,0,h);return tt}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/FrictionEquation":24,"../math/vec2":31,"../objects/Body":32,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Rectangle":44,"../shapes/Shape":45,"../utils/TupleDictionary":49,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],14:[function(n,t){function i(){r.call(this,r.SAP);this.axisList=[];this.axisIndex=0;var n=this;this._addBodyHandler=function(t){n.axisList.push(t.body)};this._removeBodyHandler=function(t){var i=n.axisList.indexOf(t.body);i!==-1&&n.axisList.splice(i,1)}}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),u=n("../utils/Utils"),r=n("../collision/Broadphase");t.exports=i;i.prototype=new r;i.prototype.setWorld=function(n){this.axisList.length=0;u.appendArray(this.axisList,n.bodies);n.off("addBody",this._addBodyHandler).off("removeBody",this._removeBodyHandler);n.on("addBody",this._addBodyHandler).on("removeBody",this._removeBodyHandler);this.world=n};i.sortAxisList=function(n,t){var r,f,u,i;for(t=t|0,r=1,f=n.length;r<f;r++){for(u=n[r],i=r-1;i>=0;i--){if(n[i].aabb.lowerBound[t]<=u.aabb.lowerBound[t])break;n[i+1]=n[i]}n[i+1]=u}return n};i.prototype.getCollisionPairs=function(){var n=this.axisList,o=this.result,s=this.axisIndex,h,c,t,l,u,e,f,a;for(o.length=0,h=n.length;h--;)c=n[h],c.aabbNeedsUpdate&&c.updateAABB();for(i.sortAxisList(n,s),t=0,l=n.length|0;t!==l;t++)for(u=n[t],e=t+1;e<l;e++){if(f=n[e],a=f.aabb.lowerBound[s]<=u.aabb.upperBound[s],!a)break;r.canCollide(u,f)&&this.boundingVolumeCheck(u,f)&&o.push(u,f)}return o}},{"../collision/Broadphase":10,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],15:[function(n,t){function i(n,t,i,u){this.type=i;u=r.defaults(u,{collideConnected:!0,wakeUpBodies:!0});this.equations=[];this.bodyA=n;this.bodyB=t;this.collideConnected=u.collideConnected;u.wakeUpBodies&&(n&&n.wakeUp(),t&&t.wakeUp())}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),r;t.exports=i;r=n("../utils/Utils");i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!");};i.DISTANCE=1;i.GEAR=2;i.LOCK=3;i.PRISMATIC=4;i.REVOLUTE=5;i.prototype.setStiffness=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.stiffness=n,i.needsUpdate=!0};i.prototype.setRelaxation=function(n){for(var i,r=this.equations,t=0;t!==r.length;t++)i=r[t],i.relaxation=n,i.needsUpdate=!0}},{"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],16:[function(n,t){function u(n,t,r){var o,c,e,l;if(r=h.defaults(r,{localAnchorA:[0,0],localAnchorB:[0,0]}),f.call(this,n,t,f.DISTANCE,r),this.localAnchorA=i.fromValues(r.localAnchorA[0],r.localAnchorA[1]),this.localAnchorB=i.fromValues(r.localAnchorB[0],r.localAnchorB[1]),o=this.localAnchorA,c=this.localAnchorB,this.distance=0,typeof r.distance=="number")this.distance=r.distance;else{var a=i.create(),v=i.create(),u=i.create();i.rotate(a,o,n.angle);i.rotate(v,c,t.angle);i.add(u,t.position,v);i.sub(u,u,a);i.sub(u,u,n.position);this.distance=i.length(u)}e=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce;l=new s(n,t,-e,e);this.equations=[l];this.maxForce=e;var u=i.create(),y=i.create(),p=i.create(),w=this;l.computeGq=function(){var n=this.bodyA,t=this.bodyB,r=n.position,f=t.position;return i.rotate(y,o,n.angle),i.rotate(p,c,t.angle),i.add(u,f,p),i.sub(u,u,y),i.sub(u,u,r),i.length(u)-w.distance};this.setMaxForce(e);this.upperLimitEnabled=!1;this.upperLimit=1;this.lowerLimitEnabled=!1;this.lowerLimit=0;this.position=0}var c=n("__browserify_process"),l=typeof self!="undefined"?self:typeof window!="undefined"?window:{},a=n("__browserify_Buffer"),f=n("./Constraint"),s=n("../equations/Equation"),i=n("../math/vec2"),h=n("../utils/Utils");t.exports=u;u.prototype=new f;var r=i.create(),e=i.create(),o=i.create();u.prototype.update=function(){var l=this.equations[0],f=this.bodyA,s=this.bodyB,y=this.distance,a=f.position,v=s.position,n=this.equations[0],t=l.G,u,h,c;if(i.rotate(e,this.localAnchorA,f.angle),i.rotate(o,this.localAnchorB,s.angle),i.add(r,v,o),i.sub(r,r,e),i.sub(r,r,a),this.position=i.length(r),u=!1,this.upperLimitEnabled&&this.position>this.upperLimit&&(n.maxForce=0,n.minForce=-this.maxForce,this.distance=this.upperLimit,u=!0),this.lowerLimitEnabled&&this.position<this.lowerLimit&&(n.maxForce=this.maxForce,n.minForce=0,this.distance=this.lowerLimit,u=!0),(this.lowerLimitEnabled||this.upperLimitEnabled)&&!u){n.enabled=!1;return}n.enabled=!0;i.normalize(r,r);h=i.crossLength(e,r);c=i.crossLength(o,r);t[0]=-r[0];t[1]=-r[1];t[2]=-h;t[3]=r[0];t[4]=r[1];t[5]=c};u.prototype.setMaxForce=function(n){var t=this.equations[0];t.minForce=-n;t.maxForce=n};u.prototype.getMaxForce=function(){var n=this.equations[0];return n.maxForce}},{"../equations/Equation":23,"../math/vec2":31,"../utils/Utils":50,"./Constraint":15,__browserify_Buffer:1,__browserify_process:2}],17:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,r.GEAR,i);this.ratio=typeof i.ratio=="number"?i.ratio:1;this.angle=typeof i.angle=="number"?i.angle:t.angle-this.ratio*n.angle;i.angle=this.angle;i.ratio=this.ratio;this.equations=[new u(n,t,i),];typeof i.maxTorque=="number"&&this.setMaxTorque(i.maxTorque)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("./Constraint"),s=n("../equations/Equation"),u=n("../equations/AngleLockEquation"),h=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.update=function(){var n=this.equations[0];n.ratio!==this.ratio&&n.setRatio(this.ratio);n.angle=this.angle};i.prototype.setMaxTorque=function(n){this.equations[0].setMaxTorque(n)};i.prototype.getMaxTorque=function(){return this.equations[0].maxForce}},{"../equations/AngleLockEquation":21,"../equations/Equation":23,"../math/vec2":31,"./Constraint":15,__browserify_Buffer:1,__browserify_process:2}],18:[function(n,t){function u(n,t,r){var s,h;r=r||{};e.call(this,n,t,e.LOCK,r);var f=typeof r.maxForce=="undefined"?Number.MAX_VALUE:r.maxForce,p=r.localAngleB||0,a=new o(n,t,-f,f),v=new o(n,t,-f,f),y=new o(n,t,-f,f),c=i.create(),u=i.create(),l=this;a.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[0]};v.computeGq=function(){return i.rotate(c,l.localOffsetB,n.angle),i.sub(u,t.position,n.position),i.sub(u,u,c),u[1]};s=i.create();h=i.create();y.computeGq=function(){return i.rotate(s,l.localOffsetB,t.angle-l.localAngleB),i.scale(s,s,-1),i.sub(u,n.position,t.position),i.add(u,u,s),i.rotate(h,s,-Math.PI/2),i.normalize(h,h),i.dot(u,h)};this.localOffsetB=i.create();r.localOffsetB?i.copy(this.localOffsetB,r.localOffsetB):(i.sub(this.localOffsetB,t.position,n.position),i.rotate(this.localOffsetB,this.localOffsetB,-n.angle));this.localAngleB=0;this.localAngleB=typeof r.localAngleB=="number"?r.localAngleB:t.angle-n.angle;this.equations.push(a,v,y);this.setMaxForce(f)}var l=n("__browserify_process"),a=typeof self!="undefined"?self:typeof window!="undefined"?window:{},v=n("__browserify_Buffer"),e=n("./Constraint"),i=n("../math/vec2"),o=n("../equations/Equation");t.exports=u;u.prototype=new e;u.prototype.setMaxForce=function(n){for(var i=this.equations,t=0;t<this.equations.length;t++)i[t].maxForce=n,i[t].minForce=-n};u.prototype.getMaxForce=function(){return this.equations[0].maxForce};var s=i.create(),f=i.create(),r=i.create(),h=i.fromValues(1,0),c=i.fromValues(0,1);u.prototype.update=function(){var t=this.equations[0],u=this.equations[1],n=this.equations[2],e=this.bodyA,o=this.bodyB;i.rotate(s,this.localOffsetB,e.angle);i.rotate(f,this.localOffsetB,o.angle-this.localAngleB);i.scale(f,f,-1);i.rotate(r,f,Math.PI/2);i.normalize(r,r);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(s,h);t.G[3]=1;u.G[0]=0;u.G[1]=-1;u.G[2]=-i.crossLength(s,c);u.G[4]=1;n.G[0]=-r[0];n.G[1]=-r[1];n.G[3]=r[0];n.G[4]=r[1];n.G[5]=i.crossLength(f,r)}},{"../equations/Equation":23,"../math/vec2":31,"./Constraint":15,__browserify_Buffer:1,__browserify_process:2}],19:[function(n,t){function u(n,t,r){var k;r=r||{};s.call(this,n,t,s.PRISMATIC,r);var o=i.fromValues(0,0),h=i.fromValues(1,0),c=i.fromValues(0,0);r.localAnchorA&&i.copy(o,r.localAnchorA);r.localAxisA&&i.copy(h,r.localAxisA);r.localAnchorB&&i.copy(c,r.localAnchorB);this.localAnchorA=o;this.localAnchorB=c;this.localAxisA=h;var e=this.maxForce=typeof r.maxForce!="undefined"?r.maxForce:Number.MAX_VALUE,y=new a(n,t,-e,e),p=new i.create,w=new i.create,f=new i.create,u=new i.create;y.computeGq=function(){return i.dot(f,u)};y.updateJacobian=function(){var r=this.G,e=n.position,s=t.position;i.rotate(p,o,n.angle);i.rotate(w,c,t.angle);i.add(f,s,w);i.sub(f,f,e);i.sub(f,f,p);i.rotate(u,h,n.angle+Math.PI/2);r[0]=-u[0];r[1]=-u[1];r[2]=-i.crossLength(p,u)+i.crossLength(u,f);r[3]=u[0];r[4]=u[1];r[5]=i.crossLength(w,u)};this.equations.push(y);r.disableRotationalLock||(k=new v(n,t,-e,e),this.equations.push(k));this.position=0;this.velocity=0;this.lowerLimitEnabled=typeof r.lowerLimit!="undefined"?!0:!1;this.upperLimitEnabled=typeof r.upperLimit!="undefined"?!0:!1;this.lowerLimit=typeof r.lowerLimit!="undefined"?r.lowerLimit:0;this.upperLimit=typeof r.upperLimit!="undefined"?r.upperLimit:1;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=this.lowerLimitEquation.minForce=0;this.upperLimitEquation.maxForce=this.lowerLimitEquation.maxForce=e;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.motorSpeed=0;var d=this,b=this.motorEquation,g=b.computeGW;b.computeGq=function(){return 0};b.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+d.motorSpeed}}var y=n("__browserify_process"),p=typeof self!="undefined"?self:typeof window!="undefined"?window:{},w=n("__browserify_Buffer"),s=n("./Constraint"),l=n("../equations/ContactEquation"),a=n("../equations/Equation"),i=n("../math/vec2"),v=n("../equations/RotationalLockEquation");t.exports=u;u.prototype=new s;var r=i.create(),f=i.create(),e=i.create(),h=i.create(),c=i.create(),o=i.create();u.prototype.update=function(){var n=this.equations,b=n[0],p=this.upperLimit,w=this.lowerLimit,t=this.upperLimitEquation,u=this.lowerLimitEquation,a=this.bodyA,v=this.bodyB,k=this.localAxisA,d=this.localAnchorA,g=this.localAnchorB,y,s,l;b.updateJacobian();i.rotate(r,k,a.angle);i.rotate(h,d,a.angle);i.add(f,h,a.position);i.rotate(c,g,v.angle);i.add(e,c,v.position);y=this.position=i.dot(e,r)-i.dot(f,r);this.motorEnabled&&(s=this.motorEquation.G,s[0]=r[0],s[1]=r[1],s[2]=i.crossLength(r,c),s[3]=-r[0],s[4]=-r[1],s[5]=-i.crossLength(r,h));this.upperLimitEnabled&&y>p?(i.scale(t.normalA,r,-1),i.sub(t.contactPointA,f,a.position),i.sub(t.contactPointB,e,v.position),i.scale(o,r,p),i.add(t.contactPointA,t.contactPointA,o),n.indexOf(t)===-1&&n.push(t)):(l=n.indexOf(t),l!==-1&&n.splice(l,1));this.lowerLimitEnabled&&y<w?(i.scale(u.normalA,r,1),i.sub(u.contactPointA,f,a.position),i.sub(u.contactPointB,e,v.position),i.scale(o,r,w),i.sub(u.contactPointB,u.contactPointB,o),n.indexOf(u)===-1&&n.push(u)):(l=n.indexOf(u),l!==-1&&n.splice(l,1))};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)}},{"../equations/ContactEquation":22,"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../math/vec2":31,"./Constraint":15,__browserify_Buffer:1,__browserify_process:2}],20:[function(n,t){function u(n,t,u){var v;u=u||{};o.call(this,n,t,o.REVOLUTE,u);v=this.maxForce=typeof u.maxForce!="undefined"?u.maxForce:Number.MAX_VALUE;this.pivotA=i.create();this.pivotB=i.create();u.worldPivot?(i.sub(this.pivotA,u.worldPivot,n.position),i.sub(this.pivotB,u.worldPivot,t.position),i.rotate(this.pivotA,this.pivotA,-n.angle),i.rotate(this.pivotB,this.pivotB,-t.angle)):(i.copy(this.pivotA,u.localPivotA),i.copy(this.pivotB,u.localPivotB));var b=this.equations=[new c(n,t,-v,v),new c(n,t,-v,v),],p=b[0],w=b[1],y=this;p.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,s)};w.computeGq=function(){return i.rotate(f,y.pivotA,n.angle),i.rotate(e,y.pivotB,t.angle),i.add(r,t.position,e),i.sub(r,r,n.position),i.sub(r,r,f),i.dot(r,h)};w.minForce=p.minForce=-v;w.maxForce=p.maxForce=v;this.motorEquation=new a(n,t);this.motorEnabled=!1;this.angle=0;this.lowerLimitEnabled=!1;this.upperLimitEnabled=!1;this.lowerLimit=0;this.upperLimit=0;this.upperLimitEquation=new l(n,t);this.lowerLimitEquation=new l(n,t);this.upperLimitEquation.minForce=0;this.lowerLimitEquation.maxForce=0}var v=n("__browserify_process"),y=typeof self!="undefined"?self:typeof window!="undefined"?window:{},p=n("__browserify_Buffer"),o=n("./Constraint"),c=n("../equations/Equation"),a=n("../equations/RotationalVelocityEquation"),l=n("../equations/RotationalLockEquation"),i=n("../math/vec2");t.exports=u;var f=i.create(),e=i.create(),s=i.fromValues(1,0),h=i.fromValues(0,1),r=i.create();u.prototype=new o;u.prototype.setLimits=function(n,t){typeof n=="number"?(this.lowerLimit=n,this.lowerLimitEnabled=!0):(this.lowerLimit=n,this.lowerLimitEnabled=!1);typeof t=="number"?(this.upperLimit=t,this.upperLimitEnabled=!0):(this.upperLimit=t,this.upperLimitEnabled=!1)};u.prototype.update=function(){var l=this.bodyA,a=this.bodyB,w=this.pivotA,b=this.pivotB,n=this.equations,k=n[0],d=n[1],t=n[0],r=n[1],v=this.upperLimit,y=this.lowerLimit,o=this.upperLimitEquation,c=this.lowerLimitEquation,p=this.angle=a.angle-l.angle,u;this.upperLimitEnabled&&p>v?(o.angle=v,n.indexOf(o)===-1&&n.push(o)):(u=n.indexOf(o),u!==-1&&n.splice(u,1));this.lowerLimitEnabled&&p<y?(c.angle=y,n.indexOf(c)===-1&&n.push(c)):(u=n.indexOf(c),u!==-1&&n.splice(u,1));i.rotate(f,w,l.angle);i.rotate(e,b,a.angle);t.G[0]=-1;t.G[1]=0;t.G[2]=-i.crossLength(f,s);t.G[3]=1;t.G[4]=0;t.G[5]=i.crossLength(e,s);r.G[0]=0;r.G[1]=-1;r.G[2]=-i.crossLength(f,h);r.G[3]=0;r.G[4]=1;r.G[5]=i.crossLength(e,h)};u.prototype.enableMotor=function(){this.motorEnabled||(this.equations.push(this.motorEquation),this.motorEnabled=!0)};u.prototype.disableMotor=function(){if(this.motorEnabled){var n=this.equations.indexOf(this.motorEquation);this.equations.splice(n,1);this.motorEnabled=!1}};u.prototype.motorIsEnabled=function(){return!!this.motorEnabled};u.prototype.setMotorSpeed=function(n){if(this.motorEnabled){var t=this.equations.indexOf(this.motorEquation);this.equations[t].relativeVelocity=n}};u.prototype.getMotorSpeed=function(){return this.motorEnabled?this.motorEquation.relativeVelocity:!1}},{"../equations/Equation":23,"../equations/RotationalLockEquation":25,"../equations/RotationalVelocityEquation":26,"../math/vec2":31,"./Constraint":15,__browserify_Buffer:1,__browserify_process:2}],21:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;this.ratio=typeof i.ratio=="number"?i.ratio:1;this.setRatio(this.ratio)}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),r=n("./Equation"),o=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeGq=function(){return this.ratio*this.bodyA.angle-this.bodyB.angle+this.angle};i.prototype.setRatio=function(n){var t=this.G;t[2]=n;t[5]=-1;this.ratio=n};i.prototype.setMaxTorque=function(n){this.maxForce=n;this.minForce=-n}},{"../math/vec2":31,"./Equation":23,__browserify_Buffer:1,__browserify_process:2}],22:[function(n,t){function r(n,t){u.call(this,n,t,0,Number.MAX_VALUE);this.contactPointA=i.create();this.penetrationVec=i.create();this.contactPointB=i.create();this.normalA=i.create();this.restitution=0;this.firstImpact=!1;this.shapeA=null;this.shapeB=null}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;r.prototype.computeB=function(n,t,r){var v=this.bodyA,y=this.bodyB,h=this.contactPointA,c=this.contactPointB,p=v.position,w=y.position,f=this.penetrationVec,u=this.normalA,e=this.G,b=i.crossLength(h,u),k=i.crossLength(c,u),o,s,l,a;return e[0]=-u[0],e[1]=-u[1],e[2]=-b,e[3]=u[0],e[4]=u[1],e[5]=k,i.add(f,w,c),i.sub(f,f,p),i.sub(f,f,h),this.firstImpact&&this.restitution!==0?(s=0,o=1/t*(1+this.restitution)*this.computeGW()):(s=i.dot(u,f)+this.offset,o=this.computeGW()),l=this.computeGiMf(),a=-s*n-o*t-r*l,a}},{"../math/vec2":31,"./Equation":23,__browserify_Buffer:1,__browserify_process:2}],23:[function(n,t){function i(n,t,r,u){this.minForce=typeof r=="undefined"?-Number.MAX_VALUE:r;this.maxForce=typeof u=="undefined"?Number.MAX_VALUE:u;this.bodyA=n;this.bodyB=t;this.stiffness=i.DEFAULT_STIFFNESS;this.relaxation=i.DEFAULT_RELAXATION;this.G=new s.ARRAY_TYPE(6);for(var f=0;f<6;f++)this.G[f]=0;this.offset=0;this.a=0;this.b=0;this.epsilon=0;this.timeStep=1/60;this.needsUpdate=!0;this.multiplier=0;this.relativeVelocity=0;this.enabled=!0}var p=n("__browserify_process"),w=typeof self!="undefined"?self:typeof window!="undefined"?window:{},b=n("__browserify_Buffer"),e,o,u,f;t.exports=i;var r=n("../math/vec2"),s=n("../utils/Utils"),k=n("../objects/Body");i.prototype.constructor=i;i.DEFAULT_STIFFNESS=1e6;i.DEFAULT_RELAXATION=4;i.prototype.update=function(){var i=this.stiffness,n=this.relaxation,t=this.timeStep;this.a=4/(t*(1+4*n));this.b=4*n/(1+4*n);this.epsilon=4/(t*t*i*(1+4*n));this.needsUpdate=!1};i.prototype.gmult=function(n,t,i,r,u){return n[0]*t[0]+n[1]*t[1]+n[2]*i+n[3]*r[0]+n[4]*r[1]+n[5]*u};i.prototype.computeB=function(n,t,i){var r=this.computeGW(),u=this.computeGq(),f=this.computeGiMf();return-u*n-r*t-f*i};e=r.create();o=r.create();i.prototype.computeGq=function(){var i=this.G,n=this.bodyA,t=this.bodyB,f=n.position,s=t.position,r=n.angle,u=t.angle;return this.gmult(i,e,r,o,u)+this.offset};i.prototype.computeGW=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.velocity,u=t.velocity,f=n.angularVelocity,e=t.angularVelocity;return this.gmult(i,r,f,u,e)+this.relativeVelocity};i.prototype.computeGWlambda=function(){var i=this.G,n=this.bodyA,t=this.bodyB,r=n.vlambda,u=t.vlambda,f=n.wlambda,e=t.wlambda;return this.gmult(i,r,f,u,e)};u=r.create();f=r.create();i.prototype.computeGiMf=function(){var n=this.bodyA,t=this.bodyB,i=n.force,e=n.angularForce,o=t.force,s=t.angularForce,h=n.invMassSolve,c=t.invMassSolve,l=n.invInertiaSolve,a=t.invInertiaSolve,v=this.G;return r.scale(u,i,h),r.scale(f,o,c),this.gmult(v,u,e*l,f,s*a)};i.prototype.computeGiMGt=function(){var t=this.bodyA,i=this.bodyB,r=t.invMassSolve,u=i.invMassSolve,f=t.invInertiaSolve,e=i.invInertiaSolve,n=this.G;return n[0]*n[0]*r+n[1]*n[1]*r+n[2]*n[2]*f+n[3]*n[3]*u+n[4]*n[4]*u+n[5]*n[5]*e};var h=r.create(),c=r.create(),l=r.create(),a=r.create(),v=r.create(),y=r.create();i.prototype.addToWlambda=function(n){var i=this.bodyA,u=this.bodyB,f=h,e=c,o=l,k=a,d=v,s=i.invMassSolve,p=u.invMassSolve,w=i.invInertiaSolve,b=u.invInertiaSolve,g=y,t=this.G;e[0]=t[0];e[1]=t[1];o[0]=t[3];o[1]=t[4];r.scale(f,e,s*n);r.add(i.vlambda,i.vlambda,f);i.wlambda+=w*t[2]*n;r.scale(f,o,p*n);r.add(u.vlambda,u.vlambda,f);u.wlambda+=b*t[5]*n};i.prototype.computeInvC=function(n){return 1/(this.computeGiMGt()+n)}},{"../math/vec2":31,"../objects/Body":32,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],24:[function(n,t){function i(n,t,i){u.call(this,n,t,-i,i);this.contactPointA=r.create();this.contactPointB=r.create();this.t=r.create();this.contactEquations=[];this.shapeA=null;this.shapeB=null;this.frictionCoefficient=.3}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("../math/vec2"),u=n("./Equation"),s=n("../utils/Utils");t.exports=i;i.prototype=new u;i.prototype.constructor=i;i.prototype.setSlipForce=function(n){this.maxForce=n;this.minForce=-n};i.prototype.getSlipForce=function(){return this.maxForce};i.prototype.computeB=function(n,t,i){var c=this.bodyA,l=this.bodyB,e=this.contactPointA,o=this.contactPointB,u=this.t,f=this.G;f[0]=-u[0];f[1]=-u[1];f[2]=-r.crossLength(e,u);f[3]=u[0];f[4]=u[1];f[5]=r.crossLength(o,u);var s=this.computeGW(),h=this.computeGiMf();return-s*t-i*h}},{"../math/vec2":31,"../utils/Utils":50,"./Equation":23,__browserify_Buffer:1,__browserify_process:2}],25:[function(n,t){function r(n,t,i){i=i||{};u.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.angle=i.angle||0;var r=this.G;r[2]=1;r[5]=-1}var h=n("__browserify_process"),c=typeof self!="undefined"?self:typeof window!="undefined"?window:{},l=n("__browserify_Buffer"),u=n("./Equation"),i=n("../math/vec2");t.exports=r;r.prototype=new u;r.prototype.constructor=r;var f=i.create(),e=i.create(),o=i.fromValues(1,0),s=i.fromValues(0,1);r.prototype.computeGq=function(){return i.rotate(f,o,this.bodyA.angle+this.angle),i.rotate(e,s,this.bodyB.angle),i.dot(f,e)}},{"../math/vec2":31,"./Equation":23,__browserify_Buffer:1,__browserify_process:2}],26:[function(n,t){function i(n,t){r.call(this,n,t,-Number.MAX_VALUE,Number.MAX_VALUE);this.relativeVelocity=1;this.ratio=1}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),r=n("./Equation"),o=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.constructor=i;i.prototype.computeB=function(n,t,i){var r=this.G;r[2]=-1;r[5]=this.ratio;var u=this.computeGiMf(),f=this.computeGW();return-f*t-i*u}},{"../math/vec2":31,"./Equation":23,__browserify_Buffer:1,__browserify_process:2}],27:[function(n,t){var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer"),i=function(){};t.exports=i;i.prototype={constructor:i,on:function(n,t,i){t.context=i||this;this._listeners===undefined&&(this._listeners={});var r=this._listeners;return r[n]===undefined&&(r[n]=[]),r[n].indexOf(t)===-1&&r[n].push(t),this},has:function(n,t){if(this._listeners===undefined)return!1;var i=this._listeners;if(t){if(i[n]!==undefined&&i[n].indexOf(t)!==-1)return!0}else if(i[n]!==undefined)return!0;return!1},off:function(n,t){if(this._listeners===undefined)return this;var i=this._listeners,r=i[n].indexOf(t);return r!==-1&&i[n].splice(r,1),this},emit:function(n){var u,t,i,f,r;if(this._listeners===undefined)return this;if(u=this._listeners,t=u[n.type],t!==undefined)for(n.target=this,i=0,f=t.length;i<f;i++)r=t[i],r.call(r.context,n);return this}}},{__browserify_Buffer:1,__browserify_process:2}],28:[function(n,t){function r(n,t,f){if(f=f||{},!(n instanceof u)||!(t instanceof u))throw new Error("First two arguments must be Material instances.");this.id=r.idCounter++;this.materialA=n;this.materialB=t;this.friction=typeof f.friction!="undefined"?Number(f.friction):.3;this.restitution=typeof f.restitution!="undefined"?Number(f.restitution):0;this.stiffness=typeof f.stiffness!="undefined"?Number(f.stiffness):i.DEFAULT_STIFFNESS;this.relaxation=typeof f.relaxation!="undefined"?Number(f.relaxation):i.DEFAULT_RELAXATION;this.frictionStiffness=typeof f.frictionStiffness!="undefined"?Number(f.frictionStiffness):i.DEFAULT_STIFFNESS;this.frictionRelaxation=typeof f.frictionRelaxation!="undefined"?Number(f.frictionRelaxation):i.DEFAULT_RELAXATION;this.surfaceVelocity=typeof f.surfaceVelocity!="undefined"?Number(f.surfaceVelocity):0;this.contactSkinSize=.005}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),u=n("./Material"),i=n("../equations/Equation");t.exports=r;r.idCounter=0},{"../equations/Equation":23,"./Material":29,__browserify_Buffer:1,__browserify_process:2}],29:[function(n,t){function i(n){this.id=n||i.idCounter++}var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer");t.exports=i;i.idCounter=0},{__browserify_Buffer:1,__browserify_process:2}],30:[function(n,t){var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer"),i={};i.GetArea=function(n){var i,r,t;if(n.length<6)return 0;for(i=n.length-2,r=0,t=0;t<i;t+=2)r+=(n[t+2]-n[t])*(n[t+1]+n[t+3]);return r+=(n[0]-n[i])*(n[i+1]+n[1]),-r*.5};i.Triangulate=function(n){var l=n.length>>1,e,r,t,u,c,f;if(l<3)return[];for(e=[],r=[],t=0;t<l;t++)r.push(t);for(t=0,u=l;u>3;){var o=r[(t+0)%u],s=r[(t+1)%u],h=r[(t+2)%u],v=n[2*o],y=n[2*o+1],p=n[2*s],w=n[2*s+1],b=n[2*h],k=n[2*h+1],a=!1;if(i._convex(v,y,p,w,b,k))for(a=!0,c=0;c<u;c++)if((f=r[c],f!=o&&f!=s&&f!=h)&&i._PointInTriangle(n[2*f],n[2*f+1],v,y,p,w,b,k)){a=!1;break}if(a)e.push(o,s,h),r.splice((t+1)%u,1),u--,t=0;else if(t++>3*u)break}return e.push(r[0],r[1],r[2]),e};i._PointInTriangle=function(n,t,i,r,u,f,e,o){var s=e-i,h=o-r,c=u-i,l=f-r,v=n-i,y=t-r,p=s*s+h*h,a=s*c+h*l,w=s*v+h*y,b=c*c+l*l,k=c*v+l*y,d=1/(p*b-a*a),g=(b*w-a*k)*d,nt=(p*k-a*w)*d;return g>=0&&nt>=0&&g+nt<1};i._convex=function(n,t,i,r,u,f){return(t-r)*(u-i)+(i-n)*(f-r)>=0};t.exports=i},{__browserify_Buffer:1,__browserify_process:2}],31:[function(n,t){var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),i=t.exports={},r=n("../utils/Utils");i.crossLength=function(n,t){return n[0]*t[1]-n[1]*t[0]};i.crossVZ=function(n,t,r){return i.rotate(n,t,-Math.PI/2),i.scale(n,n,r),n};i.crossZV=function(n,t,r){return i.rotate(n,r,Math.PI/2),i.scale(n,n,t),n};i.rotate=function(n,t,i){if(i!==0){var r=Math.cos(i),u=Math.sin(i),f=t[0],e=t[1];n[0]=r*f-u*e;n[1]=u*f+r*e}else n[0]=t[0],n[1]=t[1]};i.rotate90cw=function(n,t){var i=t[0],r=t[1];n[0]=r;n[1]=-i};i.toLocalFrame=function(n,t,r,u){i.copy(n,t);i.sub(n,n,r);i.rotate(n,n,-u)};i.toGlobalFrame=function(n,t,r,u){i.copy(n,t);i.rotate(n,n,u);i.add(n,n,r)};i.centroid=function(n,t,r,u){return i.add(n,t,r),i.add(n,n,u),i.scale(n,n,1/3),n};i.create=function(){var n=new r.ARRAY_TYPE(2);return n[0]=0,n[1]=0,n};i.clone=function(n){var t=new r.ARRAY_TYPE(2);return t[0]=n[0],t[1]=n[1],t};i.fromValues=function(n,t){var i=new r.ARRAY_TYPE(2);return i[0]=n,i[1]=t,i};i.copy=function(n,t){return n[0]=t[0],n[1]=t[1],n};i.set=function(n,t,i){return n[0]=t,n[1]=i,n};i.add=function(n,t,i){return n[0]=t[0]+i[0],n[1]=t[1]+i[1],n};i.subtract=function(n,t,i){return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n};i.sub=i.subtract;i.multiply=function(n,t,i){return n[0]=t[0]*i[0],n[1]=t[1]*i[1],n};i.mul=i.multiply;i.divide=function(n,t,i){return n[0]=t[0]/i[0],n[1]=t[1]/i[1],n};i.div=i.divide;i.scale=function(n,t,i){return n[0]=t[0]*i,n[1]=t[1]*i,n};i.distance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return Math.sqrt(i*i+r*r)};i.dist=i.distance;i.squaredDistance=function(n,t){var i=t[0]-n[0],r=t[1]-n[1];return i*i+r*r};i.sqrDist=i.squaredDistance;i.length=function(n){var t=n[0],i=n[1];return Math.sqrt(t*t+i*i)};i.len=i.length;i.squaredLength=function(n){var t=n[0],i=n[1];return t*t+i*i};i.sqrLen=i.squaredLength;i.negate=function(n,t){return n[0]=-t[0],n[1]=-t[1],n};i.normalize=function(n,t){var r=t[0],u=t[1],i=r*r+u*u;return i>0&&(i=1/Math.sqrt(i),n[0]=t[0]*i,n[1]=t[1]*i),n};i.dot=function(n,t){return n[0]*t[0]+n[1]*t[1]};i.str=function(n){return"vec2("+n[0]+", "+n[1]+")"}},{"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],32:[function(n,t){function i(n){n=n||{};e.call(this);this.id=++i._idCounter;this.world=null;this.shapes=[];this.shapeOffsets=[];this.shapeAngles=[];this.mass=n.mass||0;this.invMass=0;this.inertia=0;this.invInertia=0;this.invMassSolve=0;this.invInertiaSolve=0;this.fixedRotation=!!n.fixedRotation;this.position=r.fromValues(0,0);n.position&&r.copy(this.position,n.position);this.interpolatedPosition=r.fromValues(0,0);this.interpolatedAngle=0;this.previousPosition=r.fromValues(0,0);this.previousAngle=0;this.velocity=r.fromValues(0,0);n.velocity&&r.copy(this.velocity,n.velocity);this.vlambda=r.fromValues(0,0);this.wlambda=0;this.angle=n.angle||0;this.angularVelocity=n.angularVelocity||0;this.force=r.create();n.force&&r.copy(this.force,n.force);this.angularForce=n.angularForce||0;this.damping=typeof n.damping=="number"?n.damping:.1;this.angularDamping=typeof n.angularDamping=="number"?n.angularDamping:.1;this.type=i.STATIC;this.type=typeof n.type!="undefined"?n.type:n.mass?i.DYNAMIC:i.STATIC;this.boundingRadius=0;this.aabb=new f;this.aabbNeedsUpdate=!0;this.allowSleep=!0;this.wantsToSleep=!1;this.sleepState=i.AWAKE;this.sleepSpeedLimit=.2;this.sleepTimeLimit=1;this.gravityScale=1;this.timeLastSleepy=0;this.concavePath=null;this._wakeUpAfterNarrowphase=!1;this.updateMassProperties()}var y=n("__browserify_process"),p=typeof self!="undefined"?self:typeof window!="undefined"?window:{},w=n("__browserify_Buffer"),r=n("../math/vec2"),h=n("poly-decomp"),c=n("../shapes/Convex"),f=n("../collision/AABB"),e=n("../events/EventEmitter"),u,o,s;t.exports=i;i.prototype=new e;i._idCounter=0;i.prototype.updateSolveMassProperties=function(){this.sleepState===i.SLEEPING||this.type===i.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve=0):(this.invMassSolve=this.invMass,this.invInertiaSolve=this.invInertia)};i.prototype.setDensity=function(n){var t=this.getArea();this.mass=t*n;this.updateMassProperties()};i.prototype.getArea=function(){for(var t=0,n=0;n<this.shapes.length;n++)t+=this.shapes[n].area;return t};i.prototype.getAABB=function(){return this.aabbNeedsUpdate&&this.updateAABB(),this.aabb};u=new f;o=r.create();i.prototype.updateAABB=function(){for(var e,s,i=this.shapes,h=this.shapeOffsets,c=this.shapeAngles,l=i.length,t=o,f=this.angle,n=0;n!==l;n++)e=i[n],s=c[n]+f,r.rotate(t,h[n],f),r.add(t,t,this.position),e.computeAABB(u,t,s),n===0?this.aabb.copy(u):this.aabb.extend(u);this.aabbNeedsUpdate=!1};i.prototype.updateBoundingRadius=function(){for(var i=this.shapes,e=this.shapeOffsets,o=i.length,t=0,n=0;n!==o;n++){var s=i[n],u=r.length(e[n]),f=s.boundingRadius;u+f>t&&(t=u+f)}this.boundingRadius=t};i.prototype.addShape=function(n,t,i){i=i||0;t=t?r.fromValues(t[0],t[1]):r.fromValues(0,0);this.shapes.push(n);this.shapeOffsets.push(t);this.shapeAngles.push(i);this.updateMassProperties();this.updateBoundingRadius();this.aabbNeedsUpdate=!0};i.prototype.removeShape=function(n){var t=this.shapes.indexOf(n);return t!==-1?(this.shapes.splice(t,1),this.shapeOffsets.splice(t,1),this.shapeAngles.splice(t,1),this.aabbNeedsUpdate=!0,!0):!1};i.prototype.updateMassProperties=function(){var n;if(this.type===i.STATIC||this.type===i.KINEMATIC)this.mass=Number.MAX_VALUE,this.invMass=0,this.inertia=Number.MAX_VALUE,this.invInertia=0;else{var u=this.shapes,f=u.length,e=this.mass/f,t=0;if(this.fixedRotation)this.inertia=Number.MAX_VALUE,this.invInertia=0;else{for(n=0;n<f;n++){var o=u[n],s=r.squaredLength(this.shapeOffsets[n]),h=o.computeMomentOfInertia(e);t+=h+e*s}this.inertia=t;this.invInertia=t>0?1/t:0}this.invMass=1/this.mass}};s=r.create();i.prototype.applyForce=function(n,t){var i=s,u;r.sub(i,t,this.position);r.add(this.force,this.force,n);u=r.crossLength(i,n);this.angularForce+=u};i.prototype.toLocalFrame=function(n,t){r.toLocalFrame(n,t,this.position,this.angle)};i.prototype.toWorldFrame=function(n,t){r.toGlobalFrame(n,t,this.position,this.angle)};i.prototype.fromPolygon=function(n,t){var f,s,l,i,u,o,e;for(t=t||{},i=this.shapes.length;i>=0;--i)this.removeShape(this.shapes[i]);if(f=new h.Polygon,f.vertices=n,f.makeCCW(),typeof t.removeCollinearPoints=="number"&&f.removeCollinearPoints(t.removeCollinearPoints),typeof t.skipSimpleCheck=="undefined"&&!f.isSimple())return!1;for(this.concavePath=f.vertices.slice(0),i=0;i<this.concavePath.length;i++)e=[0,0],r.copy(e,this.concavePath[i]),this.concavePath[i]=e;for(s=t.optimalDecomp?f.decomp():f.quickDecomp(),l=r.create(),i=0;i!==s.length;i++){for(u=new c(s[i].vertices),o=0;o!==u.vertices.length;o++)e=u.vertices[o],r.sub(e,e,u.centerOfMass);r.scale(l,u.centerOfMass,1);u.updateTriangles();u.updateCenterOfMass();u.updateBoundingRadius();this.addShape(u,l)}return this.adjustCenterOfMass(),this.aabbNeedsUpdate=!0,!0};var b=r.fromValues(0,0),l=r.fromValues(0,0),a=r.fromValues(0,0),v=r.fromValues(0,0);i.prototype.adjustCenterOfMass=function(){var e=l,i=a,u=v,o=0,f,t,n;for(r.set(i,0,0),n=0;n!==this.shapes.length;n++)f=this.shapes[n],t=this.shapeOffsets[n],r.scale(e,t,f.area),r.add(i,i,e),o+=f.area;for(r.scale(u,i,1/o),n=0;n!==this.shapes.length;n++)f=this.shapes[n],t=this.shapeOffsets[n],t||(t=this.shapeOffsets[n]=r.create()),r.sub(t,t,u);for(r.add(this.position,this.position,u),n=0;this.concavePath&&n<this.concavePath.length;n++)r.sub(this.concavePath[n],this.concavePath[n],u);this.updateMassProperties();this.updateBoundingRadius()};i.prototype.setZeroForce=function(){r.set(this.force,0,0);this.angularForce=0};i.prototype.resetConstraintVelocity=function(){var n=this,t=n.vlambda;r.set(t,0,0);n.wlambda=0};i.prototype.addConstraintVelocity=function(){var n=this,t=n.velocity;r.add(t,t,n.vlambda);n.angularVelocity+=n.wlambda};i.prototype.applyDamping=function(n){if(this.type===i.DYNAMIC){var t=this.velocity;r.scale(t,t,Math.pow(1-this.damping,n));this.angularVelocity*=Math.pow(1-this.angularDamping,n)}};i.prototype.wakeUp=function(){var n=this.sleepState;this.sleepState=i.AWAKE;this.idleTime=0;n!==i.AWAKE&&this.emit(i.wakeUpEvent)};i.prototype.sleep=function(){this.sleepState=i.SLEEPING;this.angularVelocity=0;this.angularForce=0;r.set(this.velocity,0,0);r.set(this.force,0,0);this.emit(i.sleepEvent)};i.prototype.sleepTick=function(n,t,u){if(this.allowSleep&&this.type!==i.SLEEPING){this.wantsToSleep=!1;var o=this.sleepState,f=r.squaredLength(this.velocity)+Math.pow(this.angularVelocity,2),e=Math.pow(this.sleepSpeedLimit,2);f>=e?(this.idleTime=0,this.sleepState=i.AWAKE):(this.idleTime+=u,this.sleepState=i.SLEEPY);this.idleTime>this.sleepTimeLimit&&(t?this.wantsToSleep=!0:this.sleep())}};i.prototype.getVelocityFromPosition=function(n,t){return n=n||r.create(),r.sub(n,this.position,this.previousPosition),r.scale(n,n,1/t),n};i.prototype.getAngularVelocityFromPosition=function(n){return(this.angle-this.previousAngle)/n};i.prototype.overlaps=function(n){return this.world.overlapKeeper.bodiesAreOverlapping(this,n)};i.sleepyEvent={type:"sleepy"};i.sleepEvent={type:"sleep"};i.wakeUpEvent={type:"wakeup"};i.DYNAMIC=1;i.STATIC=2;i.KINEMATIC=4;i.AWAKE=0;i.SLEEPY=1;i.SLEEPING=2},{"../collision/AABB":9,"../events/EventEmitter":27,"../math/vec2":31,"../shapes/Convex":39,__browserify_Buffer:1,__browserify_process:2,"poly-decomp":7}],33:[function(n,t){function r(n,t,r){var f,e,o;r=r||{};u.call(this,n,t,r);this.localAnchorA=i.fromValues(0,0);this.localAnchorB=i.fromValues(0,0);r.localAnchorA&&i.copy(this.localAnchorA,r.localAnchorA);r.localAnchorB&&i.copy(this.localAnchorB,r.localAnchorB);r.worldAnchorA&&this.setWorldAnchorA(r.worldAnchorA);r.worldAnchorB&&this.setWorldAnchorB(r.worldAnchorB);f=i.create();e=i.create();this.getWorldAnchorA(f);this.getWorldAnchorB(e);o=i.distance(f,e);this.restLength=typeof r.restLength=="number"?r.restLength:o}var y=n("__browserify_process"),p=typeof self!="undefined"?self:typeof window!="undefined"?window:{},w=n("__browserify_Buffer"),i=n("../math/vec2"),u=n("./Spring"),b=n("../utils/Utils");t.exports=r;r.prototype=new u;r.prototype.setWorldAnchorA=function(n){this.bodyA.toLocalFrame(this.localAnchorA,n)};r.prototype.setWorldAnchorB=function(n){this.bodyB.toLocalFrame(this.localAnchorB,n)};r.prototype.getWorldAnchorA=function(n){this.bodyA.toWorldFrame(n,this.localAnchorA)};r.prototype.getWorldAnchorB=function(n){this.bodyB.toWorldFrame(n,this.localAnchorB)};var f=i.create(),e=i.create(),o=i.create(),s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create();r.prototype.applyForce=function(){var rt=this.stiffness,ut=this.damping,ft=this.restLength,n=this.bodyA,t=this.bodyB,p=f,w=e,r=o,u=s,y=v,b=h,k=c,d=l,g=a,nt,tt,it;this.getWorldAnchorA(b);this.getWorldAnchorB(k);i.sub(d,b,n.position);i.sub(g,k,t.position);i.sub(p,k,b);nt=i.len(p);i.normalize(w,p);i.sub(r,t.velocity,n.velocity);i.crossZV(y,t.angularVelocity,g);i.add(r,r,y);i.crossZV(y,n.angularVelocity,d);i.sub(r,r,y);i.scale(u,w,-rt*(nt-ft)-ut*i.dot(r,w));i.sub(n.force,n.force,u);i.add(t.force,t.force,u);tt=i.crossLength(d,u);it=i.crossLength(g,u);n.angularForce-=tt;t.angularForce+=it}},{"../math/vec2":31,"../utils/Utils":50,"./Spring":35,__browserify_Buffer:1,__browserify_process:2}],34:[function(n,t){function i(n,t,i){i=i||{};r.call(this,n,t,i);this.restAngle=typeof i.restAngle=="number"?i.restAngle:t.angle-n.angle}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),o=n("../math/vec2"),r=n("./Spring");t.exports=i;i.prototype=new r;i.prototype.applyForce=function(){var r=this.stiffness,u=this.damping,f=this.restAngle,n=this.bodyA,t=this.bodyB,e=t.angle-n.angle,o=t.angularVelocity-n.angularVelocity,i=-r*(e-f)-u*o*0;n.angularForce-=i;t.angularForce+=i}},{"../math/vec2":31,"./Spring":35,__browserify_Buffer:1,__browserify_process:2}],35:[function(n,t){function i(n,t,i){i=r.defaults(i,{stiffness:100,damping:1});this.stiffness=i.stiffness;this.damping=i.damping;this.bodyA=n;this.bodyB=t}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),o=n("../math/vec2"),r=n("../utils/Utils");t.exports=i;i.prototype.applyForce=function(){}},{"../math/vec2":31,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],36:[function(n,t){var i=n("__browserify_process"),r=typeof self!="undefined"?self:typeof window!="undefined"?window:{},u=n("__browserify_Buffer");t.exports={AABB:n("./collision/AABB"),AngleLockEquation:n("./equations/AngleLockEquation"),Body:n("./objects/Body"),Broadphase:n("./collision/Broadphase"),Capsule:n("./shapes/Capsule"),Circle:n("./shapes/Circle"),Constraint:n("./constraints/Constraint"),ContactEquation:n("./equations/ContactEquation"),ContactMaterial:n("./material/ContactMaterial"),Convex:n("./shapes/Convex"),DistanceConstraint:n("./constraints/DistanceConstraint"),Equation:n("./equations/Equation"),EventEmitter:n("./events/EventEmitter"),FrictionEquation:n("./equations/FrictionEquation"),GearConstraint:n("./constraints/GearConstraint"),GridBroadphase:n("./collision/GridBroadphase"),GSSolver:n("./solver/GSSolver"),Heightfield:n("./shapes/Heightfield"),Line:n("./shapes/Line"),LockConstraint:n("./constraints/LockConstraint"),Material:n("./material/Material"),Narrowphase:n("./collision/Narrowphase"),NaiveBroadphase:n("./collision/NaiveBroadphase"),Particle:n("./shapes/Particle"),Plane:n("./shapes/Plane"),RevoluteConstraint:n("./constraints/RevoluteConstraint"),PrismaticConstraint:n("./constraints/PrismaticConstraint"),Rectangle:n("./shapes/Rectangle"),RotationalVelocityEquation:n("./equations/RotationalVelocityEquation"),SAPBroadphase:n("./collision/SAPBroadphase"),Shape:n("./shapes/Shape"),Solver:n("./solver/Solver"),Spring:n("./objects/Spring"),LinearSpring:n("./objects/LinearSpring"),RotationalSpring:n("./objects/RotationalSpring"),Utils:n("./utils/Utils"),World:n("./world/World"),vec2:n("./math/vec2"),version:n("../package.json").version}},{"../package.json":8,"./collision/AABB":9,"./collision/Broadphase":10,"./collision/GridBroadphase":11,"./collision/NaiveBroadphase":12,"./collision/Narrowphase":13,"./collision/SAPBroadphase":14,"./constraints/Constraint":15,"./constraints/DistanceConstraint":16,"./constraints/GearConstraint":17,"./constraints/LockConstraint":18,"./constraints/PrismaticConstraint":19,"./constraints/RevoluteConstraint":20,"./equations/AngleLockEquation":21,"./equations/ContactEquation":22,"./equations/Equation":23,"./equations/FrictionEquation":24,"./equations/RotationalVelocityEquation":26,"./events/EventEmitter":27,"./material/ContactMaterial":28,"./material/Material":29,"./math/vec2":31,"./objects/Body":32,"./objects/LinearSpring":33,"./objects/RotationalSpring":34,"./objects/Spring":35,"./shapes/Capsule":37,"./shapes/Circle":38,"./shapes/Convex":39,"./shapes/Heightfield":40,"./shapes/Line":41,"./shapes/Particle":42,"./shapes/Plane":43,"./shapes/Rectangle":44,"./shapes/Shape":45,"./solver/GSSolver":46,"./solver/Solver":47,"./utils/Utils":50,"./world/World":54,__browserify_Buffer:1,__browserify_process:2}],37:[function(n,t){function u(n,t){this.length=n||1;this.radius=t||1;f.call(this,f.CAPSULE)}var e=n("__browserify_process"),o=typeof self!="undefined"?self:typeof window!="undefined"?window:{},s=n("__browserify_Buffer"),f=n("./Shape"),r=n("../math/vec2"),i;t.exports=u;u.prototype=new f;u.prototype.computeMomentOfInertia=function(n){var t=this.radius,i=this.length+t,r=t*2;return n*(r*r+i*i)/12};u.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius+this.length/2};u.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius+this.radius*2*this.length};i=r.create();u.prototype.computeAABB=function(n,t,u){var f=this.radius;r.set(i,this.length/2,0);u!==0&&r.rotate(i,i,u);r.set(n.upperBound,Math.max(i[0]+f,-i[0]+f),Math.max(i[1]+f,-i[1]+f));r.set(n.lowerBound,Math.min(i[0]-f,-i[0]-f),Math.min(i[1]-f,-i[1]-f));r.add(n.lowerBound,n.lowerBound,t);r.add(n.upperBound,n.upperBound,t)}},{"../math/vec2":31,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],38:[function(n,t){function i(n){this.radius=n||1;u.call(this,u.CIRCLE)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),u=n("./Shape"),r=n("../math/vec2");t.exports=i;i.prototype=new u;i.prototype.computeMomentOfInertia=function(n){var t=this.radius;return n*t*t/2};i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.radius};i.prototype.updateArea=function(){this.area=Math.PI*this.radius*this.radius};i.prototype.computeAABB=function(n,t){var i=this.radius;r.set(n.upperBound,i,i);r.set(n.lowerBound,-i,-i);t&&(r.add(n.lowerBound,n.lowerBound,t),r.add(n.upperBound,n.upperBound,t))}},{"../math/vec2":31,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],39:[function(n,t){function r(n,t){var e,o,r;for(this.vertices=[],this.axes=[],r=0;r<n.length;r++)e=i.create(),i.copy(e,n[r]),this.vertices.push(e);if(t)for(r=0;r<t.length;r++)o=i.create(),i.copy(o,t[r]),this.axes.push(o);else for(r=0;r<n.length;r++){var s=n[r],h=n[(r+1)%n.length],f=i.create();i.sub(f,h,s);i.rotate90cw(f,f);i.normalize(f,f);this.axes.push(f)}if(this.centerOfMass=i.fromValues(0,0),this.triangles=[],this.vertices.length&&(this.updateTriangles(),this.updateCenterOfMass()),this.boundingRadius=0,u.call(this,u.CONVEX),this.updateBoundingRadius(),this.updateArea(),this.area<0)throw new Error("Convex vertices must be given in conter-clockwise winding.");}var b=n("__browserify_process"),k=typeof self!="undefined"?self:typeof window!="undefined"?window:{},d=n("__browserify_Buffer"),u=n("./Shape"),i=n("../math/vec2"),o=n("../math/polyk"),g=n("poly-decomp"),f,e;t.exports=r;r.prototype=new u;f=i.create();e=i.create();r.prototype.projectOntoLocalAxis=function(n,t){for(var h,r=null,u=null,s,e,n=f,o=0;o<this.vertices.length;o++)s=this.vertices[o],e=i.dot(s,n),(r===null||e>r)&&(r=e),(u===null||e<u)&&(u=e);u>r&&(h=u,u=r,r=h);i.set(t,u,r)};r.prototype.projectOntoWorldAxis=function(n,t,r,u){var f=e,o;this.projectOntoLocalAxis(n,u);r!==0?i.rotate(f,n,r):f=n;o=i.dot(t,f);i.set(u,u[0]+o,u[1]+o)};r.prototype.updateTriangles=function(){var i,r,t,n;for(this.triangles.length=0,i=[],n=0;n<this.vertices.length;n++)r=this.vertices[n],i.push(r[0],r[1]);for(t=o.Triangulate(i),n=0;n<t.length;n+=3){var u=t[n],f=t[n+1],e=t[n+2];this.triangles.push([u,f,e])}};var s=i.create(),h=i.create(),c=i.create(),l=i.create(),a=i.create(),v=i.create(),y=i.create(),p=i.create(),w=i.create();r.prototype.updateCenterOfMass=function(){var b=this.triangles,u=this.vertices,n=this.centerOfMass,k=s,it=w,d=c,g=l,nt=a,rt=v,ut=y,ft=p,tt=h,f,t,o;for(i.set(n,0,0),f=0,t=0;t!==b.length;t++){var e=b[t],d=u[e[0]],g=u[e[1]],nt=u[e[2]];i.centroid(k,d,g,nt);o=r.triangleArea(d,g,nt);f+=o;i.scale(tt,k,o);i.add(n,n,tt)}i.scale(n,n,1/f)};r.prototype.computeMomentOfInertia=function(n){for(var f=0,e=0,o=this.vertices.length,s=o-1,t=0;t<o;s=t,t++){var r=this.vertices[s],u=this.vertices[t],h=Math.abs(i.crossLength(r,u)),c=i.dot(u,u)+i.dot(u,r)+i.dot(r,r);f+=h*c;e+=h}return n/6*(f/e)};r.prototype.updateBoundingRadius=function(){for(var r,u=this.vertices,n=0,t=0;t!==u.length;t++)r=i.squaredLength(u[t]),r>n&&(n=r);this.boundingRadius=Math.sqrt(n)};r.triangleArea=function(n,t,i){return((t[0]-n[0])*(i[1]-n[1])-(i[0]-n[0])*(t[1]-n[1]))*.5};r.prototype.updateArea=function(){var i,n,t;for(this.updateTriangles(),this.area=0,i=this.triangles,n=this.vertices,t=0;t!==i.length;t++){var u=i[t],f=n[u[0]],e=n[u[1]],o=n[u[2]],s=r.triangleArea(f,e,o);this.area+=s}};r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)}},{"../math/polyk":30,"../math/vec2":31,"./Shape":45,__browserify_Buffer:1,__browserify_process:2,"poly-decomp":7}],40:[function(n,t){function i(n,t){var f,i;if(t=u.defaults(t,{maxValue:null,minValue:null,elementWidth:.1}),t.minValue===null||t.maxValue===null)for(t.maxValue=n[0],t.minValue=n[0],f=0;f!==n.length;f++)i=n[f],i>t.maxValue&&(t.maxValue=i),i<t.minValue&&(t.minValue=i);this.data=n;this.maxValue=t.maxValue;this.minValue=t.minValue;this.elementWidth=t.elementWidth;r.call(this,r.HEIGHTFIELD)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("./Shape"),s=n("../math/vec2"),u=n("../utils/Utils");t.exports=i;i.prototype=new r;i.prototype.computeMomentOfInertia=function(){return Number.MAX_VALUE};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.updateArea=function(){for(var t=this.data,i=0,n=0;n<t.length-1;n++)i+=(t[n]+t[n+1])/2*this.elementWidth;this.area=i};i.prototype.computeAABB=function(n,t){n.upperBound[0]=this.elementWidth*this.data.length+t[0];n.upperBound[1]=this.maxValue+t[1];n.lowerBound[0]=t[0];n.lowerBound[1]=-Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],41:[function(n,t){function i(n){this.length=n||1;f.call(this,f.LINE)}var e=n("__browserify_process"),o=typeof self!="undefined"?self:typeof window!="undefined"?window:{},s=n("__browserify_Buffer"),f=n("./Shape"),r=n("../math/vec2"),u;t.exports=i;i.prototype=new f;i.prototype.computeMomentOfInertia=function(n){return n*Math.pow(this.length,2)/12};i.prototype.updateBoundingRadius=function(){this.boundingRadius=this.length/2};u=[r.create(),r.create()];i.prototype.computeAABB=function(n,t,i){var f=this.length/2;r.set(u[0],-f,0);r.set(u[1],f,0);n.setFromPoints(u,t,i,0)}},{"../math/vec2":31,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],42:[function(n,t){function i(){r.call(this,r.PARTICLE)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("./Shape"),u=n("../math/vec2");t.exports=i;i.prototype=new r;i.prototype.computeMomentOfInertia=function(){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=0};i.prototype.computeAABB=function(n,t){u.copy(n.lowerBound,t);u.copy(n.upperBound,t)}},{"../math/vec2":31,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],43:[function(n,t){function i(){r.call(this,r.PLANE)}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("./Shape"),u=n("../math/vec2"),s=n("../utils/Utils");t.exports=i;i.prototype=new r;i.prototype.computeMomentOfInertia=function(){return 0};i.prototype.updateBoundingRadius=function(){this.boundingRadius=Number.MAX_VALUE};i.prototype.computeAABB=function(n,t,i){var f=0,r=u.set;typeof i=="number"&&(f=i%(2*Math.PI));f===0?(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,0)):f===Math.PI/2?(r(n.lowerBound,0,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===Math.PI?(r(n.lowerBound,-Number.MAX_VALUE,0),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE)):f===3*Math.PI/2?(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,0,Number.MAX_VALUE)):(r(n.lowerBound,-Number.MAX_VALUE,-Number.MAX_VALUE),r(n.upperBound,Number.MAX_VALUE,Number.MAX_VALUE));u.add(n.lowerBound,n.lowerBound,t);u.add(n.upperBound,n.upperBound,t)};i.prototype.updateArea=function(){this.area=Number.MAX_VALUE}},{"../math/vec2":31,"../utils/Utils":50,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],44:[function(n,t){function r(n,t){this.width=n||1;this.height=t||1;var r=[i.fromValues(-n/2,-t/2),i.fromValues(n/2,-t/2),i.fromValues(n/2,t/2),i.fromValues(-n/2,t/2)],e=[i.fromValues(1,0),i.fromValues(0,1)];u.call(this,r,e);this.type=f.RECTANGLE}var e=n("__browserify_process"),o=typeof self!="undefined"?self:typeof window!="undefined"?window:{},s=n("__browserify_Buffer"),i=n("../math/vec2"),f=n("./Shape"),u=n("./Convex");t.exports=r;r.prototype=new u([]);r.prototype.computeMomentOfInertia=function(n){var t=this.width,i=this.height;return n*(i*i+t*t)/12};r.prototype.updateBoundingRadius=function(){var n=this.width,t=this.height;this.boundingRadius=Math.sqrt(n*n+t*t)/2};var h=i.create(),c=i.create(),l=i.create(),a=i.create();r.prototype.computeAABB=function(n,t,i){n.setFromPoints(this.vertices,t,i,0)};r.prototype.updateArea=function(){this.area=this.width*this.height}},{"../math/vec2":31,"./Convex":39,"./Shape":45,__browserify_Buffer:1,__browserify_process:2}],45:[function(n,t){function i(n){this.type=n;this.id=i.idCounter++;this.boundingRadius=0;this.collisionGroup=1;this.collisionMask=1;n&&this.updateBoundingRadius();this.material=null;this.area=0;this.sensor=!1;this.updateArea()}var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer");t.exports=i;i.idCounter=0;i.CIRCLE=1;i.PARTICLE=2;i.PLANE=4;i.CONVEX=8;i.LINE=16;i.RECTANGLE=32;i.CAPSULE=64;i.HEIGHTFIELD=128;i.prototype.computeMomentOfInertia=function(){throw new Error("Shape.computeMomentOfInertia is not implemented in this Shape...");};i.prototype.updateBoundingRadius=function(){throw new Error("Shape.updateBoundingRadius is not implemented in this Shape...");};i.prototype.updateArea=function(){};i.prototype.computeAABB=function(){}},{__browserify_Buffer:1,__browserify_process:2}],46:[function(n,t){function i(n){u.call(this,n,u.GS);n=n||{};this.iterations=n.iterations||10;this.tolerance=n.tolerance||1e-10;this.arrayStep=30;this.lambda=new r.ARRAY_TYPE(this.arrayStep);this.Bs=new r.ARRAY_TYPE(this.arrayStep);this.invCs=new r.ARRAY_TYPE(this.arrayStep);this.useZeroRHS=!1;this.frictionIterations=0;this.usedIterations=0}function o(n){for(var t=n.length;t--;)n[t]=0}var s=n("__browserify_process"),h=typeof self!="undefined"?self:typeof window!="undefined"?window:{},c=n("__browserify_Buffer"),f=n("../math/vec2"),u=n("./Solver"),r=n("../utils/Utils"),e=n("../equations/FrictionEquation");t.exports=i;i.prototype=new u;i.prototype.solve=function(n,t){var s,v,u,h,b,y,w,d,k;this.sortEquations();var l=0,et=this.iterations,rt=this.frictionIterations,a=this.equations,c=a.length,ut=Math.pow(this.tolerance*c,2),g=t.bodies,nt=t.bodies.length,ot=f.add,st=f.set,ft=this.useZeroRHS,p=this.lambda;if(this.usedIterations=0,c)for(u=0;u!==nt;u++)b=g[u],b.updateSolveMassProperties();p.length<c&&(p=this.lambda=new r.ARRAY_TYPE(c+this.arrayStep),this.Bs=new r.ARRAY_TYPE(c+this.arrayStep),this.invCs=new r.ARRAY_TYPE(c+this.arrayStep));o(p);var tt=this.invCs,it=this.Bs,p=this.lambda;for(u=0;u!==a.length;u++)s=a[u],(s.timeStep!==n||s.needsUpdate)&&(s.timeStep=n,s.update()),it[u]=s.computeB(s.a,s.b,n),tt[u]=s.computeInvC(s.epsilon);if(c!==0){for(u=0;u!==nt;u++)b=g[u],b.resetConstraintVelocity();if(rt){for(l=0;l!==rt;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(i.updateMultipliers(a,p,1/n),h=0;h!==c;h++)if(y=a[h],y instanceof e){for(w=0,d=0;d!==y.contactEquations.length;d++)w+=y.contactEquations[d].multiplier;w*=y.frictionCoefficient/y.contactEquations.length;y.maxForce=w;y.minForce=-w}}for(l=0;l!==et;l++){for(v=0,h=0;h!==c;h++)s=a[h],k=i.iterateEquation(h,s,s.epsilon,it,tt,p,ft,n,l),v+=Math.abs(k);if(this.usedIterations++,v*v<=ut)break}for(u=0;u!==nt;u++)g[u].addConstraintVelocity();i.updateMultipliers(a,p,1/n)}};i.updateMultipliers=function(n,t,i){for(var r=n.length;r--;)n[r].multiplier=t[r]*i};i.iterateEquation=function(n,t,i,r,u,f,e,o){var l=r[n],y=u[n],h=f[n],p=t.computeGWlambda(),a=t.maxForce,v=t.minForce,s,c;return e&&(l=0),s=y*(l-p-i*h),c=h+s,c<v*o?s=v*o-h:c>a*o&&(s=a*o-h),f[n]+=s,t.addToWlambda(s),s}},{"../equations/FrictionEquation":24,"../math/vec2":31,"../utils/Utils":50,"./Solver":47,__browserify_Buffer:1,__browserify_process:2}],47:[function(n,t){function i(n,t){n=n||{};u.call(this);this.type=t;this.equations=[];this.equationSortFunction=n.equationSortFunction||!1}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),s=n("../utils/Utils"),u=n("../events/EventEmitter"),r;t.exports=i;i.prototype=new u;i.prototype.solve=function(){throw new Error("Solver.solve should be implemented by subclasses!");};r={bodies:[]};i.prototype.solveIsland=function(n,t){this.removeAllEquations();t.equations.length&&(this.addEquations(t.equations),r.bodies.length=0,t.getBodies(r.bodies),r.bodies.length&&this.solve(n,r))};i.prototype.sortEquations=function(){this.equationSortFunction&&this.equations.sort(this.equationSortFunction)};i.prototype.addEquation=function(n){n.enabled&&this.equations.push(n)};i.prototype.addEquations=function(n){for(var i,t=0,r=n.length;t!==r;t++)i=n[t],i.enabled&&this.equations.push(i)};i.prototype.removeEquation=function(n){var t=this.equations.indexOf(n);t!==-1&&this.equations.splice(t,1)};i.prototype.removeAllEquations=function(){this.equations.length=0};i.GS=1;i.ISLAND=2},{"../events/EventEmitter":27,"../utils/Utils":50,__browserify_Buffer:1,__browserify_process:2}],48:[function(n,t){function i(){this.overlappingShapesLastState=new r;this.overlappingShapesCurrentState=new r;this.recordPool=[];this.tmpDict=new r;this.tmpArray1=[]}function u(n,t,i,r){this.shapeA=t;this.shapeB=r;this.bodyA=n;this.bodyB=i}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),r=n("./TupleDictionary"),s=n("./Utils");t.exports=i;i.prototype.tick=function(){for(var n=this.overlappingShapesLastState,t=this.overlappingShapesCurrentState,i=n.keys.length;i--;){var r=n.keys[i],u=n.getByKey(r),f=t.getByKey(r);u&&!f&&this.recordPool.push(u)}n.reset();n.copy(t);t.reset()};i.prototype.setOverlapping=function(n,t,i,r){var o=this.overlappingShapesLastState,e=this.overlappingShapesCurrentState,f;e.get(t.id,r.id)||(this.recordPool.length?(f=this.recordPool.pop(),f.set(n,t,i,r)):f=new u(n,t,i,r),e.set(t.id,r.id,f))};i.prototype.getNewOverlaps=function(n){return this.getDiff(this.overlappingShapesLastState,this.overlappingShapesCurrentState,n)};i.prototype.getEndOverlaps=function(n){return this.getDiff(this.overlappingShapesCurrentState,this.overlappingShapesLastState,n)};i.prototype.bodiesAreOverlapping=function(n,t){for(var r=this.overlappingShapesCurrentState,u=r.keys.length,f,i;u--;)if(f=r.keys[u],i=r.data[f],i.bodyA===n&&i.bodyB===t||i.bodyA===t&&i.bodyB===n)return!0;return!1};i.prototype.getDiff=function(n,t,i){var i=i||[],s=n,u=t,f,r,e,o;for(i.length=0,f=u.keys.length;f--;){if(r=u.keys[f],e=u.data[r],!e)throw new Error("Key "+r+" had no data!");o=s.data[r];o||i.push(e)}return i};i.prototype.isNewOverlap=function(n,t){var i=n.id|0,r=t.id|0,u=this.overlappingShapesLastState,f=this.overlappingShapesCurrentState;return!!!u.get(i,r)&&!!f.get(i,r)};i.prototype.getNewBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getNewOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getEndBodyOverlaps=function(n){this.tmpArray1.length=0;var t=this.getEndOverlaps(this.tmpArray1);return this.getBodyDiff(t,n)};i.prototype.getBodyDiff=function(n,t){var r,u,i;for(t=t||[],r=this.tmpDict,u=n.length;u--;)i=n[u],r.set(i.bodyA.id|0,i.bodyB.id|0,i);for(u=r.keys.length;u--;)i=r.getByKey(r.keys[u]),i&&t.push(i.bodyA,i.bodyB);return r.reset(),t};u.prototype.set=function(n,t,i,r){u.call(this,n,t,i,r)}},{"./TupleDictionary":49,"./Utils":50,__browserify_Buffer:1,__browserify_process:2}],49:[function(n,t){function i(){this.data={};this.keys=[]}var u=n("__browserify_process"),f=typeof self!="undefined"?self:typeof window!="undefined"?window:{},e=n("__browserify_Buffer"),r=n("./Utils");t.exports=i;i.prototype.getKey=function(n,t){return(n=n|0,t=t|0,(n|0)==(t|0))?-1:((n|0)>(t|0)?n<<16|t&65535:t<<16|n&65535)|0};i.prototype.getByKey=function(n){return n=n|0,this.data[n]};i.prototype.get=function(n,t){return this.data[this.getKey(n,t)]};i.prototype.set=function(n,t,i){if(!i)throw new Error("No data!");var r=this.getKey(n,t);return this.data[r]||this.keys.push(r),this.data[r]=i,r};i.prototype.reset=function(){for(var i=this.data,n=this.keys,t=n.length;t--;)delete i[n[t]];n.length=0};i.prototype.copy=function(n){var t,i;for(this.reset(),r.appendArray(this.keys,n.keys),t=n.keys.length;t--;)i=n.keys[t],this.data[i]=n.data[i]}},{"./Utils":50,__browserify_Buffer:1,__browserify_process:2}],50:[function(n,t){function i(){}var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer");t.exports=i;i.appendArray=function(n,t){if(t.length<15e4)n.push.apply(n,t);else for(var i=0,r=t.length;i!==r;++i)n.push(t[i])};i.splice=function(n,t,i){i=i||1;for(var r=t,u=n.length-i;r<u;r++)n[r]=n[r+i];n.length=u};i.ARRAY_TYPE=window.Float32Array||Array;i.extend=function(n,t){for(var i in t)n[i]=t[i]};i.defaults=function(n,t){n=n||{};for(var i in t)i in n||(n[i]=t[i]);return n}},{__browserify_Buffer:1,__browserify_process:2}],51:[function(n,t){function r(){this.equations=[];this.bodies=[]}var f=n("__browserify_process"),e=typeof self!="undefined"?self:typeof window!="undefined"?window:{},o=n("__browserify_Buffer"),u=n("../objects/Body"),i;t.exports=r;r.prototype.reset=function(){this.equations.length=this.bodies.length=0};i=[];r.prototype.getBodies=function(n){var u=n||[],f=this.equations,r,t;for(i.length=0,r=0;r!==f.length;r++)t=f[r],i.indexOf(t.bodyA.id)===-1&&(u.push(t.bodyA),i.push(t.bodyA.id)),i.indexOf(t.bodyB.id)===-1&&(u.push(t.bodyB),i.push(t.bodyB.id));return u};r.prototype.wantsToSleep=function(){for(var t,n=0;n<this.bodies.length;n++)if(t=this.bodies[n],t.type===u.DYNAMIC&&!t.wantsToSleep)return!1;return!0};r.prototype.sleep=function(){for(var t,n=0;n<this.bodies.length;n++)t=this.bodies[n],t.sleep();return!0}},{"../objects/Body":32,__browserify_Buffer:1,__browserify_process:2}],52:[function(n,t){function i(){this._nodePool=[];this._islandPool=[];this.equations=[];this.islands=[];this.nodes=[];this.queue=[]}var e=n("__browserify_process"),o=typeof self!="undefined"?self:typeof window!="undefined"?window:{},s=n("__browserify_Buffer"),h=n("../math/vec2"),u=n("./Island"),f=n("./IslandNode"),r=n("../objects/Body");t.exports=i;i.getUnvisitedNode=function(n){for(var t,u=n.length,i=0;i!==u;i++)if(t=n[i],!t.visited&&t.body.type===r.DYNAMIC)return t;return!1};i.prototype.visit=function(n,t,i){var f,r,u;for(t.push(n.body),f=n.equations.length,r=0;r!==f;r++)u=n.equations[r],i.indexOf(u)===-1&&i.push(u)};i.prototype.bfs=function(n,t,u){var f=this.queue,o,e;for(f.length=0,f.push(n),n.visited=!0,this.visit(n,t,u);f.length;)for(o=f.pop();e=i.getUnvisitedNode(o.neighbors);)e.visited=!0,this.visit(e,t,u),e.body.type===r.DYNAMIC&&f.push(e)};i.prototype.split=function(n){for(var o=n.bodies,t=this.nodes,y=this.equations,e,h,c,s,p,r;t.length;)this._nodePool.push(t.pop());for(e=0;e!==o.length;e++)this._nodePool.length?(h=this._nodePool.pop(),h.reset(),h.body=o[e],t.push(h)):t.push(new f(o[e]));for(c=0;c!==y.length;c++){var l=y[c],e=o.indexOf(l.bodyA),w=o.indexOf(l.bodyB),a=t[e],v=t[w];a.neighbors.push(v);v.neighbors.push(a);a.equations.push(l);v.equations.push(l)}for(s=this.islands;s.length;)r=s.pop(),r.reset(),this._islandPool.push(r);while(p=i.getUnvisitedNode(t))r=this._islandPool.length?this._islandPool.pop():new u,this.bfs(p,r.bodies,r.equations),s.push(r);return s}},{"../math/vec2":31,"../objects/Body":32,"./Island":51,"./IslandNode":53,__browserify_Buffer:1,__browserify_process:2}],53:[function(n,t){function i(n){this.body=n;this.neighbors=[];this.equations=[];this.visited=!1}var r=n("__browserify_process"),u=typeof self!="undefined"?self:typeof window!="undefined"?window:{},f=n("__browserify_Buffer");t.exports=i;i.prototype.reset=function(){this.equations.length=0;this.neighbors.length=0;this.visited=!1;this.body=null}},{__browserify_Buffer:1,__browserify_process:2}],54:[function(n,t){function r(n){y.apply(this);n=n||{};this.springs=[];this.bodies=[];this.disabledBodyCollisionPairs=[];this.solver=n.solver||new p;this.narrowphase=new it(this);this.islandManager=new ut;this.gravity=i.fromValues(0,-9.78);n.gravity&&i.copy(this.gravity,n.gravity);this.frictionGravity=i.length(this.gravity)||10;this.useWorldGravityAsFrictionGravity=!0;this.useFrictionGravityOnZeroGravity=!0;this.doProfiling=n.doProfiling||!1;this.lastStepTime=0;this.broadphase=n.broadphase||new tt;this.broadphase.setWorld(this);this.constraints=[];this.defaultMaterial=new g;this.defaultContactMaterial=new nt(this.defaultMaterial,this.defaultMaterial);this.lastTimeStep=1/60;this.applySpringForces=!0;this.applyDamping=!0;this.applyGravity=!0;this.solveConstraints=!0;this.contactMaterials=[];this.time=0;this.stepping=!1;this.bodiesToBeRemoved=[];this.fixedStepTime=0;this.islandSplit=typeof n.islandSplit!="undefined"?!!n.islandSplit:!1;this.emitImpactEvent=!0;this._constraintIdCounter=0;this._bodyIdCounter=0;this.postStepEvent={type:"postStep"};this.addBodyEvent={type:"addBody",body:null};this.removeBodyEvent={type:"removeBody",body:null};this.addSpringEvent={type:"addSpring",spring:null};this.impactEvent={type:"impact",bodyA:null,bodyB:null,shapeA:null,shapeB:null,contactEquation:null};this.postBroadphaseEvent={type:"postBroadphase",pairs:null};this.sleepMode=r.NO_SLEEPING;this.beginContactEvent={type:"beginContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null,contactEquations:[]};this.endContactEvent={type:"endContact",shapeA:null,shapeB:null,bodyA:null,bodyB:null};this.preSolveEvent={type:"preSolve",contactEquations:null,frictionEquations:null};this.overlappingShapesLastState={keys:[]};this.overlappingShapesCurrentState={keys:[]};this.overlapKeeper=new rt}var lt=n("__browserify_process"),at=typeof self!="undefined"?self:typeof window!="undefined"?window:{},vt=n("__browserify_Buffer"),p=n("../solver/GSSolver"),yt=n("../solver/Solver"),pt=n("../collision/NaiveBroadphase"),i=n("../math/vec2"),w=n("../shapes/Circle"),wt=n("../shapes/Rectangle"),b=n("../shapes/Convex"),bt=n("../shapes/Line"),k=n("../shapes/Plane"),d=n("../shapes/Capsule"),v=n("../shapes/Particle"),y=n("../events/EventEmitter"),u=n("../objects/Body"),kt=n("../shapes/Shape"),dt=n("../objects/LinearSpring"),g=n("../material/Material"),nt=n("../material/ContactMaterial"),gt=n("../constraints/DistanceConstraint"),ni=n("../constraints/Constraint"),ti=n("../constraints/LockConstraint"),ii=n("../constraints/RevoluteConstraint"),ri=n("../constraints/PrismaticConstraint"),ui=n("../constraints/GearConstraint"),fi=n("../../package.json"),ei=n("../collision/Broadphase"),tt=n("../collision/SAPBroadphase"),it=n("../collision/Narrowphase"),f=n("../utils/Utils"),rt=n("../utils/OverlapKeeper"),ut=n("./IslandManager"),oi=n("../objects/RotationalSpring"),c,h,l,a;t.exports=r;typeof performance=="undefined"&&(performance={});performance.now||(c=Date.now(),performance.timing&&performance.timing.navigationStart&&(c=performance.timing.navigationStart),performance.now=function(){return Date.now()-c});r.prototype=new Object(y.prototype);r.NO_SLEEPING=1;r.BODY_SLEEPING=2;r.ISLAND_SLEEPING=4;r.prototype.addConstraint=function(n){this.constraints.push(n)};r.prototype.addContactMaterial=function(n){this.contactMaterials.push(n)};r.prototype.removeContactMaterial=function(n){var t=this.contactMaterials.indexOf(n);t!==-1&&f.splice(this.contactMaterials,t,1)};r.prototype.getContactMaterial=function(n,t){for(var i,u=this.contactMaterials,r=0,f=u.length;r!==f;r++)if(i=u[r],i.materialA.id===n.id&&i.materialB.id===t.id||i.materialA.id===t.id&&i.materialB.id===n.id)return i;return!1};r.prototype.removeConstraint=function(n){var t=this.constraints.indexOf(n);t!==-1&&f.splice(this.constraints,t,1)};var si=i.create(),hi=i.create(),ci=i.create(),li=i.create(),ft=i.create(),et=i.create(),ot=i.create(),e=i.fromValues(0,0),o=i.fromValues(0,0),ai=i.fromValues(0,0),s=i.fromValues(0,0);r.prototype.step=function(n,t,r){var e,l,h,a,c,o,f;if(r=r||10,t=t||0,t===0)this.internalStep(n),this.time+=n;else{for(e=Math.floor((this.time+t)/n)-Math.floor(this.time/n),e=Math.min(e,r),l=performance.now(),h=0;h!==e;h++)if(this.internalStep(n),performance.now()-l>n*1e3)break;for(this.time+=t,a=this.time%n,c=a/n,o=0;o!==this.bodies.length;o++)f=this.bodies[o],f.type!==u.STATIC&&f.sleepState!==u.SLEEPING?(i.sub(s,f.position,f.previousPosition),i.scale(s,s,c),i.add(f.interpolatedPosition,f.position,s),f.interpolatedAngle=f.angle+(f.angle-f.previousAngle)*c):(i.copy(f.interpolatedPosition,f.position),f.interpolatedAngle=f.angle)}};h=[];r.prototype.internalStep=function(n){var at,vt,ni,c,e,g,tt,o,ti,it,rt,ut,ii,ri,wt,st,l,ct,lt,nt,a,b,k,ht,t;this.stepping=!0;var fi=this,bt=this.doProfiling,ei=this.springs.length,oi=this.springs,v=this.bodies,si=this.gravity,d=this.solver,y=this.bodies.length,hi=this.broadphase,s=this.narrowphase,p=this.constraints,kt,dt,pi=ft,wi=et,gt=ot,bi=i.scale,ci=i.add,ki=i.rotate,w=this.islandManager;if(this.overlapKeeper.tick(),this.lastTimeStep=n,bt&&(kt=performance.now()),this.useWorldGravityAsFrictionGravity&&(at=i.length(this.gravity),at===0&&this.useFrictionGravityOnZeroGravity||(this.frictionGravity=at)),this.applyGravity)for(t=0;t!==y;t++)(c=v[t],vt=c.force,c.type===u.DYNAMIC&&c.sleepState!==u.SLEEPING)&&(i.scale(gt,si,c.mass*c.gravityScale),ci(vt,vt,gt));if(this.applySpringForces)for(t=0;t!==ei;t++)ni=oi[t],ni.applyForce();if(this.applyDamping)for(t=0;t!==y;t++)c=v[t],c.type===u.DYNAMIC&&c.applyDamping(n);for(e=hi.getCollisionPairs(this),g=this.disabledBodyCollisionPairs,t=g.length-2;t>=0;t-=2)for(o=e.length-2;o>=0;o-=2)(g[t]===e[o]&&g[t+1]===e[o+1]||g[t+1]===e[o]&&g[t]===e[o+1])&&e.splice(o,2);for(nt=p.length,t=0;t!==nt;t++)if(tt=p[t],!tt.collideConnected)for(o=e.length-2;o>=0;o-=2)(tt.bodyA===e[o]&&tt.bodyB===e[o+1]||tt.bodyB===e[o]&&tt.bodyA===e[o+1])&&e.splice(o,2);for(this.postBroadphaseEvent.pairs=e,this.emit(this.postBroadphaseEvent),s.reset(this),t=0,ti=e.length;t!==ti;t+=2)for(it=e[t],rt=e[t+1],ut=0,ii=it.shapes.length;ut!==ii;ut++){var yt=it.shapes[ut],li=it.shapeOffsets[ut],ai=it.shapeAngles[ut];for(l=0,ri=rt.shapes.length;l!==ri;l++){var pt=rt.shapes[l],vi=rt.shapeOffsets[l],yi=rt.shapeAngles[l],ui=this.defaultContactMaterial;yt.material&&pt.material&&(wt=this.getContactMaterial(yt.material,pt.material),wt&&(ui=wt));this.runNarrowphase(s,it,yt,li,ai,rt,pt,vi,yi,ui,this.frictionGravity)}}for(t=0;t!==y;t++)a=v[t],a._wakeUpAfterNarrowphase&&(a.wakeUp(),a._wakeUpAfterNarrowphase=!1);if(this.has("endContact"))for(this.overlapKeeper.getEndOverlaps(h),st=this.endContactEvent,l=h.length;l--;)ct=h[l],st.shapeA=ct.shapeA,st.shapeB=ct.shapeB,st.bodyA=ct.bodyA,st.bodyB=ct.bodyB,this.emit(st);for(lt=this.preSolveEvent,lt.contactEquations=s.contactEquations,lt.frictionEquations=s.frictionEquations,this.emit(lt),nt=p.length,t=0;t!==nt;t++)p[t].update();if(s.contactEquations.length||s.frictionEquations.length||p.length)if(this.islandSplit){for(w.equations.length=0,f.appendArray(w.equations,s.contactEquations),f.appendArray(w.equations,s.frictionEquations),t=0;t!==nt;t++)f.appendArray(w.equations,p[t].equations);for(w.split(this),t=0;t!==w.islands.length;t++)ht=w.islands[t],ht.equations.length&&d.solveIsland(n,ht)}else{for(d.addEquations(s.contactEquations),d.addEquations(s.frictionEquations),t=0;t!==nt;t++)d.addEquations(p[t].equations);this.solveConstraints&&d.solve(n,this);d.removeAllEquations()}for(t=0;t!==y;t++)a=v[t],a.sleepState!==u.SLEEPING&&a.type!==u.STATIC&&r.integrateBody(a,n);for(t=0;t!==y;t++)v[t].setZeroForce();if(bt&&(dt=performance.now(),fi.lastStepTime=dt-kt),this.emitImpactEvent&&this.has("impact"))for(b=this.impactEvent,t=0;t!==s.contactEquations.length;t++)k=s.contactEquations[t],k.firstImpact&&(b.bodyA=k.bodyA,b.bodyB=k.bodyB,b.shapeA=k.shapeA,b.shapeB=k.shapeB,b.contactEquation=k,this.emit(b));if(this.sleepMode===r.BODY_SLEEPING)for(t=0;t!==y;t++)v[t].sleepTick(this.time,!1,n);else if(this.sleepMode===r.ISLAND_SLEEPING&&this.islandSplit){for(t=0;t!==y;t++)v[t].sleepTick(this.time,!0,n);for(t=0;t<this.islandManager.islands.length;t++)ht=this.islandManager.islands[t],ht.wantsToSleep()&&ht.sleep()}if(this.stepping=!1,this.bodiesToBeRemoved.length){for(t=0;t!==this.bodiesToBeRemoved.length;t++)this.removeBody(this.bodiesToBeRemoved[t]);this.bodiesToBeRemoved.length=0}this.emit(this.postStepEvent)};l=i.create();a=i.create();r.integrateBody=function(n,t){var f=n.invMass,e=n.force,u=n.position,r=n.velocity;i.copy(n.previousPosition,n.position);n.previousAngle=n.angle;n.fixedRotation||(n.angularVelocity+=n.angularForce*n.invInertia*t,n.angle+=n.angularVelocity*t);i.scale(l,e,t*f);i.add(r,l,r);i.scale(a,r,t);i.add(u,u,a);n.aabbNeedsUpdate=!0};r.prototype.runNarrowphase=function(n,t,r,f,s,h,c,l,a,v,y){var g,nt,rt,k,b,tt,ut,d,ft,et,ot,st,p,w,it;if((r.collisionGroup&c.collisionMask)!=0&&(c.collisionGroup&r.collisionMask)!=0&&(i.rotate(e,f,t.angle),i.rotate(o,l,h.angle),i.add(e,e,t.position),i.add(o,o,h.position),g=s+t.angle,nt=a+h.angle,n.enableFriction=v.friction>0,n.frictionCoefficient=v.friction,rt=t.type===u.STATIC||t.type===u.KINEMATIC?h.mass:h.type===u.STATIC||h.type===u.KINEMATIC?t.mass:t.mass*h.mass/(t.mass+h.mass),n.slipForce=v.friction*y*rt,n.restitution=v.restitution,n.surfaceVelocity=v.surfaceVelocity,n.frictionStiffness=v.frictionStiffness,n.frictionRelaxation=v.frictionRelaxation,n.stiffness=v.stiffness,n.relaxation=v.relaxation,n.contactSkinSize=v.contactSkinSize,k=n[r.type|c.type],b=0,k&&(tt=r.sensor||c.sensor,ut=n.frictionEquations.length,b=r.type<c.type?k.call(n,t,r,e,g,h,c,o,nt,tt):k.call(n,h,c,o,nt,t,r,e,g,tt),d=n.frictionEquations.length-ut,b))){if(t.allowSleep&&t.type===u.DYNAMIC&&t.sleepState===u.SLEEPING&&h.sleepState===u.AWAKE&&h.type!==u.STATIC&&(ft=i.squaredLength(h.velocity)+Math.pow(h.angularVelocity,2),et=Math.pow(h.sleepSpeedLimit,2),ft>=et*2&&(t._wakeUpAfterNarrowphase=!0)),h.allowSleep&&h.type===u.DYNAMIC&&h.sleepState===u.SLEEPING&&t.sleepState===u.AWAKE&&t.type!==u.STATIC&&(ot=i.squaredLength(t.velocity)+Math.pow(t.angularVelocity,2),st=Math.pow(t.sleepSpeedLimit,2),ot>=st*2&&(h._wakeUpAfterNarrowphase=!0)),this.overlapKeeper.setOverlapping(t,r,h,c),this.has("beginContact")&&this.overlapKeeper.isNewOverlap(r,c)){if(p=this.beginContactEvent,p.shapeA=r,p.shapeB=c,p.bodyA=t,p.bodyB=h,p.contactEquations.length=0,typeof b=="number")for(w=n.contactEquations.length-b;w<n.contactEquations.length;w++)p.contactEquations.push(n.contactEquations[w]);this.emit(p)}if(typeof b=="number"&&d>1)for(w=n.frictionEquations.length-d;w<n.frictionEquations.length;w++)it=n.frictionEquations[w],it.setSlipForce(it.getSlipForce()/d)}};r.prototype.addSpring=function(n){this.springs.push(n);this.addSpringEvent.spring=n;this.emit(this.addSpringEvent)};r.prototype.removeSpring=function(n){var t=this.springs.indexOf(n);t!==-1&&f.splice(this.springs,t,1)};r.prototype.addBody=function(n){this.bodies.indexOf(n)===-1&&(this.bodies.push(n),n.world=this,this.addBodyEvent.body=n,this.emit(this.addBodyEvent))};r.prototype.removeBody=function(n){if(this.stepping)this.bodiesToBeRemoved.push(n);else{n.world=null;var t=this.bodies.indexOf(n);t!==-1&&(f.splice(this.bodies,t,1),this.removeBodyEvent.body=n,n.resetConstraintVelocity(),this.emit(this.removeBodyEvent))}};r.prototype.getBodyById=function(n){for(var i,r=this.bodies,t=0;t<r.length;t++)if(i=r[t],i.id===n)return i;return!1};r.prototype.disableBodyCollision=function(n,t){this.disabledBodyCollisionPairs.push(n,t)};r.prototype.enableBodyCollision=function(n,t){for(var r=this.disabledBodyCollisionPairs,i=0;i<r.length;i+=2)if(r[i]===n&&r[i+1]===t||r[i+1]===n&&r[i]===t){r.splice(i,2);return}};r.prototype.clear=function(){var t,i,u,f,n;for(this.time=0,this.fixedStepTime=0,this.solver&&this.solver.equations.length&&this.solver.removeAllEquations(),t=this.constraints,n=t.length-1;n>=0;n--)this.removeConstraint(t[n]);for(i=this.bodies,n=i.length-1;n>=0;n--)this.removeBody(i[n]);for(u=this.springs,n=u.length-1;n>=0;n--)this.removeSpring(u[n]);for(f=this.contactMaterials,n=f.length-1;n>=0;n--)this.removeContactMaterial(f[n]);r.apply(this)};r.prototype.clone=function(){var n=new r;return n.fromJSON(this.toJSON()),n};var st=i.create(),ht=i.fromValues(0,0),ct=i.fromValues(0,0);r.prototype.hitTest=function(n,t,r){var l,nt,g,tt,f,s,it,a;r=r||0;var h=new u({position:n}),c=new v,y=n,p=0,o=st,rt=ht,ut=ct;for(h.addShape(c),l=this.narrowphase,nt=[],g=0,tt=t.length;g!==tt;g++)for(f=t[g],s=0,it=f.shapes.length;s!==it;s++){var e=f.shapes[s],ft=f.shapeOffsets[s]||rt,et=f.shapeAngles[s]||0;i.rotate(o,ft,f.angle);i.add(o,o,f.position);a=et+f.angle;(e instanceof w&&l.circleParticle(f,e,o,a,h,c,y,p,!0)||e instanceof b&&l.particleConvex(h,c,y,p,f,e,o,a,!0)||e instanceof k&&l.particlePlane(h,c,y,p,f,e,o,a,!0)||e instanceof d&&l.particleCapsule(h,c,y,p,f,e,o,a,!0)||e instanceof v&&i.squaredLength(i.sub(ut,o,n))<r*r)&&nt.push(f)}return nt};r.prototype.setGlobalEquationParameters=function(n){var r,u,i,t;for(n=n||{},i=0;i!==this.constraints.length;i++)for(t=this.constraints[i],r=0;r!==t.equations.length;r++)u=t.equations[r],typeof n.stiffness!="undefined"&&(u.stiffness=n.stiffness),typeof n.relaxation!="undefined"&&(u.relaxation=n.relaxation),u.needsUpdate=!0;for(i=0;i!==this.contactMaterials.length;i++)t=this.contactMaterials[i],typeof n.stiffness!="undefined"&&(t.stiffness=n.stiffness,t.frictionStiffness=n.stiffness),typeof n.relaxation!="undefined"&&(t.relaxation=n.relaxation,t.frictionRelaxation=n.relaxation);t=this.defaultContactMaterial;typeof n.stiffness!="undefined"&&(t.stiffness=n.stiffness,t.frictionStiffness=n.stiffness);typeof n.relaxation!="undefined"&&(t.relaxation=n.relaxation,t.frictionRelaxation=n.relaxation)};r.prototype.setGlobalStiffness=function(n){this.setGlobalEquationParameters({stiffness:n})};r.prototype.setGlobalRelaxation=function(n){this.setGlobalEquationParameters({relaxation:n})}},{"../../package.json":8,"../collision/Broadphase":10,"../collision/NaiveBroadphase":12,"../collision/Narrowphase":13,"../collision/SAPBroadphase":14,"../constraints/Constraint":15,"../constraints/DistanceConstraint":16,"../constraints/GearConstraint":17,"../constraints/LockConstraint":18,"../constraints/PrismaticConstraint":19,"../constraints/RevoluteConstraint":20,"../events/EventEmitter":27,"../material/ContactMaterial":28,"../material/Material":29,"../math/vec2":31,"../objects/Body":32,"../objects/LinearSpring":33,"../objects/RotationalSpring":34,"../shapes/Capsule":37,"../shapes/Circle":38,"../shapes/Convex":39,"../shapes/Line":41,"../shapes/Particle":42,"../shapes/Plane":43,"../shapes/Rectangle":44,"../shapes/Shape":45,"../solver/GSSolver":46,"../solver/Solver":47,"../utils/OverlapKeeper":48,"../utils/Utils":50,"./IslandManager":52,__browserify_Buffer:1,__browserify_process:2}]},{},[36])(36)});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
p2.Body.prototype.parent=null;p2.Spring.prototype.parent=null;Phaser.Physics.P2=function(n,t){this.game=n;typeof t!="undefined"&&t.hasOwnProperty("gravity")&&t.hasOwnProperty("broadphase")||(t={gravity:[0,0],broadphase:new p2.SAPBroadphase});this.config=t;this.world=new p2.World(this.config);this.frameRate=1/60;this.useElapsedTime=!1;this.paused=!1;this.materials=[];this.gravity=new Phaser.Physics.P2.InversePointProxy(this,this.world.gravity);this.walls={left:null,right:null,top:null,bottom:null};this.onBodyAdded=new Phaser.Signal;this.onBodyRemoved=new Phaser.Signal;this.onSpringAdded=new Phaser.Signal;this.onSpringRemoved=new Phaser.Signal;this.onConstraintAdded=new Phaser.Signal;this.onConstraintRemoved=new Phaser.Signal;this.onContactMaterialAdded=new Phaser.Signal;this.onContactMaterialRemoved=new Phaser.Signal;this.postBroadphaseCallback=null;this.callbackContext=null;this.onBeginContact=new Phaser.Signal;this.onEndContact=new Phaser.Signal;t.hasOwnProperty("mpx")&&t.hasOwnProperty("pxm")&&t.hasOwnProperty("mpxi")&&t.hasOwnProperty("pxmi")&&(this.mpx=t.mpx,this.mpxi=t.mpxi,this.pxm=t.pxm,this.pxmi=t.pxmi);this.world.on("beginContact",this.beginContactHandler,this);this.world.on("endContact",this.endContactHandler,this);this.collisionGroups=[];this.nothingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(1);this.boundsCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2);this.everythingCollisionGroup=new Phaser.Physics.P2.CollisionGroup(2147483648);this.boundsCollidesWith=[];this._toRemove=[];this._collisionGroupID=2;this.setBoundsToWorld(!0,!0,!0,!0,!1)};Phaser.Physics.P2.prototype={removeBodyNextStep:function(n){this._toRemove.push(n)},preUpdate:function(){for(var n=this._toRemove.length;n--;)this.removeBody(this._toRemove[n]);this._toRemove.length=0},enable:function(n,t,i){typeof t=="undefined"&&(t=!1);typeof i=="undefined"&&(i=!0);var r=1;if(Array.isArray(n))for(r=n.length;r--;)n[r]instanceof Phaser.Group?this.enable(n[r].children,t,i):(this.enableBody(n[r],t),i&&n[r].hasOwnProperty("children")&&n[r].children.length>0&&this.enable(n[r],t,!0));else n instanceof Phaser.Group?this.enable(n.children,t,i):(this.enableBody(n,t),i&&n.hasOwnProperty("children")&&n.children.length>0&&this.enable(n.children,t,!0))},enableBody:function(n,t){n.hasOwnProperty("body")&&n.body===null&&(n.body=new Phaser.Physics.P2.Body(this.game,n,n.x,n.y,1),n.body.debug=t,n.anchor.set(.5))},setImpactEvents:function(n){if(n)this.world.on("impact",this.impactHandler,this);else this.world.off("impact",this.impactHandler,this)},setPostBroadphaseCallback:function(n,t){if(this.postBroadphaseCallback=n,this.callbackContext=t,n!==null)this.world.on("postBroadphase",this.postBroadphaseHandler,this);else this.world.off("postBroadphase",this.postBroadphaseHandler,this)},postBroadphaseHandler:function(n){var t=n.pairs.length;if(this.postBroadphaseCallback&&t>0)while(t-=2)n.pairs[t].parent&&n.pairs[t+1].parent&&!this.postBroadphaseCallback.call(this.callbackContext,n.pairs[t].parent,n.pairs[t+1].parent)&&n.pairs.splice(t,2)},impactHandler:function(n){if(n.bodyA.parent&&n.bodyB.parent){var t=n.bodyA.parent,i=n.bodyB.parent;t._bodyCallbacks[n.bodyB.id]&&t._bodyCallbacks[n.bodyB.id].call(t._bodyCallbackContext[n.bodyB.id],t,i,n.shapeA,n.shapeB);i._bodyCallbacks[n.bodyA.id]&&i._bodyCallbacks[n.bodyA.id].call(i._bodyCallbackContext[n.bodyA.id],i,t,n.shapeB,n.shapeA);t._groupCallbacks[n.shapeB.collisionGroup]&&t._groupCallbacks[n.shapeB.collisionGroup].call(t._groupCallbackContext[n.shapeB.collisionGroup],t,i,n.shapeA,n.shapeB);i._groupCallbacks[n.shapeA.collisionGroup]&&i._groupCallbacks[n.shapeA.collisionGroup].call(i._groupCallbackContext[n.shapeA.collisionGroup],i,t,n.shapeB,n.shapeA)}},beginContactHandler:function(n){this.onBeginContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB,n.contactEquations);n.bodyA.parent&&n.bodyA.parent.onBeginContact.dispatch(n.bodyB.parent,n.shapeA,n.shapeB,n.contactEquations);n.bodyB.parent&&n.bodyB.parent.onBeginContact.dispatch(n.bodyA.parent,n.shapeB,n.shapeA,n.contactEquations)},endContactHandler:function(n){this.onEndContact.dispatch(n.bodyA,n.bodyB,n.shapeA,n.shapeB);n.bodyA.parent&&n.bodyA.parent.onEndContact.dispatch(n.bodyB.parent,n.shapeA,n.shapeB);n.bodyB.parent&&n.bodyB.parent.onEndContact.dispatch(n.bodyA.parent,n.shapeB,n.shapeA)},setBoundsToWorld:function(n,t,i,r,u){this.setBounds(this.game.world.bounds.x,this.game.world.bounds.y,this.game.world.bounds.width,this.game.world.bounds.height,n,t,i,r,u)},setWorldMaterial:function(n,t,i,r,u){typeof t=="undefined"&&(t=!0);typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=!0);t&&this.walls.left&&(this.walls.left.shapes[0].material=n);i&&this.walls.right&&(this.walls.right.shapes[0].material=n);r&&this.walls.top&&(this.walls.top.shapes[0].material=n);u&&this.walls.bottom&&(this.walls.bottom.shapes[0].material=n)},updateBoundsCollisionGroup:function(n){var t=this.everythingCollisionGroup.mask;typeof n=="undefined"&&(t=this.boundsCollisionGroup.mask);this.walls.left&&(this.walls.left.shapes[0].collisionGroup=t);this.walls.right&&(this.walls.right.shapes[0].collisionGroup=t);this.walls.top&&(this.walls.top.shapes[0].collisionGroup=t);this.walls.bottom&&(this.walls.bottom.shapes[0].collisionGroup=t)},setBounds:function(n,t,i,r,u,f,e,o,s){typeof u=="undefined"&&(u=!0);typeof f=="undefined"&&(f=!0);typeof e=="undefined"&&(e=!0);typeof o=="undefined"&&(o=!0);typeof s=="undefined"&&(s=!0);this.walls.left&&this.world.removeBody(this.walls.left);this.walls.right&&this.world.removeBody(this.walls.right);this.walls.top&&this.world.removeBody(this.walls.top);this.walls.bottom&&this.world.removeBody(this.walls.bottom);u&&(this.walls.left=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t)],angle:1.5707963267948966}),this.walls.left.addShape(new p2.Plane),s&&(this.walls.left.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.left));f&&(this.walls.right=new p2.Body({mass:0,position:[this.pxmi(n+i),this.pxmi(t)],angle:-1.5707963267948966}),this.walls.right.addShape(new p2.Plane),s&&(this.walls.right.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.right));e&&(this.walls.top=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t)],angle:-3.1415926535897931}),this.walls.top.addShape(new p2.Plane),s&&(this.walls.top.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.top));o&&(this.walls.bottom=new p2.Body({mass:0,position:[this.pxmi(n),this.pxmi(t+r)]}),this.walls.bottom.addShape(new p2.Plane),s&&(this.walls.bottom.shapes[0].collisionGroup=this.boundsCollisionGroup.mask),this.world.addBody(this.walls.bottom))},pause:function(){this.paused=!0},resume:function(){this.paused=!1},update:function(){this.paused||(this.useElapsedTime?this.world.step(this.game.time.physicsElapsed):this.world.step(this.frameRate))},clear:function(){this.world.clear();this.world.off("beginContact",this.beginContactHandler,this);this.world.off("endContact",this.endContactHandler,this);this.postBroadphaseCallback=null;this.callbackContext=null;this.impactCallback=null;this.collisionGroups=[];this._toRemove=[];this._collisionGroupID=2;this.boundsCollidesWith=[]},destroy:function(){this.clear();this.game=null},addBody:function(n){return n.data.world?!1:(this.world.addBody(n.data),this.onBodyAdded.dispatch(n),!0)},removeBody:function(n){return n.data.world==this.world&&(this.world.removeBody(n.data),this.onBodyRemoved.dispatch(n)),n},addSpring:function(n){return n instanceof Phaser.Physics.P2.Spring||n instanceof Phaser.Physics.P2.RotationalSpring?this.world.addSpring(n.data):this.world.addSpring(n),this.onSpringAdded.dispatch(n),n},removeSpring:function(n){return n instanceof Phaser.Physics.P2.Spring||n instanceof Phaser.Physics.P2.RotationalSpring?this.world.removeSpring(n.data):this.world.removeSpring(n),this.onSpringRemoved.dispatch(n),n},createDistanceConstraint:function(n,t,i,r,u,f){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addConstraint(new Phaser.Physics.P2.DistanceConstraint(this,n,t,i,r,u,f));console.warn("Cannot create Constraint, invalid body objects given")},createGearConstraint:function(n,t,i,r){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addConstraint(new Phaser.Physics.P2.GearConstraint(this,n,t,i,r));console.warn("Cannot create Constraint, invalid body objects given")},createRevoluteConstraint:function(n,t,i,r,u,f){if(n=this.getBody(n),i=this.getBody(i),n&&i)return this.addConstraint(new Phaser.Physics.P2.RevoluteConstraint(this,n,t,i,r,u,f));console.warn("Cannot create Constraint, invalid body objects given")},createLockConstraint:function(n,t,i,r,u){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addConstraint(new Phaser.Physics.P2.LockConstraint(this,n,t,i,r,u));console.warn("Cannot create Constraint, invalid body objects given")},createPrismaticConstraint:function(n,t,i,r,u,f,e){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addConstraint(new Phaser.Physics.P2.PrismaticConstraint(this,n,t,i,r,u,f,e));console.warn("Cannot create Constraint, invalid body objects given")},addConstraint:function(n){return this.world.addConstraint(n),this.onConstraintAdded.dispatch(n),n},removeConstraint:function(n){return this.world.removeConstraint(n),this.onConstraintRemoved.dispatch(n),n},addContactMaterial:function(n){return this.world.addContactMaterial(n),this.onContactMaterialAdded.dispatch(n),n},removeContactMaterial:function(n){return this.world.removeContactMaterial(n),this.onContactMaterialRemoved.dispatch(n),n},getContactMaterial:function(n,t){return this.world.getContactMaterial(n,t)},setMaterial:function(n,t){for(var i=t.length;i--;)t[i].setMaterial(n)},createMaterial:function(n,t){n=n||"";var i=new Phaser.Physics.P2.Material(n);return this.materials.push(i),typeof t!="undefined"&&t.setMaterial(i),i},createContactMaterial:function(n,t,i){typeof n=="undefined"&&(n=this.createMaterial());typeof t=="undefined"&&(t=this.createMaterial());var r=new Phaser.Physics.P2.ContactMaterial(n,t,i);return this.addContactMaterial(r)},getBodies:function(){for(var n=[],t=this.world.bodies.length;t--;)n.push(this.world.bodies[t].parent);return n},getBody:function(n){return n instanceof p2.Body?n:n instanceof Phaser.Physics.P2.Body?n.data:n.body&&n.body.type===Phaser.Physics.P2JS?n.body.data:null},getSprings:function(){for(var n=[],t=this.world.springs.length;t--;)n.push(this.world.springs[t].parent);return n},getConstraints:function(){for(var n=[],t=this.world.constraints.length;t--;)n.push(this.world.constraints[t].parent);return n},hitTest:function(n,t,i,r){typeof t=="undefined"&&(t=this.world.bodies);typeof i=="undefined"&&(i=5);typeof r=="undefined"&&(r=!1);for(var e=[this.pxmi(n.x),this.pxmi(n.y)],f=[],u=t.length;u--;)t[u]instanceof Phaser.Physics.P2.Body&&!(r&&t[u].data.type===p2.Body.STATIC)?f.push(t[u].data):t[u]instanceof p2.Body&&t[u].parent&&!(r&&t[u].type===p2.Body.STATIC)?f.push(t[u]):t[u]instanceof Phaser.Sprite&&t[u].hasOwnProperty("body")&&!(r&&t[u].body.data.type===p2.Body.STATIC)&&f.push(t[u].body.data);return this.world.hitTest(e,f,i)},toJSON:function(){return this.world.toJSON()},createCollisionGroup:function(n){var t=Math.pow(2,this._collisionGroupID),i;return this.walls.left&&(this.walls.left.shapes[0].collisionMask=this.walls.left.shapes[0].collisionMask|t),this.walls.right&&(this.walls.right.shapes[0].collisionMask=this.walls.right.shapes[0].collisionMask|t),this.walls.top&&(this.walls.top.shapes[0].collisionMask=this.walls.top.shapes[0].collisionMask|t),this.walls.bottom&&(this.walls.bottom.shapes[0].collisionMask=this.walls.bottom.shapes[0].collisionMask|t),this._collisionGroupID++,i=new Phaser.Physics.P2.CollisionGroup(t),this.collisionGroups.push(i),n&&this.setCollisionGroup(n,i),i},setCollisionGroup:function(n,t){if(n instanceof Phaser.Group)for(var i=0;i<n.total;i++)n.children[i].body&&n.children[i].body.type===Phaser.Physics.P2JS&&n.children[i].body.setCollisionGroup(t);else n.body.setCollisionGroup(t)},createSpring:function(n,t,i,r,u,f,e,o,s){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addSpring(new Phaser.Physics.P2.Spring(this,n,t,i,r,u,f,e,o,s));console.warn("Cannot create Spring, invalid body objects given")},createRotationalSpring:function(n,t,i,r,u){if(n=this.getBody(n),t=this.getBody(t),n&&t)return this.addSpring(new Phaser.Physics.P2.RotationalSpring(this,n,t,i,r,u));console.warn("Cannot create Rotational Spring, invalid body objects given")},createBody:function(n,t,i,r,u,f){var e,o;return(typeof r=="undefined"&&(r=!1),e=new Phaser.Physics.P2.Body(this.game,null,n,t,i),f&&(o=e.addPolygon(u,f),!o))?!1:(r&&this.world.addBody(e.data),e)},createParticle:function(n,t,i,r,u,f){var e,o;return(typeof r=="undefined"&&(r=!1),e=new Phaser.Physics.P2.Body(this.game,null,n,t,i),f&&(o=e.addPolygon(u,f),!o))?!1:(r&&this.world.addBody(e.data),e)},convertCollisionObjects:function(n,t,i){var f,r,o,u,e;for(typeof i=="undefined"&&(i=!0),f=[],r=0,o=n.collision[t].length;r<o;r++)u=n.collision[t][r],e=this.createBody(u.x,u.y,0,i,{},u.polyline),e&&f.push(e);return f},clearTilemapLayerBodies:function(n,t){t=n.getLayer(t);for(var i=n.layers[t].bodies.length;i--;)n.layers[t].bodies[i].destroy();n.layers[t].bodies.length=0},convertTilemap:function(n,t,i,r){var o,a,s,v,u,h,f;t=n.getLayer(t);typeof i=="undefined"&&(i=!0);typeof r=="undefined"&&(r=!0);this.clearTilemapLayerBodies(n,t);var e=0,c=0,l=0;for(o=0,a=n.layers[t].height;o<a;o++)for(e=0,s=0,v=n.layers[t].width;s<v;s++)u=n.layers[t].data[o][s],u&&u.index>-1&&u.collides&&(r?(h=n.getTileRight(t,s,o),e===0&&(c=u.x*u.width,l=u.y*u.height,e=u.width),h&&h.collides?e+=u.width:(f=this.createBody(c,l,0,!1),f.addRectangle(e,u.height,e/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f),e=0)):(f=this.createBody(u.x*u.width,u.y*u.height,0,!1),f.addRectangle(u.width,u.height,u.width/2,u.height/2,0),i&&this.addBody(f),n.layers[t].bodies.push(f)));return n.layers[t].bodies},mpx:function(n){return n*20},pxm:function(n){return n*.05},mpxi:function(n){return n*-20},pxmi:function(n){return n*-.05}};Object.defineProperty(Phaser.Physics.P2.prototype,"friction",{get:function(){return this.world.defaultContactMaterial.friction},set:function(n){this.world.defaultContactMaterial.friction=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"restitution",{get:function(){return this.world.defaultContactMaterial.restitution},set:function(n){this.world.defaultContactMaterial.restitution=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"contactMaterial",{get:function(){return this.world.defaultContactMaterial},set:function(n){this.world.defaultContactMaterial=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"applySpringForces",{get:function(){return this.world.applySpringForces},set:function(n){this.world.applySpringForces=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyDamping",{get:function(){return this.world.applyDamping},set:function(n){this.world.applyDamping=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"applyGravity",{get:function(){return this.world.applyGravity},set:function(n){this.world.applyGravity=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"solveConstraints",{get:function(){return this.world.solveConstraints},set:function(n){this.world.solveConstraints=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"time",{get:function(){return this.world.time}});Object.defineProperty(Phaser.Physics.P2.prototype,"emitImpactEvent",{get:function(){return this.world.emitImpactEvent},set:function(n){this.world.emitImpactEvent=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"sleepMode",{get:function(){return this.world.sleepMode},set:function(n){this.world.sleepMode=n}});Object.defineProperty(Phaser.Physics.P2.prototype,"total",{get:function(){return this.world.bodies.length}});
/**
* @author       Georgios Kaleadis https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.FixtureList=function(n){Array.isArray(n)||(n=[n]);this.rawList=n;this.init();this.parse(this.rawList)};Phaser.Physics.P2.FixtureList.prototype={init:function(){this.namedFixtures={};this.groupedFixtures=[];this.allFixtures=[]},setCategory:function(n,t){var i=function(t){t.collisionGroup=n};this.getFixtures(t).forEach(i)},setMask:function(n,t){var i=function(t){t.collisionMask=n};this.getFixtures(t).forEach(i)},setSensor:function(n,t){var i=function(t){t.sensor=n};this.getFixtures(t).forEach(i)},setMaterial:function(n,t){var i=function(t){t.material=n};this.getFixtures(t).forEach(i)},getFixtures:function(n){var i=[],t;return n?(n instanceof Array||(n=[n]),t=this,n.forEach(function(n){t.namedFixtures[n]&&i.push(t.namedFixtures[n])}),this.flatten(i)):this.allFixtures},getFixtureByKey:function(n){return this.namedFixtures[n]},getGroup:function(n){return this.groupedFixtures[n]},parse:function(){var n,t,i,r;i=this.rawList;r=[];for(n in i)t=i[n],isNaN(+n)?this.namedFixtures[n]=this.flatten(t):(this.groupedFixtures[n]=this.groupedFixtures[n]||[],this.groupedFixtures[n]=this.groupedFixtures[n].concat(t)),r.push(this.allFixtures=this.flatten(this.groupedFixtures))},flatten:function(n){var t,i;return t=[],i=arguments.callee,n.forEach(function(n){return Array.prototype.push.apply(t,Array.isArray(n)?i(n):[n])}),t}};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.PointProxy=function(n,t){this.world=n;this.destination=t};Phaser.Physics.P2.PointProxy.prototype.constructor=Phaser.Physics.P2.PointProxy;Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"x",{get:function(){return this.world.mpx(this.destination[0])},set:function(n){this.destination[0]=this.world.pxm(n)}});Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"y",{get:function(){return this.world.mpx(this.destination[1])},set:function(n){this.destination[1]=this.world.pxm(n)}});Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=n}});Object.defineProperty(Phaser.Physics.P2.PointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.InversePointProxy=function(n,t){this.world=n;this.destination=t};Phaser.Physics.P2.InversePointProxy.prototype.constructor=Phaser.Physics.P2.InversePointProxy;Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"x",{get:function(){return this.world.mpxi(this.destination[0])},set:function(n){this.destination[0]=this.world.pxmi(n)}});Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"y",{get:function(){return this.world.mpxi(this.destination[1])},set:function(n){this.destination[1]=this.world.pxmi(n)}});Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"mx",{get:function(){return this.destination[0]},set:function(n){this.destination[0]=-n}});Object.defineProperty(Phaser.Physics.P2.InversePointProxy.prototype,"my",{get:function(){return this.destination[1]},set:function(n){this.destination[1]=-n}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.Body=function(n,t,i,r,u){t=t||null;i=i||0;r=r||0;typeof u=="undefined"&&(u=1);this.game=n;this.world=n.physics.p2;this.sprite=t;this.type=Phaser.Physics.P2JS;this.offset=new Phaser.Point;this.data=new p2.Body({position:[this.world.pxmi(i),this.world.pxmi(r)],mass:u});this.data.parent=this;this.velocity=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.velocity);this.force=new Phaser.Physics.P2.InversePointProxy(this.world,this.data.force);this.gravity=new Phaser.Point;this.onBeginContact=new Phaser.Signal;this.onEndContact=new Phaser.Signal;this.collidesWith=[];this.removeNextStep=!1;this.debugBody=null;this._collideWorldBounds=!0;this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};t&&(this.setRectangleFromSprite(t),t.exists&&this.game.physics.p2.addBody(this))};Phaser.Physics.P2.Body.prototype={createBodyCallback:function(n,t,i){var r=-1;n.id?r=n.id:n.body&&(r=n.body.id);r>-1&&(t===null?(delete this._bodyCallbacks[r],delete this._bodyCallbackContext[r]):(this._bodyCallbacks[r]=t,this._bodyCallbackContext[r]=i))},createGroupCallback:function(n,t,i){t===null?(delete this._groupCallbacks[n.mask],delete this._groupCallbacksContext[n.mask]):(this._groupCallbacks[n.mask]=t,this._groupCallbackContext[n.mask]=i)},getCollisionMask:function(){var n=0,t;for(this._collideWorldBounds&&(n=this.game.physics.p2.boundsCollisionGroup.mask),t=0;t<this.collidesWith.length;t++)n=n|this.collidesWith[t].mask;return n},updateCollisionMask:function(n){var i=this.getCollisionMask(),t;if(typeof n=="undefined")for(t=this.data.shapes.length-1;t>=0;t--)this.data.shapes[t].collisionMask=i;else n.collisionMask=i},setCollisionGroup:function(n,t){var r=this.getCollisionMask(),i;if(typeof t=="undefined")for(i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].collisionGroup=n.mask,this.data.shapes[i].collisionMask=r;else t.collisionGroup=n.mask,t.collisionMask=r},clearCollision:function(n,t,i){if(typeof i=="undefined")for(var r=this.data.shapes.length-1;r>=0;r--)n&&(this.data.shapes[r].collisionGroup=null),t&&(this.data.shapes[r].collisionMask=null);else n&&(i.collisionGroup=null),t&&(i.collisionMask=null);n&&(this.collidesWith.length=0)},collides:function(n,t,i,r){var f,u;if(Array.isArray(n))for(u=0;u<n.length;u++)this.collidesWith.indexOf(n[u])===-1&&(this.collidesWith.push(n[u]),t&&this.createGroupCallback(n[u],t,i));else this.collidesWith.indexOf(n)===-1&&(this.collidesWith.push(n),t&&this.createGroupCallback(n,t,i));if(f=this.getCollisionMask(),typeof r=="undefined")for(u=this.data.shapes.length-1;u>=0;u--)this.data.shapes[u].collisionMask=f;else r.collisionMask=f},adjustCenterOfMass:function(){this.data.adjustCenterOfMass()},applyDamping:function(n){this.data.applyDamping(n)},applyForce:function(n,t,i){this.data.applyForce(n,[this.world.pxmi(t),this.world.pxmi(i)])},setZeroForce:function(){this.data.setZeroForce()},setZeroRotation:function(){this.data.angularVelocity=0},setZeroVelocity:function(){this.data.velocity[0]=0;this.data.velocity[1]=0},setZeroDamping:function(){this.data.damping=0;this.data.angularDamping=0},toLocalFrame:function(n,t){return this.data.toLocalFrame(n,t)},toWorldFrame:function(n,t){return this.data.toWorldFrame(n,t)},rotateLeft:function(n){this.data.angularVelocity=this.world.pxm(-n)},rotateRight:function(n){this.data.angularVelocity=this.world.pxm(n)},moveForward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=t*Math.cos(i);this.data.velocity[1]=t*Math.sin(i)},moveBackward:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.velocity[0]=-(t*Math.cos(i));this.data.velocity[1]=-(t*Math.sin(i))},thrust:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]+=t*Math.cos(i);this.data.force[1]+=t*Math.sin(i)},reverse:function(n){var t=this.world.pxmi(-n),i=this.data.angle+Math.PI/2;this.data.force[0]-=t*Math.cos(i);this.data.force[1]-=t*Math.sin(i)},moveLeft:function(n){this.data.velocity[0]=this.world.pxmi(-n)},moveRight:function(n){this.data.velocity[0]=this.world.pxmi(n)},moveUp:function(n){this.data.velocity[1]=this.world.pxmi(-n)},moveDown:function(n){this.data.velocity[1]=this.world.pxmi(n)},preUpdate:function(){this.removeNextStep&&(this.removeFromWorld(),this.removeNextStep=!1)},postUpdate:function(){this.sprite.x=this.world.mpxi(this.data.position[0]);this.sprite.y=this.world.mpxi(this.data.position[1]);this.fixedRotation||(this.sprite.rotation=this.data.angle)},reset:function(n,t,i,r){typeof i=="undefined"&&(i=!1);typeof r=="undefined"&&(r=!1);this.setZeroForce();this.setZeroVelocity();this.setZeroRotation();i&&this.setZeroDamping();r&&(this.mass=1);this.x=n;this.y=t},addToWorld:function(){if(this.game.physics.p2._toRemove)for(var n=0;n<this.game.physics.p2._toRemove.length;n++)this.game.physics.p2._toRemove[n]===this&&this.game.physics.p2._toRemove.splice(n,1);this.data.world!==this.game.physics.p2.world&&this.game.physics.p2.addBody(this)},removeFromWorld:function(){this.data.world===this.game.physics.p2.world&&this.game.physics.p2.removeBodyNextStep(this)},destroy:function(){this.removeFromWorld();this.clearShapes();this._bodyCallbacks={};this._bodyCallbackContext={};this._groupCallbacks={};this._groupCallbackContext={};this.debugBody&&this.debugBody.destroy();this.debugBody=null;this.sprite.body=null;this.sprite=null},clearShapes:function(){for(var n=this.data.shapes.length;n--;)this.data.removeShape(this.data.shapes[n]);this.shapeChanged()},addShape:function(n,t,i,r){return typeof t=="undefined"&&(t=0),typeof i=="undefined"&&(i=0),typeof r=="undefined"&&(r=0),this.data.addShape(n,[this.world.pxmi(t),this.world.pxmi(i)],r),this.shapeChanged(),n},addCircle:function(n,t,i,r){var u=new p2.Circle(this.world.pxm(n));return this.addShape(u,t,i,r)},addRectangle:function(n,t,i,r,u){var f=new p2.Rectangle(this.world.pxm(n),this.world.pxm(t));return this.addShape(f,i,r,u)},addPlane:function(n,t,i){var r=new p2.Plane;return this.addShape(r,n,t,i)},addParticle:function(n,t,i){var r=new p2.Particle;return this.addShape(r,n,t,i)},addLine:function(n,t,i,r){var u=new p2.Line(this.world.pxm(n));return this.addShape(u,t,i,r)},addCapsule:function(n,t,i,r,u){var f=new p2.Capsule(this.world.pxm(n),this.world.pxm(t));return this.addShape(f,i,r,u)},addPolygon:function(n,t){var i,u,e,f,r,o;if(n=n||{},Array.isArray(t)||(t=Array.prototype.slice.call(arguments,1)),i=[],t.length===1&&Array.isArray(t[0]))i=t[0].slice(0);else if(Array.isArray(t[0]))i=t.slice();else if(typeof t[0]=="number")for(u=0,e=t.length;u<e;u+=2)i.push([t[u],t[u+1]]);for(f=i.length-1,i[f][0]===i[0][0]&&i[f][1]===i[0][1]&&i.pop(),r=0;r<i.length;r++)i[r][0]=this.world.pxmi(i[r][0]),i[r][1]=this.world.pxmi(i[r][1]);return o=this.data.fromPolygon(i,n),this.shapeChanged(),o},removeShape:function(n){var t=this.data.removeShape(n);return this.shapeChanged(),t},setCircle:function(n,t,i,r){return this.clearShapes(),this.addCircle(n,t,i,r)},setRectangle:function(n,t,i,r,u){return typeof n=="undefined"&&(n=16),typeof t=="undefined"&&(t=16),this.clearShapes(),this.addRectangle(n,t,i,r,u)},setRectangleFromSprite:function(n){return typeof n=="undefined"&&(n=this.sprite),this.clearShapes(),this.addRectangle(n.width,n.height,0,0,n.rotation)},setMaterial:function(n,t){if(typeof t=="undefined")for(var i=this.data.shapes.length-1;i>=0;i--)this.data.shapes[i].material=n;else t.material=n},shapeChanged:function(){this.debugBody&&this.debugBody.draw()},addPhaserPolygon:function(n,t){for(var i,f,e=this.game.cache.getPhysicsData(n,t),r=[],u=0;u<e.length;u++)i=e[u],f=this.addFixture(i),r[i.filter.group]=r[i.filter.group]||[],r[i.filter.group]=r[i.filter.group].concat(f),i.fixtureKey&&(r[i.fixtureKey]=f);return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),r},addFixture:function(n){var s=[],u,h,i,f,e,c,r,t,o,l;if(n.circle)t=new p2.Circle(this.world.pxm(n.circle.radius)),t.collisionGroup=n.filter.categoryBits,t.collisionMask=n.filter.maskBits,t.sensor=n.isSensor,u=p2.vec2.create(),u[0]=this.world.pxmi(n.circle.position[0]-this.sprite.width/2),u[1]=this.world.pxmi(n.circle.position[1]-this.sprite.height/2),this.data.addShape(t,u),s.push(t);else for(h=n.polygons,i=p2.vec2.create(),f=0;f<h.length;f++){for(e=h[f],c=[],r=0;r<e.length;r+=2)c.push([this.world.pxmi(e[r]),this.world.pxmi(e[r+1])]);for(t=new p2.Convex(c),o=0;o!==t.vertices.length;o++)l=t.vertices[o],p2.vec2.sub(l,l,t.centerOfMass);p2.vec2.scale(i,t.centerOfMass,1);i[0]-=this.world.pxmi(this.sprite.width/2);i[1]-=this.world.pxmi(this.sprite.height/2);t.updateTriangles();t.updateCenterOfMass();t.updateBoundingRadius();t.collisionGroup=n.filter.categoryBits;t.collisionMask=n.filter.maskBits;t.sensor=n.isSensor;this.data.addShape(t,i);s.push(t)}return s},loadPolygon:function(n,t){for(var s,u,i,o,h,f=this.game.cache.getPhysicsData(n,t),e=p2.vec2.create(),r=0;r<f.length;r++){for(s=[],u=0;u<f[r].shape.length;u+=2)s.push([this.world.pxmi(f[r].shape[u]),this.world.pxmi(f[r].shape[u+1])]);for(i=new p2.Convex(s),o=0;o!==i.vertices.length;o++)h=i.vertices[o],p2.vec2.sub(h,h,i.centerOfMass);p2.vec2.scale(e,i.centerOfMass,1);e[0]-=this.world.pxmi(this.sprite.width/2);e[1]-=this.world.pxmi(this.sprite.height/2);i.updateTriangles();i.updateCenterOfMass();i.updateBoundingRadius();this.data.addShape(i,e)}return this.data.aabbNeedsUpdate=!0,this.shapeChanged(),!0}};Phaser.Physics.P2.Body.prototype.constructor=Phaser.Physics.P2.Body;Phaser.Physics.P2.Body.DYNAMIC=1;Phaser.Physics.P2.Body.STATIC=2;Phaser.Physics.P2.Body.KINEMATIC=4;Object.defineProperty(Phaser.Physics.P2.Body.prototype,"static",{get:function(){return this.data.type===Phaser.Physics.P2.Body.STATIC},set:function(n){n&&this.data.type!==Phaser.Physics.P2.Body.STATIC?(this.data.type=Phaser.Physics.P2.Body.STATIC,this.mass=0):n||this.data.type!==Phaser.Physics.P2.Body.STATIC||(this.data.type=Phaser.Physics.P2.Body.DYNAMIC,this.mass===0&&(this.mass=1))}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"dynamic",{get:function(){return this.data.type===Phaser.Physics.P2.Body.DYNAMIC},set:function(n){n&&this.data.type!==Phaser.Physics.P2.Body.DYNAMIC?(this.data.type=Phaser.Physics.P2.Body.DYNAMIC,this.mass===0&&(this.mass=1)):n||this.data.type!==Phaser.Physics.P2.Body.DYNAMIC||(this.data.type=Phaser.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"kinematic",{get:function(){return this.data.type===Phaser.Physics.P2.Body.KINEMATIC},set:function(n){n&&this.data.type!==Phaser.Physics.P2.Body.KINEMATIC?(this.data.type=Phaser.Physics.P2.Body.KINEMATIC,this.mass=4):n||this.data.type!==Phaser.Physics.P2.Body.KINEMATIC||(this.data.type=Phaser.Physics.P2.Body.STATIC,this.mass=0)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"allowSleep",{get:function(){return this.data.allowSleep},set:function(n){n!==this.data.allowSleep&&(this.data.allowSleep=n)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angle",{get:function(){return Phaser.Math.wrapAngle(Phaser.Math.radToDeg(this.data.angle))},set:function(n){this.data.angle=Phaser.Math.degToRad(Phaser.Math.wrapAngle(n))}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularDamping",{get:function(){return this.data.angularDamping},set:function(n){this.data.angularDamping=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularForce",{get:function(){return this.data.angularForce},set:function(n){this.data.angularForce=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"angularVelocity",{get:function(){return this.data.angularVelocity},set:function(n){this.data.angularVelocity=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"damping",{get:function(){return this.data.damping},set:function(n){this.data.damping=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"fixedRotation",{get:function(){return this.data.fixedRotation},set:function(n){n!==this.data.fixedRotation&&(this.data.fixedRotation=n)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"inertia",{get:function(){return this.data.inertia},set:function(n){this.data.inertia=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"mass",{get:function(){return this.data.mass},set:function(n){n!==this.data.mass&&(this.data.mass=n,this.data.updateMassProperties())}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"motionState",{get:function(){return this.data.type},set:function(n){n!==this.data.type&&(this.data.type=n)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"rotation",{get:function(){return this.data.angle},set:function(n){this.data.angle=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"sleepSpeedLimit",{get:function(){return this.data.sleepSpeedLimit},set:function(n){this.data.sleepSpeedLimit=n}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"x",{get:function(){return this.world.mpxi(this.data.position[0])},set:function(n){this.data.position[0]=this.world.pxmi(n)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"y",{get:function(){return this.world.mpxi(this.data.position[1])},set:function(n){this.data.position[1]=this.world.pxmi(n)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"id",{get:function(){return this.data.id}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"debug",{get:function(){return this.debugBody!==null},set:function(n){n&&!this.debugBody?this.debugBody=new Phaser.Physics.P2.BodyDebug(this.game,this.data):!n&&this.debugBody&&(this.debugBody.destroy(),this.debugBody=null)}});Object.defineProperty(Phaser.Physics.P2.Body.prototype,"collideWorldBounds",{get:function(){return this._collideWorldBounds},set:function(n){n&&!this._collideWorldBounds?(this._collideWorldBounds=!0,this.updateCollisionMask()):!n&&this._collideWorldBounds&&(this._collideWorldBounds=!1,this.updateCollisionMask())}});
/**
* @author       George https://github.com/georgiee
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.BodyDebug=function(n,t,i){Phaser.Group.call(this,n);this.settings=Phaser.Utils.extend({pixelsPerLengthUnit:20,debugPolygons:!1,lineWidth:1,alpha:.5},i);this.ppu=this.settings.pixelsPerLengthUnit;this.ppu=-1*this.ppu;this.body=t;this.canvas=new Phaser.Graphics(n);this.canvas.alpha=this.settings.alpha;this.add(this.canvas);this.draw()};Phaser.Physics.P2.BodyDebug.prototype=Object.create(Phaser.Group.prototype);Phaser.Physics.P2.BodyDebug.prototype.constructor=Phaser.Physics.P2.BodyDebug;Phaser.Utils.extend(Phaser.Physics.P2.BodyDebug.prototype,{update:function(){this.updateSpriteTransform()},updateSpriteTransform:function(){return this.position.x=this.body.position[0]*this.ppu,this.position.y=this.body.position[1]*this.ppu,this.rotation=this.body.angle},draw:function(){var r,n,o,e,a,s,i,u,t,f,y,v,l,h,c,p;if(u=this.body,f=this.canvas,f.clear(),o=parseInt(this.randomPastelHex(),16),s=16711680,i=this.lineWidth,u instanceof p2.Body&&u.shapes.length)for(p=u.shapes.length,e=0;e!==p;){if(n=u.shapes[e],t=u.shapeOffsets[e],r=u.shapeAngles[e],t=t||0,r=r||0,n instanceof p2.Circle)this.drawCircle(f,t[0]*this.ppu,t[1]*this.ppu,r,n.radius*this.ppu,o,i);else if(n instanceof p2.Convex){for(v=[],l=p2.vec2.create(),a=h=0,c=n.vertices.length;0<=c?h<c:h>c;a=0<=c?++h:--h)y=n.vertices[a],p2.vec2.rotate(l,y,r),v.push([(l[0]+t[0])*this.ppu,-(l[1]+t[1])*this.ppu]);this.drawConvex(f,v,n.triangles,s,o,i,this.settings.debugPolygons,[t[0]*this.ppu,-t[1]*this.ppu])}else n instanceof p2.Plane?this.drawPlane(f,t[0]*this.ppu,-t[1]*this.ppu,o,s,i*5,i*10,i*10,this.ppu*100,r):n instanceof p2.Line?this.drawLine(f,n.length*this.ppu,s,i):n instanceof p2.Rectangle&&this.drawRectangle(f,t[0]*this.ppu,-t[1]*this.ppu,r,n.width*this.ppu,n.height*this.ppu,s,o,i);e++}},drawRectangle:function(n,t,i,r,u,f,e,o,s){typeof s=="undefined"&&(s=1);typeof e=="undefined"&&(e=0);n.lineStyle(s,e,1);n.beginFill(o);n.drawRect(t-u/2,i-f/2,u,f)},drawCircle:function(n,t,i,r,u,f,e){typeof e=="undefined"&&(e=1);typeof f=="undefined"&&(f=16777215);n.lineStyle(e,0,1);n.beginFill(f,1);n.drawCircle(t,i,-u);n.endFill();n.moveTo(t,i);n.lineTo(t+u*Math.cos(-r),i+u*Math.sin(-r))},drawLine:function(n,t,i,r){typeof r=="undefined"&&(r=1);typeof i=="undefined"&&(i=0);n.lineStyle(r*5,i,1);n.moveTo(-t/2,0);n.lineTo(t/2,0)},drawConvex:function(n,t,i,r,u,f,e,o){var h,s,c,l,a,v,y,b,p,w,k;if(typeof f=="undefined"&&(f=1),typeof r=="undefined"&&(r=0),e){for(h=[16711680,65280,255],s=0;s!==t.length+1;)l=t[s%t.length],a=t[(s+1)%t.length],y=l[0],w=l[1],b=a[0],k=a[1],n.lineStyle(f,h[s%h.length],1),n.moveTo(y,-w),n.lineTo(b,-k),n.drawCircle(y,-w,f*2),s++;return n.lineStyle(f,0,1),n.drawCircle(o[0],o[1],f*2)}for(n.lineStyle(f,r,1),n.beginFill(u),s=0;s!==t.length;)c=t[s],v=c[0],p=c[1],s===0?n.moveTo(v,-p):n.lineTo(v,-p),s++;if(n.endFill(),t.length>2)return n.moveTo(t[t.length-1][0],-t[t.length-1][1]),n.lineTo(t[0][0],-t[0][1])},drawPath:function(n,t,i,r,u){var v,f,s,h,c,l,y,p,w,b,a,e,o;for(typeof u=="undefined"&&(u=1),typeof i=="undefined"&&(i=0),n.lineStyle(u,i,1),typeof r=="number"&&n.beginFill(r),s=null,h=null,f=0;f<t.length;)a=t[f],e=a[0],o=a[1],(e!==s||o!==h)&&(f===0?n.moveTo(e,o):(c=s,l=h,y=e,p=o,w=t[(f+1)%t.length][0],b=t[(f+1)%t.length][1],v=(y-c)*(b-l)-(w-c)*(p-l),v!==0&&n.lineTo(e,o)),s=e,h=o),f++;typeof r=="number"&&n.endFill();t.length>2&&typeof r=="number"&&(n.moveTo(t[t.length-1][0],t[t.length-1][1]),n.lineTo(t[0][0],t[0][1]))},drawPlane:function(n,t,i,r,u,f,e,o,s,h){var a,c,l;typeof f=="undefined"&&(f=1);typeof r=="undefined"&&(r=16777215);n.lineStyle(f,u,11);n.beginFill(r);a=s;n.moveTo(t,-i);c=t+Math.cos(h)*this.game.width;l=i+Math.sin(h)*this.game.height;n.lineTo(c,-l);n.moveTo(t,-i);c=t+Math.cos(h)*-this.game.width;l=i+Math.sin(h)*-this.game.height;n.lineTo(c,-l)},randomPastelHex:function(){var n,t,i,r;return i=[255,255,255],r=Math.floor(Math.random()*256),t=Math.floor(Math.random()*256),n=Math.floor(Math.random()*256),r=Math.floor((r+3*i[0])/4),t=Math.floor((t+3*i[1])/4),n=Math.floor((n+3*i[2])/4),this.rgbToHex(r,t,n)},rgbToHex:function(n,t,i){return this.componentToHex(n)+this.componentToHex(t)+this.componentToHex(i)},componentToHex:function(n){var t;return t=n.toString(16),t.len===2?t:t+"0"}});
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.Spring=function(n,t,i,r,u,f,e,o,s,h){this.game=n.game;this.world=n;typeof r=="undefined"&&(r=1);typeof u=="undefined"&&(u=100);typeof f=="undefined"&&(f=1);r=n.pxm(r);var c={restLength:r,stiffness:u,damping:f};typeof e!="undefined"&&e!==null&&(c.worldAnchorA=[n.pxm(e[0]),n.pxm(e[1])]);typeof o!="undefined"&&o!==null&&(c.worldAnchorB=[n.pxm(o[0]),n.pxm(o[1])]);typeof s!="undefined"&&s!==null&&(c.localAnchorA=[n.pxm(s[0]),n.pxm(s[1])]);typeof h!="undefined"&&h!==null&&(c.localAnchorB=[n.pxm(h[0]),n.pxm(h[1])]);this.data=new p2.LinearSpring(t,i,c);this.data.parent=this};Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.RotationalSpring=function(n,t,i,r,u,f){this.game=n.game;this.world=n;typeof r=="undefined"&&(r=null);typeof u=="undefined"&&(u=100);typeof f=="undefined"&&(f=1);r&&(r=n.pxm(r));var e={restAngle:r,stiffness:u,damping:f};this.data=new p2.RotationalSpring(t,i,e);this.data.parent=this};Phaser.Physics.P2.Spring.prototype.constructor=Phaser.Physics.P2.Spring;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.Material=function(n){this.name=n;p2.Material.call(this)};Phaser.Physics.P2.Material.prototype=Object.create(p2.Material.prototype);Phaser.Physics.P2.Material.prototype.constructor=Phaser.Physics.P2.Material;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.ContactMaterial=function(n,t,i){p2.ContactMaterial.call(this,n,t,i)};Phaser.Physics.P2.ContactMaterial.prototype=Object.create(p2.ContactMaterial.prototype);Phaser.Physics.P2.ContactMaterial.prototype.constructor=Phaser.Physics.P2.ContactMaterial;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.CollisionGroup=function(n){this.mask=n};
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.DistanceConstraint=function(n,t,i,r,u,f,e){typeof r=="undefined"&&(r=100);typeof u=="undefined"&&(u=[0,0]);typeof f=="undefined"&&(f=[0,0]);typeof e=="undefined"&&(e=Number.MAX_VALUE);this.game=n.game;this.world=n;r=n.pxm(r);u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var o={distance:r,localAnchorA:u,localAnchorB:f,maxForce:e};p2.DistanceConstraint.call(this,t,i,o)};Phaser.Physics.P2.DistanceConstraint.prototype=Object.create(p2.DistanceConstraint.prototype);Phaser.Physics.P2.DistanceConstraint.prototype.constructor=Phaser.Physics.P2.DistanceConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.GearConstraint=function(n,t,i,r,u){typeof r=="undefined"&&(r=0);typeof u=="undefined"&&(u=1);this.game=n.game;this.world=n;var f={angle:r,ratio:u};p2.GearConstraint.call(this,t,i,f)};Phaser.Physics.P2.GearConstraint.prototype=Object.create(p2.GearConstraint.prototype);Phaser.Physics.P2.GearConstraint.prototype.constructor=Phaser.Physics.P2.GearConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.LockConstraint=function(n,t,i,r,u,f){typeof r=="undefined"&&(r=[0,0]);typeof u=="undefined"&&(u=0);typeof f=="undefined"&&(f=Number.MAX_VALUE);this.game=n.game;this.world=n;r=[n.pxm(r[0]),n.pxm(r[1])];var e={localOffsetB:r,localAngleB:u,maxForce:f};p2.LockConstraint.call(this,t,i,e)};Phaser.Physics.P2.LockConstraint.prototype=Object.create(p2.LockConstraint.prototype);Phaser.Physics.P2.LockConstraint.prototype.constructor=Phaser.Physics.P2.LockConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.PrismaticConstraint=function(n,t,i,r,u,f,e,o){typeof r=="undefined"&&(r=!0);typeof u=="undefined"&&(u=[0,0]);typeof f=="undefined"&&(f=[0,0]);typeof e=="undefined"&&(e=[0,0]);typeof o=="undefined"&&(o=Number.MAX_VALUE);this.game=n.game;this.world=n;u=[n.pxmi(u[0]),n.pxmi(u[1])];f=[n.pxmi(f[0]),n.pxmi(f[1])];var s={localAnchorA:u,localAnchorB:f,localAxisA:e,maxForce:o,disableRotationalLock:!r};p2.PrismaticConstraint.call(this,t,i,s)};Phaser.Physics.P2.PrismaticConstraint.prototype=Object.create(p2.PrismaticConstraint.prototype);Phaser.Physics.P2.PrismaticConstraint.prototype.constructor=Phaser.Physics.P2.PrismaticConstraint;
/**
* @author       Richard Davey <rich@photonstorm.com>
* @copyright    2014 Photon Storm Ltd.
* @license      {@link https://github.com/photonstorm/phaser/blob/master/license.txt|MIT License}
*/
Phaser.Physics.P2.RevoluteConstraint=function(n,t,i,r,u,f,e){typeof f=="undefined"&&(f=Number.MAX_VALUE);typeof e=="undefined"&&(e=null);this.game=n.game;this.world=n;i=[n.pxmi(i[0]),n.pxmi(i[1])];u=[n.pxmi(u[0]),n.pxmi(u[1])];e&&(e=[n.pxmi(e[0]),n.pxmi(e[1])]);var o={worldPivot:e,localPivotA:i,localPivotB:u,maxForce:f};p2.RevoluteConstraint.call(this,t,r,o)};Phaser.Physics.P2.RevoluteConstraint.prototype=Object.create(p2.RevoluteConstraint.prototype);Phaser.Physics.P2.RevoluteConstraint.prototype.constructor=Phaser.Physics.P2.RevoluteConstraint;
/*
//# sourceMappingURL=phaser.min.js.map
*/